WKABTRN is currently running on Floradev Server. 
The goal is to move this database to wkabuat Server and re name to wkabtrg1

######################################################################################################################
1. Move wkabtrn to ARCHIVELOG MODE to run HOT BACKUP (completed !!!)
######################################################################################################################
2. Run HOT BACKUP (completed !!!)
  
   cd /workability/home/oracle/Scripts/

   ./nightly_jobs.ksh

   Output should be on: /u27/wkabtrn/Backup/


######################################################################################################################
3. ### Add oratab entry on wkabuat server (completed!!!)

 wkabtrg1:/workability/orabin/v920:Y:/workability
 
######################################################################################################################
4.  ### Modify server tnsnames.ora and listener.ora files to add new entry (completed!!!)
  TNSNAMES.ORA

 netstat -an|grep 1725


#################### listener.ora
 wkabtrg1 =
 (DESCRIPTION_LIST =
  (DESCRIPTION =
   (ADDRESS =
    (PROTOCOL = TCP)
    (HOST = wkabuat)
    (PORT = 1725)
    (queuesize=50)
   )
  )
 )
LOG_DIRECTORY_wkabtrg1 = /workability3/wkabtrg1/oracle/admin/network/log
TRACE_DIRECTORY_wkabtrg1 = /workability3/wkabtrg1/oracle/admin/network/trace
TRACE_FILE_wkabtrg1 = wkabtrg1.trc
TRACE_TIMESTAMP_wkabtrg1 = ON
#TRACE_LEVEL_wkabtrg1 = USER
#TRACE_LEVEL_wkabtrg1 = ADMIN
TRACE_LEVEL_wkabtrg1 = OFF
LOG_FILE_wkabtrg1 = wkabtrg1.log
STARTUP_WAIT_TIME_wkabtrg1 = 0
CONNECT_TIMEOUT_wkabtrg1 = 10
SID_LIST_wkabtrg1=
 (SID_LIST =
  (SID_DESC =
   (SDU = 8192)
   (TDU = 8192)
   (GLOBAL_DBNAME = wkabtrg1)
   (ORACLE_HOME = /workability/orabin/v920)
   (SID_NAME = wkabtrg1)
  )
 )

################ tnsnames.ora

WKABTRG1.WORLD =
 (DESCRIPTION =
  (ADDRESS = (PROTOCOL = TCP)(HOST = wkabuat)(PORT = 1725))
  (CONNECT_DATA = (SERVICE_NAME = wkabtrg1))
 )

######################################################################################################################
5. ### Create new directories for wkabtrg1 (completed !!!)

   /workability3/wkabtrg1/oracle/
   /workability3/wkabtrg1/oracle/admin
   /workability3/wkabtrg1/oracle/admin/adump
   /workability3/wkabtrg1/oracle/admin/bdump
   /workability3/wkabtrg1/oracle/admin/cdump
   /workability3/wkabtrg1/oracle/admin/udump
   /workability3/wkabtrg1/oracle/admin/create

   /workability3/wkabtrg1/oracle/admin/network
   /workability3/wkabtrg1/oracle/admin/network/log
   /workability3/wkabtrg1/oracle/admin/network/log/Archive
   /workability3/wkabtrg1/oracle/admin/network/trace
   

   /workability3/wkabtrg1/oracle/oradata
   
   /workability3/wkabtrg1/Backup
   /workability3/wkabtrg1/oraarch
   /workability3/wkabtrg1/Utl_File_Dir








######################################################################################################################
6.  Copy latest backups from wkabtrn (on Floradev) to wkabuat Server 
   
   
 
A.  --->Backup of control file (completed !!!)
   ssh to Floradev server
   login sqlplus
   alter database backup controlfile to trace;
   nohup scp -rp /workability/wkabtrn/oracle/admin/udump/wkabtrn_ora_2670704.trc wkabuat:/workability3/wkabtrg1/oracle/admin/create/createcontrol.sql
   Modify this file on wkabuat server

  

B.  --->Copy backup of archivelog files to wkabuat server and uncompress/untar (completed!!!)
    ssh to Floradev server
    cd 
    nohup scp -rp /u27/wkabtrn/Backup/08072008235001/archive_log_files.tar.Z wkabuat:/workability3/wkabtrg1/oraarch/archive_log_files.tar.Z
    
    ssh to WKABUAT server
    cd /workability3/wkabtrg1/oraarch
    uncompress *.Z
    gtar -xvf *.tar

C.   --->Create new orapwpassword  for wkabtrg1 database (completed!!!)
    
   
       cd $ORACLE_HOME/dbs
       orapwd file=$ORACLE_HOME/dbs/orapwwkabtrg1 password=no734 entries=20
    


D.  -->Copy  datafiles backupsets from floradev to wkabuat server and uncompress/untar (completed!!!)


    
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/beneng_data01.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/beneng_data01.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/ejsadmin01.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/ejsadmin01.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/beneng_index01.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/beneng_index01.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/fineos_data03.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/fineos_data03.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/fineos_data02.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/fineos_data02.dbf.Z 
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/fineos_data01.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/fineos_data01.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/logminer01.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/logminer01.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/fineos_index01.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/fineos_index01.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/tools01.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/tools01.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/users01.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/users01.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/undotbs01.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/undotbs01.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/wkab_data03.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/wkab_data03.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/wkab_data02.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/wkab_data02.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/wkab_data01.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/wkab_data01.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/wkab_index03.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/wkab_index03.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/wkab_index01.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/wkab_index01.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/wkab_lob01.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/wkab_lob01.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/wkab_index02.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/wkab_index02.dbf.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/temp01.tmp.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/temp01.tmp.Z
nohup scp -rp /u27/wkabtrn/Backup/08072008235001/Datafiles/system01.dbf.Z wkabuat:/workability3/wkabtrg1/oracle/oradata/system01.dbf.Z


    


    cd /workability3/wkabtrg1/oracle/oradata (completed!!!)

    uncompress beneng_data01.dbf.Z
    #gtar -xvf beneng_data01.dbf.tar
    #rm -f beneng_data01.dbf.tar

    uncompress ejsadmin01.dbf.Z
    #gtar -xvf ejsadmin01.dbf.tar
    #rm -f ejsadmin01.dbf.tar

    uncompress beneng_index01.dbf.Z
    #gtar -xvf beneng_index01.dbf.tar
    #rm -f beneng_index01.dbf.tar

    uncompress fineos_data03.dbf.Z
    #gtar -xvf fineos_data03.dbf.tar
    #rm -f fineos_data03.dbf.tar    

    uncompress fineos_data01.dbf.Z
    #gtar -xvf fineos_data01.dbf.tar
    #rm -f fineos_data01.dbf.tar

    uncompress fineos_data02.dbf.Z
    #gtar -xvf fineos_data02.dbf.tar
    #rm -f fineos_data02.dbf.tar


    uncompress fineos_index01.dbf.Z
    #gtar -xvf fineos_index01.dbf.tar
    #rm -f fineos_index01.dbf.tar  
  
  
    uncompress wkab_data02.dbf.Z
    #gtar -xvf wkab_data02.dbf.tar
    #rm -f wkab_data02.dbf.tar

    uncompress logminer01.dbf.Z
    #gtar -xvf logminer01.dbf.tar
    #rm -f logminer01.dbf.tar
   
    
    uncompress wkab_data03.dbf.Z
    #gtar -xvf wkab_data03.dbf.tar
    #rm -f wkab_data03.dbf.tar  

    uncompress system01.dbf.Z
    #gtar -xvf system01.dbf.tar
    #rm -f system01.dbf.tar  

    
 
    uncompress temp01.tmp.Z
    #gtar -xvf temp01.tmp.tar
    #rm -f temp01.tmp.tar 

    
    uncompress wkab_index01.dbf.Z
    #gtar -xvf wkab_index01.dbf.tar
    #rm -f wkab_index01.dbf.tar

    uncompress tools01.dbf.Z
    #gtar -xvf tools01.dbf.tar
    #rm -f tools01.dbf.tar

    
    uncompress wkab_index02.dbf.Z
    #gtar -xvf wkab_index02.dbf.tar
    #rm -f wkab_index02.dbf.tar


   
    uncompress undotbs01.dbf.Z
    #gtar -xvf undotbs01.dbf.tar
    #rm -f undotbs01.dbf.tar

    
    uncompress wkab_index03.dbf.Z
    #gtar -xvf wkab_index03.dbf.tar
    #rm -f wkab_index03.dbf.tar

    uncompress users01.dbf.Z
    #gtar -xvf users01.dbf.tar
    #rm -f users01.dbf.tar

    uncompress wkab_lob01.dbf.Z
    #gtar -xvf wkab_lob01.dbf.tar
    #rm -f wkab_lob01.dbf.tar

    
    uncompress wkab_data01.dbf.Z
    #gtar -xvf wkab_data01.dbf.tar
    #rm -f wkab_data01.dbf.tar

     

  
                       
E.   --->Copy init file to boraw1d server  (completed !!!)
    ssh to WKABUAT server
    nohup rcp -rp /workability/orabin/v920/dbs/initwkabtrn.ora wkabuat:/workability/orabin/v920/dbs/initwkabtrg1.ora
    

    Modify this file on wkabuat server


 
   
######################################################################################################################
10.    
       ssh to wkabuat server
       Make sure: . $SETUPENV wkabtrg1

       cd /workability3/wkabtrg1/oracle/admin/create

-- createcontrol.sql -------------------------------------------------
STARTUP NOMOUNT pfile=/workability/orabin/v920/dbs/initwkabtrg1.ora
CREATE CONTROLFILE SET DATABASE "WKABTRG1" RESETLOGS  ARCHIVELOG
    MAXLOGFILES 15
    MAXLOGMEMBERS 3
    MAXDATAFILES 200
    MAXINSTANCES 1
    MAXLOGHISTORY 25865
LOGFILE
  GROUP 1 (
    '/workability3/wkabtrg1/oracle/oradata/redo01a.log',
    '/workability3/wkabtrg1/oracle/oradata/redo01b.log'
  ) SIZE 5M,
  GROUP 2 (
    '/workability3/wkabtrg1/oracle/oradata/redo02a.log',
    '/workability3/wkabtrg1/oracle/oradata/redo02b.log'
  ) SIZE 5M,
  GROUP 3 (
    '/workability3/wkabtrg1/oracle/oradata/redo03a.log',
    '/workability3/wkabtrg1/oracle/oradata/redo03b.log'
  ) SIZE 5M,
  GROUP 4 (
    '/workability3/wkabtrg1/oracle/oradata/redo04a.log',
    '/workability3/wkabtrg1/oracle/oradata/redo04b.log'
  ) SIZE 5M,
  GROUP 5 (
    '/workability3/wkabtrg1/oracle/oradata/redo05a.log',
    '/workability3/wkabtrg1/oracle/oradata/redo05b.log'
  ) SIZE 5M,
  GROUP 6 (
    '/workability3/wkabtrg1/oracle/oradata/redo06a.log',
    '/workability3/wkabtrg1/oracle/oradata/redo06b.log'
STARTUP NOMOUNT pfile=/workability/orabin/v920/dbs/initwkabtrg1.ora
CREATE CONTROLFILE SET DATABASE "WKABTRG1" RESETLOGS  ARCHIVELOG
    MAXLOGFILES 15
    MAXLOGMEMBERS 3
    MAXDATAFILES 200
    MAXINSTANCES 1
    MAXLOGHISTORY 25865
LOGFILE
  GROUP 1 (
    '/workability3/wkabtrg1/oracle/oradata/redo01a.log',
    '/workability3/wkabtrg1/oracle/oradata/redo01b.log'
  ) SIZE 5M,
  GROUP 2 (
    '/workability3/wkabtrg1/oracle/oradata/redo02a.log',
    '/workability3/wkabtrg1/oracle/oradata/redo02b.log'
  ) SIZE 5M,
  GROUP 3 (
    '/workability3/wkabtrg1/oracle/oradata/redo03a.log',
    '/workability3/wkabtrg1/oracle/oradata/redo03b.log'
  ) SIZE 5M,
  GROUP 4 (
    '/workability3/wkabtrg1/oracle/oradata/redo04a.log',
    '/workability3/wkabtrg1/oracle/oradata/redo04b.log'
  ) SIZE 5M,
  GROUP 5 (
    '/workability3/wkabtrg1/oracle/oradata/redo05a.log',
    '/workability3/wkabtrg1/oracle/oradata/redo05b.log'
  ) SIZE 5M,
  GROUP 6 (
    '/workability3/wkabtrg1/oracle/oradata/redo06a.log',
    '/workability3/wkabtrg1/oracle/oradata/redo06b.log'
  ) SIZE 5M
DATAFILE
  '/workability3/wkabtrg1/oracle/oradata/beneng_data01.dbf',
  '/workability3/wkabtrg1/oracle/oradata/beneng_index01.dbf',
  '/workability3/wkabtrg1/oracle/oradata/ejsadmin01.dbf',
  '/workability3/wkabtrg1/oracle/oradata/fineos_data01.dbf',
  '/workability3/wkabtrg1/oracle/oradata/fineos_data02.dbf',
  '/workability3/wkabtrg1/oracle/oradata/fineos_data03.dbf',
  '/workability3/wkabtrg1/oracle/oradata/fineos_index01.dbf',
  '/workability3/wkabtrg1/oracle/oradata/logminer01.dbf',
  '/workability3/wkabtrg1/oracle/oradata/system01.dbf',
  '/workability3/wkabtrg1/oracle/oradata/tools01.dbf',
  '/workability3/wkabtrg1/oracle/oradata/undotbs01.dbf',
  '/workability3/wkabtrg1/oracle/oradata/users01.dbf',
  '/workability3/wkabtrg1/oracle/oradata/wkab_data01.dbf',
  '/workability3/wkabtrg1/oracle/oradata/wkab_data02.dbf',
  '/workability3/wkabtrg1/oracle/oradata/wkab_data03.dbf',
  '/workability3/wkabtrg1/oracle/oradata/wkab_index01.dbf',
  '/workability3/wkabtrg1/oracle/oradata/wkab_index02.dbf',
  '/workability3/wkabtrg1/oracle/oradata/wkab_index03.dbf',
  '/workability3/wkabtrg1/oracle/oradata/wkab_lob01.dbf'
CHARACTER SET WE8ISO8859P1
;

---------------------------------------------------------------------
       sqlplus /nolog
      
       spool /workability3/wkabtrg1/oracle/admin/create/createcontrol.log
       @/workability3/wkabtrg1/oracle/admin/create/createcontrol.sql

       RECOVER DATABASE USING BACKUP CONTROLFILE UNTIL CANCEL;
       ...

	Specify log: {<RET>=suggested | filename | AUTO | CANCEL}

	Specify the path and archivelog files name which you have just copied.
        AUTO
        ...

        CANCEL (did not have to do last time, just do ALTER...)

       ...
       ALTER DATABASE OPEN RESETLOGS;
       spool off
       shutdown immediate;
       startup
       or
       startup pfile=/workability/orabin/v920/dbs/initwkabtrg1.ora
       
       ALTER TABLESPACE TEMP ADD TEMPFILE '/workability3/wkabtrg1/oracle/oradata/temp01.tmp' SIZE 8000M REUSE AUTOEXTEND ON NEXT 524288000  MAXSIZE 8000M;
       


  

    
######################################################################################################################
12. 
******EXAMPLE of how to move into ARCHIVE MODE ********************
SQL> shutdown immediate;
Database closed.
Database dismounted.
ORACLE instance shut down.

SQL> startup mount;
ORACLE instance started.
Total System Global Area  612368384 bytes
Fixed Size                  2074768 bytes
Variable Size             390072176 bytes
Database Buffers          213909504 bytes
Redo Buffers                6311936 bytes
Database mounted.

SQL> alter database noarchivelog;
##SQL> alter database archivelog;

Database altered.

SQL> alter database open;

Database altered.

SQL> archive log list;

change LOG_ARCHIVE_START=FALSE in init.ora file
restart DB

######################################################################################################################
11. --this step need to be complete to avoid sending emails to actual customers

Login to DBArtisan wkab10/wkab10_wkabtrn  

--Updates may take long time since a lot of records

select count(*) from S_COMMUNICATION where COMM_MODE_ID in (3,6,10)
and LOCATOR <> 'WKAB3.0@coreinc.com';


update S_COMMUNICATION set LOCATOR = 'WKAB3.0@coreinc.com'
where COMM_MODE_ID in (3,6,10)
and LOCATOR <> 'WKAB3.0@coreinc.com';
commit;

select count(*) from s_report_recipient where email_address like '%@%'
        and email_address <> 'WKAB3.0@coreinc.com'; 

update s_report_recipient
set email_address = 'WKAB3.0@coreinc.com'
where email_address like '%@%'
and email_address <> 'WKAB3.0@coreinc.com' ;
commit;
        
*** Will take long time look in *** (Select * from V$SESSION_LONGOPS) for monitor

######################################################################################################################

12. 
       select * from global_name;
    alter database rename global_name to WKABTRG1;

######################################################################################################################
13. Change  password...

    alter user wkab10 identified by wkab10_wkabtrg1;
    alter user beneng identified by beneng_wkabtrg1;

######################################################################################################################
14.

******Setup Nightly jobs ************
cd /workability/home/oracle/Scripts
vi Oracle.nightly.backup.control.file
# add this line
wkabtrg1 /workability3/wkabtrg1


vi Oracle.nightly.control.file
# add

wkabtrg1

######################################################################################################################
15. Stop wkabtrn listener and shutdown database on Floradev Server
    Comment out cront jobs
    Change oratab to N or comment out entry for this database

######################################################################################################################
16. Found several DBlinks from wkabtrg1 over to PeopleSoft
    Check and add if needed tnsnames.ora entry on wkabuat server to corresponding PeopleSoft 
    Review Synonyms
    Test Links
    If corresponding PeopleSoft Datbase renamed/created/changed. Rebuild DbLink and rebuild all Synonyms!!!

####################################################################################################################

17. Create sfile
 
      cd $ORACLE_HOME/dbs
       sqlplus
 
       create spfile FROM pfile='/workability/orabin/v920/dbs/initwkabtrg1.ora';

       shutdown immediate
       startup
    
       Show parameter pfile;

    
