Pimary Database:       TARGET (WKABQA1)
Duplicate Database :    AUX    (WKABDEV1)
RMAN Catalog Database: RMAN   (RCATDEV)


Target Database wkabqa1 reside on boraw1q server
Aux Database wkabdev1 reside on boraw1d Server

**************************************** DONE **********************************************************************************************
********************************************************************************************************************************************
********************************************************************************************************************************************
********************************************************************************************************************************************
********************************************************************************************************************************************

Prior to duplicate we need to Save last backup on wkabqa1 which will be used in future to restoration (duplication) over to Dev3.


. $SETUPENV wkabqa1

cd $INSTANCE_OUTPUTS\rman_backups

ls -altr
-rw-r-----    1 oracle   dba        76459520 Sep 14 03:00 bkp_df761799646_s5913_s1
-rw-r-----    1 oracle   dba      6165602304 Sep 14 03:14 bkp_df761799663_s5914_s1
-rw-r-----    1 oracle   dba         1243136 Sep 14 03:14 bkp_df761800480_s5915_s1
-rw-r-----    1 oracle   dba         6873088 Sep 14 03:14 snapcf_wkabqa1.f
-rw-r-----    1 oracle   dba         6914048 Sep 14 03:14 c-472815084-20110914-00


rman
connect target /
connect catalog wkabqa1/wkabqa1namr@RCATDEV

list backup summary;


List of Backups
===============
Key     TY LV S Device Type Completion Time #Pieces #Copies Compressed Tag
------- -- -- - ----------- --------------- ------- ------- ---------- ---
115353  B  0  A DISK        13-SEP-11       1       1       YES        L0_BACKUP
115383  B  A  A DISK        13-SEP-11       1       1       YES        L0_BACKUP
115454  B  A  A DISK        13-SEP-11       1       1       YES        TAG20110913T123011
115464  B  F  A DISK        13-SEP-11       1       1       NO         TAG20110913T123021

115498  B  A  A DISK        14-SEP-11       1       1       YES        L0_BACKUP
115513  B  0  A DISK        14-SEP-11       1       1       YES        L0_BACKUP
115543  B  A  A DISK        14-SEP-11       1       1       YES        L0_BACKUP
115570  B  F  A DISK        14-SEP-11       1       1       NO         TAG20110914T031443



   CATALOG BACKUPPIECE '/boraw1qu101/wkabqa1/rman_backups/bkp_df724129209_s3967_s1';



********* Used this to Safe backupsets ***************


CHANGE BACKUPSET 115498 KEEP FOREVER;
CHANGE BACKUPSET 115513 KEEP FOREVER;
CHANGE BACKUPSET 115543 KEEP FOREVER;
CHANGE BACKUPSET 115570 KEEP FOREVER;



***** Archive to TSM

dsmc archive -archmc=B30D_A1Y /boraw1qu101/wkabqa1/rman_backups/bkp_df761799646_s5913_s1
dsmc archive -archmc=B30D_A1Y /boraw1qu101/wkabqa1/rman_backups/bkp_df761799663_s5914_s1
dsmc archive -archmc=B30D_A1Y /boraw1qu101/wkabqa1/rman_backups/bkp_df761800480_s5915_s1
dsmc archive -archmc=B30D_A1Y /boraw1qu101/wkabqa1/rman_backups/c-472815084-20110914-00


*** Capture sequence for duplication ************





select sequence#,completion_time, next_change# as scn 
         from v$archived_log 
            order by completion_time desc;


7201	09/14/2011 3:14:38.000 AM	8255084565517	   
7200	09/14/2011 3:00:43.000 AM	8255084560716	   

## use latest 7201




Create directory or symbolic link on AUX Server and copy backupsets over
   


cd /boraw1du101/wkabdev3/
mkdir backup_temp

nohup scp -rp /boraw1qu101/wkabqa1/rman_backups/bkp_df761799646_s5913_s1 boraw1d:/boraw1du101/wkabdev3/backup_temp/bkp_df761799646_s5913_s1
nohup scp -rp /boraw1qu101/wkabqa1/rman_backups/bkp_df761799663_s5914_s1 boraw1d:/boraw1du101/wkabdev3/backup_temp/bkp_df761799663_s5914_s1
nohup scp -rp /boraw1qu101/wkabqa1/rman_backups/bkp_df761800480_s5915_s1 boraw1d:/boraw1du101/wkabdev3/backup_temp/bkp_df761800480_s5915_s1
nohup scp -rp /boraw1qu101/wkabqa1/rman_backups/snapcf_wkabqa1.f boraw1d:/boraw1du101/wkabdev3/backup_temp/snapcf_wkabqa1.f
nohup scp -rp /boraw1qu101/wkabqa1/rman_backups/c-472815084-20110914-00 boraw1d:/boraw1du101/wkabdev3/backup_temp/c-472815084-20110914-00



cd /

mkdir /boraw1qu101
cd /boraw1qu101
mkdir wkabqa1


ln -s /boraw1du101/wkabdev3/backup_temp /boraw1qu101/wkabqa1/rman_backups


*** Now we can see it 

cd /boraw1qu101/wkabqa1/rman_backups


***************************************************************************************************************************
***************************************************************************************************************************
***************************************************************************************************************************
***************************************************************************************************************************
***************************************************************************************************************************


------>TARGET WKABQA1 Directory and datafile location<----------------- 

   ORACLE_HOME: /orahome/wkab01/app/oracle/product/11.2.0/db_2
   ORACLE_BASE: /orahome/wkab01/app/oracle
   
   /boraw1qu01/app/oracle/admin/wkabqa1
   /boraw1qu01/app/oracle/admin/wkabqa1/bdump
   /boraw1qu01/app/oracle/admin/wkabqa1/udump
   /boraw1qu01/app/oracle/admin/wkabqa1/cdump
   /boraw1qu01/app/oracle/admin/wkabqa1/create
   /boraw1qu01/app/oracle/admin/wkabqa1/pfile
   /boraw1qu01/app/oracle/admin/wkabqa1/diag


   /boraw1qu101/wkabqa1/
   /boraw1qu101/wkabqa1/rman_backups
   /boraw1qu101/wkabqa1/backups
   /boraw1qu101/wkabqa1/arch

   /boraw1qu01/aetna/scripts


select file_id,file_name from dba_data_files order by 1

FILE_ID	FILE_NAME	   
1	/boraw1qu201/oradata/wkabqa1/system_01.dbf	   
2	/boraw1qu201/oradata/wkabqa1/undotbs_01.dbf	   
3	/boraw1qu202/oradata/wkabqa1/beneng_data_01.dbf	   
4	/boraw1qu202/oradata/wkabqa1/beneng_data_02.dbf	   
5	/boraw1qu202/oradata/wkabqa1/beneng_index_01.dbf	   
6	/boraw1qu202/oradata/wkabqa1/beneng_index_02.dbf	   
7	/boraw1qu201/oradata/wkabqa1/sysaux01.dbf	   
11	/boraw1qu202/oradata/wkabqa1/wkab_data_01.dbf	   
12	/boraw1qu202/oradata/wkabqa1/wkab_data_02.dbf	   
13	/boraw1qu202/oradata/wkabqa1/wkab_index_01.dbf	   
14	/boraw1qu202/oradata/wkabqa1/wkab_index_02.dbf	   
15	/boraw1qu202/oradata/wkabqa1/wkab_lob_01.dbf	   
16	/boraw1qu202/oradata/wkabqa1/wkab_lob_02.dbf	   
17	/boraw1qu202/oradata/wkabqa1/ejsadmin_01.dbf	   
18	/boraw1qu202/oradata/wkabqa1/TAEDBA2.dbf	   
19	/boraw1qu202/oradata/wkabqa1/users_01.dbf	   
20	/boraw1qu202/oradata/wkabqa1/tools_01.dbf	   
21	/boraw1qu202/oradata/wkabqa1/tivoliorts01.dbf	   
			
	



	
select file_id,file_name  from dba_temp_files order by 1

FILE_ID	FILE_NAME	   
1	/boraw1qu201/oradata/wkabqa1/temp_01.dbf	   
2	/boraw1qu201/oradata/wkabqa1/tivoliortempts.dbf	   
		
	

	

select * from v$logfile

GROUP#	STATUS	TYPE	MEMBER	IS_RECOVERY_DEST_FILE	   
3	[NULL]	ONLINE	/boraw1qu201/oradata/wkabqa1/redo03.log	NO	   
2	[NULL]	ONLINE	/boraw1qu201/oradata/wkabqa1/redo02.log	NO	   
1	[NULL]	ONLINE	/boraw1qu201/oradata/wkabqa1/redo01.log	NO	   
					
			



			
select * from v$controlfile

STATUS	NAME	IS_RECOVERY_DEST_FILE	BLOCK_SIZE	FILE_SIZE_BLKS	   
[NULL]	/boraw1qu201/oradata/wkabqa1/control01.ctl	NO	8192	838	   
[NULL]	/boraw1qu202/oradata/wkabqa1/control02.ctl	NO	8192	838	   
[NULL]	/boraw1qu201/oradata/wkabqa1/control03.ctl	NO	8192	838	   
						


SQL> show sga

Total System Global Area 3206836224 bytes
Fixed Size                  2223904 bytes
Variable Size            2181038304 bytes
Database Buffers         1006632960 bytes
Redo Buffers               16941056 bytes

------>AUX WKABDEV1 Directory and datafile location<----------------- 

   
   ORACLE_HOME: /orahome/wkab01/app/oracle/product/11.2.0/db_2
   ORACLE_BASE: /orahome/wkab01/app/oracle

   /boraw1du01/app/oracle/diag/rdbms/wkabdev1/wkabdev1/trace
   !!! new ---> /orahome/wkab01/app/oracle/admin/wkabdev1

   /boraw1du101/wkabdev1/rman_backups

   /boraw1du101/wkabdev1/arch


select file_id,file_name from dba_data_files order by 2

FILE_ID	FILE_NAME	   
18	/boraw1du203/oradata/wkabdev1/TAEDBA2.dbf	   
3	/boraw1du203/oradata/wkabdev1/beneng_data_01.dbf	   
4	/boraw1du203/oradata/wkabdev1/beneng_data_02.dbf	   
5	/boraw1du203/oradata/wkabdev1/beneng_index_01.dbf	   
6	/boraw1du203/oradata/wkabdev1/beneng_index_02.dbf	   
17	/boraw1du203/oradata/wkabdev1/ejsadmin_01.dbf	   
7	/boraw1du203/oradata/wkabdev1/sysaux01.dbf	   
1	/boraw1du203/oradata/wkabdev1/system_01.dbf	   
20	/boraw1du203/oradata/wkabdev1/tivoliorts01.dbf	   
2	/boraw1du203/oradata/wkabdev1/undotbs_01.dbf	   
19	/boraw1du203/oradata/wkabdev1/users_01.dbf	   
13	/boraw1du203/oradata/wkabdev1/wkab_index_01.dbf	   
14	/boraw1du203/oradata/wkabdev1/wkab_index_02.dbf	   
15	/boraw1du203/oradata/wkabdev1/wkab_lob_01.dbf	   
16	/boraw1du203/oradata/wkabdev1/wkab_lob_02.dbf	   
11	/boraw1du204/oradata/wkabdev1/wkab_data_01.dbf	   
12	/boraw1du204/oradata/wkabdev1/wkab_data_02.dbf	   



select file_id,file_name  from dba_temp_files order by 1

FILE_ID	FILE_NAME	   
1	/boraw1du203/oradata/wkabdev1/temp_01.dbf	   
2	/boraw1du203/oradata/wkabdev1/tivoliortempts.dbf	   
		

select * from v$logfile

GROUP#	STATUS	TYPE	MEMBER	IS_RECOVERY_DEST_FILE	   
3	[NULL]	ONLINE	/boraw1du203/oradata/wkabdev1/redo03.log	NO	   
2	[NULL]	ONLINE	/boraw1du203/oradata/wkabdev1/redo02.log	NO	   
1	[NULL]	ONLINE	/boraw1du203/oradata/wkabdev1/redo01.log	NO	   
					

select * from v$controlfile
		
STATUS	NAME	IS_RECOVERY_DEST_FILE	BLOCK_SIZE	FILE_SIZE_BLKS	   
[NULL]	/boraw1du203/oradata/wkabdev1/control01.ctl	NO	16384	516	   
[NULL]	/boraw1du203/oradata/wkabdev1/control02.ctl	NO	16384	516	   
[NULL]	/boraw1du203/oradata/wkabdev1/control03.ctl	NO	16384	516	   
					

SQL> show sga

Total System Global Area 2087780352 bytes
Fixed Size                  2221208 bytes
Variable Size            1577061224 bytes
Database Buffers          503316480 bytes
Redo Buffers                5181440 bytes




Rman setting prior to duplicate
. $SETUPENV wkabdev1

rman
connect target /
#####....connected to target database: WKABDEV1 (DBID=2345772393)
connected to target database: WKABDEV1 (DBID=2366253602)  
connect catalog wkabdev1/wkabdev1namr@RCATDEV

show all;

#RMAN configuration parameters for database with db_unique_name WKABDEV1 are:
#CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 7 DAYS;
#CONFIGURE BACKUP OPTIMIZATION OFF; # default
#CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
#CONFIGURE CONTROLFILE AUTOBACKUP ON;
#CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/boraw1du101/wkabdev1/rman_backups/%F';
#CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F';
#CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO COMPRESSED BACKUPSET;
#CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 1 BACKUP TYPE TO BACKUPSET;
#CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
#CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
#CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
#CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
#CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/boraw1du101/wkabdev1/rman_backups/bkp_df%t_s%s_s%p';
#CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/boraw1du01/app/oracle/tdpoopt/tdpo.wkabdev1.opt)';
#CONFIGURE MAXSETSIZE TO UNLIMITED; # default
#CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
#CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
#CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
#CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
#CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/boraw1du101/wkabdev1/rman_backups/snapcf_wkabdev1.f';


RMAN configuration parameters for database with db_unique_name WKABDEV1 are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 3;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F';
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/boraw1du101/wkabdev1/rman_backups/%F';
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 1 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/boraw1du01/app/oracle/tdpoopt/tdpo.wkabdev1.opt)' RATE 62 M;
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/boraw1du101/wkabdev1/rman_backups/bkp_df%t_s%s_s%p';
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/boraw1du101/wkabdev1/rman_backups/snapcf_wkabdev1.f';






---->2. Move init file from TARGET server to AUX server  However I would get latest in case any changes.
  



   . $SETUPENV wkabqa1
   cd $ORACLE_HOME/dbs
   sqlplus / as sysdba
   create pfile from spfile;
   exit
   

   scp  /orahome/wkab01/app/oracle/product/11.2.0/db_2/dbs/initwkabqa1.ora boraw1d.aetna.com:/orahome/wkab01/app/oracle/product/11.2.0/db_2/dbs/initwkabdev1New.ora 

  
 . $SETUPENV wkabdev1
   cd $ORACLE_HOME/dbs
  

   


mv initwkabdev1New.ora initwkabdev1_fromQA1.ora 


*.control_files='/boraw1du203/oradata/wkabdev1/control01.ctl','/boraw1du203/oradata/wkabdev1/control02.ctl','/boraw1du203/oradata/wkabdev1/control03.ctl'
*.db_file_name_convert='/boraw1qu201/oradata/wkabqa1/','/boraw1du204/oradata/wkabdev1/','/boraw1qu202/oradata/wkabqa1/','/boraw1du203/oradata/wkabdev1/'
*.log_file_name_convert='/boraw1qu201/oradata/wkabqa1/','/boraw1du203/oradata/wkabdev1/'

/boraw1du101/wkabdev1/arch
*.utl_file_dir='/boraw1du01/wkabdev1/Utl_File_Dir'

53.41  /boraw1qu201 - 11 GB-------->11.05  /boraw1du204 - 36 GB/
32.88  /boraw1qu202 - 32 GB ------->32.37  /boraw1du203 - 62 GB/










---->3. Create password file on AUX server. Check these could be completed before. 
  
   cd $ORACLE_HOME/dbs
   orapwd file=$ORACLE_HOME/dbs/orapwwkabdev1 password=no734s entries=10



   !!!Add oratab entry for Only if this brand new database

   wkabdev1:/orahome/wkab01/app/oracle/product/11.2.0/db_2:Y:/boraw1du01:/boraw1du101





    
---->4.    Test connection from AUX(wkabdev1) server to TARGET (wkabqa1)   

   . $SETUPENV wkabdev1

   rman
   
   connect target sys/no734s@wkabqa1
   connect catalog wkabqa1/wkabqa1namr@RCATDEV
   connect AUXILIARY /
   #connect AUXILIARY sys/no734s@wkabdev1




---->5. If this clone repeat process or AUX database exist then
         delete all datafiles,redo logs and control files in AUX (wkabdev3) database

   Make sure . $SETUPENV wkabdev1

   AUX database (WKABDEV1)




   !!! Make sure no jobs running from cron !!!!!



   sqlplus / as sysdba
   shutdown immediate; 


   
   #Confirm
   ls /boraw1du*/oradata/wkabdev1/*
 
   #Remove
   rm /boraw1du*/oradata/wkabdev1/*

   #Confirm again
   ls /boraw1du*/oradata/wkabdev1/*


   #Optional delete old trace and log files

    
   cd /orahome/wkab01/app/oracle/admin/wkabdev1

   rm -rf ./diag
 

   cd $ORACLE_HOME/dbs
   # to have backup in case. If file exist.
   mv initwkabdev1.ora initwkadev1_20111020.ora
   mv spfilewkabdev1.ora spfilewkabdev1_20111020.ora
   rm spfilewkabdev1.ora
   mv initwkabdev1_fromQA1.ora initwkabdev1.ora



---->6. AUX (WKABDEV1) database
    Make sure . $SETUPENV wkabdev1

    sqlplus / as sysdba
  
    startup pfile=/orahome/wkab01/app/oracle/product/11.2.0/db_2/dbs/initwkabdev1.ora force nomount;
  
   ####  startup pfile=/orahome/wkab01/app/oracle/product/11.2.0/db_1/dbs/initwkabdev3.ora;
   ####  startup force nomount;


#    Make sure . $SETUPENV wkabdev1

#    cd /boraw1qu101/wkabqa1/rman_backups

#    select sequence#,thread#,completion_time, next_change# as scn 
#         from v$archived_log 
#            order by completion_time desc;


#    7201	09/14/2011 3:14:38.000 AM	8255084565517	   
#    7200	09/14/2011 3:00:43.000 AM	8255084560716



****** From test below never worked. **************************************************************
*****************************************************************************************************
*****************************************************************************************************

## use latest 7201
## set until scn 8255084565517;
## set until sequence 7201 thread 1;
##  set until time "TO_DATE('09/14/2011:03:14:38', 'MM/DD/YYYY HH24:MI S')";
## set until time "TO_DATE('09/14/2011 03:14:43','MM/DD/YYYY HH24:MI:SS')";


#   rman
#   connect target sys/no734s@wkabqa1
#   connect catalog wkabqa1/wkabqa1namr@RCATDEV
#   connect AUXILIARY /

#  SPOOL LOG TO 'dup2.txt'
#   run {
#        set until time "TO_DATE('09/14/2011 03:14:30','MM/DD/YYYY HH24:MI:SS')";
#        duplicate target database to wkabdev3;
#   }
#   SPOOL LOG OFF; 

# duplicate target database to wkabdev3 until time "TO_DATE('09/14/2011 03:14:43','MM/DD/YYYY HH24:MI:SS')";



channel ORA_AUX_DISK_1: starting datafile backup set restore
channel ORA_AUX_DISK_1: restoring control file
channel ORA_AUX_DISK_1: reading from backup piece /boraw1qu101/wkabqa1/rman_back
ups/c-472815084-20110913-01
channel ORA_AUX_DISK_1: ORA-19870: error while restoring backup piece /boraw1qu1
01/wkabqa1/rman_backups/c-472815084-20110913-01
ORA-19505: failed to identify file "/boraw1qu101/wkabqa1/rman_backups/c-472815084-20110913-01"
4-20110913-01"
ORA-27037: unable to obtain file status
IBM AIX RISC System/6000 Error: 2: No such file or directory

*****************************************************************************************************
*****************************************************************************************************
*****************************************************************************************************

!!!!!!!!!!!!!!! This worked !!!!!!!!!!!!!!!!!!!!!!!!!

rman
connect AUXILIARY /
run {

 DUPLICATE DATABASE TO 'wkabdev1' BACKUP LOCATION '/boraw1qu101/wkabqa1/rman_backups';
}



!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
ORA-0600 [KCK_RLS_CHECK Must Use (11,0,0,0,0) or Lower] Whwn Starting From Newly Created SPFILE [ID 1064264.1]

_compression_compatibility= "11.2.0"

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!




---->7. Move Database to NONEARCHIVELOG

SQL> shutdown immediate;
startup mount;

SQL> alter database noarchivelog;
##SQL> alter database archivelog;

Database altered.


SQL> alter database open;

Database altered.

SQL> archive log list;


---->8. this step need to be complete to avoid sending emails to actual customers

Login to sqlplus wkab10/wkab10_wkabqa1 

--Updates may take long time since a lot of records

select count(*) from S_COMMUNICATION where COMM_MODE_ID in (3,6,10)
and LOCATOR <> 'WKAB3.0@coreinc.com';


update S_COMMUNICATION set LOCATOR = 'WKAB3.0@coreinc.com'
where COMM_MODE_ID in (3,6,10)
and LOCATOR <> 'WKAB3.0@coreinc.com';
commit;

select count(*) from s_report_recipient where email_address like '%@%'
        and email_address <> 'WKAB3.0@coreinc.com'; 

update s_report_recipient
set email_address = 'WKAB3.0@coreinc.com'
where email_address like '%@%'
and email_address <> 'WKAB3.0@coreinc.com' ;
commit;



---->9.Change passwords

ALTER PROFILE DEFAULT LIMIT 
PASSWORD_VERIFY_FUNCTION NULL
/

alter user wkab10 identified by wkab10_wkabdev1;
alter user beneng identified by beneng_wkabdev1; 
                                  

ALTER PROFILE DEFAULT LIMIT 
PASSWORD_VERIFY_FUNCTION AI_PASSWORD_VALIDATE
/



###alter database rename global_name to WKABDEV1.WORLD;



---->10. Move Database back to ARCHIVELOG

SQL> shutdown immediate;
startup mount;

##SQL> alter database noarchivelog;
alter database archivelog;

Database altered.


SQL> alter database open;

Database altered.

SQL> archive log list;



Create SPFILE
sqlplus / as sysdba
create spfile from pfile;

shutdown immediate;
startup


ALTER SYSTEM SET MEMORY_TARGET = 2000M SCOPE = SPFILE;

shutdown immediate;
startup



---->11. RMAN Backup


Rman setting prior to duplicate

rman

SET DBID 2345772393


rman
connect target /
connect catalog wkabdev1/wkabdev1namr@RCATDEV


LIST DB_UNIQUE_NAME ALL;


List of Databases
DB Key  DB Name  DB ID            Database Role    Db_unique_name
------- ------- ----------------- ---------------  ------------------
66341   WKABDEV1 2370294244       PRIMARY          WKABDEV1




#SET DBID 2370294244;
#UNREGISTER DATABASE;


rman
connect target /
connect catalog wkabdev1/wkabdev1namr@RCATDEV



register database;

show all;
show schema;



RMAN configuration parameters for database with db_unique_name WKABDEV1 are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 1; # default
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE CONTROLFILE AUTOBACKUP OFF; # default
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F'; # default
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/orahome/wkab01/app/oracle/product/11.2.0/db_2/dbs/snapcf_wkabdev1.f'; # default




RMAN configuration parameters for database with db_unique_name WKABDEV1 are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 3;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F';
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/boraw1du101/wkabdev1/rman_backups/%F';
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 1 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/boraw1du01/app/oracle/tdpoopt/tdpo.wkabdev1.opt)' RATE 62 M;
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/boraw1du101/wkabdev1/rman_backups/bkp_df%t_s%s_s%p';
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/boraw1du101/wkabdev1/rman_backups/snapcf_wkabdev1.f';




-- Apply correct configuration. See above where we saved before duplicate.




---->12. Makes sure remote connections working properly					