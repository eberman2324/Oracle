********* HEDWPRD/HEDWPRD_RPT************


1. Datafiles were added to DATA tablespace from Primary while /orahome/u01 on Standby was full

2. Cleanup /orahome/u01 on Standby (old incidents were removed)

    rm -rf ./incdir_492529

3. Re start agent on Standby

cd /orahome/u01/app/oracle/product/agent12c/agent_13.2.0.0.0/bin

xhedwdbw21p.aetna.com (oracle) HEDWPRD::/orahome/u01/app/oracle/product/agent12c/agent_13.2.0.0.0/bin
HEDWPRD> ./emctl start agent
Oracle Enterprise Manager Cloud Control 13c Release 2
Copyright (c) 1996, 2016 Oracle Corporation.  All rights reserved.
Starting agent .................. started.


4. Check if Redo apply on Standby working 

ON Primary

SELECT DB_NAME, HOSTNAME, LOG_ARCHIVED, LOG_APPLIED,APPLIED_TIME,
LOG_ARCHIVED-LOG_APPLIED LOG_GAP
FROM
(
SELECT NAME DB_NAME
FROM V$DATABASE
),
(
SELECT UPPER(SUBSTR(HOST_NAME,1,(DECODE(INSTR(HOST_NAME,'.'),0,LENGTH(HOST_NAME),
(INSTR(HOST_NAME,'.')-1))))) HOSTNAME
FROM V$INSTANCE
),
(
SELECT MAX(SEQUENCE#) LOG_ARCHIVED
FROM V$ARCHIVED_LOG WHERE DEST_ID=1 AND ARCHIVED='YES'
),
(
SELECT MAX(SEQUENCE#) LOG_APPLIED
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
),
(
SELECT TO_CHAR(MAX(COMPLETION_TIME),'DD-MON/HH24:MI') APPLIED_TIME
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
);



ON Standby
    sqlplus / as sysdba
    set line 140
    select thread#,
           sequence# as "REDO LOG BEING APPLIED",
           process,
           status,
           block#,
           blocks
    from   v$managed_standby;



MRP0 was not up

5. Check broker status on Standby

dgmgrl /

show database verbose 'HEDWPRD_xhedwdbw21p';

###Showed errors in redo apply. Status was ON


##Try recovery manually and open DB in READ ONLY mode

# Check alert.log
ORA-10458 ORA-01152 while bringing standby in READ ONLY mode (Doc ID 2140754.1) 
ORA-10458: standby database requires recovery

 SQL>recover standby database ;

Got errors complaining about /orahome/u01/app/oracle/product/12.1.0.2.200414/db_1/dbs/UNNAMED00340
               
SQL>alter database open read only;


6. Recover datafile on Standby


MRP0: Background Media Recovery terminated with error 1119 (Doc ID 1397416.1)


dgmgrl /


edit database 'HEDWPRD_xhedwdbw21p' set state = 'APPLY-OFF';

show database verbose 'HEDWPRD_xhedwdbw21p';

edit database 'HEDWPRD_xhedwdbw21p' set property StandbyFileManagement='MANUAL';
exit

sqlplus / as sysdba
alter database create datafile '/orahome/u01/app/oracle/product/12.1.0.2.200414/db_1/dbs/UNNAMED00340'  as new ;
exit

dgmgrl /

edit database 'HEDWPRD_xhedwdbw21p' set property StandbyFileManagement='AUTO';
edit database 'HEDWPRD_xhedwdbw21p' set state = 'APPLY-ON';
show database verbose 'HEDWPRD_xhedwdbw21p';
exit

SQL> select open_mode from v$database;

OPEN_MODE
------------------------------------------------------------
MOUNTED


SQL> alter database open read only;

Database altered.

SQL> select open_mode from v$database;

OPEN_MODE
------------------------------------------------------------
READ ONLY

!! Check in few min. This state shoudl be
SQL> select open_mode from v$database;

OPEN_MODE
------------------------------------------------------------
READ ONLY WITH APPLY


   
