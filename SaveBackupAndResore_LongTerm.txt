**********Pre 23.2 HEPYSTS save backup before HPR upgrade and restore steps

!!!Suspend all OEM backup jobs
!!!Note backup next start times


###REMOVE PRIVIOUSE SAVED BACKUP
.oraenv

HEPYSTS
cd /home/oracle/tls/rman/
rmanc
@HEPYSTS_DELETE_SBK_20230510.rman
crosscheck backup;
exit

#Increase number of channels.

.oraenv

HEPYSTS
rmanc

CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 12 BACKUP TYPE TO BACKUPSET;
exit

cd /home/oracle/tls/rman/




# backup + save in one script

nohup backup_HEPYSTS_b4_rlse23_2.sh ${ORACLE_SID} backup_HEPYSTS_b4_rlse23_2.rman

open new SS session
cd /home/oracle/tls/rman/

tail -f *.log



## mark backup keep 
rmanc

-- File date stamp will be different...

## Run this script to mark backupsets keep forever
rmanc
@HEPYSTS_sbk_202309??_??:??:??.rman

## put back 6 channels
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 6 BACKUP TYPE TO BACKUPSET;
exit


#Upon backup completion and after backupsets set forever
!!Resume OEM Jobs






**********Pre 23.2 HEDWSTS save backup before HPR upgrade and restore steps

!!!Suspend all OEM backup jobs
!!!Note backup next start times


###REMOVE PRIVIOUSE SAVED BACKUP
.oraenv

HEDWSTS

cd /home/oracle/tls/rman/
rmanc
@HEDWSTS_DELETE_SBK_20230510.rman
crosscheck backup;
exit

#Increase number of channels.

.oraenv

HEDWSTS
rmanc

CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 8 BACKUP TYPE TO BACKUPSET;
exit

cd /home/oracle/tls/rman/




# backup + save in one script

nohup backup_HEDWSTS_b4_rlse23_2.sh ${ORACLE_SID} backup_HEDWSTS_b4_rlse23_2.rman

open new SS session
cd /home/oracle/tls/rman/

tail -f *.log



## mark backup keep 
rmanc

-- File date stamp will be different...

## Run this script to mark backupsets keep forever
@HEDWSTS_sbk_202309??_??:??:??.rman
## put back 6 channels
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 6 BACKUP TYPE TO BACKUPSET;
exit

#Upon backup completion and after backupsets set forever
!!Resume OEM Jobs


!! 

**********Pre 23.4 HEPYSTS save backup before HPR upgrade and restore steps

!!!Suspend all OEM backup jobs
!!!Note backup next start times


###REMOVE PRIVIOUSE SAVED BACKUP
.oraenv

HEPYSTS
cd /home/oracle/tls/rman/
rmanc
@HEPYSTS_DELETE_SBK_20230510.rman
crosscheck backup;
exit

#Increase number of channels.

.oraenv

HEPYSTS
rmanc

CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 12 BACKUP TYPE TO BACKUPSET;
exit

cd /home/oracle/tls/rman/




# backup + save in one script

nohup backup_HEPYSTS_b4_rlse23_2.sh ${ORACLE_SID} backup_HEPYSTS_b4_rlse23_2.rman

open new SS session
cd /home/oracle/tls/rman/

tail -f *.log



## mark backup keep 
rmanc

-- File date stamp will be different...

## Run this script to mark backupsets keep forever
rmanc
@HEPYSTS_sbk_202309??_??:??:??.rman

## put back 6 channels
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 6 BACKUP TYPE TO BACKUPSET;
exit


#Upon backup completion and after backupsets set forever
!!Resume OEM Jobs






**********Pre 23.4 HEDWSTS save backup before HPR upgrade and restore steps

!!!Suspend all OEM backup jobs
!!!Note backup next start times


###REMOVE PRIVIOUSE SAVED BACKUP
.oraenv

HEDWSTS

cd /home/oracle/tls/rman/
rmanc
@HEDWSTS_DELETE_SBK_20230510.rman
crosscheck backup;
exit

#Increase number of channels.

.oraenv

HEDWSTS
rmanc

CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 8 BACKUP TYPE TO BACKUPSET;
exit

cd /home/oracle/tls/rman/




# backup + save in one script

nohup backup_HEDWSTS_b4_rlse23_2.sh ${ORACLE_SID} backup_HEDWSTS_b4_rlse23_2.rman

open new SS session
cd /home/oracle/tls/rman/

tail -f *.log



## mark backup keep 
rmanc

-- File date stamp will be different...

## Run this script to mark backupsets keep forever
@HEDWSTS_sbk_202309??_??:??:??.rman
## put back 6 channels
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 6 BACKUP TYPE TO BACKUPSET;
exit

#Upon backup completion and after backupsets set forever
!!Resume OEM Jobs





***************** Save QA2 and Restore back in couple of month in support of bootstrap from freshly cloned HEPYMASK *****



!!!Suspend all OEM backup jobs
!!!Note backup next start times


###REMOVE OLD SAVED BACKUP IF EXISTED
.oraenv

HEPYQA2
cd /orahome/u01/app/oracle/local/scripts/backup/long_term/
rmanc
@HEPYQA_DELETE_SBK_YYYYMMDD.rman
crosscheck backup;
exit

#Increase number of channels.

.oraenv

HEPYQA
rmanc

CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 6 BACKUP TYPE TO BACKUPSET;
exit

cd /orahome/u01/app/oracle/local/scripts/backup/long_term/

## Saved for reference

RMAN> list incarnation of database;

List of Database Incarnations
DB Key  Inc Key DB Name  DB ID            STATUS  Reset SCN  Reset Time
------- ------- -------- ---------------- --- ---------- ----------
4142169 4143577 HEPYQA2  2834009084       PARENT  13569756236671 10-AUG-2020 22:12:48
4142169 4142170 HEPYQA2  2834009084       CURRENT 13569781452168 02-SEP-2020 21:43:56
10301111 10301241 HEPYQA2  2908068873       PARENT  13641495197785 03-NOV-2022 09:10:29
10301111 10301112 HEPYQA2  2908068873       CURRENT 13641666736748 23-DEC-2022 01:53:17
11060911 11061053 HEPYQA2  2927958017       PARENT  13667176249997 14-JUN-2023 08:24:01
11060911 11060912 HEPYQA2  2927958017       PARENT  13667298723705 05-AUG-2023 06:39:02
11060911 11574511 HEPYQA2  2927958017       CURRENT 13668065659788 22-DEC-2023 17:25:08


## Create new backup script for this release as copy from previous release. Change Tags etc..

vi backup_HEPYQA2_B4_DROP_052024.rman
vi backup_HEPYQA2_B4_DROP_052024.sh

# backup + save in one script

nohup backup_HEPYQA2_B4_DROP_052024.sh ${ORACLE_SID} backup_HEPYQA2_B4_DROP_052024.rman

open new SS session
cd /orahome/u01/app/oracle/local/scripts/backup/long_term/

tail -f *.log




-- File date stamp will be different...

mv HEPYQA2_sbk_20240507_12:24:42.rman HEPYQA2_sbk_20240507_keep.rman
## Run this script to mark backupsets keep forever
rmanc
@HEPYQA2_sbk_20240507_keep.rman

## put back 6 channels if needed
rmanc
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 6 BACKUP TYPE TO BACKUPSET;
exit


#Upon backup completion and after backupsets set forever
!!Resume OEM Jobs




## Create Restore Script

## Save priv restore_HEPYQA2.rman if exist

mv restore_HEPYQA2.rman restore_HEPYQA2.rman_priv


#add restore portion into this file from  HEPYQA2_sbk_20240507_keep.rman + add some missing BT code from original restore script. See below example


vi restore_HEPYQA2.rman


set echo on
startup force nomount;
set DBID=2927958017
reset database to incarnation 11574511;
restore controlfile from 'c-2927958017-20240508-02';
alter database mount;
run{
restore database until sequence 4831;
recover database until sequence 4831;
}
alter database disable block change tracking;
alter database enable block change tracking using file '+DATA_01';
alter database open resetlogs;






--- Restore steps



1. Suspend OEM jobs for HEPYQA2 if not already suspended
2. comment out crontab jobs
3. Make sure HRP bring all apps down.

sqlplus / as sysdba

shutdown immediate
exit





ps -ef | grep restore_HEPYQA2.sh





!!! Made bunch of changes in support of move to $SCRIPT/backup/long_term. It can fail from first time..
nohup restore_HEPYQA2.sh HEPYQA2

open new SS session
cd /orahome/u01/app/oracle/local/scripts/backup/long_term//logs


tail -f *.log

##After your restore is complete, query the heartbeat table and compare the heartbeat date
 to the heartbeat date in the backup log prior to enabling the heartbeat job in cron.
select * from aedba.rman_heartbeat order by 2


   sqlplus / as sysdba

   @?/rdbms/admin/utlrp.sql

	select count(*)
	from dba_objects
	where status = 'INVALID';






**********Save HEDWQA2 for long term

!!!Suspend all OEM backup jobs
!!!Note backup next start times


###REMOVE OLD SAVED BACKUP IF EXISTS
.oraenv

HEDWQA2
cd /orahome/u01/app/oracle/local/scripts/backup/long_term/
rmanc
@HEDWQA2_DELETE_SBK_xxxxxxxx.rman
crosscheck backup;
exit

#Increase number of channels if needed

.oraenv

HEDWQA2
rmanc

CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 6 BACKUP TYPE TO BACKUPSET;
exit

cd /orahome/u01/app/oracle/local/scripts/backup/long_term/

## Saved for reference

RMAN> list incarnation of database;

List of Database Incarnations
DB Key  Inc Key DB Name  DB ID            STATUS  Reset SCN  Reset Time
------- ------- -------- ---------------- --- ---------- ----------
2779833 2780120 HEDWQA2  3999091145       PARENT  13560390630875 24-SEP-2019 12:08:07
2779833 2779834 HEDWQA2  3999091145       PARENT  13560412639651 07-OCT-2019 11:02:38
2779833 3017747 HEDWQA2  3999091145       CURRENT 13560420675273 06-JAN-2020 16:45:44
4747733 4748185 HEDWQA2  4055772354       PARENT  13560413323835 10-OCT-2019 10:39:27
4747733 4747734 HEDWQA2  4055772354       PARENT  13604738314786 12-JUL-2021 11:49:33
4747733 6927926 HEDWQA2  4055772354       PARENT  13609515762700 29-NOV-2022 18:14:41
4747733 7936126 HEDWQA2  4055772354       CURRENT 13621531540522 22-DEC-2023 02:41:30


## Create new backup script for this release as copy from previous release. Change Tags etc..

vi backup_HEDWQA2_B4_DROP_052024.rman
vi backup_HEDWQA2_B4_DROP_052024.sh

# backup + save in one script

nohup backup_HEDWQA2_B4_DROP_052024.sh ${ORACLE_SID} backup_HEDWQA2_B4_DROP_052024.rman

open new SS session
cd /orahome/u01/app/oracle/local/scripts/backup/long_term/

tail -f *.log




-- File date stamp will be different...
mv HEDWQA2_sbk_20240507_12:31:41.rman HEDWQA2_sbk_20240507_keep.rman
## Run this script to mark backupsets keep forever
rmanc
@HEDWQA2_sbk_20240507_keep.rman

## put back 6 channels if needed
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
exit


#Upon backup completion and after backupsets set forever
!!Resume OEM Jobs


## Create Restore Script

## Save priv restore_HEDWQA2.rman if exist

mv restore_HEDWQA2.rman restore_HEDWQA2.rman_priv


#add restore portion into this file from  HEDWQA2_sbk_20240507_keep.rman + add some missing BT code from original restore script. See below example



##Restore DataBase
connect target /
connect catalog HEDWQA2/xyz@RCATDEV

vi restore_HEDWQA2.rman
set echo on
startup force nomount;
set DBID=4055772354
reset database to incarnation 7936126;
restore controlfile from 'c-4055772354-20240507-0f';
alter database mount;
run{
restore database until sequence 7965;
recover database until sequence 7965;
}
alter database disable block change tracking;
alter database enable block change tracking using file '+DATA_01';
alter database open resetlogs;



--- Restore steps



1. Suspend OEM jobs for HEDWQA2 if not already suspended
2. comment out crontab jobs
3. Make sure HRP bring all apps down.

sqlplus / as sysdba

shutdown immediate
exit





ps -ef | grep restore_HEDWQA2.sh





!!! Made bunch of changes in support of move to $SCRIPT/backup/long_term. It can fail from first time..

nohup restore_HEDWQA2.sh HEDWQA2

open new SS session
cd /orahome/u01/app/oracle/local/scripts/backup/long_term/logs


tail -f *.log

##After your restore is complete, query the heartbeat table and compare the heartbeat date
 to the heartbeat date in the backup log prior to enabling the heartbeat job in cron.
select * from aedba.rman_heartbeat order by 2


   sqlplus / as sysdba

   @?/rdbms/admin/utlrp.sql

	select count(*)
	from dba_objects
	where status = 'INVALID';