CREATE OR REPLACE EDITIONABLE PROCEDURE                               AE_CUSTOM.USP_TRUNCATE_TABLE
(table_owner_in  in    varchar2,
 table_name_in   in    varchar2,
 error_code      out   number,
 error_message   out   varchar2)
as
v_temp_var         char(200) := ' ';
checkit            number := 0;
begin
error_code := 0;
error_message := ' ';
select count(*) into checkit
 from ae_custom.tables_that_can_be_truncated
 where upper(owner) = upper(table_owner_in)
 and   upper(table_name)  = upper(table_name_in);
if checkit = 0 then
   error_code := -20000;
   error_message := 'Unsupported table';
   goto end_it;
end if;
BEGIN 
EXECUTE IMMEDIATE 'TRUNCATE TABLE '||upper(table_owner_in)||'.'||upper(table_name_in); 
END; 
<<end_it>>
return;
exception
when others then
     error_code := sqlcode;
     v_temp_var := substr(sqlerrm,1,150);
     error_message := v_temp_var;
end;
/
GRANT EXECUTE ON AE_CUSTOM.USP_TRUNCATE_TABLE TO S060331
/




CREATE TABLE AE_CUSTOM.TABLES_THAT_CAN_BE_TRUNCATED
(
    OWNER      VARCHAR2(32) NOT NULL,
    TABLE_NAME VARCHAR2(32) NOT NULL
)
ORGANIZATION HEAP
TABLESPACE AE_DATA
LOGGING
PCTFREE 10
PCTUSED 0
INITRANS 1
MAXTRANS 255
STORAGE(BUFFER_POOL DEFAULT)
NOPARALLEL
NOCACHE
NOROWDEPENDENCIES
NO INMEMORY
/
CREATE UNIQUE INDEX AE_CUSTOM.TRUNCATED_TB_IX
    ON AE_CUSTOM.TABLES_THAT_CAN_BE_TRUNCATED(OWNER,TABLE_NAME)
TABLESPACE AE_NDX
LOGGING
PCTFREE 10
INITRANS 2
MAXTRANS 255
STORAGE(INITIAL 16K
        BUFFER_POOL DEFAULT)
NOPARALLEL
NOCOMPRESS
/

GRANT SELECT ON AE_CUSTOM.TABLES_THAT_CAN_BE_TRUNCATED TO S060331
/




INSERT INTO AE_CUSTOM.TABLES_THAT_CAN_BE_TRUNCATED VALUES ('AE_CUSTOM','CODE')
INSERT INTO AE_CUSTOM.TABLES_THAT_CAN_BE_TRUNCATED VALUES ('AE_CUSTOM','QUERY_FILTER')



DECLARE
trunc_error_code number;
trunc_error_message varchar2(200);
BEGIN
   AE_CUSTOM.USP_TRUNCATE_TABLE('AE_CUSTOM','CODE',trunc_error_code,trunc_error_message);
END;
/


DECLARE
trunc_error_code number;
trunc_error_message varchar2(200);
BEGIN
   AE_CUSTOM.USP_TRUNCATE_TABLE('AE_CUSTOM','QUERY_FILTER',trunc_error_code,trunc_error_message);
END;
/



INSERT INTO AE_CUSTOM.QUERY_FILTER (QUERYNAME, FILTERNAME, VALUE) 
SELECT 'cms_memeber_extract','MEMBER_HCC_ID','101161150500' from dual
UNION ALL SELECT 'cms_memeber_extract','MEMBER_HCC_ID','101051636200' from dual
UNION ALL SELECT 'cms_memeber_extract','MEMBER_HCC_ID','101114013600' from dual
UNION ALL SELECT 'cms_memeber_extract','MEMBER_HCC_ID','101107570700' from dual
UNION ALL SELECT 'cms_memeber_extract','MEMBER_HCC_ID','101144983000' from dual;




select count(*) from AE_CUSTOM.QUERY_FILTER


INSERT INTO AE_CUSTOM.CODE VALUES ('xxxx01');
INSERT INTO AE_CUSTOM.CODE VALUES ('xxxx02');
INSERT INTO AE_CUSTOM.CODE VALUES ('xxxx03');
