http://www.dbspecialists.com/files/presentations/temp_space.html

!!! Temp datafiles size never goes down. It only goes up or stays the same. Real Sort/Temp space see sql below.


SELECT   A.tablespace_name tablespace, D.mb_total,
         SUM (A.used_blocks * D.block_size) / 1024 / 1024 mb_used,
         D.mb_total - SUM (A.used_blocks * D.block_size) / 1024 / 1024 mb_free
FROM     v$sort_segment A,
         (
         SELECT   B.name, C.block_size, SUM (C.bytes) / 1024 / 1024 mb_total
         FROM     v$tablespace B, v$tempfile C
         WHERE    B.ts#= C.ts#
         GROUP BY B.name, C.block_size
         ) D
WHERE    A.tablespace_name = D.name
GROUP by A.tablespace_name, D.mb_total;


--How to find out which tablespace is DEFAULT temp
SELECT * FROM DATABASE_PROPERTIES where PROPERTY_NAME='DEFAULT_TEMP_TABLESPACE';


************************************************************************************

---WKABDEV3 errors after DUPLICATE tests by Mike

1. Error

SQL> select * from dba_temp_files;
select * from dba_temp_files
*
ERROR at line 1:
ORA-01187: cannot read from file 201 because it failed verification tests
ORA-01110: data file 201: '/boraw1du203/oradata/wkabdev3/temp_01.dbf'


alter database tempfile '/boraw1du203/oradata/wkabdev3/temp_01.dbf' drop;
      ALTER TABLESPACE TEMP ADD TEMPFILE '/boraw1du203/oradata/wkabdev3/temp_01.dbf' SIZE 200M reuse;


alter database tempfile '/boraw1du205/oradata/wkabdev1/temp01.dbf' drop;
  ALTER TABLESPACE TEMP ADD TEMPFILE '/boraw1du205/oradata/wkabdev1/temp01.dbf' SIZE 6000M reuse;



alter database tempfile '/boraw1du205/oradata/wkabdev1/tivoliortempts.dbf' drop;
  ALTER TABLESPACE TEMP ADD TEMPFILE '/boraw1du205/oradata/wkabdev1/tivoliortempts.dbf' SIZE 100M reuse;


alter database tempfile '/boraw1du202/oradata/wkabdev3/tivoliortempts.dbf' drop;
  ALTER TABLESPACE TEMP ADD TEMPFILE '/boraw1du202/oradata/wkabdev3/tivoliortempts.dbf' SIZE 100M reuse;





 It was in a funny state.  Wouldn't let me re-add.
 I had to create a new temporary tablespace, make it default, drop the original and recreate it, then make it default again.

2. Error

SQL> select * from dba_temp_files;
ERROR:
ORA-01187: cannot read from file 202 because it failed verification tests
ORA-01110: data file 202: '/boraw1du203/oradata/wkabdev3/tivoliortempts.dbf'

alter database tempfile '/boraw1du203/oradata/wkabdev3/tivoliortempts.dbf' drop;
      ALTER TABLESPACE tivoliortempts ADD TEMPFILE '/boraw1du203/oradata/wkabdev3/tivoliortempts.dbf' SIZE 100M reuse;


****************** DR02 after Lift and Load issues *************************************

ORA-00054:

ORA-00054: Resource busy and acquire with NOWAIT specified 

This mean while issue truncate somebody had open cursor on table

Bounced the instance

Restarted and getting this error

ORA-01658: unable to create INITIAL extent for segment in tablespace TEMP

select * from v$session where status = 'KILLED'

kill -9 1265756

ps -ef | grep ora_

select * from v$sort_usage


select * from v$transaction
UBABLK field if going down this mean rollback 
             if going up this mean insert or update or delete going


Desion was made to re create TEMP tablespace change from Dictionary to LOCAL

DROP TABLESPACE temp INCLUDING CONTENTS; 
CREATE TEMPORARY TABLESPACE TEMP
    TEMPFILE '/u24/oracle/DR02/temp/temp_DR02_01.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_02.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_03.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_04.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_05.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_06.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_07.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_08.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_09.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_10.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_11.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_12.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_13.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_14.dbf' SIZE 2000M REUSE AUTOEXTEND OFF,
             '/u24/oracle/DR02/temp/temp_DR02_15.dbf' SIZE 2000M REUSE AUTOEXTEND OFF
    EXTENT MANAGEMENT LOCAL UNIFORM SIZE 1M
    /


We had ROLL Back errors Mike just added extra datafiles


alter database tempfile '/oratemp/pihmsu003/DPGMP000/temp01.dbf' drop;

alter database tempfile '/oratemp/pihmsu003/DPMGP000/temp01.dbf' drop;
alter database tempfile '/oratemp/pihmsu003/DPMGP000/tivoliortempts.dbf' drop;
alter database tempfile '/oratemp/pihmsu003/DPGMP000/tivoliortempts.dbf' drop;


ALTER TABLESPACE TEMP ADD TEMPFILE '/oratemp/pihmsu003/DPGMP000/temp01.dbf' SIZE 1000M reuse;
ALTER TABLESPACE tivoliortempts ADD TEMPFILE '/oratemp/pihmsu003/DPGMP000/tivoliortempts.dbf' SIZE 150M reuse;

*************** To see what is using Temp tablespace most ******************

select * from v$sort_usage


select sql_id,max(TEMP_SPACE_ALLOCATED)/(1024*1024*1024) gig 
from DBA_HIST_ACTIVE_SESS_HISTORY 
where 
sample_time
 BETWEEN
 to_date ('2017-10-17T04:20:00', 'YYYY-MM-DD"T"HH24:MI:SS')
   AND
 
  to_date ('2017-10-17T04:37:00', 'YYYY-MM-DD"T"HH24:MI:SS')
    and 

TEMP_SPACE_ALLOCATED > (50*1024*1024*1024) 
group by sql_id order by sql_id;


************ Temp Tables ***************

There’s no reason you can’t use temporary tables - but temporary tables in Oracle are not the same as temporary tables in SQL Server or Sybase. 
You don’t create global temporary tables within a PL/SQL procedure or function.  You would create the global temporary table once with whatever definition you want.
The contents of it though are temporary.  They are only visible to the current session and the data is discarded when you commit or when you disconnect - 
depending on the setting for “on commit” when you created the global temporary table.

So - if you want to use a global temporary table in Oracle, you create the global temporary table once along with whatever build you go with to create your procedures. 
 You reference it and use it in your procedures just like any other table - but there is no persistent storage for the data, any work you do is done in a temporary segment 
in the default temporary tablespace for your session and discarded when you disconnect (or commit depending on how you created it).

Mike

