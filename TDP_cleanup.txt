APHMM1D-ORA	/DDV3T000	bkp_DDV3T000_f817936232_s586_s	oracle	06/12/2013
APHMM1D-ORA	/DDV3T000	bkp_DDV3T000_f817936298_s587_s	oracle	06/12/2013
APHMM1D-ORA	/DDV3T000	bkp_DDV3T000_f817936304_s588_s	oracle	06/12/2013
APHMM1D-ORA	/DDV3T000	bkp_DDV3T000_f844288232_s1308_	oracle	04/07/2014
APHMM1D-ORA	/DDV3T000	bkp_DDV3T000_f844288760_s1309_	oracle	04/07/2014
APHMM1D-ORA	/DDV3T000	bkp_DDV3T000_f844353613_s1311_	oracle	04/08/2014
APHMM1D-ORA	/DDV3T000	bkp_DDV3T000_f849454867_s1313_	oracle	06/05/2014
APHMM1D-ORA	/DDV3T000	bkp_DDV3T000_f849454885_s1314_	oracle	06/05/2014
APHMM1D-ORA	/DDV3T000	bkp_DDV3T000_f849455637_s1315_	oracle	06/05/2014
APHMM1D-ORA	/DDV3T000	c-1690466669-20140408-00	oracle	04/08/2014
APHMM1D-ORA	/DDV3T000	c-1690466669-20140605-00	oracle	06/05/2014



CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/home/oracle/tdpoopt/tdpo.DNTMT001.opt)' FORMAT   'bkp_%d_f%t_s%s_s%p';

tdpo.DDV3T000.opt

dsmc -virtualnodename=aphmm1d-ora



***********************************




connect catalog DDV3T000/DDV3T000namr@RCATDEV


DDV3T000:/orahome/allu01/app/oracle/product/11.2.0/db_2:Y:/orahome/allu01:/orabackup/pihmsu001

***********************************************************************************************
Berman, Eugene 10:10 AM
Hey
Swafford, Mike 10:10 AM
Hey
Berman, Eugene 10:11 AM
Can I share my screen and let you check purge. I am not sure if I am doing it correctly
Swafford, Mike 10:11 AM
Sure
Berman, Eugene 10:13 AM
So I see few backups for DDV3T000 in list
want to start with that 
Swafford, Mike 10:13 AM
OK.  So for that, if they are in the rman catalog, you can just issue manual deletes.
rman target / catalog ...
then do delete backup 
specifying the recid I think
Or you can unregister it
then do tdposync to delete the records from TDP
Berman, Eugene 10:15 AM
So for every database this is how you do it
Swafford, Mike 10:15 AM
It depends.  
There are different conditions that may exist.
The only thing that Dennis' report shows is old backups
The question is why are they old and why aren't they getting cleaned up
so you have to look at:
1) Are the backups in the rman catalog?  If so, why are they not getting purged?
2) If they are not in the rman catalog, why did they not get removed from TDP
If the backups ARE in the rman catalog, then you can look at cleaning up the catalog and TDP at the same time.
If the backups aren't in the rman catalog, you can just use TDPOSYNC or dsmc to delete them and you're good to go, you just have to figure out if there is something that causes the two to get out of sync.
Berman, Eugene 10:18 AM
This particular DB no longer exist
Swafford, Mike 10:19 AM
Is the database still in the rman catalog
>
?
Berman, Eugene 10:19 AM
yes
Swafford, Mike 10:19 AM
Then you can unregister the database from rman
catalog
then you can use tdposync to clear up the backups
Berman, Eugene 10:20 AM
Ok. I tried to do that and it failed to connect 
what is password 
Swafford, Mike 10:20 AM
when you unregistered, did you remove the user-id from rman
?
Berman, Eugene 10:20 AM
I did not do that yet
I just tried to do tdposync 
Swafford, Mike 10:20 AM
OK
Hmm.  Looks like the logon is gone
but there's another way to delete them.
Berman, Eugene 10:22 AM
So nornally you would enter DB name as user id and rman password for password ?
Swafford, Mike 10:22 AM
yes
Berman, Eugene 10:22 AM
ok. I was able to login via sqlplus. I will try one more time
Swafford, Mike 10:22 AM
ok
Berman, Eugene 10:22 AM
But first I will unregist from catalog
like you said
Swafford, Mike 10:22 AM
ok
if that doesn't work, you can also delete them via dsmc
Anyway, once all of the backups are gone, you can delete the schema from the rman catalog as well to finish the clean-up.
Berman, Eugene 10:25 AM
sure. I will try that
fire alarm in Hartford office got to run :)
Swafford, Mike 10:26 AM
Yikes
later!
Swafford, Mike 10:34 AM
FYI - I wrote a hack of a script a while back so I could get a report of old backups
it's out on most of the workability/pihms boxes in
$HOME/mfs/backupcheck.sh
it checks the TDP catalog for old backups that would show up on Dennis' report
Berman, Eugene 10:56 AM
what is user id / password for dsmc
Swafford, Mike 10:56 AM
Hi
Berman, Eugene 10:56 AM
dsmc -virtualnodename=aphmm1d-ora
Swafford, Mike 10:57 AM
ahh
enter for the username
the oracle for the password
Berman, Eugene 10:59 AM
yes got it. Thanks
Berman, Eugene 11:16 AM
So I can still login to catalog. But since DB no longer exist it not allow me to issue any rman commands 
I was able to login with tdposync SYNCdb -TDPO_OPTfile=/home/oracle/tdpoopt/tdpo.DDV3T000.opt
Getting following message:
The TSM Server is Synchronized with the Oracle Catalog or there 
are no matching files in the requested filespace.
and it disconnects
Swafford, Mike 11:18 AM
yes
that's good
that means that it didn't find any mismatches
Berman, Eugene 11:18 AM
Is any way I can use just dsmc to delete 
Swafford, Mike 11:18 AM
Yes
Berman, Eugene 11:18 AM
This does reports what was on list q ba -todate=06/05/2014 /DDV3T000/
Swafford, Mike 11:18 AM
do this
when you're logged on to dsmc
with the virtualnode
the issue
d ba -todate 11/24/2014 /DDV3T000/
that should find any backups for that filespace before yesterday
and let you delete them
the d is for delete
Berman, Eugene 11:20 AM
Ok. Let me try that
Ok. Done with that one. Thanks. I will look into other ones from that list.


************************************************************************************************

dsmc -virtualnodename=aphmm1d-ora

-> Just hit ENTER for username
-->Type oracle as password

--Report
q ba -todate=11/24/2014 /DDV3T000/


-- to delete
d ba -todate=11/24/2014 /DDV3T000/

tdposync SYNCdb -TDPO_OPTfile=/home/oracle/tdpoopt/tdpo.DDV3T000.opt





. $SETUPENV DNTMT001

1. Do this first unless already in place with regular backup

rman
connect target /

crosscheck backup;

delete obsolete;


connect catalog DNTMT001/DNTMT001namr@RCATDEV



2. tdposync SYNCdb -TDPO_OPTfile=/home/oracle/tdpoopt/tdpo.DNTMT001.opt

1:50+
ok


3. dsmc -virtualnodename=aphmm1d-ora

-> Just hit ENTER for username
-->Type oracle as password

--Report
q ba -todate=09/09/2014 /DNTMT001/
--to delete
###d ba -todate=09/09/2014 /DNTMT001/




. $SETUPENV DNTMT003

1. Do this first unless already in place with regular backup

rman
connect target /
connect catalog DNTMT003/DNTMT003namr@RCATDEV


DELETE NOPROMPT OBSOLETE;
crosscheck backup;





2. tdposync SYNCdb -TDPO_OPTfile=/home/oracle/tdpoopt/tdpo.DNTMT003.opt

1:50+
ok


3. dsmc -virtualnodename=aphmm1d-ora

-> Just hit ENTER for username
-->Type oracle as password

--Report
q ba -todate=10/21/2014 /DNTMT003/
--to delete
###d ba -todate=10/21/2014 /DNTMT003/




. $SETUPENV DNTMTRP1

1. Do this first unless already in place with regular backup

rman
connect target /
connect catalog DNTMTRP1/DNTMTRP1namr@RCATDEV


DELETE NOPROMPT OBSOLETE;
crosscheck backup;





2. tdposync SYNCdb -TDPO_OPTfile=/home/oracle/tdpoopt/tdpo.DNTMTRP1.opt

1:50+
ok


3. dsmc -virtualnodename=aphmm1d-ora

-> Just hit ENTER for username
-->Type oracle as password

--Report
q ba -todate=09/09/2014 /DNTMTRP1/
--to delete
###d ba -todate=09/09/2014 /DNTMTRP1/




*******************************aphmm1q****************

. $SETUPENV DNTMQ001

1. Do this first unless already in place with regular backup

rman
connect target /
connect catalog DNTMQ001/DNTMQ001namr@RCATDEV


DELETE NOPROMPT OBSOLETE;
crosscheck backup;





2. tdposync SYNCdb -TDPO_OPTfile=/home/oracle/tdpoopt/tdpo.DNTMQ001.opt

1:50+
ok


3. dsmc -virtualnodename=aphmm1q-ora

-> Just hit ENTER for username
-->Type oracle as password

--Report
q ba -todate=09/06/2015 /DNTMQ001/
--to delete
###d ba -todate=09/06/2015 /DNTMQ001/




. $SETUPENV DNTMQ002

1. Do this first unless already in place with regular backup

rman
connect target /
connect catalog DNTMQ002/DNTMQ002namr@RCATDEV


DELETE NOPROMPT OBSOLETE;
crosscheck backup;





2. tdposync SYNCdb -TDPO_OPTfile=/home/oracle/tdpoopt/tdpo.DNTMQ002.opt

1:50+
ok


3. dsmc -virtualnodename=aphmm1q-ora

-> Just hit ENTER for username
-->Type oracle as password

--Report
q ba -todate=09/06/2015 /DNTMQ002/
--to delete
###d ba -todate=09/06/2015 /DNTMQ002/


. $SETUPENV DNTMQ003

1. Do this first unless already in place with regular backup

rman
connect target /
connect catalog DNTMQ003/DNTMQ003namr@RCATDEV


DELETE NOPROMPT OBSOLETE;
crosscheck backup;





2. tdposync SYNCdb -TDPO_OPTfile=/home/oracle/tdpoopt/tdpo.DNTMQ003.opt

1:50+
ok


3. dsmc -virtualnodename=aphmm1q-ora

-> Just hit ENTER for username
-->Type oracle as password

--Report
q ba -todate=09/06/2015 /DNTMQ003/
--to delete
###d ba -todate=09/06/2015 /DNTMQ003/


. $SETUPENV DNTMQ004

1. Do this first unless already in place with regular backup

rman
connect target /
connect catalog DNTMQ004/DNTMQ004namr@RCATDEV


DELETE NOPROMPT OBSOLETE;
crosscheck backup;





2. tdposync SYNCdb -TDPO_OPTfile=/home/oracle/tdpoopt/tdpo.DNTMQ004.opt

1:50+
ok


3. dsmc -virtualnodename=aphmm1q-ora

-> Just hit ENTER for username
-->Type oracle as password

--Report
q ba -todate=09/06/2015 /DNTMQ004/
--to delete
###d ba -todate=09/06/2015 /DNTMQ004/




. $SETUPENV DNTMQRP1

1. Do this first unless already in place with regular backup

rman
connect target /
connect catalog DNTMQ004/DNTMQ004namr@RCATDEV


DELETE NOPROMPT OBSOLETE;
crosscheck backup;





2. tdposync SYNCdb -TDPO_OPTfile=/home/oracle/tdpoopt/tdpo.DNTMQRP1.opt

1:50+
ok


3. dsmc -virtualnodename=aphmm1q-ora

-> Just hit ENTER for username
-->Type oracle as password

--Report
q ba -todate=09/06/2015 /DNTMQ004/
--to delete
###d ba -todate=09/06/2015 /DNTMQ004/


*********************************datamart********


. $SETUPENV DNTMPRP1

1. Do this first unless already in place with regular backup

rman
connect target /
connect catalog DNTMPRP1/DNTMPRP1namr@RCATPROD


DELETE NOPROMPT OBSOLETE;
crosscheck backup;





2. tdposync SYNCdb -TDPO_OPTfile=/home/oracle/tdpoopt/tdpo.DNTMPRP1.opt

1:50+
ok


3. dsmc -virtualnodename=datamart-ora

-> Just hit ENTER for username
-->Type oracle as password

--Report
q ba -todate=09/06/2015 /DNTMPRP1/
--to delete
###d ba -todate=09/06/2015 /DNTMPRP1/


*********************************aoradbm1p********


. $SETUPENV DEDYP001

1. Do this first unless already in place with regular backup

rman
connect target /
connect catalog DEDYP001/DEDYP001namr@RCATPROD


DELETE NOPROMPT OBSOLETE;
crosscheck backup;





2. tdposync SYNCdb -TDPO_OPTfile=/home/oracle/tdpoopt/tdpo.DEDYP001.opt

1:50+
ok


3. dsmc -virtualnodename=aoradbm1p-ora

-> Just hit ENTER for username
-->Type oracle as password

--Report
q ba -todate=09/06/2015 /DEDYP001/
--to delete
###d ba -todate=09/06/2015 /DEDYP001/



dsmc -virtualnodename=aebsm1p-ora


--Report
q ba -todate=09/06/2015 /PPMP01/
--to delete
###d ba -todate=09/06/2015 /PPMP01/



***********Mikes script******

I have a script out on most of the boxes:
$HOME/mfs/backupcheck.sh

You can run that to show the old backups.  
On the prod boxes there really shouldn’t be any.  Usually the old backups come from duplications.  I think for datamart it was like an old backup from when we created DNTMPRP1 or something.  Not sure why that was still there but I cleaned it up.

Mike



***************HEPYTST*********************

rmanc

show all;


/home/oracle/tdpoopt/tdpo.HEPYTST.opt


2. tdposync SYNCdb -TDPO_OPTfile=/home/oracle/tdpoopt/tdpo.HEPYTST.opt

1:50+
ok

 
3. dsmc -virtualnodename=xhepydbw24d-ora

-> Just hit ENTER for username
-->Type oracle as password

--Report
q ba -todate=08/28/2020 /HEPYTST/
--to delete
###d ba -todate=09/06/2015 /DEDYP001/
