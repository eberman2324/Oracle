y       TomSchloendorn          schloendornt@Aetna.com

archivelog_backup.rman

tag archivelog_backup

rman << EOF
connect target /
connect catalog ${connstrng}@rmanwdev
set echo on
SPOOL LOG TO '${FN}' APPEND
list backup;
SPOOL LOG OFF
EOF


            rman
            connect target /
            connect catalog ${ORACLE_SID}/${rmanpass}@$RMAN_SID
            << EOF
            run
             {
             sql 'ALTER SYSTEM ARCHIVE LOG CURRENT';
             
             }
             EOF


     0403-057 Syntax error at line 101 : `<' is not matched.


            rman  target / catalog ${ORACLE_SID}/${rmanpass}@$RMAN_SID << EOF cmdfile=${SCRDIR}/$CMDFILE EOF
            
            



TAG $ARCHIVE_TAG
tag="ARCHIVE_TAG_${ORACLE_SID}"


if [ "$CMDFILE" = "archivelog_backup.rman" ]
then
   send_message $? "SUCCESSFUL - RMAN ARCHIVELOG Backup of $ORACLE_SID successful"
else
   send_message $? "SUCCESSFUL - RMAN FULL Backup of $ORACLE_SID successful"
fi

#!/bin/sh
if [ "$1" = "1" ]
then
   echo "The first choice is nice"
elif [ "$1" = "2" ]
then
   echo "The second choice is just as nice"
elif [ "$1" = "3" ]
then
   echo "The third choice is excellent"
else
   echo "I see you were wise enough not to choose"
   echo "You win"
fi
        
 

run
 {
  sql 'ALTER SYSTEM ARCHIVE LOG CURRENT';
  BACKUP
  filesperset 20
  #FORMAT '/u10/oraback/DPDEVUG/rman_backups/arc_df%t_s%s_s%p'
  tag="ARCHIVE_TAG_${ORACLE_SID}"
  skip inaccessible
  ARCHIVELOG ALL
  DELETE INPUT;
}
exit;
`<' is not m
 tag="ARCHIVE_TAG_${ORACLE_SID}"

**********

rman << EOF
connect target /
connect catalog ${ORACLE_SID}/${rmanpass}@$RMAN_SID
run
{
sql 'ALTER SYSTEM ARCHIVE LOG CURRENT';
BACKUP
filesperset 20
FORMAT '/u10/oraback/$ORACLE_SID/rman_backups/arc_df%t_s%s_s%p'
tag =ARCHIVE$tagdt$tm
skip inaccessible
ARCHIVELOG ALL
DELETE INPUT;
}
exit;
EOF


rman << EOF
            target / catalog ${ORACLE_SID}/${rmanpass}@$RMAN_SID
            run
             {
             sql 'ALTER SYSTEM ARCHIVE LOG CURRENT';
             BACKUP
  	     filesperset 20
             FORMAT '/u10/oraback/DPDEVUG/rman_backups/arc_df%t_s%s_s%p'
             tag =ARCHIVE$tagdt$tm
             skip inaccessible
             ARCHIVELOG ALL
             DELETE INPUT;
             }
             exit;
             EOF
rman_backup.DPDEV89.112007.111841.log

TAG 20071116T234110

TAG=ARCHIVE_`date +%Y%m%d`

export tagdt=`date +%Y%m%d`

if [ "$CMDFILE" = "archivelog_backup.rman" ]
then

./rman_general_purpose.ksh DPDEV89 rmanwdev full_level0_backup
./rman_general_purpose.ksh DPDEV89 rmanwdev archivelog_backup


if [ "$CMDFILE" = "archivelog_backup" ]
then

elif [ "$CMDFILE" = "full_level0_backup" ]
then
   run
{
   BACKUP DATABASE PLUS ARCHIVELOG DELETE INPUT;
   DELETE NOPROMPT OBSOLETE;

}
exit;


***********
if [ "$CMDFILE" = "archivelog_backup" ]
then

rman << EOF
connect target /
connect catalog ${ORACLE_SID}/${rmanpass}@$RMAN_SID
run
{






sql 'ALTER SYSTEM ARCHIVE LOG CURRENT';
BACKUP
filesperset 20
FORMAT '/u10/oraback/$ORACLE_SID/rman_backups/arc_df%t_s%s_s%p'
tag=ARCHIVE$tagdt$tm
skip inaccessible
ARCHIVELOG ALL
DELETE INPUT;
}
exit;
EOF
elif [ "$CMDFILE" = "full_level0_backup" ]
then
rman << EOF
connect target /
connect catalog ${ORACLE_SID}/${rmanpass}@$RMAN_SID
run
{
BACKUP DATABASE  PLUS ARCHIVELOG DELETE INPUT TAG FULL$tagdt$tm;
DELETE NOPROMPT OBSOLETE;
}
exit;
EOF
fi



  if [ "$CMDFILE" = "archivelog_backup" ]
  then
      mailx -s "SUCCESSFUL - RMAN ARCHIVELOG Backup of $ORACLE_SID"  bermanE@Aetna.com
      mailx -s "SUCCESSFUL - RMAN ARCHIVELOG Backup of $ORACLE_SID"  schloendornt@Aetna.com
 

  elif [ "$CMDFILE" = "full_level0_backup" ]
  then
     mailx -s "SUCCESSFUL - RMAN FULL Backup of $ORACLE_SID"  bermanE@Aetna.com
     mailx -s "SUCCESSFUL - RMAN FULL Backup of $ORACLE_SID"  schloendornt@Aetna.com 
  fi



********************

CREATE USER A238055 IDENTIFIED BY VALUES 'password'
    DEFAULT TABLESPACE USERS
    TEMPORARY TABLESPACE TEMP
    PROFILE APP_USER_PROFILE
    PASSWORD EXPIRE
    ACCOUNT UNLOCK
/
GRANT "CONNECT" TO A238055
/
GRANT "RESOURCE" TO A238055
/
GRANT APP_USER_ROLE TO A238055
/
ALTER USER A238055 DEFAULT ROLE "CONNECT",
                                "RESOURCE",
                                APP_USER_ROLE
/
GRANT UNLIMITED TABLESPACE TO A238055
/


CREATE USER A238055 IDENTIFIED BY "password"
    DEFAULT TABLESPACE USERS
    TEMPORARY TABLESPACE TEMP
    PROFILE APP_USER_PROFILE
    ACCOUNT UNLOCK
/
GRANT APP_USER_ROLE TO A238055
/
GRANT "CONNECT" TO A238055
/
GRANT "RESOURCE" TO A238055
/
ALTER USER A238055 DEFAULT ROLE APP_USER_ROLE,
                                "CONNECT",
                                "RESOURCE"
/


GRANT UNLIMITED TABLESPACE TO A238055
/

**************************************************************************
send_message() {
   # post_message $2
   # $SCRDIR/set_page.scr $2
  if [ "$CMDFILE" = "archivelog_backup" ]
  then
      post_message "SUCCESSFUL - RMAN ARCHIVELOG Backup of $ORACLE_SID"
      mailx -s "SUCCESSFUL - RMAN ARCHIVELOG Backup of $ORACLE_SID"  bermanE@Ae
na.com
     # mailx -s "SUCCESSFUL - RMAN ARCHIVELOG Backup of $ORACLE_SID"  schloendo
nt@Aetna.com
 exit

  elif [ "$CMDFILE" = "full_level0_backup" ]
  then
     post_message "SUCCESSFUL - RMAN FULL Backup of $ORACLE_SID"
     mailx -s "SUCCESSFUL - RMAN FULL Backup of $ORACLE_SID"  bermanE@Aetna.com
    # mailx -s "SUCCESSFUL - RMAN FULL Backup of $ORACLE_SID"  schloendornt@Aet
a.com
 exit
  fi

}
**************************************************************
  if [ "$CMDFILE" = "archivelog_backup" ]
  then
   send_message $? "SUCCESSFUL - RMAN ARCHIVELOG Backup of $ORACLE_SID"
  elif [ "$CMDFILE" = "full_level0_backup" ]
  then
   send_message $? "SUCCESSFUL - RMAN FULL Backup of $ORACLE_SID" 
  else
   send_message $? "SUCCESSFUL - RMAN restore of $ORACLE_SID" 
  fi