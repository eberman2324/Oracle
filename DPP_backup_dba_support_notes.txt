Review DDL/Grant Security To Development or QA DataBase

An email request will come in via the EMS Database Administration alias.
SQL file(s) will be attached.  You'll want to confirm the SQL File(s)
have the following:

1) The file has the statement whenever sqlerror exit failure;
2) The syntax looks correct (no errors)
3) In regards to views, the script has CREATE OR REPLACE VIEW as opposed to DROP VIEW
4) Question any new table that doesn't have an index

Upon completion of your SQL File review, reply to email indicating everything looks ok.
Be sure to include requestor on email distribution list.

You'll then receive an email indicating something like:
  "All Set. Please run grants, syns, etc"

At that point, you'll need to grant permissions, analyze tables, and create synonyms 


Log on to the specified test or QA Unix server as the Oracle account

Enter the database name when prompted

Change directory to where the security shell script resides
cd $SECSCR
DPDEV92
DPUAT92

DPDRYRUN


DPPRD01

!!!!No need to run twice.  If you do however, adjust the time when prompted to be just x minutes
!!!!Moving forward, please request running the permissions script at the end of your implementation just prior to notifying the customer.
!!!!There is no reason to have the permission script run more than once during an implementation.


Run the security shell script:
psoft_permissions.ksh

Enter database name when prompted

You'll then be prompted with the following:

Enter the number of days to look back from current date
If hours, enter in format x/24 where x is the no. of hrs

Enter 2/24  (denotes two hours)
(If they want to run for more then 1 day use one number without "/")
Enter 1 for 1 day or 2 for days etc..

if less then 1 hour

!!! 15 min Type: 15/(24*60)


!!!30 minutes type: 1/48

select sysdate - 1/48 from dual; 


Review script output (confirm all reviewed objects above were created/replaced, analyzed, granted 
permissions, and synonyms created(where applicable))

Change directory to where the security shell script output resides

cd $SECLOG

view create_pubsyn.out
view create_grants.out 
view analyze.out

Reply to email indicating grants, syns, etc applied.  Be sure to include requestor
on email distribution list.
----------------------------------------------------------------------------------
Export/Import Request

If a request is sent to perform an import or an export, a document should be sent
to you as well.  Inside the doc will list the table name(s) and the actions to be 
performed.  The work cannot be complete w/o the doc.

Below is an example of an export/import request.

For an export, you'll see something like the following in the attached doc:

Migrate ? Table Name 		New Table (Y/N)	Source DB  Target DB  Migration Process  Migration Type
X	  PS_AI_ELIGCNFG1_TB	N		PSPROD	   PSPREPRD   E 		 R	


The above denotes an export is to occur against source db PRPROD for table PS_AI_ELIGCNFG1_TB.
The tabe PS_AI_ELIGCNFG1_TB in target db PSPREPRD is to be truncated (Migration type R) prior
to the import into target db PSPREPRD.  To complete the above request, you'll need to do the following:

Log on to source server SPSP as your aetna ID

Obtain the current zopa for the Oracle Unix account
cd /spspu01/app/oracle
cat .oracle.pw

su -a oracle

Enter PSPROD when prompted to enter db name

Change directory to where the export/import parameter files reside
cd $PARDIR

ls -ltr *.par

copy an export par file to new name and make changes to par file accordingly

run the export

Update the doc with export output info:

Export from PSPROD performed by T.S. on MM/DD/YYYY at HH:MM a.m. est.

About to export specified tables via Conventional Path ...
Current user changed to SYSADM
. . exporting table             PS_AI_ELIGCNFG1_TB         34 rows exported
Export terminated successfully without warnings.


Copy export file to SPSQ


cd /spspu130/oraback/export
rcp -pr your_export_file_name_goes_here.dmp spsq:/spsqu109/oraback/export/your_export_file_name_goes_here.dmp


Log completely off SPSP


Log on to SPSQ as the Oracle account

Enter the database name (PSPREPRD) when prompted.

Change directory to where the export/import parameter files reside
cd $PARDIR

ls -ltr *.par

copy an import par file to new name (latest similar) and make changes to par file accordingly

Log on to PSPREPRD via SQLPlus as the system account or your ZZ ID

truncate table SYSADM.PS_AI_ELIGCNFG1_TB
exit

run the import

Update the doc with import output info:

Import into PSPREPRD performed by T.S. on 5/2/2006 at 10:47 a.m. est.

import done in WE8ISO8859P1 character set and AL16UTF16 NCHAR character set
. importing SYSADM's objects into SYSADM
. . importing table           "PS_AI_ELIGCNFG1_TB"         34 rows imported
Import terminated successfully without warnings.

Reply to email indicating export/import complete.  Be sure to include requestor on email distribution
list.
-----------------------------------------------------------------------------------------
Save current database backup (example below illustrates saving the backup for db DPDEMO91)

Log on to the specified test or QA server as the Oracle account

Enter the database name when prompted (DPDEMO91)

Change directory to where the save backup shell script resides
cd $BKPSCR

###### savebkp.ksh <dbname> <save reason>

savebkp.ksh DPDEV92 b4tax18C
savebkp.ksh DPUAT92 b4tax18C

savebkp.ksh DPDEV92 b4tax18D
savebkp.ksh DPUAT92 b4tax18D

savebkp.ksh DPDEV92 b4tax18E
savebkp.ksh DPUAT92 b4tax18E

savebkp.ksh DPDEV92 b4tax19A
savebkp.ksh DPUAT92 b4tax19A


savebkp.ksh DPDEV92 b4tax19C
savebkp.ksh DPUAT92 b4tax19C


savebkp.ksh DPDEV92 b4tax19D
savebkp.ksh DPUAT92 b4tax19D

savebkp.ksh DPDEV92 b4tax19E
savebkp.ksh DPUAT92 b4tax19E

savebkp.ksh DPDEV92 b4tax19EP
savebkp.ksh DPUAT92 b4tax19EP

savebkp.ksh DPDEV92 bRestoreForTraining


savebkp.ksh DPDEV92 b4tax20A
savebkp.ksh DPUAT92 b4tax20A


savebkp.ksh DPDEV92 b4tax20B
savebkp.ksh DPUAT92 b4tax20B

savebkp.ksh DPDEV92 bDecomm

 
Note:  This is a RMAN backup.  It will generate a RMAN script and output file.

       To confirm backup exist:
       cd $SAVBKP and look for the RMAN script that saved the backup.  

	DPDEV91_sbk_20130123_22:45:00_b4tax13A.rman
        DPDEMO91_sbk_20130331_22:00:00_b4tax13B.rman
        DPDEMO91_sbk_20131020_22:00:01_b4tax13E.rman

	Open the file and look for the TAG of the backup set, and using RMAN command to list the backup set.
------------------------------------------------------------------------------
Production DataBase Requests

No work except an export can be performed against PSPROD, PSIA, or PSPRDARC w/o
an Remedy ticket.
------------------------------------------------------------------------------
Database Backup - Example uses DPDEMO91

Log on to the specified test or QA server as the Oracle account

Enter the database name when prompted (DPDEMO91)

Change directory to where the backup shell script resides
cd $BKPSCR

rm nohup.out

nohup dbbackup_rman DPDEMO91 &
------------------------------------------------------------------------------
Database Restore Request

Contact App Admins to bring down process scheduler and app servers on PSSBOX8

Take a database backup (See above example of Database backup)

Save database backup (See above example to save current database backup)
   
Go to either $BKPLOG or $SAVBKP if restore from a saved backup, and locate the RMAN script.
	DPUAT91_sbk_20140701_22:55:07_bPT8_52_21.rman

Copy the file to another name
	cp -r DPUAT91_sbk_20140701_22:55:07_bPT8_52_21.rman Restore_DPUAT91_sbk_20140701_22:55:07_bPT8_52_21.rman

Modify the copied file where you comment out the backup section in the script and uncomment the restore section of the RMAN commands.

Run it through RMAN

rman
RMAN> Restore_DPDEV91_sbk_20130206_22:45:00.rman

Contact App Admins to bring up process scheduler and app servers

Respond to requestor indicating request is complete.



DPUAT91_sbk_20140701_22:55:07_bPT8_52_21.rman




connect target /
connect catalog DPUAT91/DPUAT91namr@RCATDEV
startup force nomount;
set DBID=2332859867;
reset database to incarnation 22847;
restore controlfile from '/u10/oraback/DPUAT91/rman_backups/c-2332859867-20140701-06';
alter database mount;
run{
restore database until sequence 79845;
recover database until sequence 79845;
}
alter database open resetlogs;



sysadm/fxw8mY$z


select * from sysadm.tom

truncate table sysadm.tom


1. blackout the db in GC

 comment this in cron before you start

  . ~/.profile

    GCAGENT



              emctl start blackout ${HOST}blkp -nodeLevel -d 1 01:00

      emctl status blackout





   ###emctl start blackout DPUAT91_blackout_20130405 DPUAT91.world -d  1:00



2.   0,15,30,45 0-20 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPUAT91 > /dev/null

3. 
    cd $HOME
   ./.profile

    DPUAT91

   shutdown the db first


4. 

connect target /
connect catalog DPUAT91/DPUAT91namr@RCATDEV
startup force nomount;
set DBID=2332859867;
reset database to incarnation 22847;
restore controlfile from '/u10/oraback/DPUAT91/rman_backups/c-2332859867-20140701-06';
alter database mount;
run{
restore database until sequence 79845;
recover database until sequence 79845;
}
alter database open resetlogs;


5. after restore
   select * from AETNADBA.RMAN_HEARTBEAT
   compare to backup log in $BKPLOG

   Current TimeStamp 
   ---------------------- 
   04-04-2013 10:55:19 PM
   or somewhere in there
   depending if another cron fired
   certainly not before
   maybe within 15 minutes or so
   I think I fire this job every 5 minutes in prod

   if you plan on querying the heartbeat table from SQLPlus, do the following once the restore is complete


   export NLS_DATE_FORMAT='YYYY-MM-DD HH24:MI:SS'
   sql => select * from AETNADBA.RMAN_HEARTBEAT;


   

6. uncomment cron job



7. end blackout


   cd $HOME
   . ~/.profile

   CAGENT

      emctl stop blackout ${HOST}blkp

    emctl stop blackout DPUAT91_blackout_20130405
------------------------------------------------------------------------------
Development DataBases - Unix server DPPDEV

DPDEMO91
DPDEV91
DPDEVUG

QA DataBases - Unix server DPPQA
DPUAT91
DPDRYRUN

Prod DataBases - Unix server SPONDE45
DPPROD1
DPPROD2



************ Misc *****************


We are applying Tools Patch 8.52.12 to DPDEMO91. I need last nights backup set aside and will need DBA's to review DDL and run permissions script......Thanks Rick


Do I need save backup first?
Cai, Peter Z 10:03 AM
Yes, you will need to save the backup first.  Using the savebkp script
Berman, Eugene 10:03 AM
ok. 
Cai, Peter Z 10:05 AM
When you done, you should get an email with the name of the script used to save the backup.  Use that to reply back saying the backup has been saved to ....
Berman, Eugene 10:06 AM
Ok. Would RIck email me scripts for reveiw after that ?
Cai, Peter Z 10:07 AM
Yes, after you review it, then let him know it is OK with you
Berman, Eugene 10:07 AM
Ok.  SO he will execute them right? and let me know so I can apply permission
Cai, Peter Z 10:08 AM
Yes, then you run the permission scirpt
Berman, Eugene 10:08 AM
Thanks
Cai, Peter Z 10:09 AM
Make sure you put that script name in the SR when you close it for reference
Berman, Eugene 10:10 AM
DO you mean backup script or Rick's script ?
Cai, Peter Z 10:10 AM
The script that saved the backup
Berman, Eugene 10:10 AM
ok


************** Duplcate Database process ***************

Duplicate from saved backup of DPDEMO91 to new DB DPBCKOUT

cd /u01/app/oracle/aetna/db_admin/db_DPDEMO91/save_backup

DPDEMO91_sbk_20130213_22:00:00_b4ToolPatch85212.rman 


Tom's instructions...>

select 'set newname for datafile '||file_id||' to '||chr(39)||replace(file_name,'DPDEMO91','DPBCKOUT')||chr(39)||';'
from   dba_data_files
order by file_id;


set newname for datafile 1 to '/u02/oradata/DPBCKOUT/system01.dbf';
set newname for datafile 2 to '/u02/oradata/DPBCKOUT/sysaux01.dbf';
set newname for datafile 3 to '/u08/oradata/DPBCKOUT/psundots01.dbf';
set newname for datafile 4 to '/u06/oradata/DPBCKOUT/psdefault.dbf';
set newname for datafile 5 to '/u02/oradata/DPBCKOUT/aalarge.dbf';
set newname for datafile 6 to '/u02/oradata/DPBCKOUT/adapp.dbf';
set newname for datafile 7 to '/u02/oradata/DPBCKOUT/amapp.dbf';
set newname for datafile 8 to '/u02/oradata/DPBCKOUT/avapp.dbf';
set newname for datafile 9 to '/u02/oradata/DPBCKOUT/bdapp.dbf';
set newname for datafile 10 to '/u02/oradata/DPBCKOUT/bnapp.dbf';
set newname for datafile 11 to '/u02/oradata/DPBCKOUT/bnlarge.dbf';
set newname for datafile 12 to '/u02/oradata/DPBCKOUT/ccapp.dbf';
set newname for datafile 13 to '/u02/oradata/DPBCKOUT/coapp.dbf';
set newname for datafile 14 to '/u02/oradata/DPBCKOUT/cuaudit.dbf';
set newname for datafile 15 to '/u02/oradata/DPBCKOUT/cularg1.dbf';
set newname for datafile 16 to '/u02/oradata/DPBCKOUT/cularg2.dbf';
set newname for datafile 17 to '/u02/oradata/DPBCKOUT/cularg3.dbf';
set newname for datafile 18 to '/u02/oradata/DPBCKOUT/cularge.dbf';
set newname for datafile 19 to '/u02/oradata/DPBCKOUT/diapp.dbf';
set newname for datafile 20 to '/u02/oradata/DPBCKOUT/dtapp.dbf';
set newname for datafile 21 to '/u02/oradata/DPBCKOUT/eoapp.dbf';
set newname for datafile 22 to '/u02/oradata/DPBCKOUT/eobfapp.dbf';
set newname for datafile 23 to '/u02/oradata/DPBCKOUT/eocfapp.dbf';
set newname for datafile 24 to '/u02/oradata/DPBCKOUT/eocmapp.dbf';
set newname for datafile 25 to '/u02/oradata/DPBCKOUT/eocmlrg.dbf';
set newname for datafile 26 to '/u02/oradata/DPBCKOUT/eocmwrk.dbf';
set newname for datafile 27 to '/u02/oradata/DPBCKOUT/eocuapp.dbf';
set newname for datafile 28 to '/u02/oradata/DPBCKOUT/eoculrg.dbf';
set newname for datafile 29 to '/u02/oradata/DPBCKOUT/eodsapp.dbf';
set newname for datafile 30 to '/u02/oradata/DPBCKOUT/eodslrg.dbf';
set newname for datafile 31 to '/u02/oradata/DPBCKOUT/eoecapp.dbf';
set newname for datafile 32 to '/u02/oradata/DPBCKOUT/eoeclrg.dbf';
set newname for datafile 33 to '/u02/oradata/DPBCKOUT/eoecwrk.dbf';
set newname for datafile 34 to '/u02/oradata/DPBCKOUT/eoeiapp.dbf';
set newname for datafile 35 to '/u02/oradata/DPBCKOUT/eoeilrg.dbf';
set newname for datafile 36 to '/u02/oradata/DPBCKOUT/eoewapp.dbf';
set newname for datafile 37 to '/u02/oradata/DPBCKOUT/eoewlrg.dbf';
set newname for datafile 38 to '/u02/oradata/DPBCKOUT/eoewwrk.dbf';
set newname for datafile 39 to '/u02/oradata/DPBCKOUT/eoiuapp.dbf';
set newname for datafile 40 to '/u02/oradata/DPBCKOUT/eoiulrg.dbf';
set newname for datafile 41 to '/u02/oradata/DPBCKOUT/eoiuwrk.dbf';
set newname for datafile 42 to '/u02/oradata/DPBCKOUT/eolarge.dbf';
set newname for datafile 43 to '/u02/oradata/DPBCKOUT/eoltapp.dbf';
set newname for datafile 44 to '/u02/oradata/DPBCKOUT/eoppapp.dbf';
set newname for datafile 45 to '/u02/oradata/DPBCKOUT/eopplrg.dbf';
set newname for datafile 46 to '/u02/oradata/DPBCKOUT/eotpapp.dbf';
set newname for datafile 47 to '/u02/oradata/DPBCKOUT/eotplrg.dbf';
set newname for datafile 48 to '/u02/oradata/DPBCKOUT/epapp.dbf';
set newname for datafile 49 to '/u02/oradata/DPBCKOUT/eplarge.dbf';
set newname for datafile 50 to '/u02/oradata/DPBCKOUT/erapp.dbf';
set newname for datafile 51 to '/u02/oradata/DPBCKOUT/erlarge.dbf';
set newname for datafile 52 to '/u02/oradata/DPBCKOUT/erwork.dbf';
set newname for datafile 53 to '/u02/oradata/DPBCKOUT/faapp.dbf';
set newname for datafile 54 to '/u02/oradata/DPBCKOUT/falarge.dbf';
set newname for datafile 55 to '/u02/oradata/DPBCKOUT/fgapp.dbf';
set newname for datafile 56 to '/u02/oradata/DPBCKOUT/fglarge.dbf';
set newname for datafile 57 to '/u02/oradata/DPBCKOUT/fsapp.dbf';
set newname for datafile 58 to '/u02/oradata/DPBCKOUT/giapp.dbf';
set newname for datafile 59 to '/u02/oradata/DPBCKOUT/gpapp.dbf';
set newname for datafile 60 to '/u02/oradata/DPBCKOUT/gpdeapp.dbf';
set newname for datafile 61 to '/u02/oradata/DPBCKOUT/hpapp.dbf';
set newname for datafile 62 to '/u02/oradata/DPBCKOUT/hrapp.dbf';
set newname for datafile 63 to '/u02/oradata/DPBCKOUT/hrapp1.dbf';
set newname for datafile 64 to '/u02/oradata/DPBCKOUT/hrapp2.dbf';
set newname for datafile 65 to '/u02/oradata/DPBCKOUT/hrapp3.dbf';
set newname for datafile 66 to '/u02/oradata/DPBCKOUT/hrapp4.dbf';
set newname for datafile 67 to '/u02/oradata/DPBCKOUT/hrapp5.dbf';
set newname for datafile 68 to '/u02/oradata/DPBCKOUT/hrapp6.dbf';
set newname for datafile 69 to '/u02/oradata/DPBCKOUT/hrapp7.dbf';
set newname for datafile 70 to '/u02/oradata/DPBCKOUT/hrimage.dbf';
set newname for datafile 71 to '/u02/oradata/DPBCKOUT/hrlarg1.dbf';
set newname for datafile 72 to '/u02/oradata/DPBCKOUT/hrlarge.dbf';
set newname for datafile 73 to '/u02/oradata/DPBCKOUT/hrsapp.dbf';
set newname for datafile 74 to '/u02/oradata/DPBCKOUT/hrsarch.dbf';
set newname for datafile 75 to '/u02/oradata/DPBCKOUT/hrslarge.dbf';
set newname for datafile 76 to '/u02/oradata/DPBCKOUT/hrswork.dbf';
set newname for datafile 77 to '/u02/oradata/DPBCKOUT/hrwork.dbf';
set newname for datafile 78 to '/u02/oradata/DPBCKOUT/htapp.dbf';
set newname for datafile 79 to '/u02/oradata/DPBCKOUT/inapp.dbf';
set newname for datafile 80 to '/u02/oradata/DPBCKOUT/paapp.dbf';
set newname for datafile 81 to '/u02/oradata/DPBCKOUT/palarge.dbf';
set newname for datafile 82 to '/u02/oradata/DPBCKOUT/pcapp.dbf';
set newname for datafile 83 to '/u02/oradata/DPBCKOUT/pclarge.dbf';
set newname for datafile 84 to '/u02/oradata/DPBCKOUT/piapp.dbf';
set newname for datafile 85 to '/u02/oradata/DPBCKOUT/pilarge.dbf';
set newname for datafile 86 to '/u02/oradata/DPBCKOUT/piwork.dbf';
set newname for datafile 87 to '/u02/oradata/DPBCKOUT/poapp.dbf';
set newname for datafile 88 to '/u02/oradata/DPBCKOUT/psimage.dbf';
set newname for datafile 89 to '/u02/oradata/DPBCKOUT/psimgr.dbf';
set newname for datafile 90 to '/u04/oradata/DPBCKOUT/psindex.dbf';
set newname for datafile 91 to '/u06/oradata/DPBCKOUT/psindex1.dbf';
set newname for datafile 92 to '/u08/oradata/DPBCKOUT/psindex2.dbf';
set newname for datafile 93 to '/u08/oradata/DPBCKOUT/psindex3.dbf';
set newname for datafile 94 to '/u08/oradata/DPBCKOUT/pswork.dbf';
set newname for datafile 95 to '/u08/oradata/DPBCKOUT/ptamsg.dbf';
set newname for datafile 96 to '/u08/oradata/DPBCKOUT/ptapp.dbf';
set newname for datafile 97 to '/u08/oradata/DPBCKOUT/ptappe.dbf';
set newname for datafile 98 to '/u08/oradata/DPBCKOUT/ptaudit.dbf';
set newname for datafile 99 to '/u08/oradata/DPBCKOUT/ptcmstar.dbf';
set newname for datafile 100 to '/u08/oradata/DPBCKOUT/ptlock.dbf';
set newname for datafile 101 to '/u08/oradata/DPBCKOUT/ptprc.dbf';
set newname for datafile 102 to '/u08/oradata/DPBCKOUT/ptprjwk.dbf';
set newname for datafile 103 to '/u08/oradata/DPBCKOUT/ptrpts.dbf';
set newname for datafile 104 to '/u08/oradata/DPBCKOUT/pttbl.dbf';
set newname for datafile 105 to '/u08/oradata/DPBCKOUT/pttlrg.dbf';
set newname for datafile 106 to '/u08/oradata/DPBCKOUT/pttree.dbf';
set newname for datafile 107 to '/u08/oradata/DPBCKOUT/ptwork.dbf';
set newname for datafile 108 to '/u08/oradata/DPBCKOUT/pvapp.dbf';
set newname for datafile 109 to '/u08/oradata/DPBCKOUT/py0lrg.dbf';
set newname for datafile 110 to '/u08/oradata/DPBCKOUT/pyapp.dbf';
set newname for datafile 111 to '/u08/oradata/DPBCKOUT/pylarge.dbf';
set newname for datafile 112 to '/u08/oradata/DPBCKOUT/pywork.dbf';
set newname for datafile 113 to '/u08/oradata/DPBCKOUT/saapp.dbf';
set newname for datafile 114 to '/u08/oradata/DPBCKOUT/sacapp.dbf';
set newname for datafile 115 to '/u08/oradata/DPBCKOUT/salarge.dbf';
set newname for datafile 116 to '/u08/oradata/DPBCKOUT/srapp.dbf';
set newname for datafile 117 to '/u08/oradata/DPBCKOUT/stapp.dbf';
set newname for datafile 118 to '/u08/oradata/DPBCKOUT/stlarge.dbf';
set newname for datafile 119 to '/u08/oradata/DPBCKOUT/stwork.dbf';
set newname for datafile 120 to '/u08/oradata/DPBCKOUT/tlapp.dbf';
set newname for datafile 121 to '/u08/oradata/DPBCKOUT/tllarge.dbf';
set newname for datafile 122 to '/u08/oradata/DPBCKOUT/tlwork.dbf';
set newname for datafile 123 to '/u08/oradata/DPBCKOUT/waapp.dbf';
set newname for datafile 124 to '/u02/oradata/DPBCKOUT/aaapp.dbf';
set newname for datafile 125 to '/u02/oradata/DPBCKOUT/aidba.dbf';

select 'set newname for tempfile '||file_id||' to '||chr(39)||replace(file_name,'DPDEMO91','DPBCKOUT')||chr(39)||';'
from   dba_temp_files
order by file_id;

set newname for tempfile 1 to '/u09/oradata/DPBCKOUT/temp01.dbf';	   
set newname for tempfile 2 to '/u04/oradata/DPBCKOUT/pstemp01.dbf';	   


select lf.group# grp,
  replace(member,'DPDEMO91','DPBCKOUT') member,
   bytes/1024/1024 mbytes 
           from   v$logfile lf,
                  v$log l
           where  lf.group# = l.group#
                  order by lf.group#,
                           substr(lf.member,instr(lf.member,'/',-1) + 1);

1	/oraredologs/dpu21/DPBCKOUT/redo0101.log	100	   
1	/oraredologs/dpu22/DPBCKOUT/redo0102.log	100	   
2	/oraredologs/dpu21/DPBCKOUT/redo0201.log	100	   
2	/oraredologs/dpu22/DPBCKOUT/redo0202.log	100	   
3	/oraredologs/dpu21/DPBCKOUT/redo0301.log	100	   
3	/oraredologs/dpu22/DPBCKOUT/redo0302.log	100	   


And then replace the below with the info obtained from the log sql above

duplicate target database to DPBCKOUT
pfile=/u01/app/oracle/product/11.2.0/db_1/dbs/initDPBCKOUT.ora
logfile
GROUP 1 ('/oraredologs/dpuxx/DPBCKOUT/redo0101.log','/oraredologs/dpuxx/DPBCKOUT/redo0102.log') SIZE xxM,
GROUP 2 ('/oraredologs/dpuxx/DPBCKOUT/redo0201.log','/oraredologs/dpuxx/DPBCKOUT/redo0202.log') SIZE xxM,
GROUP 3 ('/oraredologs/dpuxx/DPBCKOUT/redo0301.log','/oraredologs/dpuxx/DPBCKOUT/redo0302.log') SIZE xxM;

......>


1. Create new folders

   cd /u02/oradata/
   mkdir DPBCKOUT

   cd /u04/oradata/
   mkdir DPBCKOUT

   cd /u06/oradata/
   mkdir DPBCKOUT

   cd /u08/oradata/
   mkdir DPBCKOUT


   cd /u09/oradata/
   mkdir DPBCKOUT
   
   cd /oraredologs/dpu21
   mkdir DPBCKOUT

   cd /oraredologs/dpu22/
   mkdir DPBCKOUT

   cd /u01/app/oracle/admin/
   mkdir DPBCKOUT    
   
   cd /u01/app/oracle/admin/DPBCKOUT
    mkdir diag

   cd /u03/archlogs/
   mkdir DPBCKOUT 
   
  cd /u10/oraback
  mkdir DPBCKOUT 
    
2. Identify location of control files

   select * from v$controlfile;

[NULL]	/oraredologs/dpu21/DPDEMO91/control1DPDEMO91.ctl	NO	16384	842	   
[NULL]	/oraredologs/dpu22/DPDEMO91/control2DPDEMO91.ctl	NO	16384	842	


3. Copy init.ora file

  cd $ORACLE_HOME/dbs
  cp initDPDEMO91.ora initDPBCKOUT.ora      


db_file_name_convert='/u02/oradata/DPDEMO91/','/u02/oradata/DPBCKOUT/','/u04/oradata/DPDEMO91/','/u04/oradata/DPBCKOUT/','/u06/oradata/DPDEMO91/','/u06/oradata/DPBCKOUT/','/u08/oradata/DPDEMO91/','/u08/oradata/DPBCKOUT/','/u09/oradata/DPDEMO91/','/u09/oradata/DPBCKOUT/'
log_file_name_convert='/oraredologs/dpu21/DPDEMO91/','/oraredologs/dpu21/DPBCKOUT/','/oraredologs/dpu22/DPDEMO91/','/oraredologs/dpu22/DPBCKOUT/'


4. Create zopa file on AUX server (completed !!!)
  
   cd $ORACLE_HOME/dbs
   cp orapwDPDEMO91 orapwDPBCKOUT

5. Identify backupsets location.

   cd $SAVBKP

   view DPDEMO91_sbk_20130213_22:00:00_b4ToolPatch85212.out


   cd /u10/oraback/DPDEMO91/rman_backups
   Feb 14 10:19:34 2013

   7> #restore controlfile from '/u10/oraback/DPDEMO91/rman_backups/c-91945938-20130213-00';
   19> #TAG20130213T220110 - Data Files
   20> #TAG20130213T220324 - Control File
   28> CHANGE BACKUPSET 85016 KEEP FOREVER NOLOGS;
   29> CHANGE BACKUPSET 85017 KEEP FOREVER NOLOGS;
   30> CHANGE BACKUPSET 85018 KEEP FOREVER NOLOGS;
   31> CHANGE BACKUPSET 85019 KEEP FOREVER NOLOGS;
   32> CHANGE BACKUPSET 85020 KEEP FOREVER NOLOGS;
   33> CHANGE BACKUPSET 85021 KEEP FOREVER NOLOGS;
   34> CHANGE BACKUPSET 85022 KEEP FOREVER NOLOGS;
   35> CHANGE BACKUPSET 85023 KEEP FOREVER NOLOGS;
   36> CHANGE BACKUPSET 85024 KEEP FOREVER NOLOGS;
   37> CHANGE BACKUPSET 85164 KEEP FOREVER NOLOGS;
   57> #set DBID=91945938;
   58> #reset database to incarnation 10101;

-rw-r-----    1 oracle   dba        13860864 Feb 13 22:03 c-91945938-20130213-00
-rw-r-----    1 oracle   dba       260079616 Feb 13 22:03 bkp_df807314522_s3320_s1
-rw-r-----    1 oracle   dba       169017344 Feb 13 22:03 bkp_df807314530_s3321_s1
-rw-r-----    1 oracle   dba       155975680 Feb 13 22:03 bkp_df807314533_s3322_s1
-rw-r-----    1 oracle   dba       133218304 Feb 13 22:02 bkp_df807314515_s3319_s1
-rw-r-----    1 oracle   dba       102449152 Feb 13 22:02 bkp_df807314489_s3314_s1
-rw-r-----    1 oracle   dba        96321536 Feb 13 22:02 bkp_df807314489_s3317_s1
-rw-r-----    1 oracle   dba         2842624 Feb 13 22:01 bkp_df807314515_s3318_s1
-rw-r-----    1 oracle   dba        69664768 Feb 13 22:01 bkp_df807314489_s3315_s1
-rw-r-----    1 oracle   dba        69517312 Feb 13 22:01 bkp_df807314489_s3316_s1



6. Add entry into oratab
   cd /etc
   vi oratab

   DPBCKOUT:/u01/app/oracle/product/11.2.0/db_1:N


   cd $HOME/aetna/scripts

   cp -p oraprof oraprof_20130422   

   vi oraprof

Add DPBCKOUT entry to oraprof
 
"DPBCKOUT")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;



7. setup new AUX env

   . ~/.profile

DPBCKOUT


8. 

   #Remove
 #  rm /u*/oradata/DPBCKOUT/*


   #Confirm again
   ls /boraw1du*/oradata/wkabdev1/*

  ls /u*/oradata/DPBCKOUT/*
  

  

9. Dupliicate...


    sqlplus / as sysdba
    startup pfile=/u01/app/oracle/product/11.2.0/db_1/dbs/initDPBCKOUT.ora force nomount;
    



rman
connect target sys/sysdpdemo91@DPDEMO91
connect catalog DPDEMO91/DPDEMO91namr@RCATDEV
connect AUXILIARY /


run {
set until time "TO_DATE('02/13/2013 22:03:40','MM/DD/YYYY HH24:MI:SS')";
duplicate target database to DPBCKOUT;
}



10. cd $ORACLE_HOME/network/admin

vi listener.ora

DPBCKOUT =
  (DESCRIPTION =
    (ADDRESS= (PROTOCOL= IPC)(KEY= DPBCKOUT_ipc))
    (ADDRESS = (PROTOCOL = TCP)(HOST = dppdev)(PORT = 1695))
  )

SID_LIST_DPBCKOUT =
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME = DPBCKOUT)
      (ORACLE_HOME = /u01/app/oracle/product/11.2.0/db_1)
      (SID_NAME = DPBCKOUT)
    )
  )

SECURE_REGISTER_DPBCKOUT = (IPC)

SUBSCRIBE_FOR_NODE_DOWN_EVENT_DPBCKOUT=OFF


11.

select * from aetnadba.RMAN_HEARTBEAt;
should be time from saved backup...


12. Add new entry to Web Server oratab : xpsapm2d

DPBCKOUT:/orahome/psu01/oracle/product/11.2.0/client_64bit_dp1:N

cd /orahome/psu01/oracle/scripts
  cp -p oraprof oraprof_20130422   

   vi oraprof

Add DPBCKOUT entry to oraprof
 
"DPBCKOUT")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;
   . ~/.profile

DPBCKOUT

cd $ORACLE_HOME/network/admin

vi tnsnames.ora

DPBCKOUT.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppdev)
          (Port = 1695)
        )
    )
    (CONNECT_DATA = (SID = DPBCKOUT)
    )
  )


13. Change sys zopas

DPBCKOUT
system/sysdpbckout
sys/sysdpbckout

ALTER USER system IDENTIFIED BY "sysdpbckout"

/
ALTER USER sys
IDENTIFIED BY "sysdpbckout"
/


14.


1. Setup Catalog in  RCATDEV database on xoragridw1d Server

SSH to xoragridw1d. Login as A id and su to oracle

cd /u01/app/oracle/admin/RCATDEV/sql
sqlplus / as sysdba
@create_catalog.sql

...
enter catalog name: DPBCKOUT
enter catalog zopa: DPBCKOUTnamr



   . ~/.profile

DPBCKOUT

11.02.00.04

>rman

connect catalog DPBCKOUT/DPBCKOUTnamr@RCATDEV

create catalog;

exit


>rman

connect target /

connect catalog DPBCKOUT/DPBCKOUTnamr@RCATDEV

connect catalog DPDEV91/DPDEV91namr@RCATDEV

                DPBCKOUT/DPBCKOUTnamr


register database;


report schema;

show all;

RMAN configuration parameters for database with db_unique_name DPBCKOUT are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 1; # default
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE CONTROLFILE AUTOBACKUP OFF; # default
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F'; # default
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u01/app/oracle/product/11.2.0/db_1/dbs/snapcf_DPBCKOUT.f'; # default


Change to (based on DPDEMO91)
RMAN> show all;

RMAN configuration parameters for database with db_unique_name DPDEMO91 are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 5;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/u10/oraback/DPBCKOUT/rman_backups/%F';
CONFIGURE DEVICE TYPE DISK PARALLELISM 4 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/u10/oraback/DPBCKOUT/rman_backups/bkp_df%t_s%s_s%p';
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPBCKOUT/rman_backups/snapcf_DPBCKOUT.f';


cd $ORACLE_BASE/

make sure both file exists
.DPBCKOUT.pw
.DPBCKOUT_RMAN.pw


00 22 * * * ${HOME}/aetna/db_mgmt/backup/dbbackup_rman DPBCKOUT


******** Restore saved backup ******

  -- This case not cront jobs and not GRID monitor to blackout since this is temp database.
1. --Check what is current version of DPBCKOUT before restore

   select * from aetnadba.RMAN_HEARTBEAt;
  
   DPDEMO91	2/13/2013 10:00:23 PM	   
   DPBCKOUT	4/25/2013 8:33:35 AM	   
		

Go to either $BKPLOG or $SAVBKP if restore from a saved backup, and locate the RMAN script.
	DPBCKOUT backup saved as DPBCKOUT_sbk_20130425_08:33:30_b4pt85212.rman

Copy the file to another name

cp DPBCKOUT_sbk_20130425_08:33:30_b4pt85212.rman Restore_DPBCKOUT_sbk_20130425_08:33:30_b4pt85212.rman
	
cp Restore_DPBCKOUT_sbk_20130425_08:33:30_b4pt85212.rman Restore_DPBCKOUT_sbk_20130425_083330_b4pt85212.rman

#Run it through RMAN

--For some reason running .rman file did not work. Possible something to do with "run{" maybe need space try next time
--Had to all manually which is worked.

#rman
#connect target /
#connect catalog DPBCKOUT/DPBCKOUTnamr@RCATDEV

#RMAN> Restore_DPBCKOUT.rman



connect target /
connect catalog DPBCKOUT/DPBCKOUTnamr@RCATDEV
startup force nomount;
set DBID=3622371352;
reset database to incarnation 2;
restore controlfile from '/u10/oraback/DPBCKOUT/rman_backups/c-3622371352-20130425-00';
alter database mount;
run{
restore database from TAG=TAG20130425T083408;
recover database noredo;
}
alter database open resetlogs;

 select * from aetnadba.RMAN_HEARTBEAt;
DBNAME	TIMESTMP	   
DPDEMO91	2/13/2013 10:00:23 PM	   
DPBCKOUT	4/25/2013 8:33:35 AM	   
		


***********************DPDEVUG_sbk_20150130_05:44:32_b4upgora11204.rman****************

!! This Database was upgraded to 11.2.0.4
!! So we are kind downgrading back to 11.2.0.4



1. Shutdown Database
2. Stop listener

lsnrctl stop DPDEVUG
3. Drop Data files

/u02/oradata/DPDEVUG/USERS01.dbf
/u05/oradata/DPDEVUG/aaapp1.dbf
/u09/oradata/DPDEVUG/eolarge.dbf


MEMBER
/oraredologs/dpu21/DPDEVUG/redo0601.log
/oraredologs/dpu22/DPDEVUG/redo0602.log

NAME
/oraredologs/dpu21/DPDEVUG/control1DPDEVUG.ctl
/oraredologs/dpu22/DPDEVUG/control2DPDEVUG.ctl


 #Confirm
   ls /u02/oradata/DPDEVUG/*
   ls /u05/oradata/DPDEVUG/*
   ls /u09/oradata/DPDEVUG/* 
   ls /oraredologs/dpu21/DPDEVUG/* 
   ls /oraredologs/dpu22/DPDEVUG/*
 
   #Remove
   rm /u02/oradata/DPDEVUG/*
   rm /u05/oradata/DPDEVUG/*
   rm /u09/oradata/DPDEVUG/* 
   rm /oraredologs/dpu21/DPDEVUG/* 
   rm /oraredologs/dpu22/DPDEVUG/*

   #Confirm again




3. cd /etc
   vi oratab

Current: DPDEVUG:/u01/app/oracle/product/11.2.0.4/db_2:Y
Change"  DPDEVUG:/u01/app/oracle/product/11.2.0/db_2:Y

. ~/.profile

DPDEVUG


#Restore DataBase

connect target /
connect catalog DPDEVUG/DPDEVUGnamr@RCATDEV
startup force nomount;
set DBID=3241090986;
reset database to incarnation 2;
restore controlfile from 'c-3241090986-20150130-00_DPDEVUG';
alter database mount;
run{
restore database from TAG=TAG20150130T054512;
recover database noredo;
}
alter database open resetlogs;


lsnrctl start DPDEVUG

#End Restore DataBase




*** Restore DPDEVUG from last good backup ****

cd $SAVBKP
DPDEVUG backup saved as DPDEVUG_sbk_20151210_08:07:22_postupgora12102_tstz.rman

view DPDEVUG_sbk_20151210_08:07:22_postupgora12102_tstz.rman

sqlplus / as sysdba
shutdown immediate
exit

select file_id,file_name from dba_data_files order by 2

FILE_NAME
/u02/oradata/DPDEVUG/USERS01.dbf
/u02/oradata/DPDEVUG/bnapp.dbf
/u02/oradata/DPDEVUG/bnlarge.dbf
/u02/oradata/DPDEVUG/fsapp.dbf
/u02/oradata/DPDEVUG/giapp.dbf
/u02/oradata/DPDEVUG/glapp.dbf
/u02/oradata/DPDEVUG/gpapp.dbf
/u02/oradata/DPDEVUG/hrapp.dbf
/u02/oradata/DPDEVUG/hrlarge.dbf
/u02/oradata/DPDEVUG/htapp.dbf
/u02/oradata/DPDEVUG/inapp.dbf
/u02/oradata/DPDEVUG/omapp.dbf
/u02/oradata/DPDEVUG/paapp.dbf
/u02/oradata/DPDEVUG/palarge.dbf
/u02/oradata/DPDEVUG/piapp.dbf
/u02/oradata/DPDEVUG/pilarge.dbf
/u02/oradata/DPDEVUG/psimage.dbf
/u02/oradata/DPDEVUG/psimage2_1.dbf
/u02/oradata/DPDEVUG/psindex.dbf
/u02/oradata/DPDEVUG/psindex01.dbf
/u02/oradata/DPDEVUG/psindex02.dbf
/u02/oradata/DPDEVUG/psindex03.dbf
/u02/oradata/DPDEVUG/psundots.dbf
/u02/oradata/DPDEVUG/ptapp.dbf
/u02/oradata/DPDEVUG/ptprc.dbf
/u02/oradata/DPDEVUG/system01.dbf
/u05/oradata/DPDEVUG/aaapp1.dbf
/u05/oradata/DPDEVUG/aalarge1.dbf
/u05/oradata/DPDEVUG/adapp1.dbf
/u05/oradata/DPDEVUG/aidba.dbf
/u05/oradata/DPDEVUG/amapp.dbf
/u05/oradata/DPDEVUG/audit.dbf
/u05/oradata/DPDEVUG/audit2.dbf
/u05/oradata/DPDEVUG/avapp1.dbf
/u05/oradata/DPDEVUG/bdapp.dbf
/u05/oradata/DPDEVUG/bpapp.dbf
/u05/oradata/DPDEVUG/ccapp1.dbf
/u05/oradata/DPDEVUG/coapp.dbf
/u05/oradata/DPDEVUG/cuaudit.dbf
/u05/oradata/DPDEVUG/cularg1.dbf
/u05/oradata/DPDEVUG/cularg2.dbf
/u05/oradata/DPDEVUG/cularg3.dbf
/u05/oradata/DPDEVUG/cularge.dbf
/u05/oradata/DPDEVUG/dbtune.dbf
/u05/oradata/DPDEVUG/diapp.dbf
/u05/oradata/DPDEVUG/eoapp.dbf
/u05/oradata/DPDEVUG/eobfapp1.dbf
/u05/oradata/DPDEVUG/eocfapp1.dbf
/u05/oradata/DPDEVUG/eocmapp.dbf
/u05/oradata/DPDEVUG/eocmlrg.dbf
/u05/oradata/DPDEVUG/eocmwrk.dbf
/u05/oradata/DPDEVUG/eocuapp.dbf
/u05/oradata/DPDEVUG/eoculrg.dbf
/u05/oradata/DPDEVUG/eoditbl.dbf
/u05/oradata/DPDEVUG/eodsapp.dbf
/u05/oradata/DPDEVUG/eodslrg.dbf
/u05/oradata/DPDEVUG/eoecapp.dbf
/u05/oradata/DPDEVUG/eoeclrg.dbf
/u05/oradata/DPDEVUG/eoecwrk.dbf
/u05/oradata/DPDEVUG/eoeiapp.dbf
/u05/oradata/DPDEVUG/eoeilrg.dbf
/u05/oradata/DPDEVUG/eoewapp.dbf
/u05/oradata/DPDEVUG/eoewlrg.dbf
/u05/oradata/DPDEVUG/eoewwrk.dbf
/u05/oradata/DPDEVUG/eoiuapp.dbf
/u05/oradata/DPDEVUG/eoiulrg.dbf
/u05/oradata/DPDEVUG/eoiuwrk.dbf
/u05/oradata/DPDEVUG/eoltapp1.dbf
/u05/oradata/DPDEVUG/eoppapp1.dbf
/u05/oradata/DPDEVUG/eopplrg1.dbf
/u05/oradata/DPDEVUG/faapp1.dbf
/u05/oradata/DPDEVUG/falarge1.dbf
/u05/oradata/DPDEVUG/hrapp71.dbf
/u05/oradata/DPDEVUG/hrsapp1.dbf
/u05/oradata/DPDEVUG/hrslarge1.dbf
/u05/oradata/DPDEVUG/hrswork1.dbf
/u05/oradata/DPDEVUG/psdefault.dbf
/u05/oradata/DPDEVUG/psimgr.dbf
/u05/oradata/DPDEVUG/psindex06.dbf
/u05/oradata/DPDEVUG/pstemp01.dbf
/u05/oradata/DPDEVUG/pswork.dbf
/u05/oradata/DPDEVUG/ptamsg.dbf
/u05/oradata/DPDEVUG/ptappe.dbf
/u05/oradata/DPDEVUG/ptaudit.dbf
/u05/oradata/DPDEVUG/ptcmstar.dbf
/u05/oradata/DPDEVUG/ptlock.dbf
/u05/oradata/DPDEVUG/ptprjwk.dbf
/u05/oradata/DPDEVUG/ptrpts.dbf
/u05/oradata/DPDEVUG/pttbl.dbf
/u05/oradata/DPDEVUG/pttlrg.dbf
/u05/oradata/DPDEVUG/pttree.dbf
/u05/oradata/DPDEVUG/ptwork.dbf
/u05/oradata/DPDEVUG/pyapp.dbf
/u05/oradata/DPDEVUG/pylarge.dbf
/u05/oradata/DPDEVUG/pylarge02.dbf
/u05/oradata/DPDEVUG/saapp1.dbf
/u05/oradata/DPDEVUG/sacapp1.dbf
/u05/oradata/DPDEVUG/salarge1.dbf
/u05/oradata/DPDEVUG/srapp1.dbf
/u05/oradata/DPDEVUG/stapp.dbf
/u05/oradata/DPDEVUG/stlarge.dbf
/u05/oradata/DPDEVUG/sysaux01.dbf
/u05/oradata/DPDEVUG/sysaux02.dbf
/u05/oradata/DPDEVUG/tivoliorts01.dbf
/u05/oradata/DPDEVUG/tlapp.dbf
/u05/oradata/DPDEVUG/tllarge.dbf
/u09/oradata/DPDEVUG/eolarge.dbf
/u09/oradata/DPDEVUG/eotpapp.dbf
/u09/oradata/DPDEVUG/eotplrg.dbf
/u09/oradata/DPDEVUG/epapp.dbf
/u09/oradata/DPDEVUG/eplarge.dbf
/u09/oradata/DPDEVUG/erapp.dbf
/u09/oradata/DPDEVUG/erlarge.dbf
/u09/oradata/DPDEVUG/erwork.dbf
/u09/oradata/DPDEVUG/fgapp.dbf
/u09/oradata/DPDEVUG/gpdeapp.dbf
/u09/oradata/DPDEVUG/hpapp.dbf
/u09/oradata/DPDEVUG/hrapp1.dbf
/u09/oradata/DPDEVUG/hrapp2.dbf
/u09/oradata/DPDEVUG/hrapp3.dbf
/u09/oradata/DPDEVUG/hrapp4.dbf
/u09/oradata/DPDEVUG/hrapp5.dbf
/u09/oradata/DPDEVUG/hrapp6.dbf
/u09/oradata/DPDEVUG/hrlarge02.dbf
/u09/oradata/DPDEVUG/hrlarge03.dbf
/u09/oradata/DPDEVUG/hrwork.dbf
/u09/oradata/DPDEVUG/knsapp.dbf
/u09/oradata/DPDEVUG/pcapp.dbf
/u09/oradata/DPDEVUG/pclarge.dbf
/u09/oradata/DPDEVUG/piwork.dbf
/u09/oradata/DPDEVUG/poapp.dbf
/u09/oradata/DPDEVUG/psindex04.dbf
/u09/oradata/DPDEVUG/psindex05.dbf
/u09/oradata/DPDEVUG/psindex07.dbf
/u09/oradata/DPDEVUG/psundots_02.dbf
/u09/oradata/DPDEVUG/pvapp.dbf
/u09/oradata/DPDEVUG/py0lrg.dbf
/u09/oradata/DPDEVUG/pylarge03.dbf
/u09/oradata/DPDEVUG/pylarge04.dbf
/u09/oradata/DPDEVUG/pywork.dbf
/u09/oradata/DPDEVUG/stwork.dbf
/u09/oradata/DPDEVUG/tlwork.dbf
/u09/oradata/DPDEVUG/tom1.dbf
/u09/oradata/DPDEVUG/waapp.dbf

select file_id,file_name  from dba_temp_files order by 1
FILE_NAME
/u09/oradata/DPDEVUG/temp01.dbf
/u09/oradata/DPDEVUG/tivoliortempts_01.dbf


select * from v$logfile


MEMBER
/oraredologs/dpu21/DPDEVUG/redo0601.log
/oraredologs/dpu22/DPDEVUG/redo0602.log
/oraredologs/dpu21/DPDEVUG/redo0501.log
/oraredologs/dpu22/DPDEVUG/redo0502.log
/oraredologs/dpu21/DPDEVUG/redo0401.log
/oraredologs/dpu22/DPDEVUG/redo0402.log
/oraredologs/dpu21/DPDEVUG/redo0301.log
/oraredologs/dpu22/DPDEVUG/redo0302.log
/oraredologs/dpu21/DPDEVUG/redo0201.log
/oraredologs/dpu22/DPDEVUG/redo0202.log
/oraredologs/dpu21/DPDEVUG/redo0101.log
/oraredologs/dpu22/DPDEVUG/redo0102.log

select * from v$controlfile
NAME
/oraredologs/dpu21/DPDEVUG/control1DPDEVUG.ctl
/oraredologs/dpu22/DPDEVUG/control2DPDEVUG.ctl


#Restore DataBase
connect target /
connect catalog DPDEVUG/DPDEVUGnamr@RCATDEV
startup force nomount;
set DBID=3241090986;
reset database to incarnation 252223;
restore controlfile from 'c-3241090986-20151210-00';
alter database mount;
run{
restore database from TAG=TAG20151210T080840;
recover database noredo;
}
alter database open resetlogs;
#End Restore DataBase

lsnrctl start DPDEVUG


************ Duplicate DPDEV91 to DPDEV92 *****



. ~/.profile

DPDEV91 

Duplicate from saved backup of DPDEV91 to new DB DPDEV92

cd /u01/app/oracle/aetna/db_admin/db_DPDEV91/save_backup

DPDEV91_sbk_20160418_22:45:05_forDPDEV92dupl.rman



Tom's instructions...>

select 'set newname for datafile '||file_id||' to '||chr(39)||replace(file_name,'DPDEV91','DPDEV92')||chr(39)||';'
from   dba_data_files
order by file_name;


'SETNEWNAMEFORDATAFILE'||FILE_ID||'TO'||CHR(39)||REPLACE(FILE_NAME,'DPDEV91','DPDEV92')||CHR(39)||';'

set newname for datafile 3 to '/u02/oradata/DPDEV92/USERS01.dbf';
set newname for datafile 4 to '/u02/oradata/DPDEV92/bnapp.dbf';
set newname for datafile 5 to '/u02/oradata/DPDEV92/bnlarge.dbf';
set newname for datafile 6 to '/u02/oradata/DPDEV92/fsapp.dbf';
set newname for datafile 7 to '/u02/oradata/DPDEV92/giapp.dbf';
set newname for datafile 8 to '/u02/oradata/DPDEV92/glapp.dbf';
set newname for datafile 9 to '/u02/oradata/DPDEV92/gpapp.dbf';
set newname for datafile 10 to '/u02/oradata/DPDEV92/hrapp.dbf';
set newname for datafile 11 to '/u02/oradata/DPDEV92/hrlarge.dbf';
set newname for datafile 12 to '/u02/oradata/DPDEV92/htapp.dbf';
set newname for datafile 13 to '/u02/oradata/DPDEV92/inapp.dbf';
set newname for datafile 14 to '/u02/oradata/DPDEV92/omapp.dbf';
set newname for datafile 15 to '/u02/oradata/DPDEV92/paapp.dbf';
set newname for datafile 16 to '/u02/oradata/DPDEV92/palarge.dbf';
set newname for datafile 17 to '/u02/oradata/DPDEV92/piapp.dbf';
set newname for datafile 18 to '/u02/oradata/DPDEV92/pilarge.dbf';
set newname for datafile 19 to '/u02/oradata/DPDEV92/psimage.dbf';
set newname for datafile 115 to '/u02/oradata/DPDEV92/psimage2_1.dbf';
set newname for datafile 142 to '/u02/oradata/DPDEV92/psimage2_2.dbf';
set newname for datafile 143 to '/u02/oradata/DPDEV92/psimage2_3.dbf';
set newname for datafile 144 to '/u02/oradata/DPDEV92/psimage2_4.dbf';
set newname for datafile 145 to '/u02/oradata/DPDEV92/psimage2_5.dbf';
set newname for datafile 20 to '/u02/oradata/DPDEV92/psindex.dbf';
set newname for datafile 21 to '/u02/oradata/DPDEV92/psindex01.dbf';
set newname for datafile 22 to '/u02/oradata/DPDEV92/psindex02.dbf';
set newname for datafile 23 to '/u02/oradata/DPDEV92/psindex03.dbf';
set newname for datafile 2 to '/u02/oradata/DPDEV92/psundots.dbf';
set newname for datafile 24 to '/u02/oradata/DPDEV92/ptapp.dbf';
set newname for datafile 25 to '/u02/oradata/DPDEV92/ptprc.dbf';
set newname for datafile 1 to '/u02/oradata/DPDEV92/system01.dbf';
set newname for datafile 125 to '/u05/oradata/DPDEV92/aaapp1.dbf';
set newname for datafile 116 to '/u05/oradata/DPDEV92/aalarge1.dbf';
set newname for datafile 126 to '/u05/oradata/DPDEV92/adapp1.dbf';
set newname for datafile 138 to '/u05/oradata/DPDEV92/aidba.dbf';
set newname for datafile 49 to '/u05/oradata/DPDEV92/amapp.dbf';
set newname for datafile 127 to '/u05/oradata/DPDEV92/avapp1.dbf';
set newname for datafile 50 to '/u05/oradata/DPDEV92/bdapp.dbf';
set newname for datafile 51 to '/u05/oradata/DPDEV92/bpapp.dbf';
set newname for datafile 128 to '/u05/oradata/DPDEV92/ccapp1.dbf';
set newname for datafile 52 to '/u05/oradata/DPDEV92/coapp.dbf';
set newname for datafile 53 to '/u05/oradata/DPDEV92/cuaudit.dbf';
set newname for datafile 54 to '/u05/oradata/DPDEV92/cularg1.dbf';
set newname for datafile 55 to '/u05/oradata/DPDEV92/cularg2.dbf';
set newname for datafile 56 to '/u05/oradata/DPDEV92/cularg3.dbf';
set newname for datafile 57 to '/u05/oradata/DPDEV92/cularge.dbf';
set newname for datafile 34 to '/u05/oradata/DPDEV92/dbtune.dbf';
set newname for datafile 58 to '/u05/oradata/DPDEV92/diapp.dbf';
set newname for datafile 59 to '/u05/oradata/DPDEV92/eoapp.dbf';
set newname for datafile 117 to '/u05/oradata/DPDEV92/eobfapp1.dbf';
set newname for datafile 118 to '/u05/oradata/DPDEV92/eocfapp1.dbf';
set newname for datafile 60 to '/u05/oradata/DPDEV92/eocmapp.dbf';
set newname for datafile 61 to '/u05/oradata/DPDEV92/eocmlrg.dbf';
set newname for datafile 62 to '/u05/oradata/DPDEV92/eocmwrk.dbf';
set newname for datafile 63 to '/u05/oradata/DPDEV92/eocuapp.dbf';
set newname for datafile 64 to '/u05/oradata/DPDEV92/eoculrg.dbf';
set newname for datafile 65 to '/u05/oradata/DPDEV92/eoditbl.dbf';
set newname for datafile 66 to '/u05/oradata/DPDEV92/eodsapp.dbf';
set newname for datafile 67 to '/u05/oradata/DPDEV92/eodslrg.dbf';
set newname for datafile 68 to '/u05/oradata/DPDEV92/eoecapp.dbf';
set newname for datafile 69 to '/u05/oradata/DPDEV92/eoeclrg.dbf';
set newname for datafile 70 to '/u05/oradata/DPDEV92/eoecwrk.dbf';
set newname for datafile 71 to '/u05/oradata/DPDEV92/eoeiapp.dbf';
set newname for datafile 72 to '/u05/oradata/DPDEV92/eoeilrg.dbf';
set newname for datafile 73 to '/u05/oradata/DPDEV92/eoewapp.dbf';
set newname for datafile 74 to '/u05/oradata/DPDEV92/eoewlrg.dbf';
set newname for datafile 75 to '/u05/oradata/DPDEV92/eoewwrk.dbf';
set newname for datafile 76 to '/u05/oradata/DPDEV92/eoiuapp.dbf';
set newname for datafile 77 to '/u05/oradata/DPDEV92/eoiulrg.dbf';
set newname for datafile 78 to '/u05/oradata/DPDEV92/eoiuwrk.dbf';
set newname for datafile 119 to '/u05/oradata/DPDEV92/eoltapp1.dbf';
set newname for datafile 129 to '/u05/oradata/DPDEV92/eoppapp1.dbf';
set newname for datafile 120 to '/u05/oradata/DPDEV92/eopplrg1.dbf';
set newname for datafile 130 to '/u05/oradata/DPDEV92/faapp1.dbf';
set newname for datafile 121 to '/u05/oradata/DPDEV92/falarge1.dbf';
set newname for datafile 122 to '/u05/oradata/DPDEV92/hrapp71.dbf';
set newname for datafile 131 to '/u05/oradata/DPDEV92/hrsapp1.dbf';
set newname for datafile 132 to '/u05/oradata/DPDEV92/hrslarge1.dbf';
set newname for datafile 133 to '/u05/oradata/DPDEV92/hrswork1.dbf';
set newname for datafile 48 to '/u05/oradata/DPDEV92/psdefault.dbf';
set newname for datafile 46 to '/u05/oradata/DPDEV92/psimgr.dbf';
set newname for datafile 136 to '/u05/oradata/DPDEV92/psindex06.dbf';
set newname for datafile 47 to '/u05/oradata/DPDEV92/pstemp01.dbf';
set newname for datafile 37 to '/u05/oradata/DPDEV92/pswork.dbf';
set newname for datafile 39 to '/u05/oradata/DPDEV92/ptamsg.dbf';
set newname for datafile 35 to '/u05/oradata/DPDEV92/ptappe.dbf';
set newname for datafile 45 to '/u05/oradata/DPDEV92/ptaudit.dbf';
set newname for datafile 43 to '/u05/oradata/DPDEV92/ptcmstar.dbf';
set newname for datafile 41 to '/u05/oradata/DPDEV92/ptlock.dbf';
set newname for datafile 44 to '/u05/oradata/DPDEV92/ptprjwk.dbf';
set newname for datafile 42 to '/u05/oradata/DPDEV92/ptrpts.dbf';
set newname for datafile 26 to '/u05/oradata/DPDEV92/pttbl.dbf';
set newname for datafile 38 to '/u05/oradata/DPDEV92/pttlrg.dbf';
set newname for datafile 36 to '/u05/oradata/DPDEV92/pttree.dbf';
set newname for datafile 40 to '/u05/oradata/DPDEV92/ptwork.dbf';
set newname for datafile 27 to '/u05/oradata/DPDEV92/pyapp.dbf';
set newname for datafile 28 to '/u05/oradata/DPDEV92/pylarge.dbf';
set newname for datafile 29 to '/u05/oradata/DPDEV92/pylarge02.dbf';
set newname for datafile 134 to '/u05/oradata/DPDEV92/saapp1.dbf';
set newname for datafile 123 to '/u05/oradata/DPDEV92/sacapp1.dbf';
set newname for datafile 124 to '/u05/oradata/DPDEV92/salarge1.dbf';
set newname for datafile 135 to '/u05/oradata/DPDEV92/srapp1.dbf';
set newname for datafile 30 to '/u05/oradata/DPDEV92/stapp.dbf';
set newname for datafile 31 to '/u05/oradata/DPDEV92/stlarge.dbf';
set newname for datafile 114 to '/u05/oradata/DPDEV92/sysaux01.dbf';
set newname for datafile 137 to '/u05/oradata/DPDEV92/sysaux02.dbf';
set newname for datafile 141 to '/u05/oradata/DPDEV92/tivoliorts01.dbf';
set newname for datafile 32 to '/u05/oradata/DPDEV92/tlapp.dbf';
set newname for datafile 33 to '/u05/oradata/DPDEV92/tllarge.dbf';
set newname for datafile 79 to '/u09/oradata/DPDEV92/eolarge.dbf';
set newname for datafile 80 to '/u09/oradata/DPDEV92/eotpapp.dbf';
set newname for datafile 81 to '/u09/oradata/DPDEV92/eotplrg.dbf';
set newname for datafile 82 to '/u09/oradata/DPDEV92/epapp.dbf';
set newname for datafile 83 to '/u09/oradata/DPDEV92/eplarge.dbf';
set newname for datafile 84 to '/u09/oradata/DPDEV92/erapp.dbf';
set newname for datafile 85 to '/u09/oradata/DPDEV92/erlarge.dbf';
set newname for datafile 86 to '/u09/oradata/DPDEV92/erwork.dbf';
set newname for datafile 87 to '/u09/oradata/DPDEV92/fgapp.dbf';
set newname for datafile 88 to '/u09/oradata/DPDEV92/gpdeapp.dbf';
set newname for datafile 89 to '/u09/oradata/DPDEV92/hpapp.dbf';
set newname for datafile 90 to '/u09/oradata/DPDEV92/hrapp1.dbf';
set newname for datafile 91 to '/u09/oradata/DPDEV92/hrapp2.dbf';
set newname for datafile 92 to '/u09/oradata/DPDEV92/hrapp3.dbf';
set newname for datafile 93 to '/u09/oradata/DPDEV92/hrapp4.dbf';
set newname for datafile 94 to '/u09/oradata/DPDEV92/hrapp5.dbf';
set newname for datafile 95 to '/u09/oradata/DPDEV92/hrapp6.dbf';
set newname for datafile 110 to '/u09/oradata/DPDEV92/hrlarge02.dbf';
set newname for datafile 139 to '/u09/oradata/DPDEV92/hrlarge03.dbf';
set newname for datafile 96 to '/u09/oradata/DPDEV92/hrwork.dbf';
set newname for datafile 113 to '/u09/oradata/DPDEV92/knsapp.dbf';
set newname for datafile 97 to '/u09/oradata/DPDEV92/pcapp.dbf';
set newname for datafile 98 to '/u09/oradata/DPDEV92/pclarge.dbf';
set newname for datafile 99 to '/u09/oradata/DPDEV92/piwork.dbf';
set newname for datafile 100 to '/u09/oradata/DPDEV92/poapp.dbf';
set newname for datafile 109 to '/u09/oradata/DPDEV92/psindex04.dbf';
set newname for datafile 112 to '/u09/oradata/DPDEV92/psindex05.dbf';
set newname for datafile 140 to '/u09/oradata/DPDEV92/psindex07.dbf';
set newname for datafile 107 to '/u09/oradata/DPDEV92/psundots_02.dbf';
set newname for datafile 101 to '/u09/oradata/DPDEV92/pvapp.dbf';
set newname for datafile 102 to '/u09/oradata/DPDEV92/py0lrg.dbf';
set newname for datafile 108 to '/u09/oradata/DPDEV92/pylarge03.dbf';
set newname for datafile 111 to '/u09/oradata/DPDEV92/pylarge04.dbf';
set newname for datafile 103 to '/u09/oradata/DPDEV92/pywork.dbf';
set newname for datafile 104 to '/u09/oradata/DPDEV92/stwork.dbf';
set newname for datafile 105 to '/u09/oradata/DPDEV92/tlwork.dbf';
set newname for datafile 106 to '/u09/oradata/DPDEV92/waapp.dbf';

select 'set newname for tempfile '||file_id||' to '||chr(39)||replace(file_name,'DPDEV91','DPDEV92')||chr(39)||';'
from   dba_temp_files
order by file_name;

'SETNEWNAMEFORTEMPFILE'||FILE_ID||'TO'||CHR(39)||REPLACE(FILE_NAME,'DPDEV91','DPDEV92')||CHR(39)||';'

set newname for tempfile 1 to '/u09/oradata/DPDEV92/temp01.dbf';
set newname for tempfile 2 to '/u09/oradata/DPDEV92/tivoliortempts_01.dbf';	   


select lf.group# grp,
  replace(member,'DPDEV91','DPDEV92') member,
   bytes/1024/1024 mbytes 
           from   v$logfile lf,
                  v$log l
           where  lf.group# = l.group#
                  order by lf.group#,
                           substr(lf.member,instr(lf.member,'/',-1) + 1);

MEMBER
/oraredologs/dpu21/DPDEV92/redo0101.log
/oraredologs/dpu22/DPDEV92/redo0102.log
/oraredologs/dpu21/DPDEV92/redo0201.log
/oraredologs/dpu22/DPDEV92/redo0202.log
/oraredologs/dpu21/DPDEV92/redo0301.log
/oraredologs/dpu22/DPDEV92/redo0302.log
/oraredologs/dpu21/DPDEV92/redo0401.log
/oraredologs/dpu22/DPDEV92/redo0402.log
/oraredologs/dpu21/DPDEV92/redo0501.log
/oraredologs/dpu22/DPDEV92/redo0502.log
/oraredologs/dpu21/DPDEV92/redo0601.log
/oraredologs/dpu22/DPDEV92/redo0602.log	


select * from v$logfile


MEMBER
/oraredologs/dpu21/DPDEV91/redo0601.log
/oraredologs/dpu22/DPDEV91/redo0602.log

/oraredologs/dpu21/DPDEV91/redo0501.log
/oraredologs/dpu22/DPDEV91/redo0502.log

/oraredologs/dpu21/DPDEV91/redo0401.log
/oraredologs/dpu22/DPDEV91/redo0402.log

/oraredologs/dpu21/DPDEV91/redo0301.log
/oraredologs/dpu22/DPDEV91/redo0302.log

/oraredologs/dpu21/DPDEV91/redo0201.log
/oraredologs/dpu22/DPDEV91/redo0202.log

/oraredologs/dpu21/DPDEV91/redo0101.log
/oraredologs/dpu22/DPDEV91/redo0102.log
   


select * from v$controlfile

NAME
/oraredologs/dpu21/DPDEV91/control1DPDEV91.ctl
/oraredologs/dpu22/DPDEV91/control2DPDEV91.ctl


###And then replace the below with the info obtained from the log sql above

###duplicate target database to DPBCKOUT
###pfile=/u01/app/oracle/product/11.2.0/db_1/dbs/initDPBCKOUT.ora
###logfile
###GROUP 1 ('/oraredologs/dpuxx/DPBCKOUT/redo0101.log','/oraredologs/dpuxx/DPBCKOUT/redo0102.log') SIZE xxM,
###GROUP 2 ('/oraredologs/dpuxx/DPBCKOUT/redo0201.log','/oraredologs/dpuxx/DPBCKOUT/redo0202.log') SIZE xxM,
###GROUP 3 ('/oraredologs/dpuxx/DPBCKOUT/redo0301.log','/oraredologs/dpuxx/DPBCKOUT/redo0302.log') SIZE xxM;

......>


1. Create new folders




cd /u02/oradata
mkdir DPDEV92 
cd /u05/oradata
mkdir DPDEV92
cd /u09/oradata
mkdir DPDEV92



   
   cd /oraredologs/dpu21/
   mkdir DPDEV92

   cd /oraredologs/dpu22
   mkdir DPDEV92



!! May not need.  Hold one with this owne.
   cd /u01/app/oracle/admin/
   mkdir DPDEV92
   
   cd /u01/app/oracle/admin/DPDEV92
    mkdir diag

   cd /u03/archlogs/
   mkdir DPDEV92
   
  cd /u10/oraback
  mkdir DPDEV92
  cd /u10/oraback/DPDEV92
  mkdir rman_backups



cd /u01/app/oracle/aetna/db_admin

cp -rp db_DPDEV91 db_DPDEV92

cleanup all under db_DPDEV92


cd /orahome/u01/app/oracle/admin
mkdir DPDEV92
 
    
2. Identify location of control files

   select * from v$controlfile;


NAME
/oraredologs/dpu21/DPDEV91/control1DPDEV91.ctl
/oraredologs/dpu22/DPDEV91/control2DPDEV91.ctl	


3. Copy init.ora file


sqlplus / as sysdba

create pfile from spfile;


  cd $ORACLE_HOME/dbs
  cp initDPDEV91.ora initDPDEV92.ora      

/u02/oradata/DPDEV91
/u05/oradata/DPDEV91
/u09/oradata/DPDEV91

/u02/oradata/DPDEV92
/u05/oradata/DPDEV92
/u09/oradata/DPDEV92


/oraredologs/dpu21/DPDEV91
/oraredologs/dpu22/DPDEV91


/oraredologs/dpu21/DPDEV92
/oraredologs/dpu22/DPDEV92

db_file_name_convert='/u02/oradata/DPDEV91/','/u02/oradata/DPDEV92/','/u05/oradata/DPDEV91/','/u05/oradata/DPDEV92/','/u09/oradata/DPDEV91/','/u09/oradata/DPDEV92/'

log_file_name_convert='/oraredologs/dpu21/DPDEV91/','/oraredologs/dpu21/DPDEV92/','/oraredologs/dpu22/DPDEV91/','/oraredologs/dpu22/DPDEV92/'


4. Create zopa file on AUX server (completed !!!)
  
   cd $ORACLE_HOME/dbs
   cp orapwDPDEV91 orapwDPDEV92

5. Identify backupsets location.

   cd $SAVBKP

   

view DPDEV91_sbk_20160418_22:45:05_forDPDEV92dupl.rman

#Backup End Time - 04/18/2016 10:55:05 PM



6. Add entry into oratab
   cd /etc
   vi oratab

  
DPDEV92:/orahome/u01/app/oracle/product/12.1.0.2/db_1:Y


   cd $HOME/aetna/scripts

   cp -p oraprof oraprof_20160418   

   vi oraprof

"DPDEV92")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;


7. setup new AUX env

   . ~/.profile

DPDEV92


8. 

   #Remove
 #  rm /u*/oradata/DPDEV92/*




  ls /u*/oradata/DPDEV92/*
  

  

9. Dupliicate...


    sqlplus / as sysdba
    startup pfile=/orahome/u01/app/oracle/product/12.1.0.2/db_1/dbs/initDPDEV92.ora force nomount;
    



rman
connect target sys/sysdpdev91@DPDEV91
connect catalog DPDEV91/DPDEV91namr@RCATDEV
connect AUXILIARY /





run {
set until time "TO_DATE('04/18/2016 22:55:05','MM/DD/YYYY HH24:MI:SS')";
duplicate target database to DPDEV92;
}



Cannot remove created server parameter file

10. cd $ORACLE_HOME/network/admin

vi listener.ora

DPDEV92 =
  (DESCRIPTION =
    (ADDRESS= (PROTOCOL= IPC)(KEY= DPDEV92_ipc))
    (ADDRESS = (PROTOCOL = TCP)(HOST = dppdev)(PORT = 1695))
  )

SID_LIST_DPDEV92 =
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME = DPDEV92)
      (ORACLE_HOME = /orahome/u01/app/oracle/product/12.1.0.2/db_1)
      (SID_NAME = DPDEV92)
    )
  )

SECURE_REGISTER_DPDEV92 = (IPC)

SUBSCRIBE_FOR_NODE_DOWN_EVENT_DPDEV92=OFF

!! Remove DBACOUT entry...




11. Change sys zopas


Remove zopa function first

AI_zopa_VALIDATE



alter profile default limit zopa_VERIFY_FUNCTION null
/




ALTER USER system IDENTIFIED BY "sysdpdev92"

/
ALTER USER sys IDENTIFIED BY "sysdpdev92"

/


ALTER USER dpadmin IDENTIFIED BY "bpsdpdev92"

/

ALTER PROFILE DEFAULT LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/







12. Add new entry to Web Server oratab : xpsdppw2d

DPDEV92:/orahome/psu01/oracle/product/12.1.0.2/client_64bit_dp1:N

cd /orahome/psu01/oracle/scripts
  cp -p oraprof oraprof_20160418 

   vi oraprof

Add DPBCKOUT entry to oraprof
 
"DPDEV92")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;
   . ~/.profile

DPDEV92

cd $ORACLE_HOME/network/admin

vi tnsnames.ora

DPDEV92.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppdev)
          (Port = 1695)
        )
    )
    (CONNECT_DATA = (SID = DPDEV92)
    )
  )



Test: sqlplus

system/sysdpdev92@DPDEV92




13. Setup Catalog in  RCATDEV database on XORACLDW2D Server

XORACLDW2D/ Bl0ckhe@d

SSH to XORACLDW2D Login as A id and su to oracle

##cd /u01/app/oracle/admin/RCATDEV/sql

cd $ORACLE_BASE/local/scripts


create_catalog.ksh RCATDEV DPDEV92 DPDEV92namr



   . ~/.profile

DPDEV92


>rman

connect catalog DPDEV92/DPDEV92namr@RCATDEV

create catalog;

exit


>rman

connect target /

connect catalog DPDEV92/DPDEV92namr@RCATDEV




register database;


report schema;

show all;

RMAN configuration parameters for database with db_unique_name DPDEV92 are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 1; # default
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE CONTROLFILE AUTOBACKUP OFF; # default
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F'; # default
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOA
D TRUE ; # default
CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/orahome/u01/app/oracle/product/12.1.0.2
/db_1/dbs/snapcf_DPDEV92.f'; # default


Change to (based on DPDEMO91)
RMAN> show all;

RMAN configuration parameters for database with db_unique_name DPDEV91 are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 10;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/u10/oraback/DPDEV92/rman_backups/%F';

CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F_%d';
CONFIGURE DEVICE TYPE DISK PARALLELISM 4 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/u10/oraback/DPDEV92/rman_backups/bkp_df%t_s%s_s%p';

CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDEV92.opt)';

CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default

CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPDEV92/rman_backups/snapcf_DPDEV92.f';



14. Make sure all files exist. Create one if needed.

cd $HOME

#make sure both file exists
cp .DPDEV91.pw .DPDEV92.pw
cp .DPDEV91_RMAN.pw .DPDEV92_RMAN.pw
cp .DPDEV91sys.pw .DPDEV92sys.pw
cp .DPDEV91_DPADMIN.pw .DPDEV92_DPADMIN.pw



15. Ask Storman to create /u01/app/oracle/tdpoopt/tdpo.DPDEV92.opt


Test backup

Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}

Monitor backup

cd /u01/app/oracle/aetna/db_admin/db_DPDEV92/log
tail -f xxx.log

Or/and 

Save backup
nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} initBackup


DPDEV92 backup saved as DPDEV92_sbk_20160420_09:51:37_initBackup.rman

16. Recompile all.

select count(*)
from dba_objects
where status = 'INVALID';

41



###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


15. Recreate Log and exp dir if needed

##EXP_DUMP_DIR
###EXPORT_LOG_DIR


CREATE OR REPLACE DIRECTORY EXP_LOG_DIR AS '/u01/app/oracle/aetna/db_admin/db_DPDEV92/export/'
/
GRANT READ ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/


16. Add new DB to OEM, add cron jobs and schedule backups


Email Rich Ryan to add database to OEM

Add crontabs jobs
50 19 * * * ${HOME}/aetna/db_mgmt/backup/expdp_full_new.ksh DPDEV92

30 03 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_all.ksh DPDEV92

00 07 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_sjt_tables.ksh DPDEV92

00,20,40 2-23 * * * ${HOME}/aetna/scripts/verify_db_is_up.ksh DPDEV92

0,15,30,45 0-23 * * * ${HOME}/aetna/db_mgmt/monitor/scan_oracle.ksh DPDEV92

15 23 * * * ${HOME}/aetna/db_mgmt/backup/rman_list_database.ksh DPDEV92

05 05 * * 0 ${HOME}/aetna/db_mgmt/extsecur/ext_spcl_permissions.ksh DPDEV92 > /dev/null 2>&1

0,15,30,45 2-23 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPDEV92 > /dev/null

20 12 * * * ${HOME}/tls/space_usage.ksh DPDEV92 > /dev/null

25 12 * * * ${HOME}/aetna/db_mgmt/space/spacechk.ksh DPDEV92

01 04 * * * ${HOME}/aetna/db_mgmt/space/get_db_file_info.ksh DPDEV92 >/dev/null




17. Add sys and system accounts to eDMZ

18. Make note of current space

FUll size: 93,598 GB




***** DPUAT91 backup saved as DPUAT91_sbk_20160415_07:52:46_b4upgora12102.rman *********


!! This Database was upgraded to 12.1.0.2
!! So we are kind downgrading back to 11.2.0.4



1. Save current 12c Backup

$BKPSCR/dbbackup_rman ${ORACLE_SID}

nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} b4downgrade12102
DPUAT91 backup saved as DPUAT91_sbk_20160428_22:55:04_b4downgrade12102.rman



2. Locate Backup to restroe
cd /u01/app/oracle/aetna/db_admin/db_DPUAT91/save_backup

view DPUAT91_sbk_20160415_07:52:46_b4upgora12102.rman



3. Blackout in OEM and disable cron

cd $HOME/local/

deactivate_cron.ksh




4. Shutdown immediate
5. lsnrctl stop DPUAT91





6. Note and Drop Data files

FILE_NAME
/u04/oradata/DPUAT91/USERS01.dbf
/u04/oradata/DPUAT91/bnapp.dbf
/u04/oradata/DPUAT91/bnlarge.dbf
/u04/oradata/DPUAT91/fsapp.dbf
/u04/oradata/DPUAT91/giapp.dbf
/u04/oradata/DPUAT91/glapp.dbf
/u04/oradata/DPUAT91/gpapp.dbf
/u04/oradata/DPUAT91/hrapp.dbf
/u04/oradata/DPUAT91/hrlarge.dbf
/u04/oradata/DPUAT91/htapp.dbf
/u04/oradata/DPUAT91/inapp.dbf
/u04/oradata/DPUAT91/omapp.dbf
/u04/oradata/DPUAT91/paapp.dbf
/u04/oradata/DPUAT91/palarge.dbf
/u04/oradata/DPUAT91/piapp.dbf
/u04/oradata/DPUAT91/pilarge.dbf
/u04/oradata/DPUAT91/psimage.dbf
/u04/oradata/DPUAT91/psimage2_1.dbf
/u04/oradata/DPUAT91/psimage2_2.dbf
/u04/oradata/DPUAT91/psimage2_3.dbf
/u04/oradata/DPUAT91/psimage2_4.dbf
/u04/oradata/DPUAT91/psimage2_5.dbf
/u04/oradata/DPUAT91/psindex.dbf
/u04/oradata/DPUAT91/psindex01.dbf
/u04/oradata/DPUAT91/psindex02.dbf
/u04/oradata/DPUAT91/psindex03.dbf
/u04/oradata/DPUAT91/psundots.dbf
/u04/oradata/DPUAT91/psundots_03.dbf
/u04/oradata/DPUAT91/ptapp.dbf
/u04/oradata/DPUAT91/ptprc.dbf
/u04/oradata/DPUAT91/system01.dbf
/u06/oradata/DPUAT91/aaapp1.dbf
/u06/oradata/DPUAT91/aalarge1.dbf
/u06/oradata/DPUAT91/adapp1.dbf
/u06/oradata/DPUAT91/aidba.dbf
/u06/oradata/DPUAT91/amapp.dbf
/u06/oradata/DPUAT91/avapp1.dbf
/u06/oradata/DPUAT91/bdapp.dbf
/u06/oradata/DPUAT91/bpapp.dbf
/u06/oradata/DPUAT91/ccapp1.dbf
/u06/oradata/DPUAT91/coapp.dbf
/u06/oradata/DPUAT91/cuaudit.dbf
/u06/oradata/DPUAT91/cularg1.dbf
/u06/oradata/DPUAT91/cularg2.dbf
/u06/oradata/DPUAT91/cularg3.dbf
/u06/oradata/DPUAT91/cularge.dbf
/u06/oradata/DPUAT91/dbtune.dbf
/u06/oradata/DPUAT91/diapp.dbf
/u06/oradata/DPUAT91/eoapp.dbf
/u06/oradata/DPUAT91/eobfapp1.dbf
/u06/oradata/DPUAT91/eocfapp1.dbf
/u06/oradata/DPUAT91/eocmapp.dbf
/u06/oradata/DPUAT91/eocmlrg.dbf
/u06/oradata/DPUAT91/eocmwrk.dbf
/u06/oradata/DPUAT91/eocuapp.dbf
/u06/oradata/DPUAT91/eoculrg.dbf
/u06/oradata/DPUAT91/eoditbl.dbf
/u06/oradata/DPUAT91/eodsapp.dbf
/u06/oradata/DPUAT91/eodslrg.dbf
/u06/oradata/DPUAT91/eoecapp.dbf
/u06/oradata/DPUAT91/eoeclrg.dbf
/u06/oradata/DPUAT91/eoecwrk.dbf
/u06/oradata/DPUAT91/eoeiapp.dbf
/u06/oradata/DPUAT91/eoeilrg.dbf
/u06/oradata/DPUAT91/eoewapp.dbf
/u06/oradata/DPUAT91/eoewlrg.dbf
/u06/oradata/DPUAT91/eoewwrk.dbf
/u06/oradata/DPUAT91/eoiuapp.dbf
/u06/oradata/DPUAT91/eoiulrg.dbf
/u06/oradata/DPUAT91/eoiuwrk.dbf
/u06/oradata/DPUAT91/eoltapp1.dbf
/u06/oradata/DPUAT91/eoppapp1.dbf
/u06/oradata/DPUAT91/eopplrg1.dbf
/u06/oradata/DPUAT91/faapp1.dbf
/u06/oradata/DPUAT91/falarge1.dbf
/u06/oradata/DPUAT91/hrapp71.dbf
/u06/oradata/DPUAT91/hrsapp1.dbf
/u06/oradata/DPUAT91/hrslarge1.dbf
/u06/oradata/DPUAT91/hrswork1.dbf
/u06/oradata/DPUAT91/psdefault.dbf
/u06/oradata/DPUAT91/psimgr.dbf
/u06/oradata/DPUAT91/psindex06.dbf
/u06/oradata/DPUAT91/pstemp01.dbf
/u06/oradata/DPUAT91/pswork.dbf
/u06/oradata/DPUAT91/ptamsg.dbf
/u06/oradata/DPUAT91/ptappe.dbf
/u06/oradata/DPUAT91/ptaudit.dbf
/u06/oradata/DPUAT91/ptcmstar.dbf
/u06/oradata/DPUAT91/ptlock.dbf
/u06/oradata/DPUAT91/ptprjwk.dbf
/u06/oradata/DPUAT91/ptrpts.dbf
/u06/oradata/DPUAT91/pttbl.dbf
/u06/oradata/DPUAT91/pttlrg.dbf
/u06/oradata/DPUAT91/pttree.dbf
/u06/oradata/DPUAT91/ptwork.dbf
/u06/oradata/DPUAT91/pyapp.dbf
/u06/oradata/DPUAT91/pylarge.dbf
/u06/oradata/DPUAT91/pylarge02.dbf
/u06/oradata/DPUAT91/saapp1.dbf
/u06/oradata/DPUAT91/sacapp1.dbf
/u06/oradata/DPUAT91/salarge1.dbf
/u06/oradata/DPUAT91/srapp1.dbf
/u06/oradata/DPUAT91/stapp.dbf
/u06/oradata/DPUAT91/stlarge.dbf
/u06/oradata/DPUAT91/sysaux01.dbf
/u06/oradata/DPUAT91/sysaux02.dbf
/u06/oradata/DPUAT91/tivoliorts01.dbf
/u06/oradata/DPUAT91/tlapp.dbf
/u06/oradata/DPUAT91/tllarge.dbf
/u08/oradata/DPUAT91/eolarge.dbf
/u08/oradata/DPUAT91/eotpapp.dbf
/u08/oradata/DPUAT91/eotplrg.dbf
/u08/oradata/DPUAT91/epapp.dbf
/u08/oradata/DPUAT91/eplarge.dbf
/u08/oradata/DPUAT91/erapp.dbf
/u08/oradata/DPUAT91/erlarge.dbf
/u08/oradata/DPUAT91/erwork.dbf
/u08/oradata/DPUAT91/fgapp.dbf
/u08/oradata/DPUAT91/gpdeapp.dbf
/u08/oradata/DPUAT91/hpapp.dbf
/u08/oradata/DPUAT91/hrapp1.dbf
/u08/oradata/DPUAT91/hrapp2.dbf
/u08/oradata/DPUAT91/hrapp3.dbf
/u08/oradata/DPUAT91/hrapp4.dbf
/u08/oradata/DPUAT91/hrapp5.dbf
/u08/oradata/DPUAT91/hrapp6.dbf
/u08/oradata/DPUAT91/hrlarge02.dbf
/u08/oradata/DPUAT91/hrlarge03.dbf
/u08/oradata/DPUAT91/hrwork.dbf
/u08/oradata/DPUAT91/knsapp.dbf
/u08/oradata/DPUAT91/pcapp.dbf
/u08/oradata/DPUAT91/pclarge.dbf
/u08/oradata/DPUAT91/piwork.dbf
/u08/oradata/DPUAT91/poapp.dbf
/u08/oradata/DPUAT91/psindex04.dbf
/u08/oradata/DPUAT91/psindex05.dbf
/u08/oradata/DPUAT91/psindex07.dbf
/u08/oradata/DPUAT91/psundots_02.dbf
/u08/oradata/DPUAT91/pvapp.dbf
/u08/oradata/DPUAT91/py0lrg.dbf
/u08/oradata/DPUAT91/pylarge03.dbf
/u08/oradata/DPUAT91/pylarge04.dbf
/u08/oradata/DPUAT91/pywork.dbf
/u08/oradata/DPUAT91/stwork.dbf
/u08/oradata/DPUAT91/tlwork.dbf
/u08/oradata/DPUAT91/waapp.dbf


/u08/oradata/DPUAT91/temp01.dbf
/u08/oradata/DPUAT91/tivoliortempts_01.dbf


MEMBER
/oraredologs/dpu21/DPUAT91/redo0601.log
/oraredologs/dpu22/DPUAT91/redo0602.log
/oraredologs/dpu21/DPUAT91/redo0501.log
/oraredologs/dpu22/DPUAT91/redo0502.log
/oraredologs/dpu21/DPUAT91/redo0401.log
/oraredologs/dpu22/DPUAT91/redo0402.log
/oraredologs/dpu21/DPUAT91/redo0301.log
/oraredologs/dpu22/DPUAT91/redo0302.log
/oraredologs/dpu21/DPUAT91/redo0201.log
/oraredologs/dpu22/DPUAT91/redo0202.log
/oraredologs/dpu21/DPUAT91/redo0101.log
/oraredologs/dpu22/DPUAT91/redo0102.log


NAME
/oraredologs/dpu21/DPUAT91/control1DPUAT91.ctl
/oraredologs/dpu22/DPUAT91/control2DPUAT91.ctl


 #Confirm
   ls /u04/oradata/DPUAT91*
   ls /u06/oradata/DPUAT91/*
   ls /u08/oradata/DPUAT91* 
   ls /oraredologs/dpu21/DPUAT91/* 
   ls /oraredologs/dpu22/DPUAT91/*
 
   #Remove
   rm /u04/oradata/DPUAT91*
   rm /u06/oradata/DPUAT91/*
   rm /u08/oradata/DPUAT91* 
   rm /oraredologs/dpu21/DPUAT91/* 
   rm /oraredologs/dpu22/DPUAT91/*

   #Confirm again




7. cd /etc
   vi oratab

Current: DPUAT91:/orahome/u01/app/oracle/product/12.1.0.2/db_1:Y
Change:  DPUAT91:/u01/app/oracle/product/11.2.0.4/db_1:Y

. ~/.profile

DPUAT91

echo $ORACLE_HOME



#Restore DataBase

rman

connect target /
connect catalog DPUAT91/DPUAT91namr@RCATDEV
startup force nomount;
set DBID=2332859867;
reset database to incarnation 651678;
restore controlfile from 'c-2332859867-20160415-01_DPUAT91';
alter database mount;
run{
restore database until sequence 78756;
recover database until sequence 78756;
}
alter database open resetlogs;
#End Restore DataBase


lsnrctl start DPUAT91

shutdown immediate
startup


8. Change Oracle home in OEM to point to old

9. Change Oracle Homes in App servers: xpsdppm1q, xpsdppw1q

move2s10

Current: DPUAT91:/orahome/psu01/oracle/product/12.1.0.2/client_64bit_dp1:N
Change to: DPUAT91:/orahome/psu01/oracle/product/11.2.0.4/client_64bit_dp1:N

Test:

. ~/.profile
     DPUAT91

sqlplus
system/sysdpuat91@DPUAT91


10. Remove OEm Blackout, change Oracle Home in OEM and enabled cron

cd $HOME/local

crontab crontab_b4_aixpatch.lst




11. After Tax B applied take new backup and safe


$BKPSCR/dbbackup_rman ${ORACLE_SID}

nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} afterTaxB11204


DPUAT91 backup saved as DPUAT91_sbk_20160429_13:46:26_afterTaxB11204.rman


****************** Revert DPUAT91 back to 12c restore from DPUAT91_sbk_20160428_22:55:04_b4downgrade12102.rman ****

1. Locate Backup to restroe
cd /u01/app/oracle/aetna/db_admin/db_DPUAT91/save_backup

view DPUAT91_sbk_20160428_22:55:04_b4downgrade12102.rman







2. Blackout in OEM and disable cron

cd $HOME/local/

deactivate_cron.ksh




3. Shutdown immediate
4. lsnrctl stop DPUAT91



5. cd /etc
   vi oratab

Current:  DPUAT91:/u01/app/oracle/product/11.2.0.4/db_1:Y

Change:  DPUAT91:/orahome/u01/app/oracle/product/12.1.0.2/db_1:Y


. ~/.profile

DPUAT91

echo $ORACLE_HOME


#Restore DataBase
connect target /
connect catalog DPUAT91/DPUAT91namr@RCATDEV
startup force nomount;
set DBID=2332859867;
reset database to incarnation 651678;
restore controlfile from 'c-2332859867-20160428-07_DPUAT91';
alter database mount;
run{
restore database until sequence 80558;
recover database until sequence 80558;
}
alter database open resetlogs;


lsnrctl start DPUAT91

shutdown immediate
startup




6. Change Oracle home in OEM to point to 12c Home

7. Change Oracle Homes in App servers: xpsdppm1q, xpsdppw1q

move2s10


Current to: DPUAT91:/orahome/psu01/oracle/product/11.2.0.4/client_64bit_dp1:N

Change: DPUAT91:/orahome/psu01/oracle/product/12.1.0.2/client_64bit_dp1:N


Test:

. ~/.profile
     DPUAT91

sqlplus
system/sysdpuat91@DPUAT91


8. Remove OEm Blackout, change Oracle Home in OEM and enabled cron

cd $HOME/local

crontab crontab_b4_aixpatch.lst


****************** Restore DPDEV92 from Saved Backup: BackingUpAfterPreparingTheDatabase *******************

cd $SAVBKP


Login to DBArtisan and run following queries

select file_id,file_name from dba_data_files order by 2


cd /u02/oradata/DPDEV92/

rm -f *.dbf

cd /u05/oradata/DPDEV92/

rm -f *.dbf

cd /u09/oradata/DPDEV92/

cd 
FILE_NAME
FILE_NAME
/u02/oradata/DPDEV92/USERS01.dbf
/u02/oradata/DPDEV92/bnapp.dbf
/u02/oradata/DPDEV92/bnlarge.dbf
/u02/oradata/DPDEV92/fsapp.dbf
/u02/oradata/DPDEV92/giapp.dbf
/u02/oradata/DPDEV92/glapp.dbf
/u02/oradata/DPDEV92/gpapp.dbf
/u02/oradata/DPDEV92/hrapp.dbf
/u02/oradata/DPDEV92/hrlarge.dbf
/u02/oradata/DPDEV92/htapp.dbf
/u02/oradata/DPDEV92/inapp.dbf
/u02/oradata/DPDEV92/omapp.dbf
/u02/oradata/DPDEV92/paapp.dbf
/u02/oradata/DPDEV92/palarge.dbf
/u02/oradata/DPDEV92/piapp.dbf
/u02/oradata/DPDEV92/pilarge.dbf
/u02/oradata/DPDEV92/psimage.dbf
/u02/oradata/DPDEV92/psimage2_1.dbf
/u02/oradata/DPDEV92/psimage2_2.dbf
/u02/oradata/DPDEV92/psimage2_3.dbf
/u02/oradata/DPDEV92/psimage2_4.dbf
/u02/oradata/DPDEV92/psimage2_5.dbf
/u02/oradata/DPDEV92/psindex.dbf
/u02/oradata/DPDEV92/psindex01.dbf
/u02/oradata/DPDEV92/psindex02.dbf
/u02/oradata/DPDEV92/psindex03.dbf
/u02/oradata/DPDEV92/psundots.dbf
/u02/oradata/DPDEV92/ptapp.dbf
/u02/oradata/DPDEV92/ptprc.dbf
/u02/oradata/DPDEV92/system01.dbf
/u05/oradata/DPDEV92/aaapp1.dbf
/u05/oradata/DPDEV92/aalarge1.dbf
/u05/oradata/DPDEV92/adapp1.dbf
/u05/oradata/DPDEV92/aidba.dbf
/u05/oradata/DPDEV92/amapp.dbf
/u05/oradata/DPDEV92/avapp1.dbf
/u05/oradata/DPDEV92/bdapp.dbf
/u05/oradata/DPDEV92/bpapp.dbf
/u05/oradata/DPDEV92/ccapp1.dbf
/u05/oradata/DPDEV92/coapp.dbf
/u05/oradata/DPDEV92/cuaudit.dbf
/u05/oradata/DPDEV92/cularg1.dbf
/u05/oradata/DPDEV92/cularg2.dbf
/u05/oradata/DPDEV92/cularg3.dbf
/u05/oradata/DPDEV92/cularge.dbf
/u05/oradata/DPDEV92/dbtune.dbf
/u05/oradata/DPDEV92/diapp.dbf
/u05/oradata/DPDEV92/eoapp.dbf
/u05/oradata/DPDEV92/eobfapp1.dbf
/u05/oradata/DPDEV92/eocfapp1.dbf
/u05/oradata/DPDEV92/eocmapp.dbf
/u05/oradata/DPDEV92/eocmlrg.dbf
/u05/oradata/DPDEV92/eocmwrk.dbf
/u05/oradata/DPDEV92/eocuapp.dbf
/u05/oradata/DPDEV92/eoculrg.dbf
/u05/oradata/DPDEV92/eoditbl.dbf
/u05/oradata/DPDEV92/eodsapp.dbf
/u05/oradata/DPDEV92/eodslrg.dbf
/u05/oradata/DPDEV92/eoecapp.dbf
/u05/oradata/DPDEV92/eoeclrg.dbf
/u05/oradata/DPDEV92/eoecwrk.dbf
/u05/oradata/DPDEV92/eoeiapp.dbf
/u05/oradata/DPDEV92/eoeilrg.dbf
/u05/oradata/DPDEV92/eoewapp.dbf
/u05/oradata/DPDEV92/eoewlrg.dbf
/u05/oradata/DPDEV92/eoewwrk.dbf
/u05/oradata/DPDEV92/eoiuapp.dbf
/u05/oradata/DPDEV92/eoiulrg.dbf
/u05/oradata/DPDEV92/eoiuwrk.dbf
/u05/oradata/DPDEV92/eoltapp1.dbf
/u05/oradata/DPDEV92/eoppapp1.dbf
/u05/oradata/DPDEV92/eopplrg1.dbf
/u05/oradata/DPDEV92/faapp1.dbf
/u05/oradata/DPDEV92/falarge1.dbf
/u05/oradata/DPDEV92/hrapp71.dbf
/u05/oradata/DPDEV92/hrsapp1.dbf
/u05/oradata/DPDEV92/hrslarge1.dbf
/u05/oradata/DPDEV92/hrswork1.dbf
/u05/oradata/DPDEV92/psdefault.dbf
/u05/oradata/DPDEV92/psimgr.dbf
/u05/oradata/DPDEV92/psindex06.dbf
/u05/oradata/DPDEV92/psmatvw.dbf
/u05/oradata/DPDEV92/pstemp01.dbf
/u05/oradata/DPDEV92/pswork.dbf
/u05/oradata/DPDEV92/ptamsg.dbf
/u05/oradata/DPDEV92/ptappe.dbf
/u05/oradata/DPDEV92/ptaudit.dbf
/u05/oradata/DPDEV92/ptcmstar.dbf
/u05/oradata/DPDEV92/ptlock.dbf
/u05/oradata/DPDEV92/ptprjwk.dbf
/u05/oradata/DPDEV92/ptrpts.dbf
/u05/oradata/DPDEV92/pttbl.dbf
/u05/oradata/DPDEV92/pttlrg.dbf
/u05/oradata/DPDEV92/pttree.dbf
/u05/oradata/DPDEV92/ptwork.dbf
/u05/oradata/DPDEV92/pyapp.dbf
/u05/oradata/DPDEV92/pylarge.dbf
/u05/oradata/DPDEV92/pylarge02.dbf
/u05/oradata/DPDEV92/saapp1.dbf
/u05/oradata/DPDEV92/sacapp1.dbf
/u05/oradata/DPDEV92/salarge1.dbf
/u05/oradata/DPDEV92/srapp1.dbf
/u05/oradata/DPDEV92/stapp.dbf
/u05/oradata/DPDEV92/stlarge.dbf
/u05/oradata/DPDEV92/sysaux01.dbf
/u05/oradata/DPDEV92/sysaux02.dbf
/u05/oradata/DPDEV92/tivoliorts01.dbf
/u05/oradata/DPDEV92/tlapp.dbf
/u05/oradata/DPDEV92/tllarge.dbf
/u09/oradata/DPDEV92/eolarge.dbf
/u09/oradata/DPDEV92/eotpapp.dbf
/u09/oradata/DPDEV92/eotplrg.dbf
/u09/oradata/DPDEV92/epapp.dbf
/u09/oradata/DPDEV92/eplarge.dbf
/u09/oradata/DPDEV92/erapp.dbf
/u09/oradata/DPDEV92/erlarge.dbf
/u09/oradata/DPDEV92/erwork.dbf
/u09/oradata/DPDEV92/fgapp.dbf
/u09/oradata/DPDEV92/gpdeapp.dbf
/u09/oradata/DPDEV92/hpapp.dbf
/u09/oradata/DPDEV92/hrapp1.dbf
/u09/oradata/DPDEV92/hrapp2.dbf
/u09/oradata/DPDEV92/hrapp3.dbf
/u09/oradata/DPDEV92/hrapp4.dbf
/u09/oradata/DPDEV92/hrapp5.dbf
/u09/oradata/DPDEV92/hrapp6.dbf
/u09/oradata/DPDEV92/hrlarge02.dbf
/u09/oradata/DPDEV92/hrlarge03.dbf
/u09/oradata/DPDEV92/hrwork.dbf
/u09/oradata/DPDEV92/knsapp.dbf
/u09/oradata/DPDEV92/pcapp.dbf
/u09/oradata/DPDEV92/pclarge.dbf
/u09/oradata/DPDEV92/piwork.dbf
/u09/oradata/DPDEV92/poapp.dbf
/u09/oradata/DPDEV92/psindex04.dbf
/u09/oradata/DPDEV92/psindex05.dbf
/u09/oradata/DPDEV92/psindex07.dbf
/u09/oradata/DPDEV92/psundots_02.dbf
/u09/oradata/DPDEV92/pvapp.dbf
/u09/oradata/DPDEV92/py0lrg.dbf
/u09/oradata/DPDEV92/pylarge03.dbf
/u09/oradata/DPDEV92/pylarge04.dbf
/u09/oradata/DPDEV92/pywork.dbf
/u09/oradata/DPDEV92/stwork.dbf
/u09/oradata/DPDEV92/tlwork.dbf
/u09/oradata/DPDEV92/waapp.dbf


select file_id,file_name  from dba_temp_files order by 1
FILE_NAME
/u09/oradata/DPDEV92/temp01.dbf
/u09/oradata/DPDEV92/tivoliortempts_01.dbf
/u09/oradata/DPDEV92/psgtt01.dbf


select * from v$logfile


MEMBER

/oraredologs/dpu22/DPDEV92/redo0602.log
/oraredologs/dpu21/DPDEV92/redo0601.log
/oraredologs/dpu21/DPDEV92/redo0501.log
/oraredologs/dpu22/DPDEV92/redo0502.log
/oraredologs/dpu21/DPDEV92/redo0401.log
/oraredologs/dpu22/DPDEV92/redo0402.log
/oraredologs/dpu21/DPDEV92/redo0301.log
/oraredologs/dpu22/DPDEV92/redo0302.log
/oraredologs/dpu22/DPDEV92/redo0202.log
/oraredologs/dpu21/DPDEV92/redo0201.log
/oraredologs/dpu21/DPDEV92/redo0101.log
/oraredologs/dpu22/DPDEV92/redo0102.log

select * from v$controlfile
NAME
/oraredologs/dpu21/DPDEV92/control1DPDEV92.ctl
/oraredologs/dpu22/DPDEV92/control2DPDEV92.ctl

psmatvw.dbf 

DPDEV92 backup saved as DPDEV92_sbk_20160519_18:33:41_BackingUpAfterPreparingTheDatabase.rman


view DPDEV92_sbk_20160519_18:33:41_BackingUpAfterPreparingTheDatabase.rman

sqlplus / as sysdba
shutdown immediate
exit



#Restore DataBase
rman

connect target /
connect catalog DPDEV92/DPDEV92namr@RCATDEV
startup force nomount;
set DBID=2215358295;
reset database to incarnation 2;
restore controlfile from 'c-2215358295-20160519-00_DPDEV92';
alter database mount;
run{
restore database from TAG=TAG20160519T183537;
recover database noredo;
}
alter database open resetlogs;

#End Restore DataBase

lsnrctl stop DPDEV92
lsnrctl start DPDEV92


----ABOVE had issues with not be able to restore Datafile, workaround below

startup force nomount;
connect target /
run{
allocate channel t1 TYPE 'SBT_TAPE' PARMS 'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDEV92.opt)';
restore controlfile from 'c-2215358295-20160519-00_DPDEV92';
}

alter database mount;

run{
restore database from TAG=TAG20160519T183537;
recover database noredo;
}
alter database open resetlogs;



************** Dupliicate DPUAT91 to DPUAT92

. ~/.profile

DPUAT91



nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} forDPUAT92dupl

Duplicate from saved backup of DPUAT91 to new DB DPUAT92


## Initial
cd /u01/app/oracle/aetna/db_admin/db_DPUAT91/save_backup

view DPUAT91_sbk_20160609_22:55:02_forDPUAT92dupl.rman


#Restore DataBase
#connect target /
#connect catalog DPUAT91/DPUAT91namr@RCATDEV
#startup force nomount;
#set DBID=2332859867;
#reset database to incarnation 1324380;
#restore controlfile from 'c-2332859867-20160609-07_DPUAT91';
#alter database mount;
#run{
#restore database until sequence 5614;
#recover database until sequence 5614;
#}
#alter database open resetlogs;
#End Restore DataBase


## Second time
cd /u01/app/oracle/aetna/db_admin/db_DPUAT91/save_backup


view DPUAT91_sbk_20160704_22:55:04_forDPUAT92dupl.rman


#Restore DataBase
#connect target /
#connect catalog DPUAT91/DPUAT91namr@RCATDEV
#startup force nomount;
#set DBID=2332859867;
#reset database to incarnation 1324380;
#restore controlfile from 'c-2332859867-20160704-07_DPUAT91';
#alter database mount;
#run{
#restore database until sequence 9012;
#recover database until sequence 9012;
#}
#alter database open resetlogs;
#End Restore DataBase


Create OEM blackout if DB already exist

Tom's instructions...>


DBArtisan - system/sysdpuat91

select 'set newname for datafile '||file_id||' to '||chr(39)||replace(file_name,'DPUAT91','DPUAT92')||chr(39)||';'
from   dba_data_files
order by file_name;



'SETNEWNAMEFORDATAFILE'||FILE_ID||'TO'||CHR(39)||REPLACE(FILE_NAME,'DPUAT91','DPUAT92')||CHR(39)||';'
set newname for datafile 3 to '/u04/oradata/DPUAT92/USERS01.dbf';
set newname for datafile 4 to '/u04/oradata/DPUAT92/bnapp.dbf';
set newname for datafile 5 to '/u04/oradata/DPUAT92/bnlarge.dbf';
set newname for datafile 6 to '/u04/oradata/DPUAT92/fsapp.dbf';
set newname for datafile 7 to '/u04/oradata/DPUAT92/giapp.dbf';
set newname for datafile 8 to '/u04/oradata/DPUAT92/glapp.dbf';
set newname for datafile 9 to '/u04/oradata/DPUAT92/gpapp.dbf';
set newname for datafile 10 to '/u04/oradata/DPUAT92/hrapp.dbf';
set newname for datafile 11 to '/u04/oradata/DPUAT92/hrlarge.dbf';
set newname for datafile 12 to '/u04/oradata/DPUAT92/htapp.dbf';
set newname for datafile 13 to '/u04/oradata/DPUAT92/inapp.dbf';
set newname for datafile 14 to '/u04/oradata/DPUAT92/omapp.dbf';
set newname for datafile 15 to '/u04/oradata/DPUAT92/paapp.dbf';
set newname for datafile 16 to '/u04/oradata/DPUAT92/palarge.dbf';
set newname for datafile 17 to '/u04/oradata/DPUAT92/piapp.dbf';
set newname for datafile 18 to '/u04/oradata/DPUAT92/pilarge.dbf';
set newname for datafile 19 to '/u04/oradata/DPUAT92/psimage.dbf';
set newname for datafile 142 to '/u04/oradata/DPUAT92/psimage2_1.dbf';
set newname for datafile 143 to '/u04/oradata/DPUAT92/psimage2_2.dbf';
set newname for datafile 144 to '/u04/oradata/DPUAT92/psimage2_3.dbf';
set newname for datafile 145 to '/u04/oradata/DPUAT92/psimage2_4.dbf';
set newname for datafile 146 to '/u04/oradata/DPUAT92/psimage2_5.dbf';
set newname for datafile 20 to '/u04/oradata/DPUAT92/psindex.dbf';
set newname for datafile 21 to '/u04/oradata/DPUAT92/psindex01.dbf';
set newname for datafile 22 to '/u04/oradata/DPUAT92/psindex02.dbf';
set newname for datafile 23 to '/u04/oradata/DPUAT92/psindex03.dbf';
set newname for datafile 2 to '/u04/oradata/DPUAT92/psundots.dbf';
set newname for datafile 115 to '/u04/oradata/DPUAT92/psundots_03.dbf';
set newname for datafile 24 to '/u04/oradata/DPUAT92/ptapp.dbf';
set newname for datafile 25 to '/u04/oradata/DPUAT92/ptprc.dbf';
set newname for datafile 1 to '/u04/oradata/DPUAT92/system01.dbf';
set newname for datafile 125 to '/u06/oradata/DPUAT92/aaapp1.dbf';
set newname for datafile 116 to '/u06/oradata/DPUAT92/aalarge1.dbf';
set newname for datafile 126 to '/u06/oradata/DPUAT92/adapp1.dbf';
set newname for datafile 138 to '/u06/oradata/DPUAT92/aidba.dbf';
set newname for datafile 49 to '/u06/oradata/DPUAT92/amapp.dbf';
set newname for datafile 127 to '/u06/oradata/DPUAT92/avapp1.dbf';
set newname for datafile 50 to '/u06/oradata/DPUAT92/bdapp.dbf';
set newname for datafile 51 to '/u06/oradata/DPUAT92/bpapp.dbf';
set newname for datafile 128 to '/u06/oradata/DPUAT92/ccapp1.dbf';
set newname for datafile 52 to '/u06/oradata/DPUAT92/coapp.dbf';
set newname for datafile 53 to '/u06/oradata/DPUAT92/cuaudit.dbf';
set newname for datafile 54 to '/u06/oradata/DPUAT92/cularg1.dbf';
set newname for datafile 55 to '/u06/oradata/DPUAT92/cularg2.dbf';
set newname for datafile 56 to '/u06/oradata/DPUAT92/cularg3.dbf';
set newname for datafile 57 to '/u06/oradata/DPUAT92/cularge.dbf';
set newname for datafile 34 to '/u06/oradata/DPUAT92/dbtune.dbf';
set newname for datafile 58 to '/u06/oradata/DPUAT92/diapp.dbf';
set newname for datafile 59 to '/u06/oradata/DPUAT92/eoapp.dbf';
set newname for datafile 117 to '/u06/oradata/DPUAT92/eobfapp1.dbf';
set newname for datafile 118 to '/u06/oradata/DPUAT92/eocfapp1.dbf';
set newname for datafile 60 to '/u06/oradata/DPUAT92/eocmapp.dbf';
set newname for datafile 61 to '/u06/oradata/DPUAT92/eocmlrg.dbf';
set newname for datafile 62 to '/u06/oradata/DPUAT92/eocmwrk.dbf';
set newname for datafile 63 to '/u06/oradata/DPUAT92/eocuapp.dbf';
set newname for datafile 64 to '/u06/oradata/DPUAT92/eoculrg.dbf';
set newname for datafile 65 to '/u06/oradata/DPUAT92/eoditbl.dbf';
set newname for datafile 66 to '/u06/oradata/DPUAT92/eodsapp.dbf';
set newname for datafile 67 to '/u06/oradata/DPUAT92/eodslrg.dbf';
set newname for datafile 68 to '/u06/oradata/DPUAT92/eoecapp.dbf';
set newname for datafile 69 to '/u06/oradata/DPUAT92/eoeclrg.dbf';
set newname for datafile 70 to '/u06/oradata/DPUAT92/eoecwrk.dbf';
set newname for datafile 71 to '/u06/oradata/DPUAT92/eoeiapp.dbf';
set newname for datafile 72 to '/u06/oradata/DPUAT92/eoeilrg.dbf';
set newname for datafile 73 to '/u06/oradata/DPUAT92/eoewapp.dbf';
set newname for datafile 74 to '/u06/oradata/DPUAT92/eoewlrg.dbf';
set newname for datafile 75 to '/u06/oradata/DPUAT92/eoewwrk.dbf';
set newname for datafile 76 to '/u06/oradata/DPUAT92/eoiuapp.dbf';
set newname for datafile 77 to '/u06/oradata/DPUAT92/eoiulrg.dbf';
set newname for datafile 78 to '/u06/oradata/DPUAT92/eoiuwrk.dbf';
set newname for datafile 119 to '/u06/oradata/DPUAT92/eoltapp1.dbf';
set newname for datafile 129 to '/u06/oradata/DPUAT92/eoppapp1.dbf';
set newname for datafile 120 to '/u06/oradata/DPUAT92/eopplrg1.dbf';
set newname for datafile 130 to '/u06/oradata/DPUAT92/faapp1.dbf';
set newname for datafile 121 to '/u06/oradata/DPUAT92/falarge1.dbf';
set newname for datafile 122 to '/u06/oradata/DPUAT92/hrapp71.dbf';
set newname for datafile 131 to '/u06/oradata/DPUAT92/hrsapp1.dbf';
set newname for datafile 132 to '/u06/oradata/DPUAT92/hrslarge1.dbf';
set newname for datafile 133 to '/u06/oradata/DPUAT92/hrswork1.dbf';
set newname for datafile 48 to '/u06/oradata/DPUAT92/psdefault.dbf';
set newname for datafile 46 to '/u06/oradata/DPUAT92/psimgr.dbf';
set newname for datafile 136 to '/u06/oradata/DPUAT92/psindex06.dbf';
set newname for datafile 47 to '/u06/oradata/DPUAT92/pstemp01.dbf';
set newname for datafile 37 to '/u06/oradata/DPUAT92/pswork.dbf';
set newname for datafile 39 to '/u06/oradata/DPUAT92/ptamsg.dbf';
set newname for datafile 35 to '/u06/oradata/DPUAT92/ptappe.dbf';
set newname for datafile 45 to '/u06/oradata/DPUAT92/ptaudit.dbf';
set newname for datafile 43 to '/u06/oradata/DPUAT92/ptcmstar.dbf';
set newname for datafile 41 to '/u06/oradata/DPUAT92/ptlock.dbf';
set newname for datafile 44 to '/u06/oradata/DPUAT92/ptprjwk.dbf';
set newname for datafile 42 to '/u06/oradata/DPUAT92/ptrpts.dbf';
set newname for datafile 26 to '/u06/oradata/DPUAT92/pttbl.dbf';
set newname for datafile 38 to '/u06/oradata/DPUAT92/pttlrg.dbf';
set newname for datafile 36 to '/u06/oradata/DPUAT92/pttree.dbf';
set newname for datafile 40 to '/u06/oradata/DPUAT92/ptwork.dbf';
set newname for datafile 27 to '/u06/oradata/DPUAT92/pyapp.dbf';
set newname for datafile 28 to '/u06/oradata/DPUAT92/pylarge.dbf';
set newname for datafile 29 to '/u06/oradata/DPUAT92/pylarge02.dbf';
set newname for datafile 134 to '/u06/oradata/DPUAT92/saapp1.dbf';
set newname for datafile 123 to '/u06/oradata/DPUAT92/sacapp1.dbf';
set newname for datafile 124 to '/u06/oradata/DPUAT92/salarge1.dbf';
set newname for datafile 135 to '/u06/oradata/DPUAT92/srapp1.dbf';
set newname for datafile 30 to '/u06/oradata/DPUAT92/stapp.dbf';
set newname for datafile 31 to '/u06/oradata/DPUAT92/stlarge.dbf';
set newname for datafile 114 to '/u06/oradata/DPUAT92/sysaux01.dbf';
set newname for datafile 137 to '/u06/oradata/DPUAT92/sysaux02.dbf';
set newname for datafile 141 to '/u06/oradata/DPUAT92/tivoliorts01.dbf';
set newname for datafile 32 to '/u06/oradata/DPUAT92/tlapp.dbf';
set newname for datafile 33 to '/u06/oradata/DPUAT92/tllarge.dbf';
set newname for datafile 79 to '/u08/oradata/DPUAT92/eolarge.dbf';
set newname for datafile 80 to '/u08/oradata/DPUAT92/eotpapp.dbf';
set newname for datafile 81 to '/u08/oradata/DPUAT92/eotplrg.dbf';
set newname for datafile 82 to '/u08/oradata/DPUAT92/epapp.dbf';
set newname for datafile 83 to '/u08/oradata/DPUAT92/eplarge.dbf';
set newname for datafile 84 to '/u08/oradata/DPUAT92/erapp.dbf';
set newname for datafile 85 to '/u08/oradata/DPUAT92/erlarge.dbf';
set newname for datafile 86 to '/u08/oradata/DPUAT92/erwork.dbf';
set newname for datafile 87 to '/u08/oradata/DPUAT92/fgapp.dbf';
set newname for datafile 88 to '/u08/oradata/DPUAT92/gpdeapp.dbf';
set newname for datafile 89 to '/u08/oradata/DPUAT92/hpapp.dbf';
set newname for datafile 90 to '/u08/oradata/DPUAT92/hrapp1.dbf';
set newname for datafile 91 to '/u08/oradata/DPUAT92/hrapp2.dbf';
set newname for datafile 92 to '/u08/oradata/DPUAT92/hrapp3.dbf';
set newname for datafile 93 to '/u08/oradata/DPUAT92/hrapp4.dbf';
set newname for datafile 94 to '/u08/oradata/DPUAT92/hrapp5.dbf';
set newname for datafile 95 to '/u08/oradata/DPUAT92/hrapp6.dbf';
set newname for datafile 110 to '/u08/oradata/DPUAT92/hrlarge02.dbf';
set newname for datafile 139 to '/u08/oradata/DPUAT92/hrlarge03.dbf';
set newname for datafile 96 to '/u08/oradata/DPUAT92/hrwork.dbf';
set newname for datafile 113 to '/u08/oradata/DPUAT92/knsapp.dbf';
set newname for datafile 97 to '/u08/oradata/DPUAT92/pcapp.dbf';
set newname for datafile 98 to '/u08/oradata/DPUAT92/pclarge.dbf';
set newname for datafile 99 to '/u08/oradata/DPUAT92/piwork.dbf';
set newname for datafile 100 to '/u08/oradata/DPUAT92/poapp.dbf';
set newname for datafile 109 to '/u08/oradata/DPUAT92/psindex04.dbf';
set newname for datafile 112 to '/u08/oradata/DPUAT92/psindex05.dbf';
set newname for datafile 140 to '/u08/oradata/DPUAT92/psindex07.dbf';
set newname for datafile 107 to '/u08/oradata/DPUAT92/psundots_02.dbf';
set newname for datafile 101 to '/u08/oradata/DPUAT92/pvapp.dbf';
set newname for datafile 102 to '/u08/oradata/DPUAT92/py0lrg.dbf';
set newname for datafile 108 to '/u08/oradata/DPUAT92/pylarge03.dbf';
set newname for datafile 111 to '/u08/oradata/DPUAT92/pylarge04.dbf';
set newname for datafile 103 to '/u08/oradata/DPUAT92/pywork.dbf';
set newname for datafile 104 to '/u08/oradata/DPUAT92/stwork.dbf';
set newname for datafile 105 to '/u08/oradata/DPUAT92/tlwork.dbf';
set newname for datafile 106 to '/u08/oradata/DPUAT92/waapp.dbf';

select 'set newname for tempfile '||file_id||' to '||chr(39)||replace(file_name,'DPUAT91','DPUAT92')||chr(39)||';'
from   dba_temp_files
order by file_name;



'SETNEWNAMEFORTEMPFILE'||FILE_ID||'TO'||CHR(39)||REPLACE(FILE_NAME,'DPUAT91','DPUAT92')||CHR(39)||';'

set newname for tempfile 1 to '/u08/oradata/DPUAT92/temp01.dbf';
set newname for tempfile 2 to '/u08/oradata/DPUAT92/tivoliortempts_01.dbf';	   


select lf.group# grp,
  replace(member,'DPUAT91','DPUAT92') member,
   bytes/1024/1024 mbytes 
           from   v$logfile lf,
                  v$log l
           where  lf.group# = l.group#
                  order by lf.group#,
                           substr(lf.member,instr(lf.member,'/',-1) + 1);

MEMBER
/oraredologs/dpu21/DPUAT92/redo0101.log
/oraredologs/dpu22/DPUAT92/redo0102.log
/oraredologs/dpu21/DPUAT92/redo0201.log
/oraredologs/dpu22/DPUAT92/redo0202.log
/oraredologs/dpu21/DPUAT92/redo0301.log
/oraredologs/dpu22/DPUAT92/redo0302.log
/oraredologs/dpu21/DPUAT92/redo0401.log
/oraredologs/dpu22/DPUAT92/redo0402.log
/oraredologs/dpu21/DPUAT92/redo0501.log
/oraredologs/dpu22/DPUAT92/redo0502.log
/oraredologs/dpu21/DPUAT92/redo0601.log
/oraredologs/dpu22/DPUAT92/redo0602.log



   


select replace(name,'DPUAT91','DPUAT92') name  from v$controlfile



NAME
/oraredologs/dpu21/DPUAT92/control1DPUAT92.ctl
/oraredologs/dpu22/DPUAT92/control2DPUAT92.ctl




1. Create new folders

/u04/oradata/DPUAT92/
/u06/oradata/DPUAT92
/u08/oradata/DPUAT92

cd /u04/oradata
mkdir DPUAT92 
cd /u06/oradata
mkdir DPUAT92
cd /u08/oradata
mkdir DPUAT92



   
   cd /oraredologs/dpu21
   mkdir DPUAT92

   cd /oraredologs/dpu22
   mkdir DPUAT92



!! May not need.  Hold one with this owne.

### cd /u01/app/oracle/admin/
### mkdir DPDEV92
   
###   cd /u01/app/oracle/admin/DPDEV92
###   mkdir diag



   cd /u03/archlogs/
   mkdir DPUAT92
   
  cd /u10/oraback
  mkdir DPUAT92
  cd /u10/oraback/DPUAT92
  mkdir rman_backups



cd /u01/app/oracle/aetna/db_admin

cp -rp db_DPUAT91 db_DPUAT92

cd db_DPUAT92
!!!cleanup all under db_DPUAT92


cd /orahome/u01/app/oracle/admin
mkdir DPUAT92
 
    



3. Copy init.ora file


sqlplus / as sysdba

create pfile from spfile;


  cd $ORACLE_HOME/dbs
  cp initDPUAT91.ora initDPUAT92.ora      

/u04/oradata/DPUAT91/
/u06/oradata/DPUAT91
/u08/oradata/DPUAT91

/u04/oradata/DPUAT92/
/u06/oradata/DPUAT92
/u08/oradata/DPUAT92


/oraredologs/dpu21/DPUAT91/control1DPUAT92.ctl
/oraredologs/dpu22/DPUAT91/control2DPUAT92.ctl


/oraredologs/dpu21/DPUAT92/control1DPUAT92.ctl
/oraredologs/dpu22/DPUAT92/control2DPUAT92.ctl

db_file_name_convert='/u04/oradata/DPUAT91/','/u04/oradata/DPUAT92/','/u06/oradata/DPUAT91/','/u06/oradata/DPUAT92/','/u08/oradata/DPUAT91/','/u08/oradata/DPUAT92/'

log_file_name_convert='/oraredologs/dpu21/DPUAT91/','/oraredologs/dpu21/DPUAT92/','/oraredologs/dpu22/DPUAT91/','/oraredologs/dpu22/DPUAT92/'


4. Create zopa file on AUX server (completed !!!)
  
   cd $ORACLE_HOME/dbs
   cp orapwDPUAT91 orapwDPUAT92

5. Identify backupsets location.

   cd $SAVBKP

   

#####view DPDEV91_sbk_20160418_22:45:05_forDPDEV92dupl.rman

######Backup End Time - 04/18/2016 10:55:05 PM

cd /u01/app/oracle/aetna/db_admin/db_DPUAT91/save_backup

view DPUAT91_sbk_20160609_22:55:02_forDPUAT92dupl.rman

#Backup End Time - 06/09/2016 11:02:36 PM



## Second time
cd /u01/app/oracle/aetna/db_admin/db_DPUAT91/save_backup


view DPUAT91_sbk_20160704_22:55:04_forDPUAT92dupl.rman


#Restore DataBase
#connect target /
#connect catalog DPUAT91/DPUAT91namr@RCATDEV
#startup force nomount;
#set DBID=2332859867;
#reset database to incarnation 1324380;
#restore controlfile from 'c-2332859867-20160704-07_DPUAT91';
#alter database mount;
#run{
#restore database until sequence 9012;
#recover database until sequence 9012;
#}
#alter database open resetlogs;
#End Restore DataBase






6. Add entry into oratab
   cd /etc
   vi oratab

  

DPUAT92:/orahome/u01/app/oracle/product/12.1.0.2/db_1:Y


   cd $HOME/aetna/scripts

   cp -p oraprof oraprof_20160610   

   vi oraprof

"DPUAT92")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;


7. setup new AUX env

   . ~/.profile

DPUAT92


8. 

   #Remove
 #  rm /u*/oradata/DPUAT92/*




  ls /u*/oradata/DPUAT92/*
  

  

9. Dupliicate...


    sqlplus / as sysdba
    startup pfile=/orahome/u01/app/oracle/product/12.1.0.2/db_1/dbs/initDPUAT92.ora force nomount;
    



rman
connect target sys/sysdpuat91@DPUAT91
connect catalog DPUAT91/DPUAT91namr@RCATDEV
connect AUXILIARY /

#Backup End Time - 06/09/2016 11:02:36 PM



###run {
###set until time "TO_DATE('06/09/2016 11:02:36','MM/DD/YYYY HH24:MI:SS')";
###duplicate target database to DPUAT92;
###}

## Second time
run {
set until sequence 9012;
duplicate target database to DPUAT92;
}










Cannot remove created server parameter file

10. cd $ORACLE_HOME/network/admin

vi listener.ora
DPUAT92 =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = dppqa)(PORT = 1598))
    (ADDRESS = (PROTOCOL = IPC) (KEY = DPUAT92_ipc))
  )

SID_LIST_DPUAT92 =
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME = DPUAT92)
      (ORACLE_HOME =/orahome/u01/app/oracle/product/12.1.0.2/db_1)
      (SID_NAME = DPUAT92)
    )
  )

SECURE_REGISTER_DPUAT92 = (IPC)




SUBSCRIBE_FOR_NODE_DOWN_EVENT_DPUAT92=OFF


lsnrctl start DPUAT92




11. Change sys zopas


Remove zopa function first

AI_zopa_VALIDATE



alter profile default limit zopa_VERIFY_FUNCTION null
/




ALTER USER system IDENTIFIED BY "sysdpuat92"

/
ALTER USER sys IDENTIFIED BY "sysdpuat92"

/


ALTER USER dpadmin IDENTIFIED BY "sysdpuat92"

/

ALTER PROFILE DEFAULT LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/







12. Add new entry to Web Server oratab : xpsdppm1q, xpsdppw1q


DPUAT92:/orahome/psu01/oracle/product/12.1.0.2/client_64bit_dp1:N

cd /orahome/psu01/oracle/scripts
  cp -p oraprof oraprof_20160610

   vi oraprof

Add new entry
 
"DPUAT92")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;
   . ~/.profile

DPUAT92

cd $ORACLE_HOME/network/admin

vi tnsnames.ora




DPUAT92.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppqa)
          (Port = 1598)
        )
    )
    (CONNECT_DATA = (SID = DPUAT92)
    )
  )



Test: sqlplus

system/sysdpuat92@DPUAT92




13. Setup Catalog in  RCATDEV database on XORACLDW2D Server

XORACLDW2D/ Bl0ckhe@d

SSH to XORACLDW2D Login as A id and su to oracle

. $SETUPENV RCATDEV

cd $ORACLE_BASE/local/scripts


create_catalog.ksh RCATDEV DPUAT92 DPUAT92namr



   . ~/.profile

DPUAT92


>rman

connect catalog DPUAT92/DPUAT92namr@RCATDEV

create catalog;

exit


>rman

connect target /

connect catalog DPUAT92/DPUAT92namr@RCATDEV




register database;


report schema;

show all;

RMAN configuration parameters for database with db_unique_name DPDEV92 are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 1; # default
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE CONTROLFILE AUTOBACKUP OFF; # default
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F'; # default
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOA
D TRUE ; # default
CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/orahome/u01/app/oracle/product/12.1.0.2
/db_1/dbs/snapcf_DPDEV92.f'; # default


Change to (based on DPDEMO91)
RMAN> show all;

RMAN configuration parameters for database with db_unique_name DPUAT91 are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 3;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/u10/oraback/DPUAT92/rman_backups/%F';
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F_%d';
CONFIGURE DEVICE TYPE DISK PARALLELISM 4 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/u10/oraback/DPUAT92/rman_backups/bkp_df%t_s%s_s%p';
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPUAT92.opt)';
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPUAT92/rman_backups/snapcf_dpuat92.f';




14. Make sure all files exist. Create one if needed.

cd $HOME

#make sure both file exists
cp .DPUAT91.pw .DPUAT92.pw
cp .DPUAT91_RMAN.pw .DPUAT92_RMAN.pw
cp .DPUAT91sys.pw .DPUAT92sys.pw
cp .DPUAT91_DPADMIN.pw .DPUAT92_DPADMIN.pw



15. Ask Storman to create /u01/app/oracle/tdpoopt/tdpo.DPUAT92.opt


Test backup

Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}

Monitor backup

cd /u01/app/oracle/aetna/db_admin/db_DPUAT92/log
tail -f xxx.log

Or/and 

Save backup
nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} initBackup


DPUAT92 backup saved as DPUAT92_sbk_20160610_14:34:51_initBackup.rman

16. Recompile all.

select count(*)
from dba_objects
where status = 'INVALID';

41



###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


15. Recreate Log and exp dir if needed

##EXP_DUMP_DIR
###EXPORT_LOG_DIR


CREATE OR REPLACE DIRECTORY EXP_LOG_DIR AS '/u01/app/oracle/aetna/db_admin/db_DPUAT92/export/'
/
GRANT READ ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/



select file_name from dba_temp_files;

/u08/oradata/DPUAT92/temp01.dbf



alter database tempfile '/u08/oradata/DPUAT92/temp01.dbf' drop;
ALTER TABLESPACE TEMP ADD TEMPFILE '/u08/oradata/DPUAT92/temp01.dbf' SIZE 15000M reuse;

alter database tempfile '/u08/oradata/DPUAT92/tivoliortempts_01.dbf' drop;
ALTER TABLESPACE TEMP ADD TEMPFILE '/u08/oradata/DPUAT92/tivoliortempts_01.dbf' SIZE 200M reuse;









16. Add new DB to OEM, add cron jobs and schedule backups


Email Rich Ryan to add database to OEM

Add crontabs jobs


crontab -e

List of all existing DPAUT91 jobs and add for DPDUAT92

45 19 * * * ${HOME}/aetna/db_mgmt/backup/expdp_full.ksh DPUAT92



00,20,40 0-20 * * * ${HOME}/aetna/scripts/verify_db_is_up.ksh DPUAT92
05,20,40 22 * * * ${HOME}/aetna/scripts/verify_db_is_up.ksh DPUAT92

15 23 * * * ${HOME}/aetna/db_mgmt/backup/rman_list_database.ksh DPUAT92

05 01 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_all.ksh DPUAT92
00 07 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_sjt_tables.ksh DPUAT92

0,15,30,45 0-23 * * * ${HOME}/aetna/db_mgmt/monitor/scan_oracle.ksh DPUAT92

30 12 * * * ${HOME}/tls/space_usage.ksh DPUAT92 > /dev/null
35 12 * * * ${HOME}/aetna/db_mgmt/space/spacechk.ksh DPUAT92

10 20 * * * ${HOME}/aetna/scripts/udump_trc_rename.ksh DPUAT92 > ${HOME}/aetna/db_admin/db_DPUAT92/log/DPUAT92_udump_trc_rename.out 2>&1

0,15,30,45 0-20 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPUAT92 > /dev/null
15,30,45 22 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPUAT92 > /dev/null

30 05 * * * ${HOME}/tls/check_undots.ksh DPUAT92 > /dev/null

20 05 * * 0 ${HOME}/aetna/db_mgmt/extsecur/ext_spcl_permissions.ksh DPUAT92 > /dev/null 2>&1


17. Add sys and system accounts to eDMZ

18. Make note of current space

19. 

    shutdown immediate
    startup

FUll size: 93,598 GB
 



************ Duplicate DPDEV92 to DPDEVSRC from saved backup *************

. ~/.profile

DPDEV92





cd /u01/app/oracle/aetna/db_admin/db_DPDEV92/save_backup

view DPDEV92_sbk_20160609_13:50:54_Final_Backup.rman


#Restore DataBase
#connect target /
#connect catalog DPDEV92/DPDEV92namr@RCATDEV
#startup force nomount;
#set DBID=2215358295;
#reset database to incarnation 28672;
#restore controlfile from 'c-2215358295-20160609-01_DPDEV92';
#alter database mount;
#run{
#restore database until sequence 5;
#recover database until sequence 5;
#}
#alter database open resetlogs;
#End Restore DataBase

#Backup End Time - 06/09/2016 01:56:33 PM


Tom's instructions...>


DBArtisan - system/sysdpuat91

select 'set newname for datafile '||file_id||' to '||chr(39)||replace(file_name,'DPDEV92','DPDEVSRC')||chr(39)||';'
from   dba_data_files
order by file_name;



'SETNEWNAMEFORDATAFILE'||FILE_ID||'TO'||CHR(39)||REPLACE(FILE_NAME,'DPDEV92','DPDEVSRC')||CHR(39)||';'
set newname for datafile 3 to '/u02/oradata/DPDEVSRC/USERS01.dbf';
set newname for datafile 4 to '/u02/oradata/DPDEVSRC/bnapp.dbf';
set newname for datafile 5 to '/u02/oradata/DPDEVSRC/bnlarge.dbf';
set newname for datafile 6 to '/u02/oradata/DPDEVSRC/fsapp.dbf';
set newname for datafile 7 to '/u02/oradata/DPDEVSRC/giapp.dbf';
set newname for datafile 8 to '/u02/oradata/DPDEVSRC/glapp.dbf';
set newname for datafile 9 to '/u02/oradata/DPDEVSRC/gpapp.dbf';
set newname for datafile 10 to '/u02/oradata/DPDEVSRC/hrapp.dbf';
set newname for datafile 11 to '/u02/oradata/DPDEVSRC/hrlarge.dbf';
set newname for datafile 12 to '/u02/oradata/DPDEVSRC/htapp.dbf';
set newname for datafile 13 to '/u02/oradata/DPDEVSRC/inapp.dbf';
set newname for datafile 14 to '/u02/oradata/DPDEVSRC/omapp.dbf';
set newname for datafile 15 to '/u02/oradata/DPDEVSRC/paapp.dbf';
set newname for datafile 16 to '/u02/oradata/DPDEVSRC/palarge.dbf';
set newname for datafile 17 to '/u02/oradata/DPDEVSRC/piapp.dbf';
set newname for datafile 18 to '/u02/oradata/DPDEVSRC/pilarge.dbf';
set newname for datafile 19 to '/u02/oradata/DPDEVSRC/psimage.dbf';
set newname for datafile 115 to '/u02/oradata/DPDEVSRC/psimage2_1.dbf';
set newname for datafile 142 to '/u02/oradata/DPDEVSRC/psimage2_2.dbf';
set newname for datafile 143 to '/u02/oradata/DPDEVSRC/psimage2_3.dbf';
set newname for datafile 144 to '/u02/oradata/DPDEVSRC/psimage2_4.dbf';
set newname for datafile 145 to '/u02/oradata/DPDEVSRC/psimage2_5.dbf';
set newname for datafile 20 to '/u02/oradata/DPDEVSRC/psindex.dbf';
set newname for datafile 21 to '/u02/oradata/DPDEVSRC/psindex01.dbf';
set newname for datafile 22 to '/u02/oradata/DPDEVSRC/psindex02.dbf';
set newname for datafile 23 to '/u02/oradata/DPDEVSRC/psindex03.dbf';
set newname for datafile 2 to '/u02/oradata/DPDEVSRC/psundots.dbf';
set newname for datafile 24 to '/u02/oradata/DPDEVSRC/ptapp.dbf';
set newname for datafile 25 to '/u02/oradata/DPDEVSRC/ptprc.dbf';
set newname for datafile 1 to '/u02/oradata/DPDEVSRC/system01.dbf';
set newname for datafile 125 to '/u05/oradata/DPDEVSRC/aaapp1.dbf';
set newname for datafile 116 to '/u05/oradata/DPDEVSRC/aalarge1.dbf';
set newname for datafile 126 to '/u05/oradata/DPDEVSRC/adapp1.dbf';
set newname for datafile 138 to '/u05/oradata/DPDEVSRC/aidba.dbf';
set newname for datafile 49 to '/u05/oradata/DPDEVSRC/amapp.dbf';
set newname for datafile 127 to '/u05/oradata/DPDEVSRC/avapp1.dbf';
set newname for datafile 50 to '/u05/oradata/DPDEVSRC/bdapp.dbf';
set newname for datafile 51 to '/u05/oradata/DPDEVSRC/bpapp.dbf';
set newname for datafile 128 to '/u05/oradata/DPDEVSRC/ccapp1.dbf';
set newname for datafile 52 to '/u05/oradata/DPDEVSRC/coapp.dbf';
set newname for datafile 53 to '/u05/oradata/DPDEVSRC/cuaudit.dbf';
set newname for datafile 54 to '/u05/oradata/DPDEVSRC/cularg1.dbf';
set newname for datafile 55 to '/u05/oradata/DPDEVSRC/cularg2.dbf';
set newname for datafile 56 to '/u05/oradata/DPDEVSRC/cularg3.dbf';
set newname for datafile 57 to '/u05/oradata/DPDEVSRC/cularge.dbf';
set newname for datafile 34 to '/u05/oradata/DPDEVSRC/dbtune.dbf';
set newname for datafile 58 to '/u05/oradata/DPDEVSRC/diapp.dbf';
set newname for datafile 59 to '/u05/oradata/DPDEVSRC/eoapp.dbf';
set newname for datafile 117 to '/u05/oradata/DPDEVSRC/eobfapp1.dbf';
set newname for datafile 118 to '/u05/oradata/DPDEVSRC/eocfapp1.dbf';
set newname for datafile 60 to '/u05/oradata/DPDEVSRC/eocmapp.dbf';
set newname for datafile 61 to '/u05/oradata/DPDEVSRC/eocmlrg.dbf';
set newname for datafile 62 to '/u05/oradata/DPDEVSRC/eocmwrk.dbf';
set newname for datafile 63 to '/u05/oradata/DPDEVSRC/eocuapp.dbf';
set newname for datafile 64 to '/u05/oradata/DPDEVSRC/eoculrg.dbf';
set newname for datafile 65 to '/u05/oradata/DPDEVSRC/eoditbl.dbf';
set newname for datafile 66 to '/u05/oradata/DPDEVSRC/eodsapp.dbf';
set newname for datafile 67 to '/u05/oradata/DPDEVSRC/eodslrg.dbf';
set newname for datafile 68 to '/u05/oradata/DPDEVSRC/eoecapp.dbf';
set newname for datafile 69 to '/u05/oradata/DPDEVSRC/eoeclrg.dbf';
set newname for datafile 70 to '/u05/oradata/DPDEVSRC/eoecwrk.dbf';
set newname for datafile 71 to '/u05/oradata/DPDEVSRC/eoeiapp.dbf';
set newname for datafile 72 to '/u05/oradata/DPDEVSRC/eoeilrg.dbf';
set newname for datafile 73 to '/u05/oradata/DPDEVSRC/eoewapp.dbf';
set newname for datafile 74 to '/u05/oradata/DPDEVSRC/eoewlrg.dbf';
set newname for datafile 75 to '/u05/oradata/DPDEVSRC/eoewwrk.dbf';
set newname for datafile 76 to '/u05/oradata/DPDEVSRC/eoiuapp.dbf';
set newname for datafile 77 to '/u05/oradata/DPDEVSRC/eoiulrg.dbf';
set newname for datafile 78 to '/u05/oradata/DPDEVSRC/eoiuwrk.dbf';
set newname for datafile 119 to '/u05/oradata/DPDEVSRC/eoltapp1.dbf';
set newname for datafile 129 to '/u05/oradata/DPDEVSRC/eoppapp1.dbf';
set newname for datafile 120 to '/u05/oradata/DPDEVSRC/eopplrg1.dbf';
set newname for datafile 130 to '/u05/oradata/DPDEVSRC/faapp1.dbf';
set newname for datafile 121 to '/u05/oradata/DPDEVSRC/falarge1.dbf';
set newname for datafile 122 to '/u05/oradata/DPDEVSRC/hrapp71.dbf';
set newname for datafile 131 to '/u05/oradata/DPDEVSRC/hrsapp1.dbf';
set newname for datafile 132 to '/u05/oradata/DPDEVSRC/hrslarge1.dbf';
set newname for datafile 133 to '/u05/oradata/DPDEVSRC/hrswork1.dbf';
set newname for datafile 48 to '/u05/oradata/DPDEVSRC/psdefault.dbf';
set newname for datafile 46 to '/u05/oradata/DPDEVSRC/psimgr.dbf';
set newname for datafile 136 to '/u05/oradata/DPDEVSRC/psindex06.dbf';
set newname for datafile 146 to '/u05/oradata/DPDEVSRC/psmatvw.dbf';
set newname for datafile 47 to '/u05/oradata/DPDEVSRC/pstemp01.dbf';
set newname for datafile 37 to '/u05/oradata/DPDEVSRC/pswork.dbf';
set newname for datafile 39 to '/u05/oradata/DPDEVSRC/ptamsg.dbf';
set newname for datafile 35 to '/u05/oradata/DPDEVSRC/ptappe.dbf';
set newname for datafile 45 to '/u05/oradata/DPDEVSRC/ptaudit.dbf';
set newname for datafile 43 to '/u05/oradata/DPDEVSRC/ptcmstar.dbf';
set newname for datafile 41 to '/u05/oradata/DPDEVSRC/ptlock.dbf';
set newname for datafile 44 to '/u05/oradata/DPDEVSRC/ptprjwk.dbf';
set newname for datafile 42 to '/u05/oradata/DPDEVSRC/ptrpts.dbf';
set newname for datafile 26 to '/u05/oradata/DPDEVSRC/pttbl.dbf';
set newname for datafile 38 to '/u05/oradata/DPDEVSRC/pttlrg.dbf';
set newname for datafile 36 to '/u05/oradata/DPDEVSRC/pttree.dbf';
set newname for datafile 40 to '/u05/oradata/DPDEVSRC/ptwork.dbf';
set newname for datafile 27 to '/u05/oradata/DPDEVSRC/pyapp.dbf';
set newname for datafile 28 to '/u05/oradata/DPDEVSRC/pylarge.dbf';
set newname for datafile 29 to '/u05/oradata/DPDEVSRC/pylarge02.dbf';
set newname for datafile 134 to '/u05/oradata/DPDEVSRC/saapp1.dbf';
set newname for datafile 123 to '/u05/oradata/DPDEVSRC/sacapp1.dbf';
set newname for datafile 124 to '/u05/oradata/DPDEVSRC/salarge1.dbf';
set newname for datafile 135 to '/u05/oradata/DPDEVSRC/srapp1.dbf';
set newname for datafile 30 to '/u05/oradata/DPDEVSRC/stapp.dbf';
set newname for datafile 31 to '/u05/oradata/DPDEVSRC/stlarge.dbf';
set newname for datafile 114 to '/u05/oradata/DPDEVSRC/sysaux01.dbf';
set newname for datafile 137 to '/u05/oradata/DPDEVSRC/sysaux02.dbf';
set newname for datafile 141 to '/u05/oradata/DPDEVSRC/tivoliorts01.dbf';
set newname for datafile 32 to '/u05/oradata/DPDEVSRC/tlapp.dbf';
set newname for datafile 33 to '/u05/oradata/DPDEVSRC/tllarge.dbf';
set newname for datafile 79 to '/u09/oradata/DPDEVSRC/eolarge.dbf';
set newname for datafile 80 to '/u09/oradata/DPDEVSRC/eotpapp.dbf';
set newname for datafile 81 to '/u09/oradata/DPDEVSRC/eotplrg.dbf';
set newname for datafile 82 to '/u09/oradata/DPDEVSRC/epapp.dbf';
set newname for datafile 83 to '/u09/oradata/DPDEVSRC/eplarge.dbf';
set newname for datafile 84 to '/u09/oradata/DPDEVSRC/erapp.dbf';
set newname for datafile 85 to '/u09/oradata/DPDEVSRC/erlarge.dbf';
set newname for datafile 86 to '/u09/oradata/DPDEVSRC/erwork.dbf';
set newname for datafile 87 to '/u09/oradata/DPDEVSRC/fgapp.dbf';
set newname for datafile 88 to '/u09/oradata/DPDEVSRC/gpdeapp.dbf';
set newname for datafile 89 to '/u09/oradata/DPDEVSRC/hpapp.dbf';
set newname for datafile 90 to '/u09/oradata/DPDEVSRC/hrapp1.dbf';
set newname for datafile 91 to '/u09/oradata/DPDEVSRC/hrapp2.dbf';
set newname for datafile 92 to '/u09/oradata/DPDEVSRC/hrapp3.dbf';
set newname for datafile 93 to '/u09/oradata/DPDEVSRC/hrapp4.dbf';
set newname for datafile 94 to '/u09/oradata/DPDEVSRC/hrapp5.dbf';
set newname for datafile 95 to '/u09/oradata/DPDEVSRC/hrapp6.dbf';
set newname for datafile 110 to '/u09/oradata/DPDEVSRC/hrlarge02.dbf';
set newname for datafile 139 to '/u09/oradata/DPDEVSRC/hrlarge03.dbf';
set newname for datafile 96 to '/u09/oradata/DPDEVSRC/hrwork.dbf';
set newname for datafile 113 to '/u09/oradata/DPDEVSRC/knsapp.dbf';
set newname for datafile 97 to '/u09/oradata/DPDEVSRC/pcapp.dbf';
set newname for datafile 98 to '/u09/oradata/DPDEVSRC/pclarge.dbf';
set newname for datafile 99 to '/u09/oradata/DPDEVSRC/piwork.dbf';
set newname for datafile 100 to '/u09/oradata/DPDEVSRC/poapp.dbf';
set newname for datafile 109 to '/u09/oradata/DPDEVSRC/psindex04.dbf';
set newname for datafile 112 to '/u09/oradata/DPDEVSRC/psindex05.dbf';
set newname for datafile 140 to '/u09/oradata/DPDEVSRC/psindex07.dbf';
set newname for datafile 107 to '/u09/oradata/DPDEVSRC/psundots_02.dbf';
set newname for datafile 101 to '/u09/oradata/DPDEVSRC/pvapp.dbf';
set newname for datafile 102 to '/u09/oradata/DPDEVSRC/py0lrg.dbf';
set newname for datafile 108 to '/u09/oradata/DPDEVSRC/pylarge03.dbf';
set newname for datafile 111 to '/u09/oradata/DPDEVSRC/pylarge04.dbf';
set newname for datafile 103 to '/u09/oradata/DPDEVSRC/pywork.dbf';
set newname for datafile 104 to '/u09/oradata/DPDEVSRC/stwork.dbf';
set newname for datafile 105 to '/u09/oradata/DPDEVSRC/tlwork.dbf';
set newname for datafile 106 to '/u09/oradata/DPDEVSRC/waapp.dbf';

select 'set newname for tempfile '||file_id||' to '||chr(39)||replace(file_name,'DPDEV92','DPDEVSRC')||chr(39)||';'
from   dba_temp_files
order by file_name;


'SETNEWNAMEFORTEMPFILE'||FILE_ID||'TO'||CHR(39)||REPLACE(FILE_NAME,'DPDEV92','DPDEVSRC')||CHR(39)||';'
set newname for tempfile 3 to '/u09/oradata/DPDEVSRC/psgtt01.dbf';
set newname for tempfile 1 to '/u09/oradata/DPDEVSRC/temp01.dbf';
set newname for tempfile 2 to '/u09/oradata/DPDEVSRC/tivoliortempts_01.dbf';

select lf.group# grp,
  replace(member,'DPDEV92','DPDEVSRC') member,
   bytes/1024/1024 mbytes 
           from   v$logfile lf,
                  v$log l
           where  lf.group# = l.group#
                  order by lf.group#,
                           substr(lf.member,instr(lf.member,'/',-1) + 1);

MEMBER
MEMBER
/oraredologs/dpu21/DPDEVSRC/redo0101.log
/oraredologs/dpu22/DPDEVSRC/redo0102.log
/oraredologs/dpu21/DPDEVSRC/redo0201.log
/oraredologs/dpu22/DPDEVSRC/redo0202.log
/oraredologs/dpu21/DPDEVSRC/redo0301.log
/oraredologs/dpu22/DPDEVSRC/redo0302.log
/oraredologs/dpu21/DPDEVSRC/redo0401.log
/oraredologs/dpu22/DPDEVSRC/redo0402.log
/oraredologs/dpu21/DPDEVSRC/redo0501.log
/oraredologs/dpu22/DPDEVSRC/redo0502.log
/oraredologs/dpu21/DPDEVSRC/redo0601.log
/oraredologs/dpu22/DPDEVSRC/redo0602.log



   


select replace(name,'DPDEV92','DPDEVSRC') name  from v$controlfile



NAME
/oraredologs/dpu21/DPDEVSRC/control1DPDEVSRC.ctl
/oraredologs/dpu22/DPDEVSRC/control2DPDEVSRC.ctl




1. Create new folders

mkdir /u02/oradata/DPDEVSRC
mkdir /u05/oradata/DPDEVSRC
mkdir /u09/oradata/DPDEVSRC





   
mkdir   /oraredologs/dpu21/DPDEVSRC

mkdir   /oraredologs/dpu22/DPDEVSRC



!! May not need.  Hold one with this owne.

### cd /u01/app/oracle/admin/
### mkdir DPDEV92
   
###   cd /u01/app/oracle/admin/DPDEV92
###   mkdir diag



   mkdir /u03/archlogs/DPDEVSRC
   
   
  cd /u10/oraback
  mkdir DPDEVSRC
  cd /u10/oraback/DPDEVSRC
  mkdir rman_backups



cd /u01/app/oracle/aetna/db_admin

cp -rp db_DPDEV92 db_DPDEVSRC


!!!cleanup all under db_DPDEVSRC


cd /orahome/u01/app/oracle/admin
mkdir DPDEVSRC
 
    



3. Copy init.ora file


sqlplus / as sysdba

create pfile from spfile;


  cd $ORACLE_HOME/dbs
  cp initDPDEV92.ora initDPDEVSRC.ora      

/u02/oradata/DPDEV92
/u05/oradata/DPDEV92
/u09/oradata/DPDEV92

/u02/oradata/DPDEVSRC
/u05/oradata/DPDEVSRC
/u09/oradata/DPDEVSRC


/oraredologs/dpu21/DPDEV92/
/oraredologs/dpu22/DPDEV92/

/oraredologs/dpu21/DPDEVSRC/
/oraredologs/dpu22/DPDEVSRC/


diag_adr_trace_dest



db_file_name_convert='/u02/oradata/DPDEV92/','/u02/oradata/DPDEVSRC/','/u05/oradata/DPDEV92/','/u05/oradata/DPDEVSRC/','/u09/oradata/DPDEV92/','/u09/oradata/DPDEVSRC/'

log_file_name_convert='/oraredologs/dpu21/DPDEV92/','/oraredologs/dpu21/DPDEVSRC/','/oraredologs/dpu22/DPDEV92/','/oraredologs/dpu22/DPDEVSRC/'




4. Create zopa file on AUX server (completed !!!)
  
   cd $ORACLE_HOME/dbs
   cp orapwDPDEV92 orapwDPDEVSRC


EB.

5. Identify backupsets location.

   cd $SAVBKP

   


cd /u01/app/oracle/aetna/db_admin/db_DPDEV92/save_backup

view DPDEV92_sbk_20160609_13:50:54_Final_Backup.rman


#Restore DataBase
#connect target /
#connect catalog DPDEV92/DPDEV92namr@RCATDEV
#startup force nomount;
#set DBID=2215358295;
#reset database to incarnation 28672;
#restore controlfile from 'c-2215358295-20160609-01_DPDEV92';
#alter database mount;
#run{
#restore database until sequence 5;
#recover database until sequence 5;
#}
#alter database open resetlogs;
#End Restore DataBase

#Backup End Time - 06/09/2016 01:56:33 PM




6. Add entry into oratab
   cd /etc
   vi oratab

  


DPDEVRSC:/orahome/u01/app/oracle/product/12.1.0.2/db_1:Y

   cd $HOME/aetna/scripts

   cp -p oraprof oraprof_20160613   

   vi oraprof

"DPDEVRSC")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;


7. setup new AUX env

   . ~/.profile

DPDEVSRC


8. 

   #Remove
 #  rm /u*/oradata/DPDEVSRC/*




  ls /u*/oradata/DPDEVSRC/*
  

  

9. Dupliicate...


    sqlplus / as sysdba
    startup pfile=/orahome/u01/app/oracle/product/12.1.0.2/db_1/dbs/initDPDEVSRC.ora force nomount;
    




   . ~/.profile

List of Database Incarnations
DB Key  Inc Key DB Name  DB ID            STATUS  Reset SCN  Reset Time
------- ------- -------- ---------------- --- ---------- ----------
1       299     DPDEV92  2215358295       PARENT  8284642534204 08-MAY-12
1       2       DPDEV92  2215358295       PARENT  9002219995688 19-APR-16
1       25901   DPDEV92  2215358295       PARENT  9002243163463 02-JUN-16
1       28672   DPDEV92  2215358295       CURRENT 9002252366454 09-JUN-16



rman
connect target sys/sysdpdev92@DPDEV92
connect catalog DPDEV92/DPDEV92namr@RCATDEV
connect AUXILIARY /




run {
set until time "TO_DATE('06/09/2016 01:56:32','MM/DD/YYYY HH24:MI:SS')";
duplicate target database to DPDEVSRC;
}

Starting Duplicate Db at 13-JUN-16
RMAN-00571: ===========================================================
RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============
RMAN-00571: ===========================================================
RMAN-03002: failure of Duplicate Db command at 06/13/2016 08:23:25
RMAN-05501: aborting duplication of target database
RMAN-06004: ORACLE error from recovery catalog database: RMAN-20207: UNTIL TIME
or RECOVERY WINDOW is before RESETLOGS time

!! Below worked.

run {
set until sequence 5;
duplicate target database to DPDEVSRC;
}


Cannot remove created server parameter file

10. cd $ORACLE_HOME/network/admin

vi listener.ora
DPDEVSRC =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = dppdev)(PORT = 1691))
    (ADDRESS = (PROTOCOL = IPC) (KEY = DPDEVSRC_ipc))
  )

SID_LIST_DPDEVSRC =
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME =DPDEVSRC)
      (ORACLE_HOME =/orahome/u01/app/oracle/product/12.1.0.2/db_1)
      (SID_NAME = DPDEVSRC)
    )
  )

SECURE_REGISTER_DPDEVSRC = (IPC)


SUBSCRIBE_FOR_NODE_DOWN_EVENT_DPDEVSRC=OFF


lsnrctl start DPDEVSRC



DPDEVSRC.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppdev)
          (Port = 1691)
        )
    )
    (CONNECT_DATA = (SID = DPDEVSRC)
    )
  )



11. Change sys zopas


Remove zopa function first

AI_zopa_VALIDATE



alter profile default limit zopa_VERIFY_FUNCTION null
/




ALTER USER system IDENTIFIED BY "sysdpdevsrc"

/
ALTER USER sys IDENTIFIED BY "sysdpdevsrc"

/


ALTER USER dpadmin IDENTIFIED BY "sysdpdevsrc"

/

ALTER PROFILE DEFAULT LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/







12. Add new entry to Web Server oratab : xpsdppw2d


DPDEVSRC:/orahome/psu01/oracle/product/12.1.0.2/client_64bit_dp1:N

cd /orahome/psu01/oracle/scripts
  cp -p oraprof oraprof_20160613

   vi oraprof

Add new entry
 
"DPDEVSRC")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;
   . ~/.profile

DPDEVSR

cd $ORACLE_HOME/network/admin

vi tnsnames.ora




DPDEVSRC.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppdev)
          (Port = 1691)
        )
    )
    (CONNECT_DATA = (SID = DPDEVSRC)
    )
  )



Test: sqlplus

system/sysdpdevsrc@DPDEVSRC




13. Setup Catalog in  RCATDEV database on XORACLDW2D Server

XORACLDW2D/ Bl0ckhe@d

SSH to XORACLDW2D Login as A id and su to oracle

. $SETUPENV RCATDEV

cd $ORACLE_BASE/local/scripts


create_catalog.ksh RCATDEV DPDEVSRC DPDEVSRCnamr



   . ~/.profile

DPDEVSRC


>rman

connect catalog DPDEVSRC/DPDEVSRCnamr@RCATDEV

create catalog;

exit


>rman

connect target /

connect catalog DPDEVSRC/DPDEVSRCnamr@RCATDEV




register database;


report schema;

show all;

RMAN configuration parameters for database with db_unique_name DPDEVSRC are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 1; # default
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO DISK; # default
CONFIGURE CONTROLFILE AUTOBACKUP OFF; # default
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F'; # default
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOA
D TRUE ; # default
CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/orahome/u01/app/oracle/product/12.1.0.2
/db_1/dbs/snapcf_DPDEVSRC.f'; # default



CONFIGURE RETENTION POLICY TO REDUNDANCY 10;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/u10/oraback/DPDEVSRC/rman_backups/%F';

CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F_%d';
CONFIGURE DEVICE TYPE DISK PARALLELISM 4 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/u10/oraback/DPDEVSRC/rman_backups/bkp_df%t_s%s_s%p';

CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDEVSRC.opt)';

CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default

CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPDEVSRC/rman_backups/snapcf_DPDEVSRC.f';



14. Make sure all files exist. Create one if needed.

cd $HOME

#make sure both file exists
cp .DPDEV92.pw .DPDEVSRC.pw
cp .DPDEV92_RMAN.pw .DPDEVSRC_RMAN.pw
cp .DPDEV92sys.pw .DPDEVSRCsys.pw
cp .DPDEV92_DPADMIN.pw .DPDEVSRC_DPADMIN.pw


.DPDEV91_DPADMIN.pw
15. Ask Storman to create /u01/app/oracle/tdpoopt/tdpo.DPDEVSRC.opt





####DPUAT92 backup saved as DPUAT92_sbk_20160610_14:34:51_initBackup.rman

16. Recompile all.

select count(*)
from dba_objects
where status = 'INVALID';

41



###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


17. Recreate Log and exp dir if needed

##EXP_DUMP_DIR
###EXPORT_LOG_DIR


CREATE OR REPLACE DIRECTORY EXP_LOG_DIR AS '/u01/app/oracle/aetna/db_admin/db_DPDEVSRC/export/'
/
GRANT READ ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/




18. Test backup

Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}

Monitor backup

cd /u01/app/oracle/aetna/db_admin/db_DPDEVSRC/log
tail -f xxx.log

Or/and 

Save backup
nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} initBackup


DPDEVSRC backup saved as DPDEVSRC_sbk_20160613_10:22:42_initBackup.rman

19. Add new DB to OEM, add cron jobs and schedule backups


Email Rich Ryan to add database to OEM

Add crontabs jobs


crontab -e

List of all existing DPAUT91 jobs and add for DPDUAT92

45 19 * * * ${HOME}/aetna/db_mgmt/backup/expdp_full.ksh DPUAT92



00,20,40 0-20 * * * ${HOME}/aetna/scripts/verify_db_is_up.ksh DPUAT92
05,20,40 22 * * * ${HOME}/aetna/scripts/verify_db_is_up.ksh DPUAT92

15 23 * * * ${HOME}/aetna/db_mgmt/backup/rman_list_database.ksh DPUAT92

05 01 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_all.ksh DPUAT92
00 07 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_sjt_tables.ksh DPUAT92

0,15,30,45 0-23 * * * ${HOME}/aetna/db_mgmt/monitor/scan_oracle.ksh DPUAT92

30 12 * * * ${HOME}/tls/space_usage.ksh DPUAT92 > /dev/null
35 12 * * * ${HOME}/aetna/db_mgmt/space/spacechk.ksh DPUAT92

10 20 * * * ${HOME}/aetna/scripts/udump_trc_rename.ksh DPUAT92 > ${HOME}/aetna/db_admin/db_DPUAT92/log/DPUAT92_udump_trc_rename.out 2>&1

0,15,30,45 0-20 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPUAT92 > /dev/null
15,30,45 22 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPUAT92 > /dev/null

30 05 * * * ${HOME}/tls/check_undots.ksh DPUAT92 > /dev/null

20 05 * * 0 ${HOME}/aetna/db_mgmt/extsecur/ext_spcl_permissions.ksh DPUAT92 > /dev/null 2>&1


20. Add sys and system accounts to eDMZ

21. Make note of current space

22. 

    shutdown immediate
    startup

FUll size: 93,598 GB


backup archivelog all delete input;



****************** Duplicate DPDEV92 to DPDEVSRC from Sunday night backup




   . ~/.profile

DPDEV92


!! duplicate into existing DB



view DPDEV92_sbk_20160627_02:45:03.rman



#Restore DataBase
#connect target /
#connect catalog DPDEV92/DPDEV92namr@RCATDEV
#startup force nomount;
#set DBID=2215358295;
#reset database to incarnation 28672;
#restore controlfile from 'c-2215358295-20160627-01_DPDEV92';
#alter database mount;
#run{
#restore database until sequence 247;
#recover database until sequence 247;
#}
#alter database open resetlogs;
#End Restore DataBase


cd /u01/app/oracle/aetna/db_admin/db_DPDEV92/log

view DPDEV92_sbk_20160706_02:45:06.rman


#Restore DataBase
#connect target /
#connect catalog DPDEV92/DPDEV92namr@RCATDEV
#startup force nomount;
#set DBID=2215358295;
#reset database to incarnation 28672;
#restore controlfile from 'c-2215358295-20160706-01_DPDEV92';
#alter database mount;
#run{
#restore database until sequence 390;
#recover database until sequence 390;
#}
#alter database open resetlogs;
#End Restore DataBase




   . ~/.profile

DPDEVSRC

sqlplus / as sysdba

create pfile from spfile;

shutdown immediate



cd $ORACLE_HOME/dbs

mv spfileDPDEVSRC.ora spfileDPDEVSRC.ora.20160627

# Just to inspect all still in place

vi initDPDEVSRC.ora 

 #Remove optional
 

#  rm /u*/oradata/DPDEVSRC/*

  ls /u*/oradata/DPDEVSRC/*
  

  

9. Dupliicate...


    sqlplus / as sysdba
    startup pfile=/orahome/u01/app/oracle/product/12.1.0.2/db_1/dbs/initDPDEVSRC.ora force nomount;
    










rman
connect target sys/sysdpdev92@DPDEV92
connect catalog DPDEV92/DPDEV92namr@RCATDEV
connect AUXILIARY /





run {
set until sequence 390;
duplicate target database to DPDEVSRC;
}



sqlplus / as sysdba

shutdown immediate

startup

show parameter spfile

>rman

connect target /

connect catalog DPDEVSRC/DPDEVSRCnamr@RCATDEV




register database;


CONFIGURE RETENTION POLICY TO REDUNDANCY 10;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/u10/oraback/DPDEVSRC/rman_backups/%F';
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F_%d';
CONFIGURE DEVICE TYPE DISK PARALLELISM 4 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/u10/oraback/DPDEVSRC/rman_backups/bkp_df%t_s%s_s%p';
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDEVSRC.opt)';
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPDEVSRC/rman_backups/snapcf_DPDEVSRC.f';



###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


CREATE OR REPLACE DIRECTORY EXP_LOG_DIR AS '/u01/app/oracle/aetna/db_admin/db_DPDEVSRC/export/'
/
GRANT READ ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/



alter profile default limit zopa_VERIFY_FUNCTION null
/




ALTER USER system IDENTIFIED BY "sysdpdevsrc"

/
ALTER USER sys IDENTIFIED BY "sysdpdevsrc"

/


ALTER USER dpadmin IDENTIFIED BY "sysdpdevsrc"

/

ALTER PROFILE DEFAULT LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/


select * from dba_temp_files;


alter database tempfile '/u09/oradata/DPDEVSRC/temp01.dbf' drop;
ALTER TABLESPACE TEMP ADD TEMPFILE '/u09/oradata/DPDEVSRC/temp01.dbf' SIZE 9000M reuse;


alter database tempfile '/u09/oradata/DPDEVSRC/tivoliortempts_01.dbf' drop;
ALTER TABLESPACE TEMP ADD TEMPFILE '/u09/oradata/DPDEVSRC/tivoliortempts_01.dbf' SIZE 200M reuse;


alter database tempfile '/u09/oradata/DPDEVSRC/psgtt01.dbf' drop;
ALTER TABLESPACE TEMP ADD TEMPFILE '/u09/oradata/DPDEVSRC/psgtt01.dbf' SIZE 500M reuse;






Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}

Monitor backup

cd /u01/app/oracle/aetna/db_admin/db_DPDEVSRC/log
tail -f xxx.log

Or/and 

Save backup
nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} initBackup2


DPDEVSRC backup saved as DPDEVSRC_sbk_20160627_14:31:17_initBackup2.rman

DPDEVSRC backup saved as DPDEVSRC_sbk_20160706_09:01:07_initBackup2.rman


***************** Restore DPUAT92 from saved backup *******************

We are going to want to restore DPUAT92 to a backup taken after the TOOLs upgrade I believe it was named DPUAT92_sbk_20160615_12:14:12_AfterPreparingDB.rman


   . ~/.profile

DPDUAT92


cd $SAVBKP


view DPUAT92_sbk_20160615_12:14:12_AfterPreparingDB.rman


###............................................................
#Restore DataBase
#connect target /
#connect catalog DPUAT92/DPUAT92namr@RCATDEV
#startup force nomount;
#set DBID=2337745691;
#reset database to incarnation 2;
#restore controlfile from 'c-2337745691-20160615-00_DPUAT92';
#alter database mount;
#run{
#restore database from TAG=TAG20160615T121517;
#recover database noredo;
#}
#alter database open resetlogs;
#End Restore DataBase



Login to DBArtisan and run following queries

select file_id,file_name from dba_data_files order by 2



!! Optional

cd /u04/oradata/DPUAT92/

rm -f *.dbf

cd /u06/oradata/DPUAT92/

rm -f *.dbf

cd /u08/oradata/DPUAT92/

cd 
FILE_NAME
/u04/oradata/DPUAT92/USERS01.dbf
/u04/oradata/DPUAT92/bnapp.dbf
/u04/oradata/DPUAT92/bnlarge.dbf
/u04/oradata/DPUAT92/fsapp.dbf
/u04/oradata/DPUAT92/giapp.dbf
/u04/oradata/DPUAT92/glapp.dbf
/u04/oradata/DPUAT92/gpapp.dbf
/u04/oradata/DPUAT92/hrapp.dbf
/u04/oradata/DPUAT92/hrlarge.dbf
/u04/oradata/DPUAT92/htapp.dbf
/u04/oradata/DPUAT92/inapp.dbf
/u04/oradata/DPUAT92/omapp.dbf
/u04/oradata/DPUAT92/paapp.dbf
/u04/oradata/DPUAT92/palarge.dbf
/u04/oradata/DPUAT92/piapp.dbf
/u04/oradata/DPUAT92/pilarge.dbf
/u04/oradata/DPUAT92/psimage.dbf
/u04/oradata/DPUAT92/psimage2_1.dbf
/u04/oradata/DPUAT92/psimage2_2.dbf
/u04/oradata/DPUAT92/psimage2_3.dbf
/u04/oradata/DPUAT92/psimage2_4.dbf
/u04/oradata/DPUAT92/psimage2_5.dbf
/u04/oradata/DPUAT92/psindex.dbf
/u04/oradata/DPUAT92/psindex01.dbf
/u04/oradata/DPUAT92/psindex02.dbf
/u04/oradata/DPUAT92/psindex03.dbf
/u04/oradata/DPUAT92/psundots.dbf
/u04/oradata/DPUAT92/psundots_03.dbf
/u04/oradata/DPUAT92/ptapp.dbf
/u04/oradata/DPUAT92/ptprc.dbf
/u04/oradata/DPUAT92/system01.dbf
/u06/oradata/DPUAT92/aaapp1.dbf
/u06/oradata/DPUAT92/aalarge1.dbf
/u06/oradata/DPUAT92/adapp1.dbf
/u06/oradata/DPUAT92/aidba.dbf
/u06/oradata/DPUAT92/amapp.dbf
/u06/oradata/DPUAT92/avapp1.dbf
/u06/oradata/DPUAT92/bdapp.dbf
/u06/oradata/DPUAT92/bpapp.dbf
/u06/oradata/DPUAT92/ccapp1.dbf
/u06/oradata/DPUAT92/coapp.dbf
/u06/oradata/DPUAT92/cuaudit.dbf
/u06/oradata/DPUAT92/cularg1.dbf
/u06/oradata/DPUAT92/cularg2.dbf
/u06/oradata/DPUAT92/cularg3.dbf
/u06/oradata/DPUAT92/cularge.dbf
/u06/oradata/DPUAT92/dbtune.dbf
/u06/oradata/DPUAT92/diapp.dbf
/u06/oradata/DPUAT92/eoapp.dbf
/u06/oradata/DPUAT92/eobfapp1.dbf
/u06/oradata/DPUAT92/eocfapp1.dbf
/u06/oradata/DPUAT92/eocmapp.dbf
/u06/oradata/DPUAT92/eocmlrg.dbf
/u06/oradata/DPUAT92/eocmwrk.dbf
/u06/oradata/DPUAT92/eocuapp.dbf
/u06/oradata/DPUAT92/eoculrg.dbf
/u06/oradata/DPUAT92/eoditbl.dbf
/u06/oradata/DPUAT92/eodsapp.dbf
/u06/oradata/DPUAT92/eodslrg.dbf
/u06/oradata/DPUAT92/eoecapp.dbf
/u06/oradata/DPUAT92/eoeclrg.dbf
/u06/oradata/DPUAT92/eoecwrk.dbf
/u06/oradata/DPUAT92/eoeiapp.dbf
/u06/oradata/DPUAT92/eoeilrg.dbf
/u06/oradata/DPUAT92/eoewapp.dbf
/u06/oradata/DPUAT92/eoewlrg.dbf
/u06/oradata/DPUAT92/eoewwrk.dbf
/u06/oradata/DPUAT92/eoiuapp.dbf
/u06/oradata/DPUAT92/eoiulrg.dbf
/u06/oradata/DPUAT92/eoiuwrk.dbf
/u06/oradata/DPUAT92/eoltapp1.dbf
/u06/oradata/DPUAT92/eoppapp1.dbf
/u06/oradata/DPUAT92/eopplrg1.dbf
/u06/oradata/DPUAT92/faapp1.dbf
/u06/oradata/DPUAT92/falarge1.dbf
/u06/oradata/DPUAT92/hrapp71.dbf
/u06/oradata/DPUAT92/hrsapp1.dbf
/u06/oradata/DPUAT92/hrslarge1.dbf
/u06/oradata/DPUAT92/hrswork1.dbf
/u06/oradata/DPUAT92/psdefault.dbf
/u06/oradata/DPUAT92/psimgr.dbf
/u06/oradata/DPUAT92/psindex06.dbf
/u06/oradata/DPUAT92/psmatvw.dbf
/u06/oradata/DPUAT92/pstemp01.dbf
/u06/oradata/DPUAT92/pswork.dbf
/u06/oradata/DPUAT92/ptamsg.dbf
/u06/oradata/DPUAT92/ptappe.dbf
/u06/oradata/DPUAT92/ptaudit.dbf
/u06/oradata/DPUAT92/ptcmstar.dbf
/u06/oradata/DPUAT92/ptlock.dbf
/u06/oradata/DPUAT92/ptprjwk.dbf
/u06/oradata/DPUAT92/ptrpts.dbf
/u06/oradata/DPUAT92/pttbl.dbf
/u06/oradata/DPUAT92/pttlrg.dbf
/u06/oradata/DPUAT92/pttree.dbf
/u06/oradata/DPUAT92/ptwork.dbf
/u06/oradata/DPUAT92/pyapp.dbf
/u06/oradata/DPUAT92/pylarge.dbf
/u06/oradata/DPUAT92/pylarge02.dbf
/u06/oradata/DPUAT92/saapp1.dbf
/u06/oradata/DPUAT92/sacapp1.dbf
/u06/oradata/DPUAT92/salarge1.dbf
/u06/oradata/DPUAT92/srapp1.dbf
/u06/oradata/DPUAT92/stapp.dbf
/u06/oradata/DPUAT92/stlarge.dbf
/u06/oradata/DPUAT92/sysaux01.dbf
/u06/oradata/DPUAT92/sysaux02.dbf
/u06/oradata/DPUAT92/tivoliorts01.dbf
/u06/oradata/DPUAT92/tlapp.dbf
/u06/oradata/DPUAT92/tllarge.dbf
/u08/oradata/DPUAT92/eolarge.dbf
/u08/oradata/DPUAT92/eotpapp.dbf
/u08/oradata/DPUAT92/eotplrg.dbf
/u08/oradata/DPUAT92/epapp.dbf
/u08/oradata/DPUAT92/eplarge.dbf
/u08/oradata/DPUAT92/erapp.dbf
/u08/oradata/DPUAT92/erlarge.dbf
/u08/oradata/DPUAT92/erwork.dbf
/u08/oradata/DPUAT92/fgapp.dbf
/u08/oradata/DPUAT92/gpdeapp.dbf
/u08/oradata/DPUAT92/hpapp.dbf
/u08/oradata/DPUAT92/hrapp1.dbf
/u08/oradata/DPUAT92/hrapp2.dbf
/u08/oradata/DPUAT92/hrapp3.dbf
/u08/oradata/DPUAT92/hrapp4.dbf
/u08/oradata/DPUAT92/hrapp5.dbf
/u08/oradata/DPUAT92/hrapp6.dbf
/u08/oradata/DPUAT92/hrlarge02.dbf
/u08/oradata/DPUAT92/hrlarge03.dbf
/u08/oradata/DPUAT92/hrwork.dbf
/u08/oradata/DPUAT92/knsapp.dbf
/u08/oradata/DPUAT92/pcapp.dbf
/u08/oradata/DPUAT92/pclarge.dbf
/u08/oradata/DPUAT92/piwork.dbf
/u08/oradata/DPUAT92/poapp.dbf
/u08/oradata/DPUAT92/psindex04.dbf
/u08/oradata/DPUAT92/psindex05.dbf
/u08/oradata/DPUAT92/psindex07.dbf
/u08/oradata/DPUAT92/psundots_02.dbf
/u08/oradata/DPUAT92/pvapp.dbf
/u08/oradata/DPUAT92/py0lrg.dbf
/u08/oradata/DPUAT92/pylarge03.dbf
/u08/oradata/DPUAT92/pylarge04.dbf
/u08/oradata/DPUAT92/pywork.dbf
/u08/oradata/DPUAT92/stwork.dbf
/u08/oradata/DPUAT92/tlwork.dbf
/u08/oradata/DPUAT92/waapp.dbf


select file_id,file_name  from dba_temp_files order by 1
FILE_NAME
/u08/oradata/DPUAT92/temp01.dbf
/u08/oradata/DPUAT92/tivoliortempts_01.dbf
/u06/oradata/DPUAT92/psgtt01.dbf


select * from v$logfile


MEMBER

MEMBER
/oraredologs/dpu22/DPUAT92/redo0602.log
/oraredologs/dpu21/DPUAT92/redo0601.log
/oraredologs/dpu21/DPUAT92/redo0501.log
/oraredologs/dpu22/DPUAT92/redo0502.log
/oraredologs/dpu21/DPUAT92/redo0401.log
/oraredologs/dpu22/DPUAT92/redo0402.log
/oraredologs/dpu21/DPUAT92/redo0301.log
/oraredologs/dpu22/DPUAT92/redo0302.log
/oraredologs/dpu22/DPUAT92/redo0202.log
/oraredologs/dpu21/DPUAT92/redo0201.log
/oraredologs/dpu21/DPUAT92/redo0101.log
/oraredologs/dpu22/DPUAT92/redo0102.log



NAME
/oraredologs/dpu21/DPUAT92/control1DPUAT92.ctl
/oraredologs/dpu22/DPUAT92/control2DPUAT92.ctl




!! Blackout in OEM


sqlplus / as sysdba
shutdown immediate
exit



###............................................................
#Restore DataBase
rman
connect target /
connect catalog DPUAT92/DPUAT92namr@RCATDEV
startup force nomount;
set DBID=2337745691;
reset database to incarnation 2;
restore controlfile from 'c-2337745691-20160615-00_DPUAT92';
alter database mount;
run{
restore database from TAG=TAG20160615T121517;
recover database noredo;
}
alter database open resetlogs;
#End Restore DataBase

lsnrctl stop DPUAT92
lsnrctl start DPUAT92


----ABOVE had issues with not be able to restore Datafile, workaround below

startup force nomount;
connect target /
run{
allocate channel t1 TYPE 'SBT_TAPE' PARMS 'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDEV92.opt)';
restore controlfile from 'c-2215358295-20160519-00_DPDEV92';
}

alter database mount;

run{
restore database from TAG=TAG20160519T183537;
recover database noredo;
}
alter database open resetlogs;


###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


select count(distinct index_name)
from  dba_ind_columns
where table_owner = 'SYSADM'
and   table_name not like 'BIN$%'
and   DESCEND = 'DESC';


*************Could you please create a db link to DPUAT92 from DPDEV92 and DPDEVSRC? *********


1. Create user on DPUAT92

CREATE USER DBLINK_92_UPGRADE IDENTIFIED BY "#dblink92UpgraDe"
    DEFAULT TABLESPACE USERS
    TEMPORARY TABLESPACE TEMP
    PROFILE DEFAULT
    ACCOUNT UNLOCK
/
GRANT CREATE SESSION TO DBLINK_92_UPGRADE
/
GRANT DEVELOPER_SELECT TO DBLINK_92_UPGRADE
/
ALTER USER DBLINK_92_UPGRADE DEFAULT ROLE DEVELOPER_SELECT
/


2. Make sure DPUAT92 tns entry exist on dppdev

3. Login to DPDEV92 and DPDEVSRC and create db link


CREATE PUBLIC DATABASE LINK DPUAT92.WORLD
    CONNECT TO DBLINK_92_UPGRADE 
    IDENTIFIED BY "#dblink92UpgraDe"
    USING 'DPUAT92.WORLD'
/


select count(*) from sysadm.ps_kns_demo_hist@DPUAT92;




************** Dupliicate DPUAT91 to DPDRYRUN

. ~/.profile

DPUAT91



nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} forDPDRYRUNdupl

Duplicate from saved backup of DPUAT91 to new DB DPDRYRUN


## Initial
cd /u01/app/oracle/aetna/db_admin/db_DPUAT91/save_backup

view DPUAT91_sbk_20160724_22:55:04_forDPDRYRUNdupl.rman


#Restore DataBase
#connect target /
#connect catalog DPUAT91/DPUAT91namr@RCATDEV
#startup force nomount;
#set DBID=2332859867;
#reset database to incarnation 1324380;
#restore controlfile from 'c-2332859867-20160724-04_DPUAT91';
#alter database mount;
#run{
#restore database until sequence 11868;
#recover database until sequence 11868;
#}
#alter database open resetlogs;
#End Restore DataBase




Create OEM blackout if DB already exist

Tom's instructions...>


DBArtisan - system/sysdpuat91

select 'set newname for datafile '||file_id||' to '||chr(39)||replace(file_name,'DPUAT91','DPDRYRUN')||chr(39)||';'
from   dba_data_files
order by file_name;



'SETNEWNAMEFORDATAFILE'||FILE_ID||'TO'||CHR(39)||REPLACE(FILE_NAME,'DPUAT91','DPDRYRUN')||CHR(39)||';'
set newname for datafile 3 to '/u04/oradata/DPDRYRUN/USERS01.dbf';
set newname for datafile 4 to '/u04/oradata/DPDRYRUN/bnapp.dbf';
set newname for datafile 5 to '/u04/oradata/DPDRYRUN/bnlarge.dbf';
set newname for datafile 6 to '/u04/oradata/DPDRYRUN/fsapp.dbf';
set newname for datafile 7 to '/u04/oradata/DPDRYRUN/giapp.dbf';
set newname for datafile 8 to '/u04/oradata/DPDRYRUN/glapp.dbf';
set newname for datafile 9 to '/u04/oradata/DPDRYRUN/gpapp.dbf';
set newname for datafile 10 to '/u04/oradata/DPDRYRUN/hrapp.dbf';
set newname for datafile 11 to '/u04/oradata/DPDRYRUN/hrlarge.dbf';
set newname for datafile 12 to '/u04/oradata/DPDRYRUN/htapp.dbf';
set newname for datafile 13 to '/u04/oradata/DPDRYRUN/inapp.dbf';
set newname for datafile 14 to '/u04/oradata/DPDRYRUN/omapp.dbf';
set newname for datafile 15 to '/u04/oradata/DPDRYRUN/paapp.dbf';
set newname for datafile 16 to '/u04/oradata/DPDRYRUN/palarge.dbf';
set newname for datafile 17 to '/u04/oradata/DPDRYRUN/piapp.dbf';
set newname for datafile 18 to '/u04/oradata/DPDRYRUN/pilarge.dbf';
set newname for datafile 19 to '/u04/oradata/DPDRYRUN/psimage.dbf';
set newname for datafile 142 to '/u04/oradata/DPDRYRUN/psimage2_1.dbf';
set newname for datafile 143 to '/u04/oradata/DPDRYRUN/psimage2_2.dbf';
set newname for datafile 144 to '/u04/oradata/DPDRYRUN/psimage2_3.dbf';
set newname for datafile 145 to '/u04/oradata/DPDRYRUN/psimage2_4.dbf';
set newname for datafile 146 to '/u04/oradata/DPDRYRUN/psimage2_5.dbf';
set newname for datafile 20 to '/u04/oradata/DPDRYRUN/psindex.dbf';
set newname for datafile 21 to '/u04/oradata/DPDRYRUN/psindex01.dbf';
set newname for datafile 22 to '/u04/oradata/DPDRYRUN/psindex02.dbf';
set newname for datafile 23 to '/u04/oradata/DPDRYRUN/psindex03.dbf';
set newname for datafile 2 to '/u04/oradata/DPDRYRUN/psundots.dbf';
set newname for datafile 115 to '/u04/oradata/DPDRYRUN/psundots_03.dbf';
set newname for datafile 24 to '/u04/oradata/DPDRYRUN/ptapp.dbf';
set newname for datafile 25 to '/u04/oradata/DPDRYRUN/ptprc.dbf';
set newname for datafile 1 to '/u04/oradata/DPDRYRUN/system01.dbf';
set newname for datafile 125 to '/u06/oradata/DPDRYRUN/aaapp1.dbf';
set newname for datafile 116 to '/u06/oradata/DPDRYRUN/aalarge1.dbf';
set newname for datafile 126 to '/u06/oradata/DPDRYRUN/adapp1.dbf';
set newname for datafile 138 to '/u06/oradata/DPDRYRUN/aidba.dbf';
set newname for datafile 49 to '/u06/oradata/DPDRYRUN/amapp.dbf';
set newname for datafile 127 to '/u06/oradata/DPDRYRUN/avapp1.dbf';
set newname for datafile 50 to '/u06/oradata/DPDRYRUN/bdapp.dbf';
set newname for datafile 51 to '/u06/oradata/DPDRYRUN/bpapp.dbf';
set newname for datafile 128 to '/u06/oradata/DPDRYRUN/ccapp1.dbf';
set newname for datafile 52 to '/u06/oradata/DPDRYRUN/coapp.dbf';
set newname for datafile 53 to '/u06/oradata/DPDRYRUN/cuaudit.dbf';
set newname for datafile 54 to '/u06/oradata/DPDRYRUN/cularg1.dbf';
set newname for datafile 55 to '/u06/oradata/DPDRYRUN/cularg2.dbf';
set newname for datafile 56 to '/u06/oradata/DPDRYRUN/cularg3.dbf';
set newname for datafile 57 to '/u06/oradata/DPDRYRUN/cularge.dbf';
set newname for datafile 34 to '/u06/oradata/DPDRYRUN/dbtune.dbf';
set newname for datafile 58 to '/u06/oradata/DPDRYRUN/diapp.dbf';
set newname for datafile 59 to '/u06/oradata/DPDRYRUN/eoapp.dbf';
set newname for datafile 117 to '/u06/oradata/DPDRYRUN/eobfapp1.dbf';
set newname for datafile 118 to '/u06/oradata/DPDRYRUN/eocfapp1.dbf';
set newname for datafile 60 to '/u06/oradata/DPDRYRUN/eocmapp.dbf';
set newname for datafile 61 to '/u06/oradata/DPDRYRUN/eocmlrg.dbf';
set newname for datafile 62 to '/u06/oradata/DPDRYRUN/eocmwrk.dbf';
set newname for datafile 63 to '/u06/oradata/DPDRYRUN/eocuapp.dbf';
set newname for datafile 64 to '/u06/oradata/DPDRYRUN/eoculrg.dbf';
set newname for datafile 65 to '/u06/oradata/DPDRYRUN/eoditbl.dbf';
set newname for datafile 66 to '/u06/oradata/DPDRYRUN/eodsapp.dbf';
set newname for datafile 67 to '/u06/oradata/DPDRYRUN/eodslrg.dbf';
set newname for datafile 68 to '/u06/oradata/DPDRYRUN/eoecapp.dbf';
set newname for datafile 69 to '/u06/oradata/DPDRYRUN/eoeclrg.dbf';
set newname for datafile 70 to '/u06/oradata/DPDRYRUN/eoecwrk.dbf';
set newname for datafile 71 to '/u06/oradata/DPDRYRUN/eoeiapp.dbf';
set newname for datafile 72 to '/u06/oradata/DPDRYRUN/eoeilrg.dbf';
set newname for datafile 73 to '/u06/oradata/DPDRYRUN/eoewapp.dbf';
set newname for datafile 74 to '/u06/oradata/DPDRYRUN/eoewlrg.dbf';
set newname for datafile 75 to '/u06/oradata/DPDRYRUN/eoewwrk.dbf';
set newname for datafile 76 to '/u06/oradata/DPDRYRUN/eoiuapp.dbf';
set newname for datafile 77 to '/u06/oradata/DPDRYRUN/eoiulrg.dbf';
set newname for datafile 78 to '/u06/oradata/DPDRYRUN/eoiuwrk.dbf';
set newname for datafile 119 to '/u06/oradata/DPDRYRUN/eoltapp1.dbf';
set newname for datafile 129 to '/u06/oradata/DPDRYRUN/eoppapp1.dbf';
set newname for datafile 120 to '/u06/oradata/DPDRYRUN/eopplrg1.dbf';
set newname for datafile 130 to '/u06/oradata/DPDRYRUN/faapp1.dbf';
set newname for datafile 121 to '/u06/oradata/DPDRYRUN/falarge1.dbf';
set newname for datafile 122 to '/u06/oradata/DPDRYRUN/hrapp71.dbf';
set newname for datafile 131 to '/u06/oradata/DPDRYRUN/hrsapp1.dbf';
set newname for datafile 132 to '/u06/oradata/DPDRYRUN/hrslarge1.dbf';
set newname for datafile 133 to '/u06/oradata/DPDRYRUN/hrswork1.dbf';
set newname for datafile 48 to '/u06/oradata/DPDRYRUN/psdefault.dbf';
set newname for datafile 46 to '/u06/oradata/DPDRYRUN/psimgr.dbf';
set newname for datafile 136 to '/u06/oradata/DPDRYRUN/psindex06.dbf';
set newname for datafile 47 to '/u06/oradata/DPDRYRUN/pstemp01.dbf';
set newname for datafile 37 to '/u06/oradata/DPDRYRUN/pswork.dbf';
set newname for datafile 39 to '/u06/oradata/DPDRYRUN/ptamsg.dbf';
set newname for datafile 35 to '/u06/oradata/DPDRYRUN/ptappe.dbf';
set newname for datafile 45 to '/u06/oradata/DPDRYRUN/ptaudit.dbf';
set newname for datafile 43 to '/u06/oradata/DPDRYRUN/ptcmstar.dbf';
set newname for datafile 41 to '/u06/oradata/DPDRYRUN/ptlock.dbf';
set newname for datafile 44 to '/u06/oradata/DPDRYRUN/ptprjwk.dbf';
set newname for datafile 42 to '/u06/oradata/DPDRYRUN/ptrpts.dbf';
set newname for datafile 26 to '/u06/oradata/DPDRYRUN/pttbl.dbf';
set newname for datafile 38 to '/u06/oradata/DPDRYRUN/pttlrg.dbf';
set newname for datafile 36 to '/u06/oradata/DPDRYRUN/pttree.dbf';
set newname for datafile 40 to '/u06/oradata/DPDRYRUN/ptwork.dbf';
set newname for datafile 27 to '/u06/oradata/DPDRYRUN/pyapp.dbf';
set newname for datafile 28 to '/u06/oradata/DPDRYRUN/pylarge.dbf';
set newname for datafile 29 to '/u06/oradata/DPDRYRUN/pylarge02.dbf';
set newname for datafile 134 to '/u06/oradata/DPDRYRUN/saapp1.dbf';
set newname for datafile 123 to '/u06/oradata/DPDRYRUN/sacapp1.dbf';
set newname for datafile 124 to '/u06/oradata/DPDRYRUN/salarge1.dbf';
set newname for datafile 135 to '/u06/oradata/DPDRYRUN/srapp1.dbf';
set newname for datafile 30 to '/u06/oradata/DPDRYRUN/stapp.dbf';
set newname for datafile 31 to '/u06/oradata/DPDRYRUN/stlarge.dbf';
set newname for datafile 114 to '/u06/oradata/DPDRYRUN/sysaux01.dbf';
set newname for datafile 137 to '/u06/oradata/DPDRYRUN/sysaux02.dbf';
set newname for datafile 141 to '/u06/oradata/DPDRYRUN/tivoliorts01.dbf';
set newname for datafile 32 to '/u06/oradata/DPDRYRUN/tlapp.dbf';
set newname for datafile 33 to '/u06/oradata/DPDRYRUN/tllarge.dbf';
set newname for datafile 79 to '/u08/oradata/DPDRYRUN/eolarge.dbf';
set newname for datafile 80 to '/u08/oradata/DPDRYRUN/eotpapp.dbf';
set newname for datafile 81 to '/u08/oradata/DPDRYRUN/eotplrg.dbf';
set newname for datafile 82 to '/u08/oradata/DPDRYRUN/epapp.dbf';
set newname for datafile 83 to '/u08/oradata/DPDRYRUN/eplarge.dbf';
set newname for datafile 84 to '/u08/oradata/DPDRYRUN/erapp.dbf';
set newname for datafile 85 to '/u08/oradata/DPDRYRUN/erlarge.dbf';
set newname for datafile 86 to '/u08/oradata/DPDRYRUN/erwork.dbf';
set newname for datafile 87 to '/u08/oradata/DPDRYRUN/fgapp.dbf';
set newname for datafile 88 to '/u08/oradata/DPDRYRUN/gpdeapp.dbf';
set newname for datafile 89 to '/u08/oradata/DPDRYRUN/hpapp.dbf';
set newname for datafile 90 to '/u08/oradata/DPDRYRUN/hrapp1.dbf';
set newname for datafile 91 to '/u08/oradata/DPDRYRUN/hrapp2.dbf';
set newname for datafile 92 to '/u08/oradata/DPDRYRUN/hrapp3.dbf';
set newname for datafile 93 to '/u08/oradata/DPDRYRUN/hrapp4.dbf';
set newname for datafile 94 to '/u08/oradata/DPDRYRUN/hrapp5.dbf';
set newname for datafile 95 to '/u08/oradata/DPDRYRUN/hrapp6.dbf';
set newname for datafile 110 to '/u08/oradata/DPDRYRUN/hrlarge02.dbf';
set newname for datafile 139 to '/u08/oradata/DPDRYRUN/hrlarge03.dbf';
set newname for datafile 96 to '/u08/oradata/DPDRYRUN/hrwork.dbf';
set newname for datafile 113 to '/u08/oradata/DPDRYRUN/knsapp.dbf';
set newname for datafile 97 to '/u08/oradata/DPDRYRUN/pcapp.dbf';
set newname for datafile 98 to '/u08/oradata/DPDRYRUN/pclarge.dbf';
set newname for datafile 99 to '/u08/oradata/DPDRYRUN/piwork.dbf';
set newname for datafile 100 to '/u08/oradata/DPDRYRUN/poapp.dbf';
set newname for datafile 109 to '/u08/oradata/DPDRYRUN/psindex04.dbf';
set newname for datafile 112 to '/u08/oradata/DPDRYRUN/psindex05.dbf';
set newname for datafile 140 to '/u08/oradata/DPDRYRUN/psindex07.dbf';
set newname for datafile 107 to '/u08/oradata/DPDRYRUN/psundots_02.dbf';
set newname for datafile 101 to '/u08/oradata/DPDRYRUN/pvapp.dbf';
set newname for datafile 102 to '/u08/oradata/DPDRYRUN/py0lrg.dbf';
set newname for datafile 108 to '/u08/oradata/DPDRYRUN/pylarge03.dbf';
set newname for datafile 111 to '/u08/oradata/DPDRYRUN/pylarge04.dbf';
set newname for datafile 103 to '/u08/oradata/DPDRYRUN/pywork.dbf';
set newname for datafile 104 to '/u08/oradata/DPDRYRUN/stwork.dbf';
set newname for datafile 105 to '/u08/oradata/DPDRYRUN/tlwork.dbf';
set newname for datafile 106 to '/u08/oradata/DPDRYRUN/waapp.dbf';


select 'set newname for tempfile '||file_id||' to '||chr(39)||replace(file_name,'DPUAT91','DPDRYRUN')||chr(39)||';'
from   dba_temp_files
order by file_name;


'SETNEWNAMEFORTEMPFILE'||FILE_ID||'TO'||CHR(39)||REPLACE(FILE_NAME,'DPUAT91','DPDRYRUN')||CHR(39)||';'
set newname for tempfile 1 to '/u08/oradata/DPDRYRUN/temp01.dbf';
set newname for tempfile 2 to '/u08/oradata/DPDRYRUN/tivoliortempts_01.dbf';   


select lf.group# grp,
  replace(member,'DPUAT91','DPDRYRUN') member,
   bytes/1024/1024 mbytes 
           from   v$logfile lf,
                  v$log l
           where  lf.group# = l.group#
                  order by lf.group#,
                           substr(lf.member,instr(lf.member,'/',-1) + 1);

MEMBER
MEMBER
/oraredologs/dpu21/DPDRYRUN/redo0101.log
/oraredologs/dpu22/DPDRYRUN/redo0102.log
/oraredologs/dpu21/DPDRYRUN/redo0201.log
/oraredologs/dpu22/DPDRYRUN/redo0202.log
/oraredologs/dpu21/DPDRYRUN/redo0301.log
/oraredologs/dpu22/DPDRYRUN/redo0302.log
/oraredologs/dpu21/DPDRYRUN/redo0401.log
/oraredologs/dpu22/DPDRYRUN/redo0402.log
/oraredologs/dpu21/DPDRYRUN/redo0501.log
/oraredologs/dpu22/DPDRYRUN/redo0502.log
/oraredologs/dpu21/DPDRYRUN/redo0601.log
/oraredologs/dpu22/DPDRYRUN/redo0602.log



   


select replace(name,'DPUAT91','DPDRYRUN') name  from v$controlfile



NAME
NAME
/oraredologs/dpu21/DPDRYRUN/control1DPDRYRUN.ctl
/oraredologs/dpu22/DPDRYRUN/control2DPDRYRUN.ctl

*.control_files='/oraredologs/dpu21/DPDRYRUN/control1DPDRYRUN.ctl','/oraredologs
/dpu22/DPDRYRUN/control2DPDRYRUN.ctl'




1. Create new folders if not already there

/u04/oradata/DPDRYRUN/
/u06/oradata/DPDRYRUN/
/u08/oradata/DPDRYRUN/

cd /u04/oradata
mkdir DPDRYRUN
cd /u06/oradata
mkdir DPDRYRUN
cd /u08/oradata
mkdir DPDRYRUN





   
   cd /oraredologs/dpu21
   mkdir DPDRYRUN

   cd /oraredologs/dpu22
   mkdir DPDRYRUN



!! May not need.  Hold one with this owne.

### cd /u01/app/oracle/admin/
### mkdir DPDEV92
   
###   cd /u01/app/oracle/admin/DPDEV92
###   mkdir diag



   cd /u03/archlogs/
   mkdir DPDRYRUN
   
  cd /u10/oraback
  mkdir DPDRYRUN
  cd /u10/oraback/DPDRYRUN
  mkdir rman_backups



cd /u01/app/oracle/aetna/db_admin

cp -rp db_DPUAT91 db_DPDRYRUN

cd db_DPDRYRUN
!!!cleanup all under db_DPDRYRUN


cd /orahome/u01/app/oracle/admin
mkdir DPDRYRUN
 
    



3. Copy init.ora file


sqlplus / as sysdba

create pfile from spfile;


  cd $ORACLE_HOME/dbs
  cp initDPUAT91.ora initDPDRYRUN.ora      

/u04/oradata/DPUAT91/
/u06/oradata/DPUAT91
/u08/oradata/DPUAT91

/u04/oradata/DPUAT92/
/u06/oradata/DPUAT92
/u08/oradata/DPUAT92


/oraredologs/dpu21/DPUAT91/control1DPUAT92.ctl
/oraredologs/dpu22/DPUAT91/control2DPUAT92.ctl


/oraredologs/dpu21/DPUAT92/control1DPUAT92.ctl
/oraredologs/dpu22/DPUAT92/control2DPUAT92.ctl

db_file_name_convert='/u04/oradata/DPUAT91/','/u04/oradata/DPDRYRUN/','/u06/oradata/DPUAT91/','/u06/oradata/DPDRYRUN/','/u08/oradata/DPUAT91/','/u08/oradata/DPDRYRUN/'

log_file_name_convert='/oraredologs/dpu21/DPUAT91/','/oraredologs/dpu21/DPDRYRUN/','/oraredologs/dpu22/DPUAT91/','/oraredologs/dpu22/DPDRYRUN/'


4. Create zopa file on AUX server (completed !!!)
  
   cd $ORACLE_HOME/dbs
   cp orapwDPUAT91 orapwDPDRYRUN

5. Identify backupsets location.

   cd $SAVBKP

   









6. Add entry into oratab
   cd /etc
   vi oratab

  

DPDRYRUN:/orahome/u01/app/oracle/product/12.1.0.2/db_2:N


   cd $HOME/aetna/scripts

   cp -p oraprof oraprof_20160610   

   vi oraprof

"DPDRYRUN")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;


7. setup new AUX env

   . ~/.profile

DPDRYRUN


8. 

   #Remove
 #  rm /u*/oradata/DPDRYRUN/*




  ls /u*/oradata/DPDRYRUN/*
  

  

9. Dupliicate...


    sqlplus / as sysdba
    startup pfile=/orahome/u01/app/oracle/product/12.1.0.2/db_2/dbs/initDPDRYRUN.ora force nomount;
    



rman
connect target sys/sysdpuat91@DPUAT91
connect catalog DPUAT91/DPUAT91namr@RCATDEV
connect AUXILIARY /

#Backup End Time - 06/09/2016 11:02:36 PM



###run {
###set until time "TO_DATE('06/09/2016 11:02:36','MM/DD/YYYY HH24:MI:SS')";
###duplicate target database to DPDRYRUN;
###}

## Second time
run {
set until sequence 11868;
duplicate target database to DPDRYRUN;
}










Cannot remove created server parameter file

10. cd $ORACLE_HOME/network/admin

vi listener.ora
DPDRYRUN=
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = dppqa)(PORT = 1596))
    (ADDRESS = (PROTOCOL = IPC) (KEY = DPDRYRUN_ipc))
  )

SID_LIST_DPDRYRUN=
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME =DPDRYRUN)
      (ORACLE_HOME = /orahome/u01/app/oracle/product/12.1.0.2/db_2)
      (SID_NAME =DPDRYRUN)
    )
  )

SECURE_REGISTER_DPDRYRUN=(IPC)

SUBSCRIBE_FOR_NODE_DOWN_EVENT_DPDRYRUN=OFF

lsnrctl start DPDRYRUN




11. Change sys zopas


Remove zopa function first

AI_zopa_VALIDATE



alter profile default limit zopa_VERIFY_FUNCTION null
/




ALTER USER system IDENTIFIED BY "sysdpdryrun"

/
ALTER USER sys IDENTIFIED BY "sysdpdryrun"

/


ALTER USER dpadmin IDENTIFIED BY "sysdpdryrun"

/

ALTER PROFILE DEFAULT LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/







12. Add new entry to Web Server oratab : xpsdppm1q, xpsdppw1q



move2s10

DPDRYRUN:/orahome/psu01/oracle/product/12.1.0.2/client_64bit_dp2:N

cd /orahome/psu01/oracle/scripts
  cp -p oraprof oraprof_20160610

   vi oraprof

Add new entry
 
"DPDRYRUN")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;
   . ~/.profile

DPDRYRUN

cd $ORACLE_HOME/network/admin

vi tnsnames.ora




DPDRYRUN.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppqa)
          (Port = 1596)
        )
    )
    (CONNECT_DATA = (SID =DPDRYRUN)
    )
  )



Test: sqlplus

system/sysdpdryrun@DPDRYRUN




13. Setup Catalog in  RCATDEV database on XORACLDW2D Server

XORACLDW2D/ Bl0ckhe@d

SSH to XORACLDW2D Login as A id and su to oracle

. $SETUPENV RCATDEV

cd $ORACLE_BASE/local/scripts


create_catalog.ksh RCATDEV DPDRYRUN @DPDRYRUNnamr



   . ~/.profile

DPDRYRUN


>rman

connect catalog DPDRYRUN/DPDRYRUNnamr@RCATDEV

create catalog;

exit


>rman

connect target /

connect catalog DPDRYRUN/DPDRYRUNnamr@RCATDEV




register database;


report schema;

show all;
RMAN configuration parameters for database with db_unique_name DPDRYRUN are:
CONFIGURE RETENTION POLICY TO REDUNDANCY 10;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/u10/oraback/DPDRYRUN/rman_backups/%F';
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F';
CONFIGURE DEVICE TYPE DISK PARALLELISM 2 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/u10/oraback/DPDRYRUN/rman_backups/bkp_df%t_s%s_p%p';
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDRYRUN.opt)';
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPDRYRUN/rman_backups/snapcf_DPDRYRUN.f';





14. Make sure all files exist. Create one if needed.

cd $HOME

#make sure both file exists
cp .DPUAT91.pw .DPDRYRUN.pw
cp .DPUAT91_RMAN.pw .DPDRYRUN_RMAN.pw
cp .DPUAT91sys.pw .DPDRYRUNsys.pw
cp .DPUAT91_DPADMIN.pw .DPDRYRUN_DPADMIN.pw





16. Recompile all.

select count(*)
from dba_objects
where status = 'INVALID';

41



###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


15. Recreate Log and exp dir if needed

##EXP_DUMP_DIR
###EXPORT_LOG_DIR


CREATE OR REPLACE DIRECTORY EXP_LOG_DIR AS '/u01/app/oracle/aetna/db_admin/db_DPDRYRUN/export/'
/
GRANT READ ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/



select file_name from dba_temp_files;

/u08/oradata/DPUAT92/temp01.dbf



alter database tempfile '/u08/oradata/DPDRYRUN/temp01.dbf' drop;
ALTER TABLESPACE TEMP ADD TEMPFILE '/u08/oradata/DPDRYRUN/temp01.dbf' SIZE 15000M reuse;

alter database tempfile '/u08/oradata/DPDRYRUN/tivoliortempts_01.dbf' drop;
ALTER TABLESPACE TEMP ADD TEMPFILE '/u08/oradata/DPDRYRUN/tivoliortempts_01.dbf' SIZE 200M reuse;



15. Ask Storman to create /u01/app/oracle/tdpoopt/tdpo.DPDRYRUN.opt


Test backup

Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}

Monitor backup

cd /u01/app/oracle/aetna/db_admin/db_DPDRYRUN/log
tail -f xxx.log

Or/and 

Save backup
nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} initBackup


DPUAT92 backup saved as DPUAT92_sbk_20160610_14:34:51_initBackup.rman





16. Add new DB to OEM, add cron jobs and schedule backups


Email Rich Ryan to add database to OEM

Add crontabs jobs


crontab -e

List of all existing DPAUT91 jobs and add for DPDUAT92

45 19 * * * ${HOME}/aetna/db_mgmt/backup/expdp_full.ksh DPUAT92



00,20,40 0-20 * * * ${HOME}/aetna/scripts/verify_db_is_up.ksh DPUAT92
05,20,40 22 * * * ${HOME}/aetna/scripts/verify_db_is_up.ksh DPUAT92

15 23 * * * ${HOME}/aetna/db_mgmt/backup/rman_list_database.ksh DPUAT92

05 01 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_all.ksh DPUAT92
00 07 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_sjt_tables.ksh DPUAT92

0,15,30,45 0-23 * * * ${HOME}/aetna/db_mgmt/monitor/scan_oracle.ksh DPUAT92

30 12 * * * ${HOME}/tls/space_usage.ksh DPUAT92 > /dev/null
35 12 * * * ${HOME}/aetna/db_mgmt/space/spacechk.ksh DPUAT92

10 20 * * * ${HOME}/aetna/scripts/udump_trc_rename.ksh DPUAT92 > ${HOME}/aetna/db_admin/db_DPUAT92/log/DPUAT92_udump_trc_rename.out 2>&1

0,15,30,45 0-20 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPUAT92 > /dev/null
15,30,45 22 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPUAT92 > /dev/null

30 05 * * * ${HOME}/tls/check_undots.ksh DPUAT92 > /dev/null

20 05 * * 0 ${HOME}/aetna/db_mgmt/extsecur/ext_spcl_permissions.ksh DPUAT92 > /dev/null 2>&1


17. Add sys and system accounts to eDMZ

18. Make note of current space

19. 

    shutdown immediate
    startup

FUll size: 93,598 GB
 


*****************DPUAT92 --> DPUATSRC

. ~/.profile

DPUAT92



#Fresh backup if needed

$BKPSCR/dbbackup_rman ${ORACLE_SID}


nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} forDPUATSRCdupl




cd /u01/app/oracle/aetna/db_admin/db_DPUAT92/save_backup

view DPUAT92_sbk_20160811_09:03:52_forDPUATSRCdupl.rman

#Restore DataBase
#connect target /
#connect catalog DPUAT92/DPUAT92namr@RCATDEV
#startup force nomount;
#set DBID=2339979026;
#reset database to incarnation 9702;
#restore controlfile from 'c-2339979026-20160811-03_DPUAT92';
#alter database mount;
#run{
#restore database until sequence 3761;
#recover database until sequence 3761;
#}
#alter database open resetlogs;
#End Restore DataBase




Create OEM blackout if DB already exist




DBArtisan - system/sysdpuat92

select 'set newname for datafile '||file_id||' to '||chr(39)||replace(file_name,'DPUAT92','DPUATSRC')||chr(39)||';'
from   dba_data_files
order by file_name;


'SETNEWNAMEFORDATAFILE'||FILE_ID||'TO'||CHR(39)||REPLACE(FILE_NAME,'DPUAT92','DPUATSRC')||CHR(39)||';'
set newname for datafile 3 to '/u04/oradata/DPUATSRC/USERS01.dbf';
set newname for datafile 4 to '/u04/oradata/DPUATSRC/bnapp.dbf';
set newname for datafile 5 to '/u04/oradata/DPUATSRC/bnlarge.dbf';
set newname for datafile 6 to '/u04/oradata/DPUATSRC/fsapp.dbf';
set newname for datafile 7 to '/u04/oradata/DPUATSRC/giapp.dbf';
set newname for datafile 8 to '/u04/oradata/DPUATSRC/glapp.dbf';
set newname for datafile 9 to '/u04/oradata/DPUATSRC/gpapp.dbf';
set newname for datafile 10 to '/u04/oradata/DPUATSRC/hrapp.dbf';
set newname for datafile 11 to '/u04/oradata/DPUATSRC/hrlarge.dbf';
set newname for datafile 12 to '/u04/oradata/DPUATSRC/htapp.dbf';
set newname for datafile 13 to '/u04/oradata/DPUATSRC/inapp.dbf';
set newname for datafile 14 to '/u04/oradata/DPUATSRC/omapp.dbf';
set newname for datafile 15 to '/u04/oradata/DPUATSRC/paapp.dbf';
set newname for datafile 16 to '/u04/oradata/DPUATSRC/palarge.dbf';
set newname for datafile 17 to '/u04/oradata/DPUATSRC/piapp.dbf';
set newname for datafile 18 to '/u04/oradata/DPUATSRC/pilarge.dbf';
set newname for datafile 19 to '/u04/oradata/DPUATSRC/psimage.dbf';
set newname for datafile 142 to '/u04/oradata/DPUATSRC/psimage2_1.dbf';
set newname for datafile 143 to '/u04/oradata/DPUATSRC/psimage2_2.dbf';
set newname for datafile 144 to '/u04/oradata/DPUATSRC/psimage2_3.dbf';
set newname for datafile 145 to '/u04/oradata/DPUATSRC/psimage2_4.dbf';
set newname for datafile 146 to '/u04/oradata/DPUATSRC/psimage2_5.dbf';
set newname for datafile 20 to '/u04/oradata/DPUATSRC/psindex.dbf';
set newname for datafile 21 to '/u04/oradata/DPUATSRC/psindex01.dbf';
set newname for datafile 22 to '/u04/oradata/DPUATSRC/psindex02.dbf';
set newname for datafile 23 to '/u04/oradata/DPUATSRC/psindex03.dbf';
set newname for datafile 2 to '/u04/oradata/DPUATSRC/psundots.dbf';
set newname for datafile 115 to '/u04/oradata/DPUATSRC/psundots_03.dbf';
set newname for datafile 24 to '/u04/oradata/DPUATSRC/ptapp.dbf';
set newname for datafile 25 to '/u04/oradata/DPUATSRC/ptprc.dbf';
set newname for datafile 1 to '/u04/oradata/DPUATSRC/system01.dbf';
set newname for datafile 125 to '/u06/oradata/DPUATSRC/aaapp1.dbf';
set newname for datafile 116 to '/u06/oradata/DPUATSRC/aalarge1.dbf';
set newname for datafile 126 to '/u06/oradata/DPUATSRC/adapp1.dbf';
set newname for datafile 138 to '/u06/oradata/DPUATSRC/aidba.dbf';
set newname for datafile 49 to '/u06/oradata/DPUATSRC/amapp.dbf';
set newname for datafile 127 to '/u06/oradata/DPUATSRC/avapp1.dbf';
set newname for datafile 50 to '/u06/oradata/DPUATSRC/bdapp.dbf';
set newname for datafile 51 to '/u06/oradata/DPUATSRC/bpapp.dbf';
set newname for datafile 128 to '/u06/oradata/DPUATSRC/ccapp1.dbf';
set newname for datafile 52 to '/u06/oradata/DPUATSRC/coapp.dbf';
set newname for datafile 53 to '/u06/oradata/DPUATSRC/cuaudit.dbf';
set newname for datafile 54 to '/u06/oradata/DPUATSRC/cularg1.dbf';
set newname for datafile 55 to '/u06/oradata/DPUATSRC/cularg2.dbf';
set newname for datafile 56 to '/u06/oradata/DPUATSRC/cularg3.dbf';
set newname for datafile 57 to '/u06/oradata/DPUATSRC/cularge.dbf';
set newname for datafile 34 to '/u06/oradata/DPUATSRC/dbtune.dbf';
set newname for datafile 58 to '/u06/oradata/DPUATSRC/diapp.dbf';
set newname for datafile 59 to '/u06/oradata/DPUATSRC/eoapp.dbf';
set newname for datafile 117 to '/u06/oradata/DPUATSRC/eobfapp1.dbf';
set newname for datafile 118 to '/u06/oradata/DPUATSRC/eocfapp1.dbf';
set newname for datafile 60 to '/u06/oradata/DPUATSRC/eocmapp.dbf';
set newname for datafile 61 to '/u06/oradata/DPUATSRC/eocmlrg.dbf';
set newname for datafile 62 to '/u06/oradata/DPUATSRC/eocmwrk.dbf';
set newname for datafile 63 to '/u06/oradata/DPUATSRC/eocuapp.dbf';
set newname for datafile 64 to '/u06/oradata/DPUATSRC/eoculrg.dbf';
set newname for datafile 65 to '/u06/oradata/DPUATSRC/eoditbl.dbf';
set newname for datafile 66 to '/u06/oradata/DPUATSRC/eodsapp.dbf';
set newname for datafile 67 to '/u06/oradata/DPUATSRC/eodslrg.dbf';
set newname for datafile 68 to '/u06/oradata/DPUATSRC/eoecapp.dbf';
set newname for datafile 69 to '/u06/oradata/DPUATSRC/eoeclrg.dbf';
set newname for datafile 70 to '/u06/oradata/DPUATSRC/eoecwrk.dbf';
set newname for datafile 71 to '/u06/oradata/DPUATSRC/eoeiapp.dbf';
set newname for datafile 72 to '/u06/oradata/DPUATSRC/eoeilrg.dbf';
set newname for datafile 73 to '/u06/oradata/DPUATSRC/eoewapp.dbf';
set newname for datafile 74 to '/u06/oradata/DPUATSRC/eoewlrg.dbf';
set newname for datafile 75 to '/u06/oradata/DPUATSRC/eoewwrk.dbf';
set newname for datafile 76 to '/u06/oradata/DPUATSRC/eoiuapp.dbf';
set newname for datafile 77 to '/u06/oradata/DPUATSRC/eoiulrg.dbf';
set newname for datafile 78 to '/u06/oradata/DPUATSRC/eoiuwrk.dbf';
set newname for datafile 119 to '/u06/oradata/DPUATSRC/eoltapp1.dbf';
set newname for datafile 129 to '/u06/oradata/DPUATSRC/eoppapp1.dbf';
set newname for datafile 120 to '/u06/oradata/DPUATSRC/eopplrg1.dbf';
set newname for datafile 130 to '/u06/oradata/DPUATSRC/faapp1.dbf';
set newname for datafile 121 to '/u06/oradata/DPUATSRC/falarge1.dbf';
set newname for datafile 122 to '/u06/oradata/DPUATSRC/hrapp71.dbf';
set newname for datafile 131 to '/u06/oradata/DPUATSRC/hrsapp1.dbf';
set newname for datafile 132 to '/u06/oradata/DPUATSRC/hrslarge1.dbf';
set newname for datafile 133 to '/u06/oradata/DPUATSRC/hrswork1.dbf';
set newname for datafile 48 to '/u06/oradata/DPUATSRC/psdefault.dbf';
set newname for datafile 46 to '/u06/oradata/DPUATSRC/psimgr.dbf';
set newname for datafile 136 to '/u06/oradata/DPUATSRC/psindex06.dbf';
set newname for datafile 147 to '/u06/oradata/DPUATSRC/psmatvw.dbf';
set newname for datafile 47 to '/u06/oradata/DPUATSRC/pstemp01.dbf';
set newname for datafile 37 to '/u06/oradata/DPUATSRC/pswork.dbf';
set newname for datafile 39 to '/u06/oradata/DPUATSRC/ptamsg.dbf';
set newname for datafile 35 to '/u06/oradata/DPUATSRC/ptappe.dbf';
set newname for datafile 45 to '/u06/oradata/DPUATSRC/ptaudit.dbf';
set newname for datafile 43 to '/u06/oradata/DPUATSRC/ptcmstar.dbf';
set newname for datafile 41 to '/u06/oradata/DPUATSRC/ptlock.dbf';
set newname for datafile 44 to '/u06/oradata/DPUATSRC/ptprjwk.dbf';
set newname for datafile 42 to '/u06/oradata/DPUATSRC/ptrpts.dbf';
set newname for datafile 26 to '/u06/oradata/DPUATSRC/pttbl.dbf';
set newname for datafile 38 to '/u06/oradata/DPUATSRC/pttlrg.dbf';
set newname for datafile 36 to '/u06/oradata/DPUATSRC/pttree.dbf';
set newname for datafile 40 to '/u06/oradata/DPUATSRC/ptwork.dbf';
set newname for datafile 27 to '/u06/oradata/DPUATSRC/pyapp.dbf';
set newname for datafile 28 to '/u06/oradata/DPUATSRC/pylarge.dbf';
set newname for datafile 29 to '/u06/oradata/DPUATSRC/pylarge02.dbf';
set newname for datafile 134 to '/u06/oradata/DPUATSRC/saapp1.dbf';
set newname for datafile 123 to '/u06/oradata/DPUATSRC/sacapp1.dbf';
set newname for datafile 124 to '/u06/oradata/DPUATSRC/salarge1.dbf';
set newname for datafile 135 to '/u06/oradata/DPUATSRC/srapp1.dbf';
set newname for datafile 30 to '/u06/oradata/DPUATSRC/stapp.dbf';
set newname for datafile 31 to '/u06/oradata/DPUATSRC/stlarge.dbf';
set newname for datafile 114 to '/u06/oradata/DPUATSRC/sysaux01.dbf';
set newname for datafile 137 to '/u06/oradata/DPUATSRC/sysaux02.dbf';
set newname for datafile 141 to '/u06/oradata/DPUATSRC/tivoliorts01.dbf';
set newname for datafile 32 to '/u06/oradata/DPUATSRC/tlapp.dbf';
set newname for datafile 33 to '/u06/oradata/DPUATSRC/tllarge.dbf';
set newname for datafile 79 to '/u08/oradata/DPUATSRC/eolarge.dbf';
set newname for datafile 80 to '/u08/oradata/DPUATSRC/eotpapp.dbf';
set newname for datafile 81 to '/u08/oradata/DPUATSRC/eotplrg.dbf';
set newname for datafile 82 to '/u08/oradata/DPUATSRC/epapp.dbf';
set newname for datafile 83 to '/u08/oradata/DPUATSRC/eplarge.dbf';
set newname for datafile 84 to '/u08/oradata/DPUATSRC/erapp.dbf';
set newname for datafile 85 to '/u08/oradata/DPUATSRC/erlarge.dbf';
set newname for datafile 86 to '/u08/oradata/DPUATSRC/erwork.dbf';
set newname for datafile 87 to '/u08/oradata/DPUATSRC/fgapp.dbf';
set newname for datafile 88 to '/u08/oradata/DPUATSRC/gpdeapp.dbf';
set newname for datafile 89 to '/u08/oradata/DPUATSRC/hpapp.dbf';
set newname for datafile 90 to '/u08/oradata/DPUATSRC/hrapp1.dbf';
set newname for datafile 91 to '/u08/oradata/DPUATSRC/hrapp2.dbf';
set newname for datafile 92 to '/u08/oradata/DPUATSRC/hrapp3.dbf';
set newname for datafile 93 to '/u08/oradata/DPUATSRC/hrapp4.dbf';
set newname for datafile 94 to '/u08/oradata/DPUATSRC/hrapp5.dbf';
set newname for datafile 95 to '/u08/oradata/DPUATSRC/hrapp6.dbf';
set newname for datafile 110 to '/u08/oradata/DPUATSRC/hrlarge02.dbf';
set newname for datafile 139 to '/u08/oradata/DPUATSRC/hrlarge03.dbf';
set newname for datafile 96 to '/u08/oradata/DPUATSRC/hrwork.dbf';
set newname for datafile 113 to '/u08/oradata/DPUATSRC/knsapp.dbf';
set newname for datafile 97 to '/u08/oradata/DPUATSRC/pcapp.dbf';
set newname for datafile 98 to '/u08/oradata/DPUATSRC/pclarge.dbf';
set newname for datafile 99 to '/u08/oradata/DPUATSRC/piwork.dbf';
set newname for datafile 100 to '/u08/oradata/DPUATSRC/poapp.dbf';
set newname for datafile 109 to '/u08/oradata/DPUATSRC/psindex04.dbf';
set newname for datafile 112 to '/u08/oradata/DPUATSRC/psindex05.dbf';
set newname for datafile 140 to '/u08/oradata/DPUATSRC/psindex07.dbf';
set newname for datafile 107 to '/u08/oradata/DPUATSRC/psundots_02.dbf';
set newname for datafile 101 to '/u08/oradata/DPUATSRC/pvapp.dbf';
set newname for datafile 102 to '/u08/oradata/DPUATSRC/py0lrg.dbf';
set newname for datafile 108 to '/u08/oradata/DPUATSRC/pylarge03.dbf';
set newname for datafile 111 to '/u08/oradata/DPUATSRC/pylarge04.dbf';
set newname for datafile 103 to '/u08/oradata/DPUATSRC/pywork.dbf';
set newname for datafile 104 to '/u08/oradata/DPUATSRC/stwork.dbf';
set newname for datafile 105 to '/u08/oradata/DPUATSRC/tlwork.dbf';
set newname for datafile 106 to '/u08/oradata/DPUATSRC/waapp.dbf';


select 'set newname for tempfile '||file_id||' to '||chr(39)||replace(file_name,'DPUAT92','DPUATSRC')||chr(39)||';'
from   dba_temp_files
order by file_name;


'SETNEWNAMEFORTEMPFILE'||FILE_ID||'TO'||CHR(39)||REPLACE(FILE_NAME,'DPUAT92','DPUATSRC')||CHR(39)||';'
set newname for tempfile 3 to '/u06/oradata/DPUATSRC/psgtt01.dbf';
set newname for tempfile 1 to '/u08/oradata/DPUATSRC/temp01.dbf';
set newname for tempfile 2 to '/u08/oradata/DPUATSRC/tivoliortempts_01.dbf';

 


select lf.group# grp,
  replace(member,'DPUAT92','DPUATSRC') member,
   bytes/1024/1024 mbytes 
           from   v$logfile lf,
                  v$log l
           where  lf.group# = l.group#
                  order by lf.group#,
                           substr(lf.member,instr(lf.member,'/',-1) + 1);

MEMBER
MEMBER
/oraredologs/dpu21/DPUATSRC/redo0101.log
/oraredologs/dpu22/DPUATSRC/redo0102.log

/oraredologs/dpu21/DPUATSRC/redo0201.log
/oraredologs/dpu22/DPUATSRC/redo0202.log
/oraredologs/dpu21/DPUATSRC/redo0301.log
/oraredologs/dpu22/DPUATSRC/redo0302.log
/oraredologs/dpu21/DPUATSRC/redo0401.log
/oraredologs/dpu22/DPUATSRC/redo0402.log
/oraredologs/dpu21/DPUATSRC/redo0501.log
/oraredologs/dpu22/DPUATSRC/redo0502.log
/oraredologs/dpu21/DPUATSRC/redo0601.log
/oraredologs/dpu22/DPUATSRC/redo0602.log



   


select replace(name,'DPUAT92','DPUATSRC') name  from v$controlfile



NAME
NAME
/oraredologs/dpu21/DPUATSRC/control1DPUATSRC.ctl
/oraredologs/dpu22/DPUATSRC/control2DPUATSRC.ctl





1. Create new folders if not already there

/u04/oradata/DPUATSRC/
/u06/oradata/DPUATSRC/
/u08/oradata/DPUATSRC/

cd /u04/oradata
mkdir DPUATSRC
cd /u06/oradata
mkdir DPUATSRC
cd /u08/oradata
mkdir DPUATSRC





   
   cd /oraredologs/dpu21
   mkdir DPUATSRC

   cd /oraredologs/dpu22
   mkdir DPUATSRC



!! May not need.  Hold one with this owne.

### cd /u01/app/oracle/admin/
### mkdir DPDEV92
   
###   cd /u01/app/oracle/admin/DPDEV92
###   mkdir diag



   cd /u03/archlogs/
   mkdir DPUATSRC
   
  cd /u10/oraback
  mkdir DPUATSRC
  cd /u10/oraback/DPUATSRC
  mkdir rman_backups



cd /u01/app/oracle/aetna/db_admin

cp -rp db_DPUAT92 db_DPUATSRC

cd db_DPDRYRUN
!!!cleanup all under db_DPUATSRC


cd /orahome/u01/app/oracle/admin
mkdir DPUATSRC
 
    



3. Copy init.ora file


sqlplus / as sysdba

create pfile from spfile;


  cd $ORACLE_HOME/dbs
  cp initDPUAT92.ora initDPUATSRC.ora      

*.db_file_name_convert='/u04/oradata/DPUAT92/','/u04/oradata/DPUATSRC/','/u06/oradata/DPUAT92/','/u06/oradata/DPUATSRC/','/u08/oradata/DPUAT92/','/u08/oradata/DPUATSRC/'
*.log_file_name_convert='/oraredologs/dpu21/DPUAT92/','/oraredologs/dpu21/DPUATSRC/','/oraredologs/dpu22/DPUAT92/','/oraredologs/dpu22/DPUATSRC/'


4. Create zopa file on AUX server (completed !!!)
  
   cd $ORACLE_HOME/dbs
   cp orapwDPUAT92 orapwinitDPUATSRC

5. Identify backupsets location.

   cd $SAVBKP

   










6. Add entry into oratab
   cd /etc
   vi oratab

  

DPUATSRC:/orahome/u01/app/oracle/product/12.1.0.2/db_1:N


   cd $HOME/aetna/scripts

   cp -p oraprof oraprof_20160720   

   vi oraprof

"DPUATSRC")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;


7. setup new AUX env

   . ~/.profile

DPUATSRC

sqlplus / as sysdba

shutdown immediate


8. 

   #Remove
 #  rm /u*/oradata/DPUATSRC/*




  ls /u*/oradata/DPUATSRC/*
  

  

9. Dupliicate...


    sqlplus / as sysdba
    startup pfile=/orahome/u01/app/oracle/product/12.1.0.2/db_1/dbs/initDPUATSRC.ora force nomount;
    



rman
connect target sys/sysdpuat92@DPUAT92
connect catalog DPUAT92/DPUAT92namr@RCATDEV
connect AUXILIARY /







run {
set until sequence 3761;
duplicate target database to DPUATSRC;
}










Cannot remove created server parameter file

10. cd $ORACLE_HOME/network/admin


netstat -an|grep 1527


vi listener.ora
DPUATSRC=
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = dppqa)(PORT = 1527))
    (ADDRESS = (PROTOCOL = IPC) (KEY = DPUATSRC_ipc))
  )

SID_LIST_DPUATSRC=
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME =DPUATSRC)
      (ORACLE_HOME = /orahome/u01/app/oracle/product/12.1.0.2/db_1)
      (SID_NAME =DPUATSRC)
    )
  )

SECURE_REGISTER_DPUATSRC=(IPC)

SUBSCRIBE_FOR_NODE_DOWN_EVENT_DPUATSRC=OFF

lsnrctl stop DPUATSRC
lsnrctl start DPUATSRC



11. Change sys zopas


Remove zopa function first

AI_zopa_VALIDATE



alter profile default limit zopa_VERIFY_FUNCTION null
/




ALTER USER system IDENTIFIED BY "sysdpuatsrc"

/
ALTER USER sys IDENTIFIED BY "sysdpuatsrc"

/


ALTER USER dpadmin IDENTIFIED BY "sysdpuatsrc"

/

ALTER PROFILE DEFAULT LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/







12. Add new entry to Web Server oratab : xpsdppm1q, xpsdppw1q


DPUATSRC:/orahome/psu01/oracle/product/12.1.0.2/client_64bit_dp1:N

cd /orahome/psu01/oracle/scripts
  cp -p oraprof oraprof_20160725

   vi oraprof

Add new entry
 
"DPUATSRC")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;
   . ~/.profile

DPUATSRC

cd $ORACLE_HOME/network/admin

vi tnsnames.ora




DPUATSRC.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppqa)
          (Port = 1527)
        )
    )
    (CONNECT_DATA = (SID =DPUATSRC)
    )
  )



Test: sqlplus

system/sysdpuatsrc@DPUATSRC




13. Setup Catalog in  RCATDEV database on XORACLDW2D Server

XORACLDW2D/ Bl0ckhe@d

SSH to XORACLDW2D Login as A id and su to oracle

. $SETUPENV RCATDEV

cd $ORACLE_BASE/local/scripts


create_catalog.ksh RCATDEV DPUATSRC DPUATSRCnamr



   . ~/.profile

DPUATSRC


>rman

connect catalog DPUATSRC/DPUATSRCnamr@RCATDEV

create catalog;

exit


>rman

connect target /

connect catalog DPUATSRC/DPUATSRCnamr@RCATDEV




register database;


report schema;

show all;

CONFIGURE RETENTION POLICY TO REDUNDANCY 10;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/u10/oraback/DPUATSRC/rman_backups/%F';
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F';
CONFIGURE DEVICE TYPE DISK PARALLELISM 2 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/u10/oraback/DPUATSRC/rman_backups/bkp_df%t_s%s_p%p';
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPUATSRC.opt)';
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPUATSRC/rman_backups/snapcf_DPUATSRC.f';





14. Make sure all files exist. Create one if needed.

cd $HOME

#make sure both file exists
cp .DPUAT91.pw .DPUATSRC.pw
cp .DPUAT91_RMAN.pw .DPUATSRC_RMAN.pw
cp .DPUAT91sys.pw .DPUATSRCsys.pw
cp .DPUAT91_DPADMIN.pw .DPUATSRC_DPADMIN.pw



15. Ask Storman to create /u01/app/oracle/tdpoopt/tdpo.DPUATSRC.opt


Test backup

Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}

Monitor backup

cd /u01/app/oracle/aetna/db_admin/db_DPUATSRC/log
tail -f xxx.log

Or/and 

Save backup
nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} initBackup

DPUATSRC backup saved as DPUATSRC_sbk_20160725_14:12:19_initBackup.rman

DPUATSRC backup saved as DPUATSRC_sbk_20160811_10:10:35_initBackup.rman


16. Recompile all.

select count(*)
from dba_objects
where status = 'INVALID';

41



###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


15. Recreate Log and exp dir if needed

##EXP_DUMP_DIR
###EXPORT_LOG_DIR


CREATE OR REPLACE DIRECTORY EXP_LOG_DIR AS '/u01/app/oracle/aetna/db_admin/db_DPUATSRC/export/'
/
GRANT READ ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/



select file_name from dba_temp_files;

/u08/oradata/DPUAT92/temp01.dbf



alter database tempfile '/u08/oradata/DPUATSRC/temp01.dbf' drop;
ALTER TABLESPACE TEMP ADD TEMPFILE '/u08/oradata/DPUATSRC/temp01.dbf' SIZE 15000M reuse;

alter database tempfile '/u08/oradata/DPDRYRUN/tivoliortempts_01.dbf' drop;
ALTER TABLESPACE TEMP ADD TEMPFILE '/u08/oradata/DPUATSRC/tivoliortempts_01.dbf' SIZE 200M reuse;









16. Add new DB to OEM, add cron jobs and schedule backups


Email Rich Ryan to add database to OEM

Add crontabs jobs


crontab -e

List of all existing DPAUT91 jobs and add for DPDUAT92

45 19 * * * ${HOME}/aetna/db_mgmt/backup/expdp_full.ksh DPUAT92



00,20,40 0-20 * * * ${HOME}/aetna/scripts/verify_db_is_up.ksh DPUAT92
05,20,40 22 * * * ${HOME}/aetna/scripts/verify_db_is_up.ksh DPUAT92

15 23 * * * ${HOME}/aetna/db_mgmt/backup/rman_list_database.ksh DPUAT92

05 01 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_all.ksh DPUAT92
00 07 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_sjt_tables.ksh DPUAT92

0,15,30,45 0-23 * * * ${HOME}/aetna/db_mgmt/monitor/scan_oracle.ksh DPUAT92

30 12 * * * ${HOME}/tls/space_usage.ksh DPUAT92 > /dev/null
35 12 * * * ${HOME}/aetna/db_mgmt/space/spacechk.ksh DPUAT92

10 20 * * * ${HOME}/aetna/scripts/udump_trc_rename.ksh DPUAT92 > ${HOME}/aetna/db_admin/db_DPUAT92/log/DPUAT92_udump_trc_rename.out 2>&1

0,15,30,45 0-20 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPUAT92 > /dev/null
15,30,45 22 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPUAT92 > /dev/null

30 05 * * * ${HOME}/tls/check_undots.ksh DPUAT92 > /dev/null

20 05 * * 0 ${HOME}/aetna/db_mgmt/extsecur/ext_spcl_permissions.ksh DPUAT92 > /dev/null 2>&1


17. Add sys and system accounts to eDMZ

18. Make note of current space

19. 

    shutdown immediate
    startup

FUll size: 93,598 GB





GRANT SELECT  ON SYS.ENC$ TO DPMASKADMIN
/



***********************************


	DPDEUVG - sec_case_sensitive_logon = true
DPDEV92 - sec_case_sensitive_logon = false
DPUAT92 - sec_case_sensitive_logon = true
DPPRD01 - sec_case_sensitive_logon = false
DPPRD02 - sec_case_sensitive_logon = false

alter system set  sec_case_sensitive_logon=false



************Retire DPDEMO91*************


1. Run backup and saved


Test backup

Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}



cd $BKPSCR
savebkp.ksh DPDEMO91 b4finalShutdown

DPDEMO91 backup saved as DPDEMO91_sbk_20161012_10:42:35_b4finalShutdown.rman



2. Remove Old Saved backups. See file Removes_saved_backups.txt



3. Black out in OEM


4. Check Files location


select file_id,file_name from dba_data_files order by 2

/u02/oradata/DPDEMO91/aaapp.dbf
/u04/oradata/DPDEMO91/psindex.dbf
/u06/oradata/DPDEMO91/psdefault.dbf
/u08/oradata/DPDEMO91/ptprjwk.dbf

select file_id,file_name  from dba_temp_files order by 1


FILE_NAME
/u09/oradata/DPDEMO91/temp01.dbf
/u04/oradata/DPDEMO91/pstemp01.dbf

select * from v$logfile


MEMBER
/oraredologs/dpu21/DPDEMO91/redo0101.log
/oraredologs/dpu22/DPDEMO91/redo0102.log
/oraredologs/dpu21/DPDEMO91/redo0201.log
/oraredologs/dpu22/DPDEMO91/redo0202.log
/oraredologs/dpu21/DPDEMO91/redo0301.log
/oraredologs/dpu22/DPDEMO91/redo0302.log

select * from v$controlfile

NAME
/oraredologs/dpu21/DPDEMO91/control1DPDEMO91.ctl
/oraredologs/dpu22/DPDEMO91/control2DPDEMO91.ctl
/oraredologs/dpu23/DPDEMO91/control3DPDEMO91.ctl


archive log list;

Database log mode              No Archive Mode
Automatic archival             Disabled
Archive destination            /u03/archlogs/DPDEMO91/
Oldest online log sequence     16807
Current log sequence           16809



5. Shutdown

sqlplus / as sysdba

shutdown immediate
exit

lsnrctl stop DPDEMO91


6. Remove or comment out any crontab jobs for DPDEMO91

7. Set oratab to N


8. Disable DB entry in ICR


in 2 weeks

9. Remove target from OEM

10. Remove all files form OS


************Retire DPDEV91*************

. ~/.profile


DPDEV91


1. Run backup and saved




Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}



cd $BKPSCR
savebkp.ksh DPDEV91 b4finalShutdown

DPDEV91 backup saved as DPDEV91_sbk_20161011_22:45:05_b4finalShutdown.rman



2. Remove Old Saved backups. See file Removes_saved_backups.txt



3. Black out in OEM


4. Check Files location


select file_id,file_name from dba_data_files order by 2

/u02/oradata/DPDEV91/USERS01.dbf
/u05/oradata/DPDEV91/aaapp1.dbf
/u09/oradata/DPDEV91/epapp.dbf

select file_id,file_name  from dba_temp_files order by 1


FILE_NAME
/u09/oradata/DPDEV91/temp01.dbf
/u09/oradata/DPDEV91/tivoliortempts_01.dbf



select * from v$logfile

MEMBER
/oraredologs/dpu21/DPDEV91/redo0601.log
/oraredologs/dpu22/DPDEV91/redo0602.log
/oraredologs/dpu21/DPDEV91/redo0501.log
/oraredologs/dpu22/DPDEV91/redo0502.log
/oraredologs/dpu21/DPDEV91/redo0401.log
/oraredologs/dpu22/DPDEV91/redo0402.log
/oraredologs/dpu21/DPDEV91/redo0301.log
/oraredologs/dpu22/DPDEV91/redo0302.log
/oraredologs/dpu21/DPDEV91/redo0201.log
/oraredologs/dpu22/DPDEV91/redo0202.log
/oraredologs/dpu21/DPDEV91/redo0101.log
/oraredologs/dpu22/DPDEV91/redo0102.log

select * from v$controlfile

NAME
/oraredologs/dpu21/DPDEV91/control1DPDEV91.ctl
/oraredologs/dpu22/DPDEV91/control2DPDEV91.ctl
/oraredologs/dpu23/DPDEV91/control3DPDEV91.ctl


archive log list;

Database log mode              Archive Mode
Automatic archival             Enabled
Archive destination            /u03/archlogs/DPDEV91/
Oldest online log sequence     30756
Next log sequence to archive   30761
Current log sequence           30761



5. Shutdown

sqlplus / as sysdba

shutdown immediate
exit

lsnrctl stop DPDEV91


6. Remove or comment out any crontab jobs for DPDEV91

7. Set oratab to N


8. Disable DB entry in ICR


in 2 weeks

9. Remove target from OEM

10. Remove all files form OS



************Retire DPUAT91*************

. ~/.profile


DPUAT91


1. Run backup and saved




Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}



cd $BKPSCR
savebkp.ksh DPUAT91 b4finalShutdown

DPUAT91 backup saved as DPUAT91_sbk_20161025_08:11:39_b4finalShutdown.rman



2. Remove Old Saved backups. See file Removes_saved_backups.txt

   ! You may need manually delete OS Backup jobs from OEM

3. Black out in OEM


4. Check Files location


select file_id,file_name from dba_data_files order by 2

/u04/oradata/DPUAT91/USERS01.dbf
/u06/oradata/DPUAT91/aaapp1.dbf
/u08/oradata/DPUAT91/epapp.dbf


select file_id,file_name  from dba_temp_files order by 1


/u08/oradata/DPUAT91/tivoliortempts_01.dbf



select * from v$logfile

/oraredologs/dpu21/DPUAT91/redo0601.log

/oraredologs/dpu22/DPUAT91/redo0502.log

select * from v$controlfile

NAME
NAME
/oraredologs/dpu21/DPUAT91/control1DPUAT91.ctl
/oraredologs/dpu22/DPUAT91/control2DPUAT91.ctl
/oraredologs/dpu23/DPUAT91/control3DPUAT91.ctl


archive log list;

Database log mode              Archive Mode
Automatic archival             Enabled
Archive destination            /u03/archlogs/DPUAT91/
Oldest online log sequence     19484
Next log sequence to archive   19489
Current log sequence           19489



5. Shutdown

sqlplus / as sysdba

shutdown immediate
exit

lsnrctl stop DPUAT91


6. Remove or comment out any crontab jobs for DPUAT91

7. Set oratab to N


8. Disable DB entry in ICR


in 2 weeks

9. Remove target from OEM

10. Remove all files form OS



************ PSADMIN Role changes********

Original extract from DPDEV92

CREATE ROLE PSADMIN NOT IDENTIFIED
/
GRANT SELECT ON SYS.V_$IM_USER_SEGMENTS TO PSADMIN
/
GRANT SELECT ON SYS.V_$IM_COLUMN_LEVEL TO PSADMIN
/
GRANT ALTER ROLLBACK SEGMENT TO PSADMIN WITH ADMIN OPTION
/
GRANT ALTER SESSION TO PSADMIN WITH ADMIN OPTION
/
GRANT ALTER TABLESPACE TO PSADMIN WITH ADMIN OPTION
/
GRANT ALTER USER TO PSADMIN WITH ADMIN OPTION
/
GRANT BECOME USER TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE CLUSTER TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE DATABASE LINK TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE MATERIALIZED VIEW TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE PROCEDURE TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE PUBLIC DATABASE LINK TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE PUBLIC SYNONYM TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE ROLLBACK SEGMENT TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE SEQUENCE TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE SESSION TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE SYNONYM TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE TABLE TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE TABLESPACE TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE TRIGGER TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE USER TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE VIEW TO PSADMIN WITH ADMIN OPTION
/
GRANT DROP PUBLIC DATABASE LINK TO PSADMIN WITH ADMIN OPTION
/
GRANT DROP PUBLIC SYNONYM TO PSADMIN WITH ADMIN OPTION
/
GRANT DROP ROLLBACK SEGMENT TO PSADMIN WITH ADMIN OPTION
/
GRANT DROP TABLESPACE TO PSADMIN WITH ADMIN OPTION
/
GRANT DROP USER TO PSADMIN WITH ADMIN OPTION
/
GRANT MANAGE TABLESPACE TO PSADMIN WITH ADMIN OPTION
/



GRANT CREATE SESSION TO PSADMIN WITH ADMIN OPTION
/






cd /u01/app/oracle/aetna/scripts

@psroles.sql


GRANT PSADMIN TO SYSADM
/
ALTER USER SYSADM DEFAULT ROLE PSADMIN
/



Original extract from DPUAT92

CREATE ROLE PSADMIN NOT IDENTIFIED
/
GRANT SELECT ON SYS.V_$IM_USER_SEGMENTS TO PSADMIN
/
GRANT SELECT ON SYS.V_$IM_COLUMN_LEVEL TO PSADMIN
/
GRANT ALTER ROLLBACK SEGMENT TO PSADMIN WITH ADMIN OPTION
/
GRANT ALTER SESSION TO PSADMIN WITH ADMIN OPTION
/
GRANT ALTER TABLESPACE TO PSADMIN WITH ADMIN OPTION
/
GRANT ALTER USER TO PSADMIN WITH ADMIN OPTION
/
GRANT BECOME USER TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE CLUSTER TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE DATABASE LINK TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE MATERIALIZED VIEW TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE PROCEDURE TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE PUBLIC DATABASE LINK TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE PUBLIC SYNONYM TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE ROLLBACK SEGMENT TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE SEQUENCE TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE SESSION TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE SYNONYM TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE TABLE TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE TABLESPACE TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE TRIGGER TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE USER TO PSADMIN WITH ADMIN OPTION
/
GRANT CREATE VIEW TO PSADMIN WITH ADMIN OPTION
/
GRANT DROP PUBLIC DATABASE LINK TO PSADMIN WITH ADMIN OPTION
/
GRANT DROP PUBLIC SYNONYM TO PSADMIN WITH ADMIN OPTION
/
GRANT DROP ROLLBACK SEGMENT TO PSADMIN WITH ADMIN OPTION
/
GRANT DROP TABLESPACE TO PSADMIN WITH ADMIN OPTION
/
GRANT DROP USER TO PSADMIN WITH ADMIN OPTION
/
GRANT MANAGE TABLESPACE TO PSADMIN WITH ADMIN OPTION
/




from dppdev

scp -p /u01/app/oracle/aetna/scripts/psroles.sql dppqa:/u01/app/oracle/aetna/scripts/psroles.sql

cd /u01/app/oracle/aetna/scripts

@psroles.sql





******************************


DPUAT92.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppqa)
          (Port = 1598)
        )
    )
    (CONNECT_DATA = (SID = DPUAT92)
    )
  )


DPUAT92 =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = dppqa)(PORT = 1598))
    (ADDRESS = (PROTOCOL = IPC) (KEY = DPUAT92_ipc))
  )

SID_LIST_DPUAT92 =
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME = DPUAT92)
      (ORACLE_HOME =/orahome/u01/app/oracle/product/12.1.0.2/db_1)
      (SID_NAME = DPUAT92)
    )
  )

SECURE_REGISTER_DPUAT92 = (IPC)

SUBSCRIBE_FOR_NODE_DOWN_EVENT_DPUAT92=OFF

************> New entry


DPUAT92.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = IPC)
          (KEY=DPUAT92_ipc) 
          (Host = dppqa)
          (Port = 1598)
        )
    )
    (CONNECT_DATA = (SID = DPUAT92)
    )
  )

(ADDRESS =  (PROTOCOL = IPC)(Key = IPCKEY))
(ADDRESS =  (PROTOCOL = TCP)(HOST = MYHOST)(PORT = 1521))

DPUAT92.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppqa)
          (Port = 1598)
        )
    )
    (CONNECT_DATA = (SID = DPUAT92)
    )
  )



DATABASE1 =   (DESCRIPTION =
(ADDRESS_LIST =
(ADDRESS =  (PROTOCOL = IPC)(Key = IPCKEY))
     (ADDRESS =  (PROTOCOL = TCP)(HOST = MYHOST)(PORT = 1521))
   )
     (CONNECT_DATA =       (SID =  DATABASE1)
   )
)

DPUAT92.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS = (COMMUNITY = tcp.world)(PROTOCOL = IPC)(KEY=DPUAT92_ipc))
        (ADDRESS = (COMMUNITY = tcp.world)(PROTOCOL = TCP)(Host = dppqa)(Port = 1598))
    )
    (CONNECT_DATA = (SID = DPUAT92)
    )
  )


************ Duplicate DPDRYRUN to DPDEV92 ****************

. ~/.profile

DPDEV92

Save last backup just in case
cd $BKPSCR


savebkp.ksh DPDEV92 b4DRYRUNduplicate


. ~/.profile

DPDRYRUN

Duplicate from saved backup of DPDRYRUN to existing DB DPDEV92

cd /u01/app/oracle/aetna/db_admin/db_DPDRYRUN/save_backup

#####DPDEV91_sbk_20160418_22:45:05_forDPDEV92dupl.rman



Tom's instructions...>

select 'set newname for datafile '||file_id||' to '||chr(39)||replace(file_name,'DPDEV91','DPDEV92')||chr(39)||';'
from   dba_data_files
order by file_name;


'SETNEWNAMEFORDATAFILE'||FILE_ID||'TO'||CHR(39)||REPLACE(FILE_NAME,'DPDEV91','DPDEV92')||CHR(39)||';'


  or

select file_id,file_name from dba_data_files order by 2


FILE_NAME
/opt/u02/DPDRYRUN/audit.dbf
/opt/u05/DPDRYRUN/USERS01.dbf
/opt/u08/DPDRYRUN/hrlarge10.dbf
/opt/u09/DPDRYRUN/psindex06.dbf
/u05/oradata/DPDRYRUN/psmatvw.dbf


select 'set newname for tempfile '||file_id||' to '||chr(39)||replace(file_name,'DPDEV91','DPDEV92')||chr(39)||';'
from   dba_temp_files
order by file_name;

	or

select file_id,file_name  from dba_temp_files order by 1

FILE_NAME
/opt/u04/DPDRYRUN/temp01.dbf
/u04/oradata/DPDRYRUN/psgtt01.dbf



	   


select lf.group# grp,
  replace(member,'DPDEV91','DPDEV92') member,
   bytes/1024/1024 mbytes 
           from   v$logfile lf,
                  v$log l
           where  lf.group# = l.group#
                  order by lf.group#,
                           substr(lf.member,instr(lf.member,'/',-1) + 1);

or


select * from v$logfile


MEMBER
/oraredologs/dpu21/DPDRYRUN/redo0601.log
/oraredologs/dpu22/DPDRYRUN/redo0602.log

/oraredologs/dpu21/DPDRYRUN/redo0501.log
/oraredologs/dpu22/DPDRYRUN/redo0502.log

/oraredologs/dpu21/DPDRYRUN/redo0401.log
/oraredologs/dpu22/DPDRYRUN/redo0402.log

/oraredologs/dpu21/DPDRYRUN/redo0301.log
/oraredologs/dpu22/DPDRYRUN/redo0302.log

/oraredologs/dpu21/DPDRYRUN/redo0201.log
/oraredologs/dpu22/DPDRYRUN/redo0202.log

/oraredologs/dpu21/DPDRYRUN/redo0101.log
/oraredologs/dpu22/DPDRYRUN/redo0102.log
   


select * from v$controlfile

NAME
/oraredologs/dpu21/DPDRYRUN/control1DPDRYRUN.ctl
/oraredologs/dpu22/DPDRYRUN/control2DPDRYRUN.ctl
/oraredologs/dpu23/DPDRYRUN/control3DPDRYRUN.ctl







......>


1. Create new folders unless it already there.



select file_id,file_name from dba_data_files order by 2

FILE_NAME
/u02/oradata/DPDEV92/USERS01.dbf
/u05/oradata/DPDEV92/aalarge1.dbf
/u09/oradata/DPDEV92/eolarge.dbf






select file_id,file_name  from dba_temp_files order by 1



FILE_NAME
/u09/oradata/DPDEV92/temp01.dbf
/u09/oradata/DPDEV92/tivoliortempts_01.dbf
/u09/oradata/DPDEV92/psgtt01.dbf


select * from v$logfile



MEMBER
/oraredologs/dpu22/DPDEV92/redo0602.log
/oraredologs/dpu21/DPDEV92/redo0601.log

/oraredologs/dpu21/DPDEV92/redo0501.log
/oraredologs/dpu22/DPDEV92/redo0502.log

/oraredologs/dpu21/DPDEV92/redo0401.log
/oraredologs/dpu22/DPDEV92/redo0402.log

/oraredologs/dpu21/DPDEV92/redo0301.log
/oraredologs/dpu22/DPDEV92/redo0302.log

/oraredologs/dpu22/DPDEV92/redo0202.log
/oraredologs/dpu21/DPDEV92/redo0201.log

/oraredologs/dpu21/DPDEV92/redo0101.log
/oraredologs/dpu22/DPDEV92/redo0102.log


select * from v$controlfile


NAME
/oraredologs/dpu21/DPDEV92/control1DPDEV92.ctl
/oraredologs/dpu22/DPDEV92/control2DPDEV92.ctl
/oraredologs/dpu23/DPDEV92/control3DPDEV92.ctl


cd /u02/oradata
mkdir DPDEV92 
cd /u05/oradata
mkdir DPDEV92
cd /u09/oradata
mkdir DPDEV92
cd /u08/oradata
mkdir DPDEV92


   
   cd /oraredologs/dpu21/
   mkdir DPDEV92

   cd /oraredologs/dpu22
   mkdir DPDEV92



!! May not need.  Hold one with this owne.
   cd /u01/app/oracle/admin/
   mkdir DPDEV92
   
   cd /u01/app/oracle/admin/DPDEV92
    mkdir diag

   cd /u03/archlogs/
   mkdir DPDEV92
   
  cd /u10/oraback
  mkdir DPDEV92
  cd /u10/oraback/DPDEV92
  mkdir rman_backups



cd /u01/app/oracle/aetna/db_admin

cp -rp db_DPDEV91 db_DPDEV92

cleanup all under db_DPDEV92


cd /orahome/u01/app/oracle/admin
mkdir DPDEV92
 
    


3. Copy init.ora file


if DPDEV92 existing Database just do this

sqlplus / as sysdba

create pfile from spfile;


  ###cd $ORACLE_HOME/dbs
  ###cp initDPDEV91.ora initDPDEV92.ora      



Currently:

*.db_file_name_convert='/u02/oradata/DPDEV91/','/u02/oradata/DPDEV92/','/u05/oradata/DPDEV91/','/u05/oradata/DPDEV92/','/u09/oradata/DPDEV91/','/u09/oradata/DPDEV92/'

*.log_file_name_convert='/oraredologs/dpu21/DPDEV91/','/oraredologs/dpu21/DPDEV92/','/oraredologs/dpu22/DPDEV91/','/oraredologs/dpu22/DPDEV92/'


New:




/u05/oradata/DPDRYRUN/psmatvw.dbf - 1 GB
/u04/oradata/DPDRYRUN/psgtt01.dbf - 1 GB


/opt/u04/DPDRYRUN/temp01.dbf - 5

/opt/u02/DPDRYRUN/audit.dbf - 10
/opt/u08/DPDRYRUN/hrlarge10.dbf - 23 
/opt/u05/DPDRYRUN/USERS01.dbf - 122
/opt/u09/DPDRYRUN/psindex06.dbf - 140









/opt/u04/DPDRYRUN/','/u09/oradata/DPDEV92/',/u05/oradata/DPDRYRUN/','/u09/oradata/DPDEV92/',/u04/oradata/DPDRYRUN/','/u09/oradata/DPDEV92/'

/u09/oradata/DPDEV92/eolarge.dbf - 99 GB + 31 GB = 130 GB


/u02/oradata/DPDEV92/USERS01.dbf - 84 GB + 30 GB = 114 GB
/u05/oradata/DPDEV92/aalarge1.dbf - 104 GB + 36 GB = 140 GB
/u08/oradata/DPDEV92 - 164 GB




/oraredologs/dpu21/DPDRYRUN/redo0601.log
/oraredologs/dpu22/DPDRYRUN/redo0602.log



/oraredologs/dpu22/DPDEV92/redo0602.log
/oraredologs/dpu21/DPDEV92/redo0601.log



*.db_file_name_convert='/opt/u09/DPDRYRUN/','/u08/oradata/DPDEV92/','/opt/u05/DPDRYRUN/','/u05/oradata/DPDEV92/','/opt/u08/DPDRYRUN/','/u02/oradata/DPDEV92/','/opt/u02/DPDRYRUN/','/u09/oradata/DPDEV92/',/opt/u04/DPDRYRUN/','/u09/oradata/DPDEV92/',/u05/oradata/DPDRYRUN/','/u09/oradata/DPDEV92/',/u04/oradata/DPDRYRUN/','/u09/oradata/DPDEV92/'

*.log_file_name_convert='/oraredologs/dpu21/DPDRYRUN/','/oraredologs/dpu21/DPDEV92/','/oraredologs/dpu22/DPDRYRUN/','/oraredologs/dpu22/DPDEV92/'

-- All set no changes
*.control_files='/oraredologs/dpu21/DPDEV92/control1DPDEV92.ctl','/oraredologs/dpu22/DPDEV92/control2DPDEV92.ctl','/oraredologs/dpu23/DPDEV92/control3DPDEV92.ctl'





4. Create zopa file on AUX server (completed !!!)
  
   cd $ORACLE_HOME/dbs
   cp orapwDPDEV91 orapwDPDEV92

5. Identify backupsets location.

   cd $SAVBKP

   

view DPDEV91_sbk_20160418_22:45:05_forDPDEV92dupl.rman

#Backup End Time - 04/18/2016 10:55:05 PM



6. Add entry into oratab
   cd /etc
   vi oratab

  
DPDEV92:/orahome/u01/app/oracle/product/12.1.0.2/db_1:Y


   cd $HOME/aetna/scripts

   cp -p oraprof oraprof_20160418   

   vi oraprof

"DPDEV92")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;


7. setup new AUX env

   . ~/.profile

DPDEV92



Save Rman settings

rman
connect target /
connect catalog DPDEV92/DPDEV92namr@RCATDEV

show all;

RMAN configuration parameters for database with db_unique_name DPDEV92 are:
CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 30 DAYS;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/u10/oraback/DPDEV92/rman_backups/%F';

CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F_%d';
CONFIGURE DEVICE TYPE DISK PARALLELISM 4 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/u10/oraback/DPDEV92/rman_backups/bkp_df%t_s%s_s%p';

CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDEV92.opt)';

CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default

CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPDEV92/rman_backups/snapcf_DPDEV92.f';
exit

Copy .opt file from DPPQA to DPPDEV server

Login to DPPQA

cd /u01/app/oracle/tdpoopt

scp tdpo.DPDRYRUN.opt dppdev:/u01/app/oracle/tdpoopt/tdpo.DPDRYRUN.opt 


Login back to dppdev and test TDP stuff


Add following into tnsnames.ora

DPDRYRUN.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppqa)
          (Port = 1596)
        )
    )
    (CONNECT_DATA = (SID =DPDRYRUN)
    )
  )



   rman
   
   connect target sys/sysdpdryrun@DPDRYRUN
   connect catalog DPDRYRUN/DPDRYRUNnamr@RCATDEV
   connect AUXILIARY /
   run{
     allocate auxiliary channel t1 TYPE 'SBT_TAPE' PARMS 'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDRYRUN.opt)';
     release channel t1;
   } 




OEM Blackout

cd $HOME/local/

deactivate_cron.ksh


sqlplus / as sysdba

shutdown immediate;
exit

lsnrctl stop DPDEV92

cd $ORACLe_HOME/dbs

mv spfileDPDEV92.ora spfileDPDEV92.ora.20161102




!!! Encryption steps

a. Create wallet dir on DPDEV92 if not already there
b. Copy DPDRYRUN zopa file over there.


8. 

   #Remove
 #  rm /u*/oradata/DPDEV92/*




  ls /u*/oradata/DPDEV92/*
  

  

9. Dupliicate...


    sqlplus / as sysdba
    startup pfile=/orahome/u01/app/oracle/product/12.1.0.2/db_1/dbs/initDPDEV92.ora force nomount;
    



rman
   connect target sys/sysdpdryrun@DPDRYRUN
   connect catalog DPDRYRUN/DPDRYRUNnamr@RCATDEV
   connect AUXILIARY /





run {
allocate auxiliary channel t1 TYPE 'SBT_TAPE' PARMS 'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDRYRUN.opt)';
#####set until sequence 3761;
duplicate target database to DPDEV92;
}



Cannot remove created server parameter file

10. cd $ORACLE_HOME/network/admin

vi listener.ora

DPDEV92 =
  (DESCRIPTION =
    (ADDRESS= (PROTOCOL= IPC)(KEY= DPDEV92_ipc))
    (ADDRESS = (PROTOCOL = TCP)(HOST = dppdev)(PORT = 1695))
  )

SID_LIST_DPDEV92 =
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME = DPDEV92)
      (ORACLE_HOME = /orahome/u01/app/oracle/product/12.1.0.2/db_1)
      (SID_NAME = DPDEV92)
    )
  )

SECURE_REGISTER_DPDEV92 = (IPC)

SUBSCRIBE_FOR_NODE_DOWN_EVENT_DPDEV92=OFF

!! Remove DBACOUT entry...




11. Change sys zopas


Remove zopa function first

AI_zopa_VALIDATE



alter profile STANDARD limit zopa_VERIFY_FUNCTION null
/




ALTER USER system IDENTIFIED BY "sysdpdev92"

/
ALTER USER sys IDENTIFIED BY "sysdpdev92"

/


ALTER USER dpadmin IDENTIFIED BY "bpsdpdev92"

/

ALTER PROFILE STANDARD LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/







12. Add new entry to Web Server oratab : xpsdppw2d

DPDEV92:/orahome/psu01/oracle/product/12.1.0.2/client_64bit_dp1:N

cd /orahome/psu01/oracle/scripts
  cp -p oraprof oraprof_20160418 

   vi oraprof

Add DPBCKOUT entry to oraprof
 
"DPDEV92")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;
   . ~/.profile

DPDEV92

cd $ORACLE_HOME/network/admin

vi tnsnames.ora

DPDEV92.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppdev)
          (Port = 1695)
        )
    )
    (CONNECT_DATA = (SID = DPDEV92)
    )
  )



Test: sqlplus

system/sysdpdev92@DPDEV92




13. Setup Catalog in  RCATDEV database on XORACLDW2D Server

XORACLDW2D/ Bl0ckhe@d

SSH to XORACLDW2D Login as A id and su to oracle

##cd /u01/app/oracle/admin/RCATDEV/sql

cd $ORACLE_BASE/local/scripts


create_catalog.ksh RCATDEV DPDEV92 DPDEV92namr



   . ~/.profile

DPDEV92


>rman

connect catalog DPDEV92/DPDEV92namr@RCATDEV

create catalog;

exit


>rman

connect target /

connect catalog DPDEV92/DPDEV92namr@RCATDEV




register database;


report schema;

RMAN configuration parameters for database with db_unique_name DPDEV92 are:
CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 30 DAYS;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/u10/oraback/DPDEV92/rman_backups/%F';

CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F_%d';
CONFIGURE DEVICE TYPE DISK PARALLELISM 4 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/u10/oraback/DPDEV92/rman_backups/bkp_df%t_s%s_s%p';

CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDEV92.opt)';

CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default

CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPDEV92/rman_backups/snapcf_DPDEV92.f';



14. Make sure all files exist. Create one if needed.

cd $HOME

#make sure both file exists
cp .DPDEV91.pw .DPDEV92.pw
cp .DPDEV91_RMAN.pw .DPDEV92_RMAN.pw
cp .DPDEV91sys.pw .DPDEV92sys.pw
cp .DPDEV91_DPADMIN.pw .DPDEV92_DPADMIN.pw



15. Ask Storman to create /u01/app/oracle/tdpoopt/tdpo.DPDEV92.opt


Test backup

Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}

Monitor backup

cd /u01/app/oracle/aetna/db_admin/db_DPDEV92/log
tail -f xxx.log

Or/and 

Save backup
nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} initBackup


DPDEV92 backup saved as DPDEV92_sbk_20160420_09:51:37_initBackup.rman

16. Recompile all.

select count(*)
from dba_objects
where status = 'INVALID';

41



###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


15. Recreate Log and exp dir if needed

##EXP_DUMP_DIR
###EXPORT_LOG_DIR


CREATE OR REPLACE DIRECTORY EXP_LOG_DIR AS '/u01/app/oracle/aetna/db_admin/db_DPDEV92/export/'
/
GRANT READ ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/


16. Add new DB to OEM, add cron jobs and schedule backups


cd $HOME/local

	crontab crontab_b4_aixpatch.lst


17. !!! Encryption steps

Query table with 

## Make sure it shows correct path
select * from V$ENCRYPTION_WALLET;
select * from DBA_ENCRYPTED_COLUMNS;



extract DDL from SYSADM.PS_YE_W2CP_DATA to make sure encryption there

select * from SYSADM.PS_YE_W2CP_DATA




Stop OEM blackout

Email Rich Ryan to add database to OEM

Add crontabs jobs
50 19 * * * ${HOME}/aetna/db_mgmt/backup/expdp_full_new.ksh DPDEV92

30 03 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_all.ksh DPDEV92

00 07 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_sjt_tables.ksh DPDEV92

00,20,40 2-23 * * * ${HOME}/aetna/scripts/verify_db_is_up.ksh DPDEV92

0,15,30,45 0-23 * * * ${HOME}/aetna/db_mgmt/monitor/scan_oracle.ksh DPDEV92

15 23 * * * ${HOME}/aetna/db_mgmt/backup/rman_list_database.ksh DPDEV92

05 05 * * 0 ${HOME}/aetna/db_mgmt/extsecur/ext_spcl_permissions.ksh DPDEV92 > /dev/null 2>&1

0,15,30,45 2-23 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPDEV92 > /dev/null

20 12 * * * ${HOME}/tls/space_usage.ksh DPDEV92 > /dev/null

25 12 * * * ${HOME}/aetna/db_mgmt/space/spacechk.ksh DPDEV92

01 04 * * * ${HOME}/aetna/db_mgmt/space/get_db_file_info.ksh DPDEV92 >/dev/null




17. Add sys and system accounts to eDMZ

18. Make note of current space

FUll size: 93,598 GB




**********Save backup for DPDRYRUN


connect catalog DPDRYRUN/DPDRYRUNnamr@RCATDEV


 run
5> {
6>  DELETE NOPROMPT OBSOLETE;
7> }


cd $BKPSCR


savebkp.ksh DPDRYRUN b4DataMasking


DPDRYRUN backup saved as DPDRYRUN_sbk_20161104_00:30:00_b4DataMasking.rman


15 16 * * * ${HOME}/aetna/db_mgmt/backup/expdp_full.ksh DPDRYRUN



## After Masking was done

$BKPSCR/start_archive.ksh


cd ${HOME}/aetna/db_mgmt/backup/dbbackup_rman DPDRYRUN



cd $BKPSCR


savebkp.ksh DPDRYRUN AfterMaskingB4Encryption


DPDRYRUN backup saved as DPDRYRUN_sbk_20161114_16:36:46_AfterMaskingB4Encryption.rman





-- Create new undo tablespace with smaller size.

SQL> create undo tablespace UNDO_RBS1 datafile 'undorbs1.dbf' size 100m;

 -- Set new tablespace as undo_tablespace

SQL> alter system set undo_tablespace=undo_rbs1;

 -- Drop the old tablespace.

SQL> drop tablespace undo_rbs0 including contents.




************

*****************DPDRYRUN --> DPPTEST

. ~/.profile

DPDRYRUN



#Fresh backup if needed

$BKPSCR/dbbackup_rman ${ORACLE_SID}






cd /u01/app/oracle/aetna/db_admin/db_DPDRYRUN/save_backup

view DPDRYRUN_sbk_20161219_07:47:33_b4Tax16e.rman

######Restore DataBase
#######connect target /
#######connect catalog DPUAT92/DPUAT92namr@RCATDEV
#######startup force nomount;
#######set DBID=2339979026;
#######reset database to incarnation 9702;
#######restore controlfile from 'c-2339979026-20160811-03_DPUAT92';
#######alter database mount;
#######run{
#######restore database until sequence 3761;
#######recover database until sequence 3761;
#######}
#######alter database open resetlogs;
#######End Restore DataBase


#Restore DataBase
connect target /
connect catalog DPDRYRUN/DPDRYRUNnamr@RCATDEV
startup force nomount;
set DBID=206085851;
reset database to incarnation 95264;
restore controlfile from 'c-206085851-20161219-00';
alter database mount;
run{
restore database from TAG=TAG20161219T075342;
recover database noredo;
}
alter database open resetlogs;
#End Restore DataBase




Create OEM blackout if DB already exist




DBArtisan - system/sysDPDRYRUN

select 'set newname for datafile '||file_id||' to '||chr(39)||replace(file_name,'DPUAT92','DPUATSRC')||chr(39)||';'
from   dba_data_files
order by file_name;


select 'set newname for tempfile '||file_id||' to '||chr(39)||replace(file_name,'DPUAT92','DPUATSRC')||chr(39)||';'
from   dba_temp_files
order by file_name;


select * from dba_data_files order by 1
 

/opt/u02/DPDRYRUN/
/opt/u05/DPDRYRUN/
/opt/u08/DPDRYRUN/
/opt/u09/DPDRYRUN/
/u05/oradata/DPDRYRUN/




select * from dba_temp_files order by 1


FILE_NAME
/opt/u04/DPDRYRUN/
/u04/oradata/DPDRYRUN/


select lf.group# grp,
  replace(member,'DPDRYRUN','DPPTEST') member,
   bytes/1024/1024 mbytes 
           from   v$logfile lf,
                  v$log l
           where  lf.group# = l.group#
                  order by lf.group#,
                           substr(lf.member,instr(lf.member,'/',-1) + 1);

MEMBER
/oraredologs/dpu21/DPPTEST/redo0101.log
/oraredologs/dpu22/DPPTEST/redo0102.log

/oraredologs/dpu21/DPPTEST/redo0201.log
/oraredologs/dpu22/DPPTEST/redo0202.log

/oraredologs/dpu21/DPPTEST/redo0301.log
/oraredologs/dpu22/DPPTEST/redo0302.log

/oraredologs/dpu21/DPPTEST/redo0401.log
/oraredologs/dpu22/DPPTEST/redo0402.log

/oraredologs/dpu21/DPPTEST/redo0501.log
/oraredologs/dpu22/DPPTEST/redo0502.log

/oraredologs/dpu21/DPPTEST/redo0601.log
/oraredologs/dpu22/DPPTEST/redo0602.log


   


select replace(name,'DPDRYRUN','DPPTEST') name  from v$controlfile



NAME
/oraredologs/dpu21/DPPTEST/control1DPPTEST.ctl
/oraredologs/dpu22/DPPTEST/control2DPPTEST.ctl
/oraredologs/dpu23/DPPTEST/control3DPPTEST.ctl





1. Create new folders if not already there

/u10/oradata/DPPTEST

mkdir /u10/oradata/DPPTEST





   



!! May not need.  Hold one with this owne.

### cd /u01/app/oracle/admin/
### mkdir DPDEV92
   
###   cd /u01/app/oracle/admin/DPDEV92
###   mkdir diag



   cd /u03/archlogs/
   mkdir DPPTEST
   
  cd /u10/oraback
  mkdir DPPTEST
  cd /u10/oraback/DPPTEST
  mkdir rman_backups



cd /u01/app/oracle/aetna/db_admin

cp -rp db_DPDRYRUN db_DPPTEST

cd db_DPPTEST
!!!cleanup all under db_db_DPPTEST


cd /orahome/u01/app/oracle/admin
mkdir DPPTEST
 
    



3. Copy init.ora file


sqlplus / as sysdba

create pfile from spfile;

CREATE PFILE='/orahome/u01/app/oracle/product/12.1.0.2/db_2/dbs/initDPDRYRUN.ora' FROM SPFILE;


  cd $ORACLE_HOME/dbs
  cp initDPDRYRUN.ora initDPPTEST.ora      



control_files = (/u10/oradata/DPPTEST/control1DPPTEST.ctl,/u10/oradata/DPPTEST/control2DPPTEST.ctl,/u10/oradata/DPPTEST/control3DPPTEST.ctl)
                 


/opt/u02/DPDRYRUN/
/opt/u05/DPDRYRUN/
/opt/u08/DPDRYRUN/
/opt/u09/DPDRYRUN/
/u05/oradata/DPDRYRUN/


/opt/u04/DPDRYRUN/
/u04/oradata/DPDRYRUN/


                 


/oraredologs/dpu21/DPDRYRUN/redo0101.log
/oraredologs/dpu22/DPDRYRUN/redo0102.log

/oraredologs/dpu21/DPPTEST/redo0201.log
/oraredologs/dpu22/DPPTEST/redo0202.log

/oraredologs/dpu21/DPPTEST/redo0301.log
/oraredologs/dpu22/DPPTEST/redo0302.log

/oraredologs/dpu21/DPPTEST/redo0401.log
/oraredologs/dpu22/DPPTEST/redo0402.log

/oraredologs/dpu21/DPPTEST/redo0501.log
/oraredologs/dpu22/DPPTEST/redo0502.log

/oraredologs/dpu21/DPPTEST/redo0601.log
/oraredologs/dpu22/DPPTEST/redo0602.log



*.db_file_name_convert='/opt/u02/DPDRYRUN/','/u10/oradata/DPPTEST/','/opt/u05/DPDRYRUN/','/u10/oradata/DPPTEST/','/opt/u08/DPDRYRUN/','/u10/oradata/DPPTEST/','/opt/u09/DPDRYRUN/','/u10/oradata/DPPTEST/','/u05/oradata/DPDRYRUN/','/u10/oradata/DPPTEST/','/u04/oradata/DPDRYRUN/','/u10/oradata/DPPTEST/','/opt/u04/DPDRYRUN/','/u10/oradata/DPPTEST/'
*.log_file_name_convert='/oraredologs/dpu21/DPDRYRUN/','/u10/oradata/DPPTEST/','/oraredologs/dpu22/DPDRYRUN/','/u10/oradata/DPPTEST/'


4. Create zopa file on AUX server (completed !!!)
  
   cd $ORACLE_HOME/dbs
   cp orapwDPDRYRUN orapwinitDPPTEST

5. Identify backupsets location.

   cd $SAVBKP

   










6. Add entry into oratab
   cd /etc
   vi oratab

  

DPPTEST:/orahome/u01/app/oracle/product/12.1.0.2/db_2:Y

   cd $HOME/aetna/scripts

   cp -p oraprof oraprof_20161219   

   vi oraprof

"DPPTEST")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;


7. setup new AUX env

   . ~/.profile

DPPTEST

sqlplus / as sysdba

shutdown immediate


8. 

   #Remove
 #  rm /u*/oradata/DPPTEST/*




  ls /u*/oradata/DPPTEST/*
  

  

9. Dupliicate...


    sqlplus / as sysdba
    startup pfile=/orahome/u01/app/oracle/product/12.1.0.2/db_2/dbs/initDPPTEST.ora force nomount;
    



rman
connect target sys/sysDPDRYRUN@DPDRYRUN
connect catalog DPDRYRUN/DPDRYRUNnamr@RCATDEV
connect AUXILIARY /







run {
duplicate target database to DPPTEST;
}










Cannot remove created server parameter file

10. cd $ORACLE_HOME/network/admin


netstat -an|grep 1629


vi listener.ora
DPPTEST=
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = dppqa)(PORT = 1629))
    (ADDRESS = (PROTOCOL = IPC) (KEY = DPPTEST_ipc))
  )

SID_LIST_DPPTEST=
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME =DPPTEST)
      (ORACLE_HOME = /orahome/u01/app/oracle/product/12.1.0.2/db_2)
      (SID_NAME =DPPTEST)
    )
  )

SECURE_REGISTER_DPPTEST=(IPC)

SUBSCRIBE_FOR_NODE_DOWN_EVENT_DPPTEST=OFF


lsnrctl stop DPPTEST
lsnrctl start DPPTEST

add entry into server tnsnames.ora


DPPTEST.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppqa)
          (Port = 1629)
        )
    )
    (CONNECT_DATA = (SID =DPPTEST)
    )
  )



11. Change sys zopas


Remove zopa function first

AI_zopa_VALIDATE



alter profile default limit zopa_VERIFY_FUNCTION null
/




ALTER USER system IDENTIFIED BY "sysDPPTEST"

/
ALTER USER sys IDENTIFIED BY "sysDPPTEST"

/


ALTER USER dpadmin IDENTIFIED BY "sysDPPTEST"

/

ALTER PROFILE DEFAULT LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/







12. Add new entry to Web Server oratab : xpsdppm1q, xpsdppw1q


DPPTEST:/orahome/psu01/oracle/product/12.1.0.2/client_64bit_dp1:N

cd /orahome/psu01/oracle/scripts
  cp -p oraprof oraprof_20160725

   vi oraprof

Add new entry
 
"DPPTEST")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;
   . ~/.profile

DPPTEST

cd $ORACLE_HOME/network/admin

vi tnsnames.ora




DPPTEST.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppqa)
          (Port = 1629)
        )
    )
    (CONNECT_DATA = (SID =DPPTEST)
    )
  )



Test: sqlplus

system/sysDPPTEST@DPPTEST




13. Setup Catalog in  RCATDEV database on XORACLDW2D Server

XORACLDW2D/ Bl0ckhe@d

SSH to XORACLDW2D Login as A id and su to oracle

. $SETUPENV RCATDEV

cd $ORACLE_BASE/local/scripts


create_catalog.ksh RCATDEV DPUATSRC DPUATSRCnamr



   . ~/.profile

DPUATSRC


>rman

connect catalog DPUATSRC/DPUATSRCnamr@RCATDEV

create catalog;

exit


>rman

connect target /

connect catalog DPUATSRC/DPUATSRCnamr@RCATDEV




register database;


report schema;

show all;

CONFIGURE RETENTION POLICY TO REDUNDANCY 10;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/u10/oraback/DPUATSRC/rman_backups/%F';
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F';
CONFIGURE DEVICE TYPE DISK PARALLELISM 2 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1; # default
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE SBT_TAPE TO 1; # default
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/u10/oraback/DPUATSRC/rman_backups/bkp_df%t_s%s_p%p';
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPUATSRC.opt)';
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPUATSRC/rman_backups/snapcf_DPUATSRC.f';





14. Make sure all files exist. Create one if needed.

cd $HOME

#make sure both file exists
cp .DPUAT92.pw .DPPTEST.pw
cp .DPUAT92_RMAN.pw .DPPTEST_RMAN.pw
cp .DPUAT92sys.pw .DPPTESTsys.pw
cp .DPUAT92_DPADMIN.pw .DPPTEST_DPADMIN.pw



15. Ask Storman to create /u01/app/oracle/tdpoopt/tdpo.DPUATSRC.opt


Test backup

Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}

Monitor backup

cd /u01/app/oracle/aetna/db_admin/db_DPUATSRC/log
tail -f xxx.log

Or/and 

Save backup
nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} initBackup

DPUATSRC backup saved as DPUATSRC_sbk_20160725_14:12:19_initBackup.rman

DPUATSRC backup saved as DPUATSRC_sbk_20160811_10:10:35_initBackup.rman


16. Recompile all.

select count(*)
from dba_objects
where status = 'INVALID';

41



###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


15. Recreate Log and exp dir if needed

##EXP_DUMP_DIR
###EXPORT_LOG_DIR


CREATE OR REPLACE DIRECTORY EXP_LOG_DIR AS '/u01/app/oracle/aetna/db_admin/db_DPPTEST/export/'
/
GRANT READ ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/


select file_name from dba_temp_files;

/u08/oradata/DPUAT92/temp01.dbf



alter database tempfile '/u08/oradata/DPUATSRC/temp01.dbf' drop;
ALTER TABLESPACE TEMP ADD TEMPFILE '/u08/oradata/DPUATSRC/temp01.dbf' SIZE 15000M reuse;

alter database tempfile '/u08/oradata/DPDRYRUN/tivoliortempts_01.dbf' drop;
ALTER TABLESPACE TEMP ADD TEMPFILE '/u08/oradata/DPUATSRC/tivoliortempts_01.dbf' SIZE 200M reuse;









16. Add new DB to OEM, add cron jobs and schedule backups


Email Rich Ryan to add database to OEM

Add crontabs jobs


crontab -e

List of all existing DPAUT91 jobs and add for DPDUAT92

45 19 * * * ${HOME}/aetna/db_mgmt/backup/expdp_full.ksh DPUAT92



00,20,40 0-20 * * * ${HOME}/aetna/scripts/verify_db_is_up.ksh DPUAT92
05,20,40 22 * * * ${HOME}/aetna/scripts/verify_db_is_up.ksh DPUAT92

15 23 * * * ${HOME}/aetna/db_mgmt/backup/rman_list_database.ksh DPUAT92

05 01 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_all.ksh DPUAT92
00 07 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_sjt_tables.ksh DPUAT92

0,15,30,45 0-23 * * * ${HOME}/aetna/db_mgmt/monitor/scan_oracle.ksh DPUAT92

30 12 * * * ${HOME}/tls/space_usage.ksh DPUAT92 > /dev/null
35 12 * * * ${HOME}/aetna/db_mgmt/space/spacechk.ksh DPUAT92

10 20 * * * ${HOME}/aetna/scripts/udump_trc_rename.ksh DPUAT92 > ${HOME}/aetna/db_admin/db_DPUAT92/log/DPUAT92_udump_trc_rename.out 2>&1

0,15,30,45 0-20 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPUAT92 > /dev/null
15,30,45 22 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPUAT92 > /dev/null

30 05 * * * ${HOME}/tls/check_undots.ksh DPUAT92 > /dev/null

20 05 * * 0 ${HOME}/aetna/db_mgmt/extsecur/ext_spcl_permissions.ksh DPUAT92 > /dev/null 2>&1


17. Add sys and system accounts to eDMZ

18. Make note of current space

19. 

    shutdown immediate
    startup

FUll size: 93,598 GB




********************************************

1. DPDRYRUN size - 355018 MB

2. Drop DATA_MASK tablepspace


--DDL just in case need to recreate

#CREATE TABLESPACE DATA_MASK
#    DATAFILE '/u05/oradata/DPDRYRUN/datamask_1.dbf' SIZE 15000M AUTOEXTEND OFF,
#             '/u05/oradata/DPDRYRUN/datamask_2.dbf' SIZE 10000M AUTOEXTEND OFF
#    EXTENT MANAGEMENT LOCAL AUTOALLOCATE
#    LOGGING
#    ONLINE
#    SEGMENT SPACE MANAGEMENT AUTO
#/




DROP TABLESPACE DATA_MASK INCLUDING CONTENTS AND DATAFILES CASCADE CONSTRAINTS

/





select count(*) from sys.aud$;
truncate table sys.aud$
purge recyclebin;




4. Turn Archive log backup


$BKPSCR/stop_archive.ksh

alter system switch logfile; 


5. Backup


. ~/.profile

DPDRYRUN








$BKPSCR/dbbackup_rman ${ORACLE_SID}




$BKPSCR/savebkp.ksh DPDRYRUN forDPDEV92dup_Latest


DPDRYRUN backup saved as DPDRYRUN_sbk_20170303_10:23:38_forDPDEV92dup_Latest.rman



cd /etc

set N for auto startup

shutdown immediate

lsnrctl stop DPDRYRUN





************ Duplicate DPDRYRUN to DPDEV92 ****************



OEM Blackout

cd $HOME/local/

deactivate_cron.ksh



. ~/.profile

DPDEV92

Save last backup just in case
cd $BKPSCR


savebkp.ksh DPDEV92 b4DRYRUNdup

DPDEV92 backup saved as DPDEV92_sbk_20170306_02:45:07_b4DRYRUNdup.rman


. ~/.profile

DPDRYRUN

Duplicate from saved backup of DPDRYRUN to existing DB DPDEV92

cd /u01/app/oracle/aetna/db_admin/db_DPDRYRUN/save_backup

#####DPDRYRUN_sbk_20170303_10:23:38_forDPDEV92dup_Latest.rman


#Restore DataBase
#connect target /
#connect catalog DPDRYRUN/DPDRYRUNnamr@RCATDEV
#startup force nomount;
#set DBID=206085851;
#reset database to incarnation 95264;
#restore controlfile from 'c-206085851-20170303-03';
#alter database mount;
#run{
#restore database until sequence 5534;
#recover database until sequence 5534;
#}
#alter database open resetlogs;
#End Restore DataBase



. ~/.profile

DPDRYRUN




select file_id,file_name from dba_data_files order by 2


FILE_NAME
/opt/u02/DPDRYRUN/audit.dbf 		- 11 GB
/opt/u05/DPDRYRUN/USERS01.dbf 		- 123 GB
/opt/u08/DPDRYRUN/hrlarge10.dbf         - 21 GB
/opt/u09/DPDRYRUN/psindex.dbf           -140 GB
/u05/oradata/DPDRYRUN/datamask_1.dbf    -37 GB 



select file_id,file_name  from dba_temp_files order by 1

FILE_NAME
/opt/u04/DPDRYRUN/temp01.dbf          -15GB
/u04/oradata/DPDRYRUN/psgtt01.dbf    - 1 GB



	   


select * from v$logfile


MEMBER
/oraredologs/dpu21/DPDRYRUN/redo0601.log
/oraredologs/dpu22/DPDRYRUN/redo0602.log

/oraredologs/dpu21/DPDRYRUN/redo0501.log
/oraredologs/dpu22/DPDRYRUN/redo0502.log

/oraredologs/dpu21/DPDRYRUN/redo0401.log
/oraredologs/dpu22/DPDRYRUN/redo0402.log

/oraredologs/dpu21/DPDRYRUN/redo0301.log
/oraredologs/dpu22/DPDRYRUN/redo0302.log

/oraredologs/dpu21/DPDRYRUN/redo0201.log
/oraredologs/dpu22/DPDRYRUN/redo0202.log

/oraredologs/dpu21/DPDRYRUN/redo0101.log
/oraredologs/dpu22/DPDRYRUN/redo0102.log
   


select * from v$controlfile

NAME
/oraredologs/dpu21/DPDRYRUN/control1DPDRYRUN.ctl
/oraredologs/dpu22/DPDRYRUN/control2DPDRYRUN.ctl
/oraredologs/dpu23/DPDRYRUN/control3DPDRYRUN.ctl







......>

On Dppdev side

. ~/.profile

DPDEV92



1. Create new folders unless it already there.



select file_id,file_name from dba_data_files order by 2

FILE_NAME
/u02/oradata/DPDEV92/USERS01.dbf                 84 +31 = 115
/u05/oradata/DPDEV92/aalarge1.dbf                 103+37 = 140
/u09/oradata/DPDEV92/eolarge.dbf                  93 + 38 = 131





select file_id,file_name  from dba_temp_files order by 1



FILE_NAME
/u09/oradata/DPDEV92/temp01.dbf



select * from v$logfile



MEMBER
/oraredologs/dpu22/DPDEV92/redo0602.log
/oraredologs/dpu21/DPDEV92/redo0601.log

/oraredologs/dpu21/DPDEV92/redo0501.log
/oraredologs/dpu22/DPDEV92/redo0502.log

/oraredologs/dpu21/DPDEV92/redo0401.log
/oraredologs/dpu22/DPDEV92/redo0402.log

/oraredologs/dpu21/DPDEV92/redo0301.log
/oraredologs/dpu22/DPDEV92/redo0302.log

/oraredologs/dpu22/DPDEV92/redo0202.log
/oraredologs/dpu21/DPDEV92/redo0201.log

/oraredologs/dpu21/DPDEV92/redo0101.log
/oraredologs/dpu22/DPDEV92/redo0102.log


select * from v$controlfile


NAME
/oraredologs/dpu21/DPDEV92/control1DPDEV92.ctl
/oraredologs/dpu22/DPDEV92/control2DPDEV92.ctl
/oraredologs/dpu23/DPDEV92/control3DPDEV92.ctl


cd /u02/oradata
mkdir DPDEV92 
cd /u05/oradata
mkdir DPDEV92
cd /u09/oradata
mkdir DPDEV92
cd /u08/oradata
mkdir DPDEV92


   
   cd /oraredologs/dpu21/
   mkdir DPDEV92

   cd /oraredologs/dpu22
   mkdir DPDEV92



!! May not need.  Hold one with this owne.
   cd /u01/app/oracle/admin/
   mkdir DPDEV92
   
   cd /u01/app/oracle/admin/DPDEV92
    mkdir diag

   cd /u03/archlogs/
   mkdir DPDEV92
   
  cd /u10/oraback
  mkdir DPDEV92
  cd /u10/oraback/DPDEV92
  mkdir rman_backups



cd /u01/app/oracle/aetna/db_admin

cp -rp db_DPDEV91 db_DPDEV92

cleanup all under db_DPDEV92


cd /orahome/u01/app/oracle/admin
mkdir DPDEV92
 
    


3. Copy init.ora file


if DPDEV92 existing Database just do this

sqlplus / as sysdba

create pfile from spfile;


  ###cd $ORACLE_HOME/dbs
  ###cp initDPDEV91.ora initDPDEV92.ora      



Currently:

*.db_file_name_convert='/u02/oradata/DPDEV91/','/u02/oradata/DPDEV92/','/u05/oradata/DPDEV91/','/u05/oradata/DPDEV92/','/u09/oradata/DPDEV91/','/u09/oradata/DPDEV92/'

*.log_file_name_convert='/oraredologs/dpu21/DPDEV91/','/oraredologs/dpu21/DPDEV92/','/oraredologs/dpu22/DPDEV91/','/oraredologs/dpu22/DPDEV92/'


New:




/u05/oradata/DPDRYRUN/psmatvw.dbf - 1 GB
/u04/oradata/DPDRYRUN/psgtt01.dbf - 1 GB


/opt/u04/DPDRYRUN/temp01.dbf - 5

/opt/u02/DPDRYRUN/audit.dbf - 10
/opt/u08/DPDRYRUN/hrlarge10.dbf - 23 
/opt/u05/DPDRYRUN/USERS01.dbf - 122
/opt/u09/DPDRYRUN/psindex06.dbf - 140


dppqa


FILE_NAME
	/opt/u02/DPDRYRUN/audit.dbf 		- 11 GB
	/opt/u05/DPDRYRUN/USERS01.dbf 		- 123 GB
	/opt/u08/DPDRYRUN/hrlarge10.dbf         - 21 GB
	/opt/u09/DPDRYRUN/psindex.dbf           -140 GB
/u05/oradata/DPDRYRUN/datamask_1.dbf    -37 GB 



select file_id,file_name  from dba_temp_files order by 1

FILE_NAME
/opt/u04/DPDRYRUN/temp01.dbf          -15GB
/u04/oradata/DPDRYRUN/psgtt01.dbf    - 1 GB


dppdev
FILE_NAME
/u02/oradata/DPDEV92/USERS01.dbf                 84 +31 = 115
/u05/oradata/DPDEV92/aalarge1.dbf                 103+37 = 140
/u09/oradata/DPDEV92/eolarge.dbf                  93 + 38 = 131






/opt/u04/DPDRYRUN/','/u09/oradata/DPDEV92/',/u05/oradata/DPDRYRUN/','/u09/oradata/DPDEV92/',/u04/oradata/DPDRYRUN/','/u09/oradata/DPDEV92/'

/u09/oradata/DPDEV92/eolarge.dbf - 99 GB + 31 GB = 130 GB


/u02/oradata/DPDEV92/USERS01.dbf - 84 GB + 30 GB = 114 GB
/u05/oradata/DPDEV92/aalarge1.dbf - 104 GB + 36 GB = 140 GB
/u08/oradata/DPDEV92 - 164 GB




/oraredologs/dpu21/DPDRYRUN/redo0601.log
/oraredologs/dpu22/DPDRYRUN/redo0602.log



/oraredologs/dpu22/DPDEV92/redo0602.log
/oraredologs/dpu21/DPDEV92/redo0601.log



*.db_file_name_convert='/opt/u09/DPDRYRUN/','/u08/oradata/DPDEV92/','/opt/u05/DPDRYRUN/','/u05/oradata/DPDEV92/','/opt/u08/DPDRYRUN/','/u02/oradata/DPDEV92/','/opt/u02/DPDRYRUN/','/u09/oradata/DPDEV92/','/opt/u04/DPDRYRUN/','/u09/oradata/DPDEV92/','/u05/oradata/DPDRYRUN/','/u09/oradata/DPDEV92/','/u04/oradata/DPDRYRUN/','/u09/oradata/DPDEV92/'

*.log_file_name_convert='/oraredologs/dpu21/DPDRYRUN/','/oraredologs/dpu21/DPDEV92/','/oraredologs/dpu22/DPDRYRUN/','/oraredologs/dpu22/DPDEV92/'

-- All set no changes
*.control_files='/oraredologs/dpu21/DPDEV92/control1DPDEV92.ctl','/oraredologs/dpu22/DPDEV92/control2DPDEV92.ctl','/oraredologs/dpu23/DPDEV92/control3DPDEV92.ctl'





4. Create zopa file on AUX server (completed !!!)
  
   cd $ORACLE_HOME/dbs
   cp orapwDPDEV91 orapwDPDEV92

5. Identify backupsets location.

   cd $SAVBKP

   





6. Add entry into oratab
   cd /etc
   vi oratab

  
DPDEV92:/orahome/u01/app/oracle/product/12.1.0.2/db_1:Y


   cd $HOME/aetna/scripts

   cp -p oraprof oraprof_20160418   

   vi oraprof

"DPDEV92")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;


7. setup new AUX env

   . ~/.profile

DPDEV92



Save Rman settings

rman
connect target /
connect catalog DPDEV92/DPDEV92namr@RCATDEV

show all;

RMAN configuration parameters for database with db_unique_name DPDEV92 are:
CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 30 DAYS;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/u10/oraback/DPDEV92/rman_backups/%F';

CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F_%d';
CONFIGURE DEVICE TYPE DISK PARALLELISM 4 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/u10/oraback/DPDEV92/rman_backups/bkp_df%t_s%s_s%p';

CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDEV92.opt)';

CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default

CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPDEV92/rman_backups/snapcf_DPDEV92.f';


Copy .opt file from DPPQA to DPPDEV server

Login to DPPQA

cd /u01/app/oracle/tdpoopt

scp tdpo.DPDRYRUN.opt dppdev:/u01/app/oracle/tdpoopt/tdpo.DPDRYRUN.opt 


Login back to dppdev and test TDP stuff


Add following into tnsnames.ora

DPDRYRUN.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppqa)
          (Port = 1596)
        )
    )
    (CONNECT_DATA = (SID =DPDRYRUN)
    )
  )



   rman
   
   connect target sys/sysDPDRYRUN@DPDRYRUN
   connect catalog DPDRYRUN/DPDRYRUNnamr@RCATDEV
   connect AUXILIARY /
   run{
     allocate auxiliary channel t1 TYPE 'SBT_TAPE' PARMS 'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDRYRUN.opt)';
     release channel t1;
   } 






sqlplus / as sysdba

shutdown immediate;
exit

lsnrctl stop DPDEV92

cd $ORACLe_HOME/dbs

mv spfileDPDEV92.ora spfileDPDEV92.ora.20170306




!!! Encryption steps

a. Create wallet dir on DPDEV92 if not already there
b. Copy DPDRYRUN zopa file over there.


8. 

   #Remove
 #  rm /u*/oradata/DPDEV92/*




  ls /u*/oradata/DPDEV92/*
  

  

9. Dupliicate...


#Restore DataBase
#connect target /
#connect catalog DPDRYRUN/DPDRYRUNnamr@RCATDEV
#startup force nomount;
#set DBID=206085851;
#reset database to incarnation 95264;
#restore controlfile from 'c-206085851-20170303-03';
#alter database mount;
#run{
#restore database until sequence 5534;
#recover database until sequence 5534;
#}
#alter database open resetlogs;
#End Restore DataBase




    sqlplus / as sysdba
    startup pfile=/orahome/u01/app/oracle/product/12.1.0.2/db_1/dbs/initDPDEV92.ora force nomount;
    



rman
   connect target sys/sysDPDRYRUN@DPDRYRUN
   connect catalog DPDRYRUN/DPDRYRUNnamr@RCATDEV
   connect AUXILIARY /





run {
allocate auxiliary channel t1 TYPE 'SBT_TAPE' PARMS 'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDRYRUN.opt)';
set until sequence 5534;
duplicate target database to DPDEV92;
}





Cannot remove created server parameter file

10. cd $ORACLE_HOME/network/admin

vi listener.ora

DPDEV92 =
  (DESCRIPTION =
    (ADDRESS= (PROTOCOL= IPC)(KEY= DPDEV92_ipc))
    (ADDRESS = (PROTOCOL = TCP)(HOST = dppdev)(PORT = 1695))
  )

SID_LIST_DPDEV92 =
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME = DPDEV92)
      (ORACLE_HOME = /orahome/u01/app/oracle/product/12.1.0.2/db_1)
      (SID_NAME = DPDEV92)
    )
  )

SECURE_REGISTER_DPDEV92 = (IPC)

SUBSCRIBE_FOR_NODE_DOWN_EVENT_DPDEV92=OFF

!! Remove DBACOUT entry...




11. Change sys zopas


Remove zopa function first

AI_zopa_VALIDATE

fje4tAq#

alter profile STANDARD limit zopa_VERIFY_FUNCTION null
/

alter profile DEFAULT limit zopa_VERIFY_FUNCTION null
/



ALTER USER system IDENTIFIED BY "sysdpdev92"

/
ALTER USER sys IDENTIFIED BY "sysdpdev92"

/


ALTER USER dpadmin IDENTIFIED BY "bpsdpdev92"

/

ALTER PROFILE STANDARD LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/

ALTER PROFILE DEFAULT  LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/







12. Add new entry to Web Server oratab : xpsdppw2d

DPDEV92:/orahome/psu01/oracle/product/12.1.0.2/client_64bit_dp1:N

cd /orahome/psu01/oracle/scripts
  cp -p oraprof oraprof_20160418 

   vi oraprof

Add DPBCKOUT entry to oraprof
 
"DPDEV92")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;
   . ~/.profile

DPDEV92

cd $ORACLE_HOME/network/admin

vi tnsnames.ora

DPDEV92.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppdev)
          (Port = 1695)
        )
    )
    (CONNECT_DATA = (SID = DPDEV92)
    )
  )



Test: sqlplus

system/sysdpdev92@DPDEV92




13. Setup Catalog in  RCATDEV database on XORACLDW2D Server

XORACLDW2D/ Bl0ckhe@d

SSH to XORACLDW2D Login as A id and su to oracle

##cd /u01/app/oracle/admin/RCATDEV/sql

cd $ORACLE_BASE/local/scripts


create_catalog.ksh RCATDEV DPDEV92 DPDEV92namr



   . ~/.profile

DPDEV92


>rman

connect catalog DPDEV92/DPDEV92namr@RCATDEV

create catalog;

exit


>rman

connect target /

connect catalog DPDEV92/DPDEV92namr@RCATDEV




register database;


report schema;


RMAN configuration parameters for database with db_unique_name DPDEV92 are:
CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 30 DAYS;
CONFIGURE BACKUP OPTIMIZATION OFF; # default
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/u10/oraback/DPDEV92/rman_backups/%F';
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F_%d';
CONFIGURE DEVICE TYPE DISK PARALLELISM 4 BACKUP TYPE TO COMPRESSED BACKUPSET;
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
CONFIGURE CHANNEL DEVICE TYPE DISK FORMAT   '/u10/oraback/DPDEV92/rman_backups/bkp_df%t_s%s_s%p';
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDEV92.opt)';
CONFIGURE MAXSETSIZE TO UNLIMITED; # default
CONFIGURE ENCRYPTION FOR DATABASE OFF; # default
CONFIGURE ENCRYPTION ALGORITHM 'AES128'; # default
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE ; # default
CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS; # default
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE; # default
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPDEV92/rman_backups/snapcf_DPDEV92.f';



14. Make sure all files exist. Create one if needed.

cd $HOME

#make sure both file exists
cp .DPDEV91.pw .DPDEV92.pw
cp .DPDEV91_RMAN.pw .DPDEV92_RMAN.pw
cp .DPDEV91sys.pw .DPDEV92sys.pw
cp .DPDEV91_DPADMIN.pw .DPDEV92_DPADMIN.pw



15. Ask Storman to create /u01/app/oracle/tdpoopt/tdpo.DPDEV92.opt


Test backup

Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}

Monitor backup

cd /u01/app/oracle/aetna/db_admin/db_DPDEV92/log
tail -f xxx.log

Or/and 

Save backup
nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} DupFromDryRUN_1




16. Recompile all.

select count(*)
from dba_objects
where status = 'INVALID';

41



###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


15. Recreate Log and exp dir if needed

##EXP_DUMP_DIR
###EXPORT_LOG_DIR


CREATE OR REPLACE DIRECTORY EXP_LOG_DIR AS '/u01/app/oracle/aetna/db_admin/db_DPDEV92/export/'
/
GRANT READ ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/


16. Add new DB to OEM, add cron jobs and schedule backups








17. !!! Encryption steps



3. Encrypt DPDRYRUN


###See File encryption_DPDRYRUN.txt
     

encryption_DPDEV92.txt


Query table with 

## Make sure it shows correct path
select * from V$ENCRYPTION_WALLET;
select * from DBA_ENCRYPTED_COLUMNS;



extract DDL from SYSADM.PS_YE_W2CP_DATA to make sure encryption there

select * from SYSADM.PS_YE_W2CP_DATA


SQL> show parameter _ignore_desc_in_index

NAME                                 TYPE        VALUE
------------------------------------ ----------- --------
_ignore_desc_in_index                boolean     FALSE


alter system set "_ignore_desc_in_index" = TRUE SCOPE=BOTH;

--Unlock if needed
ALTER USER BENENG ACCOUNT UNLOCK
/
      

     


18. Readjust Security , DB LINKS, DIR....

See file for reference

DPDEV92_security_extract_preDRYRUN.txt



DPDEV92 backup saved as DPDEV92_sbk_20170306_15:32:10_afterDRYRUN.rman

19. Stop OEM blackout


cd $HOME/local

	crontab crontab_b4_aixpatch.lst


Email Rich Ryan to add database to OEM

Add crontabs jobs
50 19 * * * ${HOME}/aetna/db_mgmt/backup/expdp_full_new.ksh DPDEV92

30 03 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_all.ksh DPDEV92

00 07 * * * ${HOME}/aetna/db_mgmt/analyze/analyze_sjt_tables.ksh DPDEV92

00,20,40 2-23 * * * ${HOME}/aetna/scripts/verify_db_is_up.ksh DPDEV92

0,15,30,45 0-23 * * * ${HOME}/aetna/db_mgmt/monitor/scan_oracle.ksh DPDEV92

15 23 * * * ${HOME}/aetna/db_mgmt/backup/rman_list_database.ksh DPDEV92

05 05 * * 0 ${HOME}/aetna/db_mgmt/extsecur/ext_spcl_permissions.ksh DPDEV92 > /dev/null 2>&1

0,15,30,45 2-23 * * * ${HOME}/aetna/scripts/heartbeat.ksh DPDEV92 > /dev/null

20 12 * * * ${HOME}/tls/space_usage.ksh DPDEV92 > /dev/null

25 12 * * * ${HOME}/aetna/db_mgmt/space/spacechk.ksh DPDEV92

01 04 * * * ${HOME}/aetna/db_mgmt/space/get_db_file_info.ksh DPDEV92 >/dev/null




17. Add sys and system accounts to eDMZ

18. Make note of current space

FUll size: 93,598 GB




!! Later on that week

Retire DPDRYRUN including removing old RMAN saved backups


***** Restore DPDEV92 from saved backup************


DPDEV92 backup saved as DPDEV92_sbk_20170120_02:45:03_b4tax17A.rman


cd $SAVBKP

view DPDEV92_sbk_20170120_02:45:03_b4tax17A.rman

#Restore DataBase
#connect target /
#connect catalog DPDEV92/DPDEV92namr@RCATDEV
#startup force nomount;
#set DBID=2215358295;
#reset database to incarnation 28672;
#restore controlfile from 'c-2215358295-20170120-01_DPDEV92';
#alter database mount;
#run{
#restore database until sequence 3471;
#recover database until sequence 3471;
#}
#alter database open resetlogs;
#End Restore DataBase



Login to DBArtisan and run following queries

select file_id,file_name from dba_data_files order by 2



cd 
FILE_NAME
FILE_NAME
/u02/oradata/DPDEV92/USERS01.dbf
/u02/oradata/DPDEV92/bnapp.dbf
/u02/oradata/DPDEV92/bnlarge.dbf
/u02/oradata/DPDEV92/fsapp.dbf
/u02/oradata/DPDEV92/giapp.dbf
/u02/oradata/DPDEV92/glapp.dbf
/u02/oradata/DPDEV92/gpapp.dbf
/u02/oradata/DPDEV92/hrapp.dbf
/u02/oradata/DPDEV92/hrlarge.dbf
/u02/oradata/DPDEV92/htapp.dbf
/u02/oradata/DPDEV92/inapp.dbf
/u02/oradata/DPDEV92/omapp.dbf
/u02/oradata/DPDEV92/paapp.dbf
/u02/oradata/DPDEV92/palarge.dbf
/u02/oradata/DPDEV92/piapp.dbf
/u02/oradata/DPDEV92/pilarge.dbf
/u02/oradata/DPDEV92/psimage.dbf
/u02/oradata/DPDEV92/psimage2_1.dbf
/u02/oradata/DPDEV92/psimage2_2.dbf
/u02/oradata/DPDEV92/psimage2_3.dbf
/u02/oradata/DPDEV92/psimage2_4.dbf
/u02/oradata/DPDEV92/psimage2_5.dbf
/u02/oradata/DPDEV92/psindex.dbf
/u02/oradata/DPDEV92/psindex01.dbf
/u02/oradata/DPDEV92/psindex02.dbf
/u02/oradata/DPDEV92/psindex03.dbf
/u02/oradata/DPDEV92/psundots.dbf
/u02/oradata/DPDEV92/ptapp.dbf
/u02/oradata/DPDEV92/ptprc.dbf
/u02/oradata/DPDEV92/system01.dbf
/u05/oradata/DPDEV92/aaapp1.dbf
/u05/oradata/DPDEV92/aalarge1.dbf
/u05/oradata/DPDEV92/adapp1.dbf
/u05/oradata/DPDEV92/aidba.dbf
/u05/oradata/DPDEV92/amapp.dbf
/u05/oradata/DPDEV92/avapp1.dbf
/u05/oradata/DPDEV92/bdapp.dbf
/u05/oradata/DPDEV92/bpapp.dbf
/u05/oradata/DPDEV92/ccapp1.dbf
/u05/oradata/DPDEV92/coapp.dbf
/u05/oradata/DPDEV92/cuaudit.dbf
/u05/oradata/DPDEV92/cularg1.dbf
/u05/oradata/DPDEV92/cularg2.dbf
/u05/oradata/DPDEV92/cularg3.dbf
/u05/oradata/DPDEV92/cularge.dbf
/u05/oradata/DPDEV92/dbtune.dbf
/u05/oradata/DPDEV92/diapp.dbf
/u05/oradata/DPDEV92/eoapp.dbf
/u05/oradata/DPDEV92/eobfapp1.dbf
/u05/oradata/DPDEV92/eocfapp1.dbf
/u05/oradata/DPDEV92/eocmapp.dbf
/u05/oradata/DPDEV92/eocmlrg.dbf
/u05/oradata/DPDEV92/eocmwrk.dbf
/u05/oradata/DPDEV92/eocuapp.dbf
/u05/oradata/DPDEV92/eoculrg.dbf
/u05/oradata/DPDEV92/eoditbl.dbf
/u05/oradata/DPDEV92/eodsapp.dbf
/u05/oradata/DPDEV92/eodslrg.dbf
/u05/oradata/DPDEV92/eoecapp.dbf
/u05/oradata/DPDEV92/eoeclrg.dbf
/u05/oradata/DPDEV92/eoecwrk.dbf
/u05/oradata/DPDEV92/eoeiapp.dbf
/u05/oradata/DPDEV92/eoeilrg.dbf
/u05/oradata/DPDEV92/eoewapp.dbf
/u05/oradata/DPDEV92/eoewlrg.dbf
/u05/oradata/DPDEV92/eoewwrk.dbf
/u05/oradata/DPDEV92/eoiuapp.dbf
/u05/oradata/DPDEV92/eoiulrg.dbf
/u05/oradata/DPDEV92/eoiuwrk.dbf
/u05/oradata/DPDEV92/eoltapp1.dbf
/u05/oradata/DPDEV92/eoppapp1.dbf
/u05/oradata/DPDEV92/eopplrg1.dbf
/u05/oradata/DPDEV92/faapp1.dbf
/u05/oradata/DPDEV92/falarge1.dbf
/u05/oradata/DPDEV92/hrapp71.dbf
/u05/oradata/DPDEV92/hrsapp1.dbf
/u05/oradata/DPDEV92/hrslarge1.dbf
/u05/oradata/DPDEV92/hrswork1.dbf
/u05/oradata/DPDEV92/psdefault.dbf
/u05/oradata/DPDEV92/psimgr.dbf
/u05/oradata/DPDEV92/psindex06.dbf
/u05/oradata/DPDEV92/psmatvw.dbf
/u05/oradata/DPDEV92/pstemp01.dbf
/u05/oradata/DPDEV92/pswork.dbf
/u05/oradata/DPDEV92/ptamsg.dbf
/u05/oradata/DPDEV92/ptappe.dbf
/u05/oradata/DPDEV92/ptaudit.dbf
/u05/oradata/DPDEV92/ptcmstar.dbf
/u05/oradata/DPDEV92/ptlock.dbf
/u05/oradata/DPDEV92/ptprjwk.dbf
/u05/oradata/DPDEV92/ptrpts.dbf
/u05/oradata/DPDEV92/pttbl.dbf
/u05/oradata/DPDEV92/pttlrg.dbf
/u05/oradata/DPDEV92/pttree.dbf
/u05/oradata/DPDEV92/ptwork.dbf
/u05/oradata/DPDEV92/pyapp.dbf
/u05/oradata/DPDEV92/pylarge.dbf
/u05/oradata/DPDEV92/pylarge02.dbf
/u05/oradata/DPDEV92/saapp1.dbf
/u05/oradata/DPDEV92/sacapp1.dbf
/u05/oradata/DPDEV92/salarge1.dbf
/u05/oradata/DPDEV92/srapp1.dbf
/u05/oradata/DPDEV92/stapp.dbf
/u05/oradata/DPDEV92/stlarge.dbf
/u05/oradata/DPDEV92/sysaux01.dbf
/u05/oradata/DPDEV92/sysaux02.dbf
/u05/oradata/DPDEV92/tivoliorts01.dbf
/u05/oradata/DPDEV92/tlapp.dbf
/u05/oradata/DPDEV92/tllarge.dbf
/u09/oradata/DPDEV92/eolarge.dbf
/u09/oradata/DPDEV92/eotpapp.dbf
/u09/oradata/DPDEV92/eotplrg.dbf
/u09/oradata/DPDEV92/epapp.dbf
/u09/oradata/DPDEV92/eplarge.dbf
/u09/oradata/DPDEV92/erapp.dbf
/u09/oradata/DPDEV92/erlarge.dbf
/u09/oradata/DPDEV92/erwork.dbf
/u09/oradata/DPDEV92/fgapp.dbf
/u09/oradata/DPDEV92/gpdeapp.dbf
/u09/oradata/DPDEV92/hpapp.dbf
/u09/oradata/DPDEV92/hrapp1.dbf
/u09/oradata/DPDEV92/hrapp2.dbf
/u09/oradata/DPDEV92/hrapp3.dbf
/u09/oradata/DPDEV92/hrapp4.dbf
/u09/oradata/DPDEV92/hrapp5.dbf
/u09/oradata/DPDEV92/hrapp6.dbf
/u09/oradata/DPDEV92/hrlarge02.dbf
/u09/oradata/DPDEV92/hrlarge03.dbf
/u09/oradata/DPDEV92/hrwork.dbf
/u09/oradata/DPDEV92/knsapp.dbf
/u09/oradata/DPDEV92/pcapp.dbf
/u09/oradata/DPDEV92/pclarge.dbf
/u09/oradata/DPDEV92/piwork.dbf
/u09/oradata/DPDEV92/poapp.dbf
/u09/oradata/DPDEV92/psindex04.dbf
/u09/oradata/DPDEV92/psindex05.dbf
/u09/oradata/DPDEV92/psindex07.dbf
/u09/oradata/DPDEV92/psundots_02.dbf
/u09/oradata/DPDEV92/pvapp.dbf
/u09/oradata/DPDEV92/py0lrg.dbf
/u09/oradata/DPDEV92/pylarge03.dbf
/u09/oradata/DPDEV92/pylarge04.dbf
/u09/oradata/DPDEV92/pywork.dbf
/u09/oradata/DPDEV92/stwork.dbf
/u09/oradata/DPDEV92/tlwork.dbf
/u09/oradata/DPDEV92/waapp.dbf

select file_id,file_name  from dba_temp_files order by 1
FILE_NAME
/u09/oradata/DPDEV92/temp01.dbf
/u09/oradata/DPDEV92/tivoliortempts_01.dbf
/u09/oradata/DPDEV92/psgtt01.dbf


select * from v$logfile


MEMBER

MEMBER
/oraredologs/dpu22/DPDEV92/redo0602.log
/oraredologs/dpu21/DPDEV92/redo0601.log
/oraredologs/dpu21/DPDEV92/redo0501.log
/oraredologs/dpu22/DPDEV92/redo0502.log
/oraredologs/dpu21/DPDEV92/redo0401.log
/oraredologs/dpu22/DPDEV92/redo0402.log
/oraredologs/dpu21/DPDEV92/redo0301.log
/oraredologs/dpu22/DPDEV92/redo0302.log
/oraredologs/dpu22/DPDEV92/redo0202.log
/oraredologs/dpu21/DPDEV92/redo0201.log
/oraredologs/dpu21/DPDEV92/redo0101.log
/oraredologs/dpu22/DPDEV92/redo0102.log

select * from v$controlfile
NAME
/oraredologs/dpu21/DPDEV92/control1DPDEV92.ctl
/oraredologs/dpu22/DPDEV92/control2DPDEV92.ctl
/oraredologs/dpu23/DPDEV92/control3DPDEV92.ctl

psmatvw.dbf 




Create OEM Blackout




cd $HOME/local/

deactivate_cron.ksh


sqlplus / as sysdba

shutdown immediate

exit




cd /u02/oradata/DPDEV92/

rm -f *.dbf

cd /u05/oradata/DPDEV92/

rm -f *.dbf

cd /u09/oradata/DPDEV92/

rm -f *.dbf



#Restore DataBase
rman
connect target /
connect catalog DPDEV92/DPDEV92namr@RCATDEV
startup force nomount;
set DBID=2215358295;
reset database to incarnation 28672;
restore controlfile from 'c-2215358295-20170120-01_DPDEV92';
alter database mount;
run{
restore database until sequence 3471;
recover database until sequence 3471;
}
alter database open resetlogs;


#End Restore DataBase


lsnrctl stop DPDEV92
lsnrctl start DPDEV92








cd $HOME/local

crontab crontab_b4_aixpatch.lst


End OEM Blackout



###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';




Query table with 

## Make sure it shows correct path
select * from V$ENCRYPTION_WALLET;
select * from DBA_ENCRYPTED_COLUMNS;



extract DDL from SYSADM.PS_YE_W2CP_DATA to make sure encryption there

select * from SYSADM.PS_YE_W2CP_DATA




*******Retire DPDRYRUN**********************


. ~/.profile


DPDRYRUN


1. Run backup and saved




Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}



cd $BKPSCR
savebkp.ksh DPDRYRUN b4finalShutdown

DPUAT91 backup saved as DPUAT91_sbk_20161025_08:11:39_b4finalShutdown.rman



2. Remove Old Saved backups. See file Removes_saved_backups.txt

   ! You may need manually delete OS Backup jobs from OEM

3. Black out in OEM


4. Check Files location


select file_id,file_name from dba_data_files order by 2

FILE_NAME
/opt/u02/DPDRYRUN/audit.dbf - 10 GB
/opt/u05/DPDRYRUN/aalarge1.dbf- 125 GB
/opt/u08/DPDRYRUN/hrlarge10.dbf -21 GB
/opt/u09/DPDRYRUN/psindex.dbf  -144 GB
/u05/oradata/DPDRYRUN/pylarge12.dbf - 12 GB


select file_id,file_name  from dba_temp_files order by 1


FILE_NAME
/opt/u04/DPDRYRUN/temp01.dbf - 15 GB
/u04/oradata/DPDRYRUN/psgtt01.dbf - 1 GB


select * from v$logfile

MEMBER
/oraredologs/dpu21/DPDRYRUN/redo0501.log
/oraredologs/dpu22/DPDRYRUN/redo0502.log


select * from v$controlfile

NAME
/oraredologs/dpu21/DPDRYRUN/control1DPDRYRUN.ctl
/oraredologs/dpu22/DPDRYRUN/control2DPDRYRUN.ctl
/oraredologs/dpu23/DPDRYRUN/control3DPDRYRUN.ctl


archive log list;

SQL> archive log list;
Database log mode              Archive Mode
Automatic archival             Enabled
Archive destination            /u03/archlogs/DPDRYRUN/
Oldest online log sequence     5531
Next log sequence to archive   5536
Current log sequence           5536



5. Shutdown

sqlplus / as sysdba

shutdown immediate
exit

lsnrctl stop DPDRYRUN


6. Remove or comment out any crontab jobs for DPUAT91

7. Set oratab to N


8. Disable DB entry in ICR


in 2 weeks

9. Remove target from OEM

10. Remove all files form OS



*******************************



DPDRYRUN

select file_id,file_name from dba_data_files order by 2


FILE_NAME
/opt/u02/DPDRYRUN/audit.dbf 		- 11 GB
/opt/u05/DPDRYRUN/USERS01.dbf 		- 123 GB
/opt/u08/DPDRYRUN/hrlarge10.dbf         - 21 GB
/opt/u09/DPDRYRUN/psindex.dbf           -140 GB
/u05/oradata/DPDRYRUN/datamask_1.dbf    -37 GB 



select file_id,file_name  from dba_temp_files order by 1

FILE_NAME
/opt/u04/DPDRYRUN/temp01.dbf          -15GB
/u04/oradata/DPDRYRUN/psgtt01.dbf    - 1 GB




DPDEV92

select file_id,file_name from dba_data_files order by 2

FILE_NAME
                                                    FREE (GB)

/u02/oradata/DPDEV92/                  - 180.00     86.71   52%
/u05/oradata/DPDEV92/		       - 194.00      6.38   97%     
/u08/oradata/DPDEV92/		        -165.00     24.33   86%       
/u09/oradata/DPDEV92/    		-190.00     98.97   48%      






DPDEVUG

FILE_NAME
/u02/oradata/DPDEVUG/ - 33 GB
/u05/oradata/DPDEVUG/ - 28 GB
/u09/oradata/DPDEVUG/ - 30 GB




		  	    FREE

/u04   		- 125.00    124.88  + 140 + 75 + 120   

/u06   		- 145.00    144.87   
/u07   		- 80.00     79.99    
/opt/u11 	- 149.00    124.69



/dev/u04lv       125.00    124.88    
/dev/u06lv       145.00    144.87   


Could you please re allocate some space on dppdev server

Add 140 GB from /u06 to /u04
Add 75 GB  from /u07 to /u04
Add 120 GB from /opt/u11 to /u04

1. Re allocate space.

2. Re build DPDEVUG over to /u04

3. This will free up space on DPDEV92 mount points.




*********Duplicate DPDEV92 to DPDEVUG (new mount points on same server)***************





**********Restore DPDEVUG from SavedBackup*******************


. ~/.profile

cd $SAVBKP

view DPDEVUG_sbk_20170321_09:10:13_b4Reorg.rman


#Restore DataBase
connect target /
connect catalog DPDEVUG/DPDEVUGnamr@RCATDEV
startup force nomount;
set DBID=3355995194;
reset database to incarnation 509379;
restore controlfile from 'c-3355995194-20170321-00_DPDEVUG';
alter database mount;
run{
restore database from TAG=TAG20170321T091146;
recover database noredo;
}
alter database open resetlogs;
#End Restore DataBase


###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';

********************DataFiles Reorg (move to different mount point) ******************************************


While the database is mounted, but not open, just move the files and do


1. sqlplus / as sysdba

shutdown immediate

STARTUP MOUNT

not open

2. Physically copy files over to /u04




cp -p /u02/oradata/DPDEVUG/USERS01.dbf /u04/oradata/DPDEVUG/USERS01.dbf
cp -p /u02/oradata/DPDEVUG/bnapp.dbf  /u04/oradata/DPDEVUG/bnapp.dbf
cp -p /u02/oradata/DPDEVUG/bnlarge.dbf  /u04/oradata/DPDEVUG/bnlarge.dbf
cp -p /u02/oradata/DPDEVUG/fsapp.dbf /u04/oradata/DPDEVUG/fsapp.dbf
cp -p /u02/oradata/DPDEVUG/giapp.dbf  /u04/oradata/DPDEVUG/giapp.dbf
cp -p /u02/oradata/DPDEVUG/glapp.dbf  /u04/oradata/DPDEVUG/glapp.dbf
cp -p /u02/oradata/DPDEVUG/gpapp.dbf  /u04/oradata/DPDEVUG/gpapp.dbf
cp -p /u02/oradata/DPDEVUG/hrapp.dbf  /u04/oradata/DPDEVUG/hrapp.dbf
cp -p /u02/oradata/DPDEVUG/hrlarge.dbf  /u04/oradata/DPDEVUG/hrlarge.dbf
cp -p /u02/oradata/DPDEVUG/htapp.dbf  /u04/oradata/DPDEVUG/htapp.dbf
cp -p /u02/oradata/DPDEVUG/inapp.dbf  /u04/oradata/DPDEVUG/inapp.dbf
cp -p /u02/oradata/DPDEVUG/omapp.dbf  /u04/oradata/DPDEVUG/omapp.dbf
cp -p /u02/oradata/DPDEVUG/paapp.dbf  /u04/oradata/DPDEVUG/paapp.dbf
cp -p /u02/oradata/DPDEVUG/palarge.dbf  /u04/oradata/DPDEVUG/palarge.dbf
cp -p /u02/oradata/DPDEVUG/piapp.dbf  /u04/oradata/DPDEVUG/piapp.dbf
cp -p /u02/oradata/DPDEVUG/pilarge.dbf  /u04/oradata/DPDEVUG/pilarge.dbf
cp -p /u02/oradata/DPDEVUG/psimage.dbf  /u04/oradata/DPDEVUG/psimage.dbf
cp -p /u02/oradata/DPDEVUG/psimage2_1.dbf  /u04/oradata/DPDEVUG/psimage2_1.dbf
cp -p /u02/oradata/DPDEVUG/psimage2_2.dbf /u04/oradata/DPDEVUG/psimage2_2.dbf
cp -p /u02/oradata/DPDEVUG/psimage2_3.dbf /u04/oradata/DPDEVUG/psimage2_3.dbf
cp -p /u02/oradata/DPDEVUG/psimage2_4.dbf /u04/oradata/DPDEVUG/psimage2_4.dbf
cp -p /u02/oradata/DPDEVUG/psimage2_5.dbf /u04/oradata/DPDEVUG/psimage2_5.dbf
cp -p /u02/oradata/DPDEVUG/psindex.dbf /u04/oradata/DPDEVUG/psindex.dbf
cp -p /u02/oradata/DPDEVUG/psindex01.dbf /u04/oradata/DPDEVUG/psindex01.dbf
cp -p /u02/oradata/DPDEVUG/psindex02.dbf /u04/oradata/DPDEVUG/psindex02.dbf
cp -p /u02/oradata/DPDEVUG/psindex03.dbf /u04/oradata/DPDEVUG/psindex03.dbf
cp -p /u02/oradata/DPDEVUG/psundots.dbf /u04/oradata/DPDEVUG/psundots.dbf
cp -p /u02/oradata/DPDEVUG/ptapp.dbf /u04/oradata/DPDEVUG/ptapp.dbf
cp -p /u02/oradata/DPDEVUG/ptprc.dbf /u04/oradata/DPDEVUG/ptprc.dbf
cp -p /u02/oradata/DPDEVUG/system01.dbf /u04/oradata/DPDEVUG/system01.dbf
cp -p /u05/oradata/DPDEVUG/aaapp1.dbf /u04/oradata/DPDEVUG/aaapp1.dbf
cp -p /u05/oradata/DPDEVUG/aalarge1.dbf /u04/oradata/DPDEVUG/aalarge1.dbf
cp -p /u05/oradata/DPDEVUG/adapp1.dbf /u04/oradata/DPDEVUG/adapp1.dbf
cp -p /u05/oradata/DPDEVUG/aidba.dbf /u04/oradata/DPDEVUG/aidba.dbf
cp -p /u05/oradata/DPDEVUG/amapp.dbf /u04/oradata/DPDEVUG/amapp.dbf
cp -p /u05/oradata/DPDEVUG/avapp1.dbf /u04/oradata/DPDEVUG/avapp1.dbf
cp -p /u05/oradata/DPDEVUG/bdapp.dbf /u04/oradata/DPDEVUG/bdapp.dbf
cp -p /u05/oradata/DPDEVUG/bpapp.dbf /u04/oradata/DPDEVUG/bpapp.dbf
cp -p /u05/oradata/DPDEVUG/ccapp1.dbf /u04/oradata/DPDEVUG/ccapp1.dbf
cp -p /u05/oradata/DPDEVUG/coapp.dbf /u04/oradata/DPDEVUG/coapp.dbf
cp -p /u05/oradata/DPDEVUG/cuaudit.dbf /u04/oradata/DPDEVUG/cuaudit.dbf
cp -p /u05/oradata/DPDEVUG/cularg1.dbf /u04/oradata/DPDEVUG/cularg1.dbf
cp -p /u05/oradata/DPDEVUG/cularg2.dbf /u04/oradata/DPDEVUG/cularg2.dbf
cp -p /u05/oradata/DPDEVUG/cularg3.dbf /u04/oradata/DPDEVUG/cularg3.dbf
cp -p /u05/oradata/DPDEVUG/cularge.dbf /u04/oradata/DPDEVUG/cularge.dbf
cp -p /u05/oradata/DPDEVUG/dbtune.dbf /u04/oradata/DPDEVUG/dbtune.dbf
cp -p /u05/oradata/DPDEVUG/diapp.dbf /u04/oradata/DPDEVUG/diapp.dbf
cp -p /u05/oradata/DPDEVUG/eoapp.dbf /u04/oradata/DPDEVUG/eoapp.dbf
cp -p /u05/oradata/DPDEVUG/eobfapp1.dbf /u04/oradata/DPDEVUG/eobfapp1.dbf
cp -p /u05/oradata/DPDEVUG/eocfapp1.dbf /u04/oradata/DPDEVUG/eocfapp1.dbf
cp -p /u05/oradata/DPDEVUG/eocmapp.dbf /u04/oradata/DPDEVUG/eocmapp.dbf
cp -p /u05/oradata/DPDEVUG/eocmlrg.dbf /u04/oradata/DPDEVUG/eocmlrg.dbf
cp -p /u05/oradata/DPDEVUG/eocmwrk.dbf /u04/oradata/DPDEVUG/eocmwrk.dbf
cp -p /u05/oradata/DPDEVUG/eocuapp.dbf /u04/oradata/DPDEVUG/eocuapp.dbf
cp -p /u05/oradata/DPDEVUG/eoculrg.dbf /u04/oradata/DPDEVUG/eoculrg.dbf
cp -p /u05/oradata/DPDEVUG/eoditbl.dbf /u04/oradata/DPDEVUG/eoditbl.dbf
cp -p /u05/oradata/DPDEVUG/eodsapp.dbf /u04/oradata/DPDEVUG/eodsapp.dbf
cp -p /u05/oradata/DPDEVUG/eodslrg.dbf /u04/oradata/DPDEVUG/eodslrg.dbf
cp -p /u05/oradata/DPDEVUG/eoecapp.dbf /u04/oradata/DPDEVUG/eoecapp.dbf
cp -p /u05/oradata/DPDEVUG/eoeclrg.dbf /u04/oradata/DPDEVUG/eoeclrg.dbf
cp -p /u05/oradata/DPDEVUG/eoecwrk.dbf /u04/oradata/DPDEVUG/eoecwrk.dbf
cp -p /u05/oradata/DPDEVUG/eoeiapp.dbf /u04/oradata/DPDEVUG/eoeiapp.dbf
cp -p /u05/oradata/DPDEVUG/eoeilrg.dbf /u04/oradata/DPDEVUG/eoeilrg.dbf
cp -p /u05/oradata/DPDEVUG/eoewapp.dbf /u04/oradata/DPDEVUG/eoewapp.dbf
cp -p /u05/oradata/DPDEVUG/eoewlrg.dbf /u04/oradata/DPDEVUG/eoewlrg.dbf
cp -p /u05/oradata/DPDEVUG/eoewwrk.dbf /u04/oradata/DPDEVUG/eoewwrk.dbf
cp -p /u05/oradata/DPDEVUG/eoiuapp.dbf /u04/oradata/DPDEVUG/eoiuapp.dbf
cp -p /u05/oradata/DPDEVUG/eoiulrg.dbf /u04/oradata/DPDEVUG/eoiulrg.dbf
cp -p /u05/oradata/DPDEVUG/eoiuwrk.dbf /u04/oradata/DPDEVUG/eoiuwrk.dbf
cp -p /u05/oradata/DPDEVUG/eoltapp1.dbf /u04/oradata/DPDEVUG/eoltapp1.dbf
cp -p /u05/oradata/DPDEVUG/eoppapp1.dbf /u04/oradata/DPDEVUG/eoppapp1.dbf
cp -p /u05/oradata/DPDEVUG/eopplrg1.dbf /u04/oradata/DPDEVUG/eopplrg1.dbf
cp -p /u05/oradata/DPDEVUG/faapp1.dbf /u04/oradata/DPDEVUG/faapp1.dbf
cp -p /u05/oradata/DPDEVUG/falarge1.dbf /u04/oradata/DPDEVUG/falarge1.dbf
cp -p /u05/oradata/DPDEVUG/hrapp71.dbf /u04/oradata/DPDEVUG/hrapp71.dbf
cp -p /u05/oradata/DPDEVUG/hrsapp1.dbf /u04/oradata/DPDEVUG/hrsapp1.dbf
cp -p /u05/oradata/DPDEVUG/hrslarge1.dbf /u04/oradata/DPDEVUG/hrslarge1.dbf
cp -p /u05/oradata/DPDEVUG/hrswork1.dbf /u04/oradata/DPDEVUG/hrswork1.dbf
cp -p /u05/oradata/DPDEVUG/psdefault.dbf /u04/oradata/DPDEVUG/psdefault.dbf
cp -p /u05/oradata/DPDEVUG/psimgr.dbf /u04/oradata/DPDEVUG/psimgr.dbf
cp -p /u05/oradata/DPDEVUG/psindex06.dbf /u04/oradata/DPDEVUG/psindex06.dbf
cp -p /u05/oradata/DPDEVUG/psmatvw.dbf /u04/oradata/DPDEVUG/psmatvw.dbf
cp -p /u05/oradata/DPDEVUG/pstemp01.dbf /u04/oradata/DPDEVUG/pstemp01.dbf
cp -p /u05/oradata/DPDEVUG/pswork.dbf /u04/oradata/DPDEVUG/pswork.dbf
cp -p /u05/oradata/DPDEVUG/ptamsg.dbf /u04/oradata/DPDEVUG/ptamsg.dbf
cp -p /u05/oradata/DPDEVUG/ptappe.dbf /u04/oradata/DPDEVUG/ptappe.dbf
cp -p /u05/oradata/DPDEVUG/ptaudit.dbf /u04/oradata/DPDEVUG/ptaudit.dbf
cp -p /u05/oradata/DPDEVUG/ptcmstar.dbf /u04/oradata/DPDEVUG/ptcmstar.dbf
cp -p /u05/oradata/DPDEVUG/ptlock.dbf /u04/oradata/DPDEVUG/ptlock.dbf
cp -p /u05/oradata/DPDEVUG/ptprjwk.dbf /u04/oradata/DPDEVUG/ptprjwk.dbf
cp -p /u05/oradata/DPDEVUG/ptrpts.dbf /u04/oradata/DPDEVUG/ptrpts.dbf
cp -p /u05/oradata/DPDEVUG/pttbl.dbf /u04/oradata/DPDEVUG/pttbl.dbf
cp -p /u05/oradata/DPDEVUG/pttlrg.dbf /u04/oradata/DPDEVUG/pttlrg.dbf
cp -p /u05/oradata/DPDEVUG/pttree.dbf /u04/oradata/DPDEVUG/pttree.dbf
cp -p /u05/oradata/DPDEVUG/ptwork.dbf /u04/oradata/DPDEVUG/ptwork.dbf
cp -p /u05/oradata/DPDEVUG/pyapp.dbf /u04/oradata/DPDEVUG/pyapp.dbf
cp -p /u05/oradata/DPDEVUG/pylarge.dbf /u04/oradata/DPDEVUG/pylarge.dbf
cp -p /u05/oradata/DPDEVUG/pylarge02.dbf /u04/oradata/DPDEVUG/pylarge02.dbf
cp -p /u05/oradata/DPDEVUG/saapp1.dbf /u04/oradata/DPDEVUG/saapp1.dbf
cp -p /u05/oradata/DPDEVUG/sacapp1.dbf /u04/oradata/DPDEVUG/sacapp1.dbf
cp -p /u05/oradata/DPDEVUG/salarge1.dbf /u04/oradata/DPDEVUG/salarge1.dbf
cp -p /u05/oradata/DPDEVUG/srapp1.dbf /u04/oradata/DPDEVUG/srapp1.dbf
cp -p /u05/oradata/DPDEVUG/stapp.dbf /u04/oradata/DPDEVUG/stapp.dbf
cp -p /u05/oradata/DPDEVUG/stlarge.dbf /u04/oradata/DPDEVUG/stlarge.dbf
cp -p /u05/oradata/DPDEVUG/sysaux01.dbf /u04/oradata/DPDEVUG/sysaux01.dbf
cp -p /u05/oradata/DPDEVUG/sysaux02.dbf /u04/oradata/DPDEVUG/sysaux02.dbf
cp -p /u05/oradata/DPDEVUG/tivoliorts01.dbf /u04/oradata/DPDEVUG/tivoliorts01.dbf
cp -p /u05/oradata/DPDEVUG/tlapp.dbf /u04/oradata/DPDEVUG/tlapp.dbf
cp -p /u05/oradata/DPDEVUG/tllarge.dbf /u04/oradata/DPDEVUG/tllarge.dbf
cp -p /u09/oradata/DPDEVUG/eolarge.dbf /u04/oradata/DPDEVUG/eolarge.dbf
cp -p /u09/oradata/DPDEVUG/eotpapp.dbf /u04/oradata/DPDEVUG/eotpapp.dbf
cp -p /u09/oradata/DPDEVUG/eotplrg.dbf /u04/oradata/DPDEVUG/eotplrg.dbf
cp -p /u09/oradata/DPDEVUG/epapp.dbf /u04/oradata/DPDEVUG/epapp.dbf
cp -p /u09/oradata/DPDEVUG/eplarge.dbf /u04/oradata/DPDEVUG/eplarge.dbf
cp -p /u09/oradata/DPDEVUG/erapp.dbf /u04/oradata/DPDEVUG/erapp.dbf
cp -p /u09/oradata/DPDEVUG/erlarge.dbf /u04/oradata/DPDEVUG/erlarge.dbf
cp -p /u09/oradata/DPDEVUG/erwork.dbf /u04/oradata/DPDEVUG/erwork.dbf
cp -p /u09/oradata/DPDEVUG/fgapp.dbf /u04/oradata/DPDEVUG/fgapp.dbf
cp -p /u09/oradata/DPDEVUG/gpdeapp.dbf /u04/oradata/DPDEVUG/gpdeapp.dbf
cp -p /u09/oradata/DPDEVUG/hpapp.dbf /u04/oradata/DPDEVUG/hpapp.dbf
cp -p /u09/oradata/DPDEVUG/hrapp1.dbf /u04/oradata/DPDEVUG/hrapp1.dbf
cp -p /u09/oradata/DPDEVUG/hrapp2.dbf /u04/oradata/DPDEVUG/hrapp2.dbf
cp -p /u09/oradata/DPDEVUG/hrapp3.dbf /u04/oradata/DPDEVUG/hrapp3.dbf
cp -p /u09/oradata/DPDEVUG/hrapp4.dbf /u04/oradata/DPDEVUG/hrapp4.dbf
cp -p /u09/oradata/DPDEVUG/hrapp5.dbf /u04/oradata/DPDEVUG/hrapp5.dbf
cp -p /u09/oradata/DPDEVUG/hrapp6.dbf /u04/oradata/DPDEVUG/hrapp6.dbf
cp -p /u09/oradata/DPDEVUG/hrlarge02.dbf /u04/oradata/DPDEVUG/hrlarge02.dbf
cp -p /u09/oradata/DPDEVUG/hrlarge03.dbf /u04/oradata/DPDEVUG/hrlarge03.dbf
cp -p /u09/oradata/DPDEVUG/hrwork.dbf /u04/oradata/DPDEVUG/hrwork.dbf
cp -p /u09/oradata/DPDEVUG/knsapp.dbf /u04/oradata/DPDEVUG/knsapp.dbf
cp -p /u09/oradata/DPDEVUG/pcapp.dbf /u04/oradata/DPDEVUG/pcapp.dbf
cp -p /u09/oradata/DPDEVUG/pclarge.dbf /u04/oradata/DPDEVUG/pclarge.dbf
cp -p /u09/oradata/DPDEVUG/piwork.dbf /u04/oradata/DPDEVUG/piwork.dbf
cp -p /u09/oradata/DPDEVUG/poapp.dbf /u04/oradata/DPDEVUG/poapp.dbf
cp -p /u09/oradata/DPDEVUG/psindex04.dbf /u04/oradata/DPDEVUG/psindex04.dbf
cp -p /u09/oradata/DPDEVUG/psindex05.dbf /u04/oradata/DPDEVUG/psindex05.dbf
cp -p /u09/oradata/DPDEVUG/psindex07.dbf /u04/oradata/DPDEVUG/psindex07.dbf
cp -p /u09/oradata/DPDEVUG/psundots_02.dbf /u04/oradata/DPDEVUG/psundots_02.dbf
cp -p /u09/oradata/DPDEVUG/pvapp.dbf /u04/oradata/DPDEVUG/pvapp.dbf
cp -p /u09/oradata/DPDEVUG/py0lrg.dbf /u04/oradata/DPDEVUG/py0lrg.dbf
cp -p /u09/oradata/DPDEVUG/pylarge03.dbf /u04/oradata/DPDEVUG/pylarge03.dbf
cp -p /u09/oradata/DPDEVUG/pylarge04.dbf /u04/oradata/DPDEVUG/pylarge04.dbf
cp -p /u09/oradata/DPDEVUG/pywork.dbf /u04/oradata/DPDEVUG/pywork.dbf
cp -p /u09/oradata/DPDEVUG/stwork.dbf /u04/oradata/DPDEVUG/stwork.dbf
cp -p /u09/oradata/DPDEVUG/tlwork.dbf /u04/oradata/DPDEVUG/tlwork.dbf
cp -p /u09/oradata/DPDEVUG/waapp.dbf /u04/oradata/DPDEVUG/waapp.dbf
cp -p /u05/oradata/DPDEVUG/psgtt01.dbf /u04/oradata/DPDEVUG/psgtt01.dbf
cp -p /u09/oradata/DPDEVUG/temp01.dbf /u04/oradata/DPDEVUG/temp01.dbf
cp -p /u09/oradata/DPDEVUG/tivoliortempts_01.dbf /u04/oradata/DPDEVUG/tivoliortempts_01.dbf




3. 


select 'set newname for datafile '||file_id||' to '||chr(39)||replace(file_name,'DPDEV91','DPDEV92')||chr(39)||';'
from   dba_data_files
order by file_name;

select file_name from dba_data_files order by 2

select 'ALTER DATABASE RENAME FILE '||chr(39)||file_name||chr(39)|| TO '||chr(39)||file_name||chr(39)||';'
from   dba_data_files
order by file_name;

ALTER DATABASE RENAME FILE '/u02/oracle/rbdb1/sort01.dbf' TO '/u02/oracle/rbdb1/users03.dbf;
    

select file_name from temp_data_files order by 2

       
*********************

ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/USERS01.dbf' TO '/u04/oradata/DPDEVUG/USERS01.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/bnapp.dbf' TO '/u04/oradata/DPDEVUG/bnapp.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/bnlarge.dbf' TO '/u04/oradata/DPDEVUG/bnlarge.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/fsapp.dbf' TO '/u04/oradata/DPDEVUG/fsapp.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/giapp.dbf' TO '/u04/oradata/DPDEVUG/giapp.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/glapp.dbf' TO '/u04/oradata/DPDEVUG/glapp.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/gpapp.dbf' TO '/u04/oradata/DPDEVUG/gpapp.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/hrapp.dbf' TO '/u04/oradata/DPDEVUG/hrapp.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/hrlarge.dbf' TO '/u04/oradata/DPDEVUG/hrlarge.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/htapp.dbf' TO '/u04/oradata/DPDEVUG/htapp.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/inapp.dbf' TO '/u04/oradata/DPDEVUG/inapp.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/omapp.dbf' TO '/u04/oradata/DPDEVUG/omapp.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/paapp.dbf' TO '/u04/oradata/DPDEVUG/paapp.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/palarge.dbf' TO '/u04/oradata/DPDEVUG/palarge.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/piapp.dbf' TO '/u04/oradata/DPDEVUG/piapp.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/pilarge.dbf' TO '/u04/oradata/DPDEVUG/pilarge.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/psimage.dbf' TO '/u04/oradata/DPDEVUG/psimage.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/psimage2_1.dbf' TO '/u04/oradata/DPDEVUG/psimage2_1.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/psimage2_2.dbf' TO '/u04/oradata/DPDEVUG/psimage2_2.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/psimage2_3.dbf' TO '/u04/oradata/DPDEVUG/psimage2_3.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/psimage2_4.dbf' TO '/u04/oradata/DPDEVUG/psimage2_4.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/psimage2_5.dbf' TO '/u04/oradata/DPDEVUG/psimage2_5.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/psindex.dbf' TO '/u04/oradata/DPDEVUG/psindex.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/psindex01.dbf' TO '/u04/oradata/DPDEVUG/psindex01.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/psindex02.dbf' TO '/u04/oradata/DPDEVUG/psindex02.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/psindex03.dbf' TO '/u04/oradata/DPDEVUG/psindex03.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/psundots.dbf' TO '/u04/oradata/DPDEVUG/psundots.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/ptapp.dbf' TO '/u04/oradata/DPDEVUG/ptapp.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/ptprc.dbf' TO '/u04/oradata/DPDEVUG/ptprc.dbf';
ALTER DATABASE RENAME FILE '/u02/oradata/DPDEVUG/system01.dbf' TO '/u04/oradata/DPDEVUG/system01.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/aaapp1.dbf' TO '/u04/oradata/DPDEVUG/aaapp1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/aalarge1.dbf' TO '/u04/oradata/DPDEVUG/aalarge1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/adapp1.dbf' TO '/u04/oradata/DPDEVUG/adapp1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/aidba.dbf' TO '/u04/oradata/DPDEVUG/aidba.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/amapp.dbf' TO '/u04/oradata/DPDEVUG/amapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/avapp1.dbf' TO '/u04/oradata/DPDEVUG/avapp1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/bdapp.dbf' TO '/u04/oradata/DPDEVUG/bdapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/bpapp.dbf' TO '/u04/oradata/DPDEVUG/bpapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/ccapp1.dbf' TO '/u04/oradata/DPDEVUG/ccapp1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/coapp.dbf' TO '/u04/oradata/DPDEVUG/coapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/cuaudit.dbf' TO '/u04/oradata/DPDEVUG/cuaudit.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/cularg1.dbf' TO '/u04/oradata/DPDEVUG/cularg1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/cularg2.dbf' TO '/u04/oradata/DPDEVUG/cularg2.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/cularg3.dbf' TO '/u04/oradata/DPDEVUG/cularg3.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/cularge.dbf' TO '/u04/oradata/DPDEVUG/cularge.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/dbtune.dbf' TO '/u04/oradata/DPDEVUG/dbtune.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/diapp.dbf' TO '/u04/oradata/DPDEVUG/diapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoapp.dbf' TO '/u04/oradata/DPDEVUG/eoapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eobfapp1.dbf' TO '/u04/oradata/DPDEVUG/eobfapp1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eocfapp1.dbf' TO '/u04/oradata/DPDEVUG/eocfapp1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eocmapp.dbf' TO '/u04/oradata/DPDEVUG/eocmapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eocmlrg.dbf' TO '/u04/oradata/DPDEVUG/eocmlrg.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eocmwrk.dbf' TO '/u04/oradata/DPDEVUG/eocmwrk.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eocuapp.dbf' TO '/u04/oradata/DPDEVUG/eocuapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoculrg.dbf' TO '/u04/oradata/DPDEVUG/eoculrg.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoditbl.dbf' TO '/u04/oradata/DPDEVUG/eoditbl.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eodsapp.dbf' TO '/u04/oradata/DPDEVUG/eodsapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eodslrg.dbf' TO '/u04/oradata/DPDEVUG/eodslrg.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoecapp.dbf' TO '/u04/oradata/DPDEVUG/eoecapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoeclrg.dbf' TO '/u04/oradata/DPDEVUG/eoeclrg.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoecwrk.dbf' TO '/u04/oradata/DPDEVUG/eoecwrk.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoeiapp.dbf' TO '/u04/oradata/DPDEVUG/eoeiapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoeilrg.dbf' TO '/u04/oradata/DPDEVUG/eoeilrg.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoewapp.dbf' TO '/u04/oradata/DPDEVUG/eoewapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoewlrg.dbf' TO '/u04/oradata/DPDEVUG/eoewlrg.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoewwrk.dbf' TO '/u04/oradata/DPDEVUG/eoewwrk.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoiuapp.dbf' TO '/u04/oradata/DPDEVUG/eoiuapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoiulrg.dbf' TO '/u04/oradata/DPDEVUG/eoiulrg.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoiuwrk.dbf' TO '/u04/oradata/DPDEVUG/eoiuwrk.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoltapp1.dbf' TO '/u04/oradata/DPDEVUG/eoltapp1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eoppapp1.dbf' TO '/u04/oradata/DPDEVUG/eoppapp1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/eopplrg1.dbf' TO '/u04/oradata/DPDEVUG/eopplrg1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/faapp1.dbf' TO '/u04/oradata/DPDEVUG/faapp1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/falarge1.dbf' TO '/u04/oradata/DPDEVUG/falarge1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/hrapp71.dbf' TO '/u04/oradata/DPDEVUG/hrapp71.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/hrsapp1.dbf' TO '/u04/oradata/DPDEVUG/hrsapp1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/hrslarge1.dbf' TO '/u04/oradata/DPDEVUG/hrslarge1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/hrswork1.dbf' TO '/u04/oradata/DPDEVUG/hrswork1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/psdefault.dbf' TO '/u04/oradata/DPDEVUG/psdefault.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/psimgr.dbf' TO '/u04/oradata/DPDEVUG/psimgr.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/psindex06.dbf' TO '/u04/oradata/DPDEVUG/psindex06.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/psmatvw.dbf' TO '/u04/oradata/DPDEVUG/psmatvw.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/pstemp01.dbf' TO '/u04/oradata/DPDEVUG/pstemp01.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/pswork.dbf' TO '/u04/oradata/DPDEVUG/pswork.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/ptamsg.dbf' TO '/u04/oradata/DPDEVUG/ptamsg.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/ptappe.dbf' TO '/u04/oradata/DPDEVUG/ptappe.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/ptaudit.dbf' TO '/u04/oradata/DPDEVUG/ptaudit.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/ptcmstar.dbf' TO '/u04/oradata/DPDEVUG/ptcmstar.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/ptlock.dbf' TO '/u04/oradata/DPDEVUG/ptlock.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/ptprjwk.dbf' TO '/u04/oradata/DPDEVUG/ptprjwk.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/ptrpts.dbf' TO '/u04/oradata/DPDEVUG/ptrpts.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/pttbl.dbf' TO '/u04/oradata/DPDEVUG/pttbl.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/pttlrg.dbf' TO '/u04/oradata/DPDEVUG/pttlrg.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/pttree.dbf' TO '/u04/oradata/DPDEVUG/pttree.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/ptwork.dbf' TO '/u04/oradata/DPDEVUG/ptwork.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/pyapp.dbf' TO '/u04/oradata/DPDEVUG/pyapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/pylarge.dbf' TO '/u04/oradata/DPDEVUG/pylarge.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/pylarge02.dbf' TO '/u04/oradata/DPDEVUG/pylarge02.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/saapp1.dbf' TO '/u04/oradata/DPDEVUG/saapp1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/sacapp1.dbf' TO '/u04/oradata/DPDEVUG/sacapp1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/salarge1.dbf' TO '/u04/oradata/DPDEVUG/salarge1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/srapp1.dbf' TO '/u04/oradata/DPDEVUG/srapp1.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/stapp.dbf' TO '/u04/oradata/DPDEVUG/stapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/stlarge.dbf' TO '/u04/oradata/DPDEVUG/stlarge.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/sysaux01.dbf' TO '/u04/oradata/DPDEVUG/sysaux01.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/sysaux02.dbf' TO '/u04/oradata/DPDEVUG/sysaux02.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/tivoliorts01.dbf' TO '/u04/oradata/DPDEVUG/tivoliorts01.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/tlapp.dbf' TO '/u04/oradata/DPDEVUG/tlapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/tllarge.dbf' TO '/u04/oradata/DPDEVUG/tllarge.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/eolarge.dbf' TO '/u04/oradata/DPDEVUG/eolarge.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/eotpapp.dbf' TO '/u04/oradata/DPDEVUG/eotpapp.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/eotplrg.dbf' TO '/u04/oradata/DPDEVUG/eotplrg.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/epapp.dbf' TO '/u04/oradata/DPDEVUG/epapp.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/eplarge.dbf' TO '/u04/oradata/DPDEVUG/eplarge.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/erapp.dbf' TO '/u04/oradata/DPDEVUG/erapp.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/erlarge.dbf' TO '/u04/oradata/DPDEVUG/erlarge.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/erwork.dbf' TO '/u04/oradata/DPDEVUG/erwork.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/fgapp.dbf' TO '/u04/oradata/DPDEVUG/fgapp.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/gpdeapp.dbf' TO '/u04/oradata/DPDEVUG/gpdeapp.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/hpapp.dbf' TO '/u04/oradata/DPDEVUG/hpapp.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/hrapp1.dbf' TO '/u04/oradata/DPDEVUG/hrapp1.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/hrapp2.dbf' TO '/u04/oradata/DPDEVUG/hrapp2.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/hrapp3.dbf' TO '/u04/oradata/DPDEVUG/hrapp3.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/hrapp4.dbf' TO '/u04/oradata/DPDEVUG/hrapp4.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/hrapp5.dbf' TO '/u04/oradata/DPDEVUG/hrapp5.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/hrapp6.dbf' TO '/u04/oradata/DPDEVUG/hrapp6.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/hrlarge02.dbf' TO '/u04/oradata/DPDEVUG/hrlarge02.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/hrlarge03.dbf' TO '/u04/oradata/DPDEVUG/hrlarge03.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/hrwork.dbf' TO '/u04/oradata/DPDEVUG/hrwork.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/knsapp.dbf' TO '/u04/oradata/DPDEVUG/knsapp.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/pcapp.dbf' TO '/u04/oradata/DPDEVUG/pcapp.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/pclarge.dbf' TO '/u04/oradata/DPDEVUG/pclarge.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/piwork.dbf' TO '/u04/oradata/DPDEVUG/piwork.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/poapp.dbf' TO '/u04/oradata/DPDEVUG/poapp.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/psindex04.dbf' TO '/u04/oradata/DPDEVUG/psindex04.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/psindex05.dbf' TO '/u04/oradata/DPDEVUG/psindex05.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/psindex07.dbf' TO '/u04/oradata/DPDEVUG/psindex07.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/psundots_02.dbf' TO '/u04/oradata/DPDEVUG/psundots_02.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/pvapp.dbf' TO '/u04/oradata/DPDEVUG/pvapp.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/py0lrg.dbf' TO '/u04/oradata/DPDEVUG/py0lrg.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/pylarge03.dbf' TO '/u04/oradata/DPDEVUG/pylarge03.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/pylarge04.dbf' TO '/u04/oradata/DPDEVUG/pylarge04.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/pywork.dbf' TO '/u04/oradata/DPDEVUG/pywork.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/stwork.dbf' TO '/u04/oradata/DPDEVUG/stwork.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/tlwork.dbf' TO '/u04/oradata/DPDEVUG/tlwork.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/waapp.dbf' TO '/u04/oradata/DPDEVUG/waapp.dbf';
ALTER DATABASE RENAME FILE '/u05/oradata/DPDEVUG/psgtt01.dbf' TO '/u04/oradata/DPDEVUG/psgtt01.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/temp01.dbf' TO '/u04/oradata/DPDEVUG/temp01.dbf';
ALTER DATABASE RENAME FILE '/u09/oradata/DPDEVUG/tivoliortempts_01.dbf' TO '/u04/oradata/DPDEVUG/tivoliortempts_01.dbf';


sqlplus / as sysdba

shutdown immediate


cd /u09/oradata/DPDEVUG
cd /u02/oradata/DPDEVUG
cd /u05/oradata/DPDEVUG





startup




Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}



cd $BKPSCR
savebkp.ksh DPDEVUG afterReOrg

DPDEVUG backup saved as DPDEVUG_sbk_20170321_13:12:23_afterReOrg.rman




*****************Activate DPUATTST****************



alter profile STANDARD limit zopa_VERIFY_FUNCTION null
/

alter profile DEFAULT limit zopa_VERIFY_FUNCTION null
/



ALTER USER system
IDENTIFIED BY "sysDPUATTST"
/

ALTER USER sys
IDENTIFIED BY "sysDPUATTST"
/


ALTER USER dpadmin IDENTIFIED BY "bpsdpdev92"

/

ALTER PROFILE STANDARD LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/

ALTER PROFILE DEFAULT  LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/



$BKPSCR/stop_archive.ksh


system/sysDPUATTST@DPUATTST




*********** Duplicate DPDEV92 to DPUATTST***********

!! DPDEV92 on dppdev and DPUATTST on dppqa


1. Remove old saved backups for DPUATTST
. ~/.profile
DPUATTST

rman
connect target /
connect catalog DPUATTST/DPUATTSTnamr@RCATDEV

cd /u01/app/oracle/aetna/db_admin/db_DPUATTST/save_backup


view DPUATTST_sbk_20170825_11:47:22_oriAfterDuplication.rman





DPUATTST_sbk_20170924_09:15:00_b4Jul2017PSU.rman


2. Note few things before removing old database

CREATE OR REPLACE DIRECTORY DATA_PUMP_DIR AS '/u10/oraback/export/'
/
GRANT READ ON DIRECTORY DATA_PUMP_DIR TO EXP_FULL_DATABASE
/
GRANT WRITE ON DIRECTORY DATA_PUMP_DIR TO EXP_FULL_DATABASE
/
GRANT READ ON DIRECTORY DATA_PUMP_DIR TO IMP_FULL_DATABASE
/
GRANT WRITE ON DIRECTORY DATA_PUMP_DIR TO IMP_FULL_DATABASE
/
GRANT EXECUTE ON DIRECTORY DATA_PUMP_DIR TO SYSTEM WITH GRANT OPTION
/
GRANT READ ON DIRECTORY DATA_PUMP_DIR TO SYSTEM WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY DATA_PUMP_DIR TO SYSTEM WITH GRANT OPTION
/
CREATE OR REPLACE DIRECTORY EXP_DUMP_DIR AS '/u10/oraback/export/'
/
GRANT READ ON DIRECTORY EXP_DUMP_DIR TO DPADMIN WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY EXP_DUMP_DIR TO DPADMIN WITH GRANT OPTION
/
CREATE OR REPLACE DIRECTORY EXP_LOG_DIR AS '/u01/app/oracle/aetna/db_admin/db_DPUATTST/export/'
/
GRANT READ ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/
CREATE OR REPLACE DIRECTORY OPATCH_INST_DIR AS '/orahome/u01/app/oracle/product/12.1.0.2.170718/db_1/OPatch'
/
CREATE OR REPLACE DIRECTORY OPATCH_LOG_DIR AS '/orahome/u01/app/oracle/product/12.1.0.2.170718/db_1/QOpatch'
/
CREATE OR REPLACE DIRECTORY OPATCH_SCRIPT_DIR AS '/orahome/u01/app/oracle/product/12.1.0.2.170718/db_1/QOpatch'
/
CREATE OR REPLACE DIRECTORY ORACLE_BASE AS '/'
/
CREATE OR REPLACE DIRECTORY ORACLE_HOME AS '/'
/
CREATE OR REPLACE DIRECTORY ORACLE_OCM_CONFIG_DIR AS '/orahome/u01/app/oracle/product/12.1.0.2/db_1/ccr/state'
/
GRANT READ ON DIRECTORY ORACLE_OCM_CONFIG_DIR TO ORACLE_OCM
/
GRANT WRITE ON DIRECTORY ORACLE_OCM_CONFIG_DIR TO ORACLE_OCM
/
CREATE OR REPLACE DIRECTORY ORACLE_OCM_CONFIG_DIR2 AS '/orahome/u01/app/oracle/product/12.1.0.2/db_1/ccr/state'
/
GRANT READ ON DIRECTORY ORACLE_OCM_CONFIG_DIR2 TO ORACLE_OCM
/
GRANT WRITE ON DIRECTORY ORACLE_OCM_CONFIG_DIR2 TO ORACLE_OCM
/
CREATE OR REPLACE DIRECTORY PREUPGRADE_DIR AS '/u01/app/oracle/cfgtoollogs/DPPRD01/preupgrade/'
/
CREATE OR REPLACE DIRECTORY TIVOLIOR_TEMP AS '/opt/Tivoli/itm/tmp'
/
GRANT READ ON DIRECTORY TIVOLIOR_TEMP TO ORATIVOLI
/
GRANT WRITE ON DIRECTORY TIVOLIOR_TEMP TO ORATIVOLI
/
CREATE OR REPLACE DIRECTORY XSDDIR AS '/orahome/u01/app/oracle/product/12.1.0.2/db_1/rdbms/xml/schema'
/



RMAN configuration parameters for database with db_unique_name DPUATTST are:

CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 30 DAYS;
CONFIGURE BACKUP OPTIMIZATION OFF;
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F';
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F';
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPUATTST.opt)' FORMAT   'bkp_%d_%I_t%t_s%s_p%p';

CONFIGURE MAXSETSIZE TO UNLIMITED;
CONFIGURE ENCRYPTION FOR DATABASE OFF;
CONFIGURE ENCRYPTION ALGORITHM 'AES128';
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE;

CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS;
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE;
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPUATTST/rman_backups/snapcf_DPUATTST.f';



3. Shutdown DPUATTST and remove data files to free up space


/u04/oradata/DPUATTST/
/u06/oradata/DPUATTST/
/u08/oradata/DPUATTST/



MEMBER
/oraredologs/dpu21/DPUATTST/redo0601.log
/oraredologs/dpu22/DPUATTST/redo0602.log


NAME
/oraredologs/dpu21/DPUATTST/
/oraredologs/dpu22/DPUATTST/


/oraredologs/dpu23/DPUATTST/control3DPUATTST.ctl



sqlplus / as sysdba

shutdown immediate;

exit

cd /u04/oradata/DPUATTST/

rm -f *.dbf

cd /u06/oradata/DPUATTST/

rm -f *.dbf

cd /u08/oradata/DPUATTST/

rm -f *.dbf






OEM Blackout

cd $HOME/local/

deactivate_cron.ksh



. ~/.profile

DPUATTST

Save last backup just in case
cd $BKPSCR


savebkp.ksh DPUATTST b4RefreshFromDPDEV92

DPUATTST backup saved as DPUATTST_sbk_20171203_09:15:01_b4RefreshFromDPDEV92.rman


. ~/.profile

DPDEV92

cd $BKPSCR

savebkp.ksh DPDEV92 forDPUATTSTrefresh

DPDEV92 backup saved as DPDEV92_sbk_20171206_02:45:04_forDPUATTSTrefresh.rman


On DPPQA side

. ~/.profile

DPUATTST



1. Create new folders unless it already there.



/u05/oradata/DPUATTST



/orahome/u01/app/oracle/admin/DPUATTST/diag

/u03/archlogs/DPUATTST



/u10/oraback/DPUATTST/rman_backups




/u01/app/oracle/aetna/db_admin/db_DPUATTST


    


3. Copy init.ora file


  


/u02/oradata/DPDEV92 - 30 GB
/u05/oradata/DPDEV92 - 139 GB
/u08/oradata/DPDEV92 - 145 GB
/u09/oradata/DPDEV92 - 32 GB


/u05/oradata/DPUATTST


MEMBER

/oraredologs/dpu21/DPDEV92/redo0101.log
/oraredologs/dpu22/DPDEV92/redo0102.log


/oraredologs/dpu21/DPUATTST/redo0601.log
/oraredologs/dpu22/DPUATTST/redo0602.log



*.db_file_name_convert='/u02/oradata/DPDEV92/','/u05/oradata/DPUATTST/','/u05/oradata/DPDEV92/','/u05/oradata/DPUATTST/','/u08/oradata/DPDEV92/','/u05/oradata/DPUATTST/','/u09/oradata/DPDEV92/','/u05/oradata/DPUATTST/'

*.log_file_name_convert='/oraredologs/dpu21/DPDEV92/','/oraredologs/dpu21/DPUATTST/','/oraredologs/dpu22/DPDEV92/','/oraredologs/dpu22/DPUATTST/'








4. Create zopa file on AUX server (completed !!!)
  
    !! Copy from dppdev

Login to dppdev

cd $ORACLE_HOME/dbs

scp orapwDPDEV92 dppqa:/orahome/u01/app/oracle/product/12.1.0.2.170117/db_1/dbs/orapwDPUATTST


5. Identify backupsets location.

   cd $SAVBKP

   





6. Add entry into oratab
   cd /etc
   vi oratab

  

DPUATTST:/orahome/u01/app/oracle/product/12.1.0.2.170117/db_1:N



   cd $HOME/aetna/scripts

   cp -p oraprof oraprof_20160418   

   vi oraprof

"DPUATTST")
         NLS_LANG=AMERICAN_AMERICA.WE8ISO8859P15; export NLS_LANG
                                              ;;


7. setup new AUX env

   . ~/.profile

DPUATTST



Copy .opt file from DPPDEV to DPPQA server

Login to DPPQA

cd /u01/app/oracle/tdpoopt

scp tdpo.DPDEV92.opt dppqa:/u01/app/oracle/tdpoopt/tdpo.DPDEV92.opt


Login back to dppdev and test TDP stuff


Add following into tnsnames.ora

DPDEV92.world =
  (DESCRIPTION =
    (ADDRESS_LIST =
        (ADDRESS =
          (COMMUNITY = tcp.world)
          (PROTOCOL = TCP)
          (Host = dppdev)
          (Port = 1695)
        )
    )
    (CONNECT_DATA = (SID = DPDEV92)
    )
  )

system/sysdpdev92@DPDEV92

ALTER USER sys
IDENTIFIED BY "sysdpdev92"
/


   rman
   
   connect target sys/sysdpdev92@DPDEV92
   connect catalog DPDEV92/DPDEV92namr@RCATDEV
   connect AUXILIARY /
   run{
     allocate auxiliary channel t1 TYPE 'SBT_TAPE' PARMS 'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDEV92.opt)';
     release channel t1;
   } 






sqlplus / as sysdba

shutdown immediate;
exit

lsnrctl stop DPUATTST

cd $ORACLe_HOME/dbs

mv spfileDPUATTST.ora spfileDPUATTST.ora.20171206




!!! Encryption steps

See document H:\Data\Misc\WKAB PeopleSoft\Encrypiton_RMAN_DUPLICATE.docx


8. 


  

9. Dupliicate...

Get this from dppdev 


cd $SAVBKP

view DPDEV92_sbk_20171206_02:45:04_forDPUATTSTrefresh.rman



#Restore DataBase
#connect target /
#connect catalog DPDEV92/DPDEV92namr@RCATDEV
#startup force nomount;
#set DBID=2243699043;
#reset database to incarnation 229602;
#restore controlfile from 'c-2243699043-20171206-01_DPDEV92';
#alter database mount;
#run{
#restore database until sequence 6511;
#recover database until sequence 6511;
#}
#alter database open resetlogs;
#End Restore DataBase




On Dppqa side

. ~/.profile

DPUATTST

    sqlplus / as sysdba
    startup pfile=/orahome/u01/app/oracle/product/12.1.0.2.170718/db_1/dbs/initDPUATTST.ora force nomount;
    



rman
   connect target sys/sysdpdev92@DPDEV92
   connect catalog DPDEV92/DPDEV92namr@RCATDEV
   connect AUXILIARY /





run {
allocate auxiliary channel t1 TYPE 'SBT_TAPE' PARMS 'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPDEV92.opt)';
set until sequence 6511;
duplicate target database to DPUATTST;
}



ORA-27191: sbtinfo2 returned error
Additional information: 3586
ORA-19511: non RMAN, but media manager or vendor specific failure, error text:
   ANU2519E Could not read zopa

!!!Reachout to Dennis/Mike Giordano and they fixed. Try again and it worked.




sqlplus / as sysdba

shutdown immediate;

startup

exit

Cannot remove created server parameter file

10. cd $ORACLE_HOME/network/admin

vi listener.ora

DPUATTST=
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = dppqa)(PORT = 1603))
    (ADDRESS = (PROTOCOL = IPC) (KEY = DPUATTST_ipc))
  )

SID_LIST_DPUATTST=
  (SID_LIST =
    (SID_DESC =
      (GLOBAL_DBNAME =DPUATTST)
      (ORACLE_HOME = /orahome/u01/app/oracle/product/12.1.0.2.170117/db_1)
      (SID_NAME =DPUATTST)
    )
  )

SECURE_REGISTER_DPUATTST=(IPC)

SUBSCRIBE_FOR_NODE_DOWN_EVENT_DPUATTST=OFF



!! Remove DBACOUT entry...




11. Change sys zopas


Remove zopa function first

AI_zopa_VALIDATE

fje4tAq#

alter profile STANDARD limit zopa_VERIFY_FUNCTION null
/

alter profile DEFAULT limit zopa_VERIFY_FUNCTION null
/



ALTER USER system IDENTIFIED BY "sysDPUATTST"

/
ALTER USER sys IDENTIFIED BY "sysDPUATTST"

/


ALTER USER dpadmin IDENTIFIED BY "sysdpuattst"

/

ALTER PROFILE STANDARD LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/

ALTER PROFILE DEFAULT  LIMIT zopa_VERIFY_FUNCTION AI_zopa_VALIDATE

/







12. Add new entry to Web Server oratab : 

Login to both xpsdppw1q, xpsdppm1q

Test: sqlplus

system/sysDPUATTST@DPUATTST




13.

>rman

connect target /

connect catalog DPUATTST/DPUATTSTnamr@RCATDEV




register database;


report schema;


CONFIGURE RETENTION POLICY TO RECOVERY WINDOW OF 30 DAYS;

CONFIGURE BACKUP OPTIMIZATION OFF;
CONFIGURE DEFAULT DEVICE TYPE TO 'SBT_TAPE';
CONFIGURE CONTROLFILE AUTOBACKUP ON;
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE 'SBT_TAPE' TO '%F';
CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '%F';
CONFIGURE DEVICE TYPE 'SBT_TAPE' PARALLELISM 4 BACKUP TYPE TO BACKUPSET;
CONFIGURE DEVICE TYPE DISK PARALLELISM 1 BACKUP TYPE TO BACKUPSET;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE DATAFILE BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE 'SBT_TAPE' TO 1;
CONFIGURE ARCHIVELOG BACKUP COPIES FOR DEVICE TYPE DISK TO 1;
CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS  'ENV=(TDPO_OPTFILE=/u01/app/oracle/tdpoopt/tdpo.DPUATTST.opt)' FORMAT   'bkp_%d_%I_t%t_s%s_p%p';
CONFIGURE MAXSETSIZE TO UNLIMITED;
CONFIGURE ENCRYPTION FOR DATABASE OFF;
CONFIGURE ENCRYPTION ALGORITHM 'AES128';
CONFIGURE COMPRESSION ALGORITHM 'BASIC' AS OF RELEASE 'DEFAULT' OPTIMIZE FOR LOAD TRUE;
CONFIGURE RMAN OUTPUT TO KEEP FOR 7 DAYS;
CONFIGURE ARCHIVELOG DELETION POLICY TO NONE;
CONFIGURE SNAPSHOT CONTROLFILE NAME TO '/u10/oraback/DPUATTST/rman_backups/snapcf_DPUATTST.f';


14. Make sure all files exist. Create one if needed.

All set



15. 





16. Recompile all.

select count(*)
from dba_objects
where status = 'INVALID';

41



###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


select * from dba_temp_files;
              *
ERROR at line 1:
ORA-01187: cannot read from file  because it failed verification tests
ORA-01110: data file 1001: '/u05/oradata/DPUATTST/temp01.dbf'

ERROR:
ORA-01187: cannot read from file  because it failed verification tests
ORA-01110: data file 1002: '/u05/oradata/DPUATTST/tivoliortempts01.dbf'

SQL> select * from dba_temp_files;
ERROR:
ORA-01187: cannot read from file  because it failed verification
ORA-01110: data file 1003: '/u05/oradata/DPUATTST/pstemp01.dbf'



SQL> select * from dba_temp_files;
ERROR:
ORA-01187: cannot read from file  because it failed verificatio
ORA-01110: data file 1004: '/u05/oradata/DPUATTST/psgtt01.dbf'


alter database tempfile '/u05/oradata/DPUATTST/temp01.dbf' drop;
      ALTER TABLESPACE TEMP ADD TEMPFILE '/u05/oradata/DPUATTST/temp01.dbf' SIZE 15360M reuse;

alter database tempfile '/u05/oradata/DPUATTST/tivoliortempts01.dbf' drop;
      ALTER TABLESPACE TEMP ADD TEMPFILE '/u05/oradata/DPUATTST/tivoliortempts01.dbf' SIZE 100M reuse;





alter database tempfile '/u05/oradata/DPUATTST/psgtt01.dbf' drop;
      ALTER TABLESPACE TEMP ADD TEMPFILE '/u05/oradata/DPUATTST/psgtt01.dbf' SIZE 500M reuse;



CREATE TEMPORARY TABLESPACE PSTEMP
    TEMPFILE '/u09/oradata/DPDEV92/pstemp01.dbf' SIZE 300M AUTOEXTEND OFF
    EXTENT MANAGEMENT LOCAL UNIFORM SIZE 128K
/




alter database tempfile '/u05/oradata/DPUATTST/pstemp01.dbf' drop;

or

alter database PSTEMP'/u05/oradata/DPUATTST/pstemp01.dbf' drop;
      


ALTER TABLESPACE PSTEMP ADD TEMPFILE '/u05/oradata/DPUATTST/pstemp01.dbf' SIZE 300M reuse;



15. Recreate Log and exp dir if needed

##EXP_DUMP_DIR
###EXPORT_LOG_DIR

CREATE OR REPLACE DIRECTORY DATA_PUMP_DIR AS '/u10/oraback/export/'
/
GRANT READ ON DIRECTORY DATA_PUMP_DIR TO EXP_FULL_DATABASE
/
GRANT WRITE ON DIRECTORY DATA_PUMP_DIR TO EXP_FULL_DATABASE
/
GRANT READ ON DIRECTORY DATA_PUMP_DIR TO IMP_FULL_DATABASE
/
GRANT WRITE ON DIRECTORY DATA_PUMP_DIR TO IMP_FULL_DATABASE
/
GRANT EXECUTE ON DIRECTORY DATA_PUMP_DIR TO SYSTEM WITH GRANT OPTION
/
GRANT READ ON DIRECTORY DATA_PUMP_DIR TO SYSTEM WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY DATA_PUMP_DIR TO SYSTEM WITH GRANT OPTION
/
CREATE OR REPLACE DIRECTORY EXP_DUMP_DIR AS '/u10/oraback/export/'
/
GRANT READ ON DIRECTORY EXP_DUMP_DIR TO DPADMIN WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY EXP_DUMP_DIR TO DPADMIN WITH GRANT OPTION
/
CREATE OR REPLACE DIRECTORY EXP_LOG_DIR AS '/u01/app/oracle/aetna/db_admin/db_DPUATTST/export/'
/
GRANT READ ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/
GRANT WRITE ON DIRECTORY EXP_LOG_DIR TO DPADMIN WITH GRANT OPTION
/
CREATE OR REPLACE DIRECTORY OPATCH_INST_DIR AS '/orahome/u01/app/oracle/product/12.1.0.2.170718/db_1/OPatch'
/
CREATE OR REPLACE DIRECTORY OPATCH_LOG_DIR AS '/orahome/u01/app/oracle/product/12.1.0.2.170718/db_1/QOpatch'
/
CREATE OR REPLACE DIRECTORY OPATCH_SCRIPT_DIR AS '/orahome/u01/app/oracle/product/12.1.0.2.170718/db_1/QOpatch'
/
CREATE OR REPLACE DIRECTORY ORACLE_BASE AS '/'
/
CREATE OR REPLACE DIRECTORY ORACLE_HOME AS '/'
/
CREATE OR REPLACE DIRECTORY ORACLE_OCM_CONFIG_DIR AS '/orahome/u01/app/oracle/product/12.1.0.2/db_1/ccr/state'
/
GRANT READ ON DIRECTORY ORACLE_OCM_CONFIG_DIR TO ORACLE_OCM
/
GRANT WRITE ON DIRECTORY ORACLE_OCM_CONFIG_DIR TO ORACLE_OCM
/
CREATE OR REPLACE DIRECTORY ORACLE_OCM_CONFIG_DIR2 AS '/orahome/u01/app/oracle/product/12.1.0.2/db_1/ccr/state'
/
GRANT READ ON DIRECTORY ORACLE_OCM_CONFIG_DIR2 TO ORACLE_OCM
/
GRANT WRITE ON DIRECTORY ORACLE_OCM_CONFIG_DIR2 TO ORACLE_OCM
/
CREATE OR REPLACE DIRECTORY PREUPGRADE_DIR AS '/u01/app/oracle/cfgtoollogs/DPPRD01/preupgrade/'
/
CREATE OR REPLACE DIRECTORY TIVOLIOR_TEMP AS '/opt/Tivoli/itm/tmp'
/
GRANT READ ON DIRECTORY TIVOLIOR_TEMP TO ORATIVOLI
/
GRANT WRITE ON DIRECTORY TIVOLIOR_TEMP TO ORATIVOLI
/
CREATE OR REPLACE DIRECTORY XSDDIR AS '/orahome/u01/app/oracle/product/12.1.0.2/db_1/rdbms/xml/schema'
/


16. Add new DB to OEM, add cron jobs and schedule backups








17. !!! Encryption steps




See document H:\Data\Misc\WKAB PeopleSoft\Encrypiton_RMAN_DUPLICATE.docx


Query table with 

## Make sure it shows correct path
select * from V$ENCRYPTION_WALLET;
select * from DBA_ENCRYPTED_COLUMNS;



extract DDL from SYSADM.PS_YE_W2CP_DATA to make sure encryption there

select * from SYSADM.PS_YE_W2CP_DATA






SQL> show parameter _ignore_desc_in_index

NAME                                 TYPE        VALUE
------------------------------------ ----------- --------
_ignore_desc_in_index                boolean     FALSE


alter system set "_ignore_desc_in_index" = TRUE SCOPE=BOTH;

--Unlock if needed
ALTER USER BENENG ACCOUNT UNLOCK
/
      

     




19. Stop OEM blackout



Test backup

Take fresh backup
$BKPSCR/dbbackup_rman ${ORACLE_SID}



dbbackup_rman DPUATTST

Monitor backup

cd /u01/app/oracle/aetna/db_admin/db_DPUATTST/log
tail -f xxx.log

Or/and 

Save backup
nohup $BKPSCR/savebkp.ksh ${ORACLE_SID} oriAfterDuplication



DPUATTST backup saved as DPUATTST_sbk_20171206_13:51:53_oriAfterDuplication.rman

17. Add sys and system accounts to eDMZ

18. Make note of current space

FUll size: 93,598 GB





*** Restore DPUAT92 from saved backup**************


Blackout Database in OEM

. ~/.profile

DPUAT92

cd $SAVBKP

view DPUAT92_sbk_20170827_23:55:02_b4tax17C.rman

sqlplus / as sysdba

shutdown immediate;


#Restore DataBase
#connect target /
#connect catalog DPUAT92/DPUAT92namr@RCATDEV
#startup force nomount;
#set DBID=2339979026;
#reset database to incarnation 9702;
#restore controlfile from 'c-2339979026-20170828-01_DPUAT92';
#alter database mount;
#run{
#restore database until sequence 43632;
#recover database until sequence 43632;
#}
#alter database open resetlogs;
#End Restore DataBase




###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


Remove OEM Blackout





****************DPDEV92 SEC_CASE_SENSITIVE_LOGON enable ******

cd $ORACLE_HOME/dbs

sqlplus / as sysdba

create pfile from spfile;

exit

shutdown immediate

vi initDPDEV92.ora

#comment it out

#sec_case_sensitive_logon

mv spfileDPDEV92.ora spfileDPDEV92.ora.20171108

startup



****************DPUATTST SEC_CASE_SENSITIVE_LOGON enable ******

cd $ORACLE_HOME/dbs

sqlplus / as sysdba

create pfile from spfile;

exit

shutdown immediate

vi initDPUATTST.ora

#comment it out

#sec_case_sensitive_logon

mv spfileDPUATTST.ora spfileDPUATTST.ora.20171128

startup

show parameter SEC_CASE_SENSITIVE_LOGON

create spfile from pfile;

shutdown immediate

startup

show parameter SEC_CASE_SENSITIVE_LOGON

****************DPUAT92 SEC_CASE_SENSITIVE_LOGON enable ******

cd $ORACLE_HOME/dbs

sqlplus / as sysdba

create pfile from spfile;

shutdown immediate

exit



vi initDPUAT92.ora

!!!remove sec_case_sensitive_logon or comment out

#sec_case_sensitive_logon 

mv spfileDPUAT92T.ora spfileDPUAT92.ora.20171128


sqlplus / as sysdbva

startup

show parameter SEC_CASE_SENSITIVE_LOGON

NAME                                 TYPE        VALUE
------------------------------------ ----------- -------------------
sec_case_sensitive_logon             boolean     TRUE


create spfile from pfile;

shutdown immediate

startup

exit


**** Restore DPUATTST from Saved backup *******


Please RESTORE the DPUATTST database to baseline backup (DPUATTST_sbk_20171214_15:12:26_Baseline.rman).



###Blackout Database in OEM

. ~/.profile

DPUATTST

cd $SAVBKP

view DPUATTST_sbk_20171214_15:12:26_Baseline.rman

sqlplus / as sysdba

shutdown immediate;


cd /u05/oradata/DPUATTST/


rm -f *.dbf




#Restore DataBase
connect target /
connect catalog DPUATTST/DPUATTSTnamr@RCATDEV
startup force nomount;
set DBID=1856252781;
reset database to incarnation 60302;
restore controlfile from 'c-1856252781-20171214-01';
alter database mount;
run{
restore database until sequence 17;
recover database until sequence 17;
}
alter database open resetlogs;
#End Restore DataBase




###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


Remove OEM Blackout




sqlplus / as sysdba

shutdown immediate;

exit



*************


*** Restore DPDEV92 from saved backup**************



/u01/app/oracle/aetna/db_admin/db_${ORACLE_SID}/autoimp


Blackout Database in OEM

. ~/.profile

DPDEV92

cd $SAVBKP

view DPDEV92_sbk_20191007_02:45:03_b4tax19D.rman
     

DPDEV92_sbk_20191209_02:45:01_b4tax19E.rman

sqlplus / as sysdba

shutdown immediate;


RMAN-03002: failure of restore command at 01/07/2020 10:59:55
RMAN-06172: no AUTOBACKUP found or specified handle is not a valid copy or piece

CHANGE BACKUPSET 1131412 KEEP FOREVER;
LIST BACKUPSET 1131412;

CHANGE BACKUPSET 1195917 KEEP FOREVER;;
LIST BACKUPSET 1195917;
#Restore DataBase
connect target /
connect catalog DPDEV92/DPDEV92namr@RCATDEV
startup force nomount;
set DBID=2243699043;
reset database to incarnation 229602;
restore controlfile from 'c-2243699043-20191007-01_DPDEV92';
alter database mount;
run{
restore database until sequence 16245;
recover database until sequence 16245;
}
alter database open resetlogs;
#End Restore DataBase



###@?/rdbms/admin/utlrp.sql


select count(*)
from dba_objects
where status = 'INVALID';


Remove OEM Blackout

crontab /u01/app/oracle/crontab.lst




***** Restore from DPDEV92_sbk_20200127_02:45:02_b4tax20A.rman ***