---7:05 PM


   7:05 p.m. confirm Datapump job is running:
   ps -ef |grep expdp

   Disable cron
   cd $ORACLE_BASE
   crontab -l > crontab.current
   Confirm backup copy of cron in $ORACLE_BASE directory
   view crontab.current
   crontab -r

   8:05 p.m. or so you should receive an email indicating Datapump job complete.
   !!!Send email back to Curt and Rick that this was completed
   !!!Do not shutdown Unix server or database DPPRD01 until Datapump email notification received.


---after 8:30 PM

1. Get confirmation from Rick that all app Servers are down before going to next step

   

2. Disable autostart
   
   Copy /etc/oratab to $ORACLE_BASE/oratab_20080912
   cd /etc
   cp oratab $ORACLE_BASE/oratab_20080912
   vi /etc/oratab
   Set the startup flag to "N" for (DPPRD01 and DPPRD02)


3. Stop Database Controls
   - set the Oracle environment (DPPRD01 and DPPRD02)
   - run emctl stop dbcontrol
   To verify shutdown, run:
  - run emctl status dbcontrol


4. Drop sysman user on all databases (DPPRD01 and DPPRD02)
   For each instance:
   Set $ORACLE_SID and $ORACLE_HOME accordingly
   #Set Env Variable
   #HOST=`hostname`
   HOST=spnode45.add.net


   #Check to see if dbcontrol already configured
   ls $ORACLE_HOME/${HOST}_$ORACLE_SID
   ls $ORACLE_HOME/oc4j/j2ee/OC4J_DBConsole_*_${ORACLE_SID}
   If directories exist, remove them
   cd $ORACLE_HOME
   rm -r $ORACLE_HOME/${HOST}_$ORACLE_SID
   rm -r $ORACLE_HOME/oc4j/j2ee/OC4J_DBConsole_*_${ORACLE_SID}

   !!!Make sure (FTP) sftp this file over to spnode45 first
   cd /tmp
   sqlplus "/ as sysdba"
   @drop_sysman_etc.sql
   exit

5.Shutdown Listeners and Databases
  cd /u01/app/oracle/local
  ./shutdown_oracle_processes.ksh 

  To verify, run:
  ps -ef | grep pmon
  No pmon processes should be found
  Then run:
  ps -ef | grep tns
  No tnslistener processes should be found
  Shut down any remaining databases or listeners manually.



6. Edit listener.ora and tnsnames.ora to remove add.net
   For each oracle home:
   make a backup of the tnsnames.ora and listener.ora files.
   vi $ORACLE_HOME/network/admin/tnsnames.ora
    and 
   vi $ORACLE_HOME/network/admin/listener.ora
   Remove references to "add.net"

7. ALL SET no need to do !!!! --Edit tnsnames.ora files on PeopleSoft App Server (sspireapw1p and sspireapw2p ) 
     


---After Server move to AETH domain -------

1. Enable Oracle autostart
   cd /etc
   vi oratab and set startup entry to Y for (DPPRD01 and DPPRD02)

2. Verify that oracle id belongs to dba group
   Run id
   Output should be: uid=7(oracle) gid=11(dba) groups=1(staff),13(invscout)

3. Verify the rc.net file has been updated with the correct host name
   Run hostname
   Should say spnode45.aetna.com
   
4. Run script to startup databases and listeners. If Server rebooted after autostart enable. All should be running
   /u01/app/oracle/local/start_oracle_processes.ksh

5. Reconfigure the database controls
   
 Set Oracle environment for database DPPRD01
 Obtain port number for database DPPRD01 from listener.ora file (1521)
 ## ---pass: sysdpprd01---
 ./emca -config dbcontrol db -repos create -DBCONTROL_HTTP_PORT 1158 -AGENT_PORT 3938 -RMI_PORT 5520 -JMS_PORT 5540


 Set Oracle environment for database DPPRD02
 Obtain port number for database DPPRD02 from listener.ora file (1522) 
 ##---pass: sysdpprd02---
 ./emca -config dbcontrol db -repos create -DBCONTROL_HTTP_PORT 5500 -AGENT_PORT 1830 -RMI_PORT 5521 -JMS_PORT 5541

6. Verify Remote Connection from desktop (Sqlplus or DBArtisan)

  
7. Verify dblinks to WKABPROD (if WKABPROD is up at this moment. If not do it later)
     Login to DPPRD01 database 
     select 1 from dual@WKABPROD.WORLD;



9. Change the following code in script $BKPSCR/dbbackup_begin: 

   Copy existing script first for backup.
   cd $BKPSCR
   cp dbbackup_begin dbbackup_begin_20080912

   vi dbbackup_begin

   $HOST = 'spnode45.add.net'
      to
   $HOST = 'spnode45.aetna.com'

8. Manually start following jobs
  


   *** Run the following jobs in the following order:
   *** Do not start the next job until the previous job completes.
  cd /u01/app/oracle/aetna/db_mgmt/backup
  ###- Runs approximately 80 minutes
  nohup ./hot_backup.ksh DPPRD01 &
  ###- Runs approximately 65 minutes                  
  nohup ./expdp_full.ksh DPPRD02 &      

  cd /u01/app/oracle/aetna/db_mgmt/analyze      
  ###- Runs approximately 2 minutes          
  nohup ./analyze_sjt_tables.ksh DPPRD01 &  

  cd /u01/app/oracle/aetna/db_mgmt/extsecur
  ###-DPPRD02 - Runs approximately 2 minutes
  nohup ./ext_spcl_permissions.ksh DPPRD02 &       
 
  cd /u01/app/oracle/tls
  ###- Runs approximately 5 minutes
  nohup ./stop_dbconsole.ksh DPPRD02 &   

  cd  /u01/app/oracle/admin/DPPRD02/autoimp
  ###- Runs approximately 5 minutes
  nohup ./export_security_tables_b4_dbrefresh.ksh                                      
  

  !!! Make sure Rick send out confirmation that 02 App Servers are down
  cd /u01/app/oracle/admin/DPPRD02/autoimp
  ###- Runs approximately 4 1/2 hours
  nohup ./auto_import.ksh 1 & 
                           





9. Enable Cron table after 7:00 a.m. Saturday morning:
   !!!Do not enable before 7:00 a.m.
   cd $ORACLE_BASE
   crontab crontab.current
   Verify: crontab -l




