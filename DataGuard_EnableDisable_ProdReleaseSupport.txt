																								wssssssssssa
Kuziak, Paul J KuziakP2@AETNA.com        (all of HRP which is PY and DW)
Graham, Judy K GrahamJK@aetna.com    (Paul’s boss)
Rajasekar, Karthikeyan RajasekarK@aetna.com     (Care Manager and MP)




!!! Example in QA

@check_dg_parms sql scripts in $SQLPATH
@check_dg_logs  sql scripts in $SQLPATH

cd $SCRIPTS


FOR QA
xhepydbw1q.aetna.com (oracle) HEPYQA::/orahome/u01/app/oracle/local/scripts
HEPYQA> ./DISable__HEPYQA_xhepydbw1q.sh


xhepydbw1q.aetna.com (oracle) HEPYQA::/orahome/u01/app/oracle/local/scripts
HEPYQA> cd ../logs
(to view logs of “transport” change…  
…
-rw-r--r-- 1 oracle dba 5456 Sep  1  2016 transport__09-01-2016-093723__HEPYQA.out
-rw-r--r-- 1 oracle dba 5456 Jun 29 10:01 transport__06-29-2017-100105__HEPYQA.out
-rw-r--r-- 1 oracle dba 5456 Jul  5 15:51 transport__07-05-2017-155149__HEPYQA.out
-rw-r--r-- 1 oracle dba 5455 Jul  5 15:55 transport__07-05-2017-155551__HEPYQA.out

xhepydbw1q.aetna.com (oracle) HEPYQA::/orahome/u01/app/oracle/local/logs
HEPYQA>








***********July 15/16 Application upgrade DG tasks*********************


-----------------------------------------------------------------------------> On Sunday July 16 around 12:30 AM 

!!!!DISABLE DG Trasport for PY

In Prod on primary machine xhepydbm1p for PAYOR (PY)

--Get oracle password from TPAM

. oraenv

HEPYPRD


## To disable data guard

cd $SCRIPTS

./DISable__HEPYPRD_xhepydbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr

!!! Create Restore Point

  No need for this 
###create_restore_point.sh HEPYPRD b4_HEPYPRD_20170716



!!!!DISABLE DG Trasport for DW

In Prod on primary machine xhedwdbm1p for Data Warehouse (DW)

--Get oracle password from TPAM

. oraenv

HEDWPRD


## To disable data guard

cd $SCRIPTS


./DISable__HEDWPRD_xhedwdbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!! Create Restore Point
  
No need for this19923
###create_restore_point.sh HEDWPRD b4_HEDWPRD_20170716


-------------------------------------------------------------------------> On Sunday July 16 around 6:30 AM



!!!!ENABLE DG Trasport for PY

In Prod on primary machine xhepydbm1p for PAYOR (PY)

--Get oracle password from TPAM

. oraenv

HEPYPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts

./ENable__HEPYPRD_xhepydbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!!!ENABLE DG Trasport for DW

In Prod on primary machine xhedwdbm1p for Data Warehouse (DW)

--Get oracle password from TPAM

. oraenv

HEDWPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts

./ENable__HEDWPRD_xhedwdbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr




SELECT DB_NAME, HOSTNAME, LOG_ARCHIVED, LOG_APPLIED,APPLIED_TIME,
LOG_ARCHIVED-LOG_APPLIED LOG_GAP
FROM
(
SELECT NAME DB_NAME
FROM V$DATABASE
),
(
SELECT UPPER(SUBSTR(HOST_NAME,1,(DECODE(INSTR(HOST_NAME,'.'),0,LENGTH(HOST_NAME),
(INSTR(HOST_NAME,'.')-1))))) HOSTNAME
FROM V$INSTANCE
),
(
SELECT MAX(SEQUENCE#) LOG_ARCHIVED
FROM V$ARCHIVED_LOG WHERE DEST_ID=1 AND ARCHIVED='YES'
),
(
SELECT MAX(SEQUENCE#) LOG_APPLIED
FROM V$ARCHIVED_LOG WHERE DEST_ID=2 AND APPLIED='YES'
),
(
SELECT TO_CHAR(MAX(COMPLETION_TIME),'DD-MON/HH24:MI') APPLIED_TIME
FROM V$ARCHIVED_LOG WHERE DEST_ID=2 AND APPLIED='YES'
);

!!! Example
DB_NAME	HOSTNAME	LOG_ARCHIVED	LOG_APPLIED	APPLIED_TIME	LOG_GAP
HEPYPRD	XHEPYDBM1P	420895		420894		16-JUL/09:20	1


6.	Verify the Standby database has been recovered to the last archive log from Primary:
On Primary:
	SQL> select max(sequence#) from v$archived_log;
On Standby:
	SQL> select max(sequence#) from v$log_history;




Suspend: BACKUP_HEDWPRD_DAILY_LEVEL_1



***********Dec 16/17 Application upgrade DG tasks*********************


-----------------------------------------------------------------------------> On Saturday Dec 16 around 10:30 PM 

!!!!DISABLE DG Trasport for PY

In Prod on primary machine xhepydbm1p for PAYOR (PY)

--Get oracle password from TPAM

. oraenv

HEPYPRD


## To disable data guard

cd $SCRIPTS

./DISable__HEPYPRD_xhepydbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!DISABLE DG Trasport for DW

In Prod on primary machine xhedwdbm1p for Data Warehouse (DW)

--Get oracle password from TPAM

. oraenv

HEDWPRD


## To disable data guard

cd $SCRIPTS


./DISable__HEDWPRD_xhedwdbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!!!DISABLE DG Trasport for CM

In Prod on primary machine xmedcdbm1p for Data Care Manager (CM)
 

--Get oracle password from TPAM (not there at this point) -  Bl0ckhe@d

. oraenv

HECMPRD



## To disable data guard

cd $SCRIPTS


./DISable__HECMPRD_xmedcdbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr





-------------------------------------------------------------------------> On Sunday Dec 17 around 6:30 AM



!!!!ENABLE DG Trasport for PY

In Prod on primary machine xhepydbm1p for PAYOR (PY)

--Get oracle password from TPAM

. oraenv

HEPYPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts

./ENable__HEPYPRD_xhepydbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!!!ENABLE DG Trasport for DW

In Prod on primary machine xhedwdbm1p for Data Warehouse (DW)

--Get oracle password from TPAM

. oraenv

HEDWPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts

./ENable__HEDWPRD_xhedwdbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!ENABLE DG Trasport for CM

In Prod on primary machine xmedcdbm1p for Data Warehouse (CM)

--Get oracle password from TPAM - Bl0ckhe@d

. oraenv

HECMPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts

./ENable__HECMPRD_xmedcdbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr





SELECT DB_NAME, HOSTNAME, LOG_ARCHIVED, LOG_APPLIED,APPLIED_TIME,
LOG_ARCHIVED-LOG_APPLIED LOG_GAP
FROM
(
SELECT NAME DB_NAME
FROM V$DATABASE
),
(
SELECT UPPER(SUBSTR(HOST_NAME,1,(DECODE(INSTR(HOST_NAME,'.'),0,LENGTH(HOST_NAME),
(INSTR(HOST_NAME,'.')-1))))) HOSTNAME
FROM V$INSTANCE
),
(
SELECT MAX(SEQUENCE#) LOG_ARCHIVED
FROM V$ARCHIVED_LOG WHERE DEST_ID=1 AND ARCHIVED='YES'
),
(
SELECT MAX(SEQUENCE#) LOG_APPLIED
FROM V$ARCHIVED_LOG WHERE DEST_ID=2 AND APPLIED='YES'
),
(
SELECT TO_CHAR(MAX(COMPLETION_TIME),'DD-MON/HH24:MI') APPLIED_TIME
FROM V$ARCHIVED_LOG WHERE DEST_ID=2 AND APPLIED='YES'
);

!!! Example
DB_NAME	HOSTNAME	LOG_ARCHIVED	LOG_APPLIED	APPLIED_TIME	LOG_GAP
HEPYPRD	XHEPYDBM1P	420895		420894		16-JUL/09:20	1


6.	Verify the Standby database has been recovered to the last archive log from Primary:
On Primary:
	SQL> select max(sequence#) from v$archived_log;
On Standby:
	SQL> select max(sequence#) from v$log_history;



--- What to do if archivelog space full -----


on Primary
 
rmanc

CONFIGURE ARCHIVELOG DELETION POLICY TO BACKED UP 1 TIMES TO 'SBT_TAPE';
BACKUP ARCHIVELOG ALL DELETE INPUT;


Go to OEM and change Archivelog backup schedule to start in 2 min.


Once they are done checkout
On Primary

 1.  enable data guard
 2.  change backup policy

rmanc


CONFIGURE ARCHIVELOG DELETION POLICY TO SHIPPED TO ALL STANDBY BACKED UP 1 TIMES  TO 'SBT_TAPE';


3. Get range  of SEQUENCES to restore

## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql

 on standby  
 ###get sequence range to restore

         SELECT SEQUENCE#,APPLIED FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;


on Primary

rmanc

restore archivelog sequence between xxx and xxx;


***********Approved Request for Database Support #58994113 for Kuziak
*Source Environment:	HEPYQA HEDWQA
*Target Environment:	HEPYQA HEDWQA

!!!!DISABLE DG Trasport for PY

Login: xhepydbw1q

HEPYQA


--Just for this release. Rename Indexes
cd /home/oracle/HE_CUSTOM
sqlplus / as sysdba
@HEPYQA_index_changes.sql
exit




## To disable data guard

cd $SCRIPTS

./DISable__HEPYQA_xhepydbw1q.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!DISABLE DG Trasport for DW

--Just for this release. Rename Indexes
cd /home/oracle/AE_CUSTOM
sqlplus / as sysdba
@HEDWQA_index_changes.sql
exit



Login: xhedwdbw1q
. oraenv

HEDWQA


## To disable data guard

cd $SCRIPTS


./DISable__HEDWQA_xhedwdbw1q.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


***********Apr 7/8-2018 Application upgrade DG tasks*********************

-----------------------------------------------------------------------------> On Saturday APR 7 around 10:00 PM 


--This is just for Apr/2018 upgrade extra task
Login: xhepydbm1p

HEPYPRD

cd /home/oracle/HE_CUSTOM
sqlplus / as sysdba
@HEPYPRD_index_changes.sql
exit


Login: xhedwdbm1p

HEDWPRD

cd /home/oracle/AE_CUSTOM
sqlplus / as sysdba
@HEDWPRD_index_changes.sql
exit


Login xhedwdbm1p

HEDWPRD

cd /home/oracle/AE_CUSTOM

sqlplus / as sysdba

@create_GETRTEMEMBERDATA_v1-4-3_2018-04-05.sql

Send create_HEDWPRD_GETRTEMEMBERDATA_v1-4-3_2018-04-05.out bermane@aetna.com







!!!!DISABLE DG Trasport for PY

In Prod on primary machine xhepydbm1p for PAYOR (PY)

--Get oracle password from TPAM

. oraenv

HEPYPRD


## To disable data guard

cd $SCRIPTS

./DISable__HEPYPRD_xhepydbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!DISABLE DG Trasport for DW

In Prod on primary machine xhedwdbm1p for Data Warehouse (DW)

--Get oracle password from TPAM

. oraenv

HEDWPRD


## To disable data guard

cd $SCRIPTS


./DISable__HEDWPRD_xhedwdbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!!!!!! No need for Apr 2018 upgrade

!!!!DISABLE DG Trasport for CM

In Prod on primary machine xmedcdbm1p for Data Care Manager (CM)
 

--Get oracle password from TPAM (not there at this point) -  Bl0ckhe@d

. oraenv

HECMPRD



## To disable data guard

cd $SCRIPTS


./DISable__HECMPRD_xmedcdbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr





-------------------------------------------------------------------------> On Sunday Apr 8 around 7 AM



!!!!ENABLE DG Trasport for PY

In Prod on primary machine xhepydbm1p for PAYOR (PY)




!! First check make sure Primary and Standby orapwHEPYPRD files are the same if not copy Primary to StandBy

Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD






--Get oracle password from TPAM

. oraenv

HEPYPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts

./ENable__HEPYPRD_xhepydbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!!!ENABLE DG Trasport for DW

In Prod on primary machine xhedwdbm1p for Data Warehouse (DW)


!! First check make sure Primary and Standby orapwHEDWPRD files are the same if not copy Primary to StandBy

(scp -p orapwHEDWPRD xhedwdbw1p:/orahome/u01/app/oracle/product/12.1.0.2.170418/db_1/dbs/orapwHEDWPRD)

Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD




--Get oracle password from TPAM

. oraenv

HEDWPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts

./ENable__HEDWPRD_xhedwdbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!!!!!! No need for Apr 2018 upgrade


!!!!ENABLE DG Trasport for CM

In Prod on primary machine xmedcdbm1p for Data Warehouse (CM)

--Get oracle password from TPAM - Bl0ckhe@d

. oraenv

HECMPRD



## To enable data guard

cd /orahome/u01/app/oracle/local/scripts

./ENable__HECMPRD_xmedcdbm1p.sh

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr





SELECT DB_NAME, HOSTNAME, LOG_ARCHIVED, LOG_APPLIED,APPLIED_TIME,
LOG_ARCHIVED-LOG_APPLIED LOG_GAP
FROM
(
SELECT NAME DB_NAME
FROM V$DATABASE
),
(
SELECT UPPER(SUBSTR(HOST_NAME,1,(DECODE(INSTR(HOST_NAME,'.'),0,LENGTH(HOST_NAME),
(INSTR(HOST_NAME,'.')-1))))) HOSTNAME
FROM V$INSTANCE
),
(
SELECT MAX(SEQUENCE#) LOG_ARCHIVED
FROM V$ARCHIVED_LOG WHERE DEST_ID=1 AND ARCHIVED='YES'
),
(
SELECT MAX(SEQUENCE#) LOG_APPLIED
FROM V$ARCHIVED_LOG WHERE DEST_ID=2 AND APPLIED='YES'
),
(
SELECT TO_CHAR(MAX(COMPLETION_TIME),'DD-MON/HH24:MI') APPLIED_TIME
FROM V$ARCHIVED_LOG WHERE DEST_ID=2 AND APPLIED='YES'
);

!!! Example
DB_NAME	HOSTNAME	LOG_ARCHIVED	LOG_APPLIED	APPLIED_TIME	LOG_GAP
HEPYPRD	XHEPYDBM1P	420895		420894		16-JUL/09:20	1


6.	Verify the Standby database has been recovered to the last archive log from Primary:
On Primary:
	SQL> select max(sequence#) from v$archived_log;
On Standby:
	SQL> select max(sequence#) from v$log_history;


## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql




--- What to do if archivelog space full -----


on Primary
 
rmanc

CONFIGURE ARCHIVELOG DELETION POLICY TO BACKED UP 1 TIMES TO 'SBT_TAPE';
BACKUP ARCHIVELOG ALL DELETE INPUT;


Go to OEM and change Archivelog backup schedule to start in 2 min.


Once they are done checkout
On Primary

 1.  enable data guard
 2.  change backup policy

rmanc



xhepydbw1p://orahome/u01/app/oracle/product/12.1.0.2.170418/db_1/dbs/orapwHEPYPRD
CONFIGURE ARCHIVELOG DELETION POLICY TO SHIPPED TO ALL STANDBY BACKED UP 1 TIMES  TO 'SBT_TAPE';


3. Get range  of SEQUENCES to restore

## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql

 on standby  
 ###get sequence range to restore

         SELECT SEQUENCE#,APPLIED FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;


on Primary

rmanc

restore archivelog sequence between xxx and xxx;





***********June 14/15-2018 Application upgrade DG tasks*********************

-----------------------------------------------------------------------------> On Saturday June 14 around 4 PM 





!!!!DISABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)


--Get oracle password from TPAM

. oraenv

HEPYPRD


## To disable data guard

cd $SCRIPTS

!! Check make sure not N/A sessions. (Kill it)
   Check make sure all apps connection down and nothing running.

./DISable__HEPYPRD_xhepydbm21p.sh

or

./DISable_log_shipping.sh HEPYPRD


## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!DISABLE DG Trasport for DW

In Prod on primary machine xhedwdbm21p for Data Warehouse (DW)

--Get oracle password from TPAM

. oraenv

HEDWPRD


## To disable data guard

cd $SCRIPTS


./DISable__HEDWPRD_xhedwdbm21p.sh

or

./DISable_log_shipping.sh HEDWPRD

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!!!!!! No need for JUne 2018 upgrade Care Manager (CM)






-------------------------------------------------------------------------> On Sunday June 15 around 7:30 AM



!!!!ENABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)




!! First check make sure Primary and Standby orapwHEPYPRD files are the same if not copy Primary to StandBy

Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD






--Get oracle password from TPAM

. oraenv

HEPYPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts

./ENable__HEPYPRD_xhepydbm21p.sh


or

./ENable_log_shipping.sh HEPYPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!!!ENABLE DG Trasport for DW

In Prod on primary machine xhepydbw21p for Data Warehouse (DW)


!! First check make sure Primary and Standby orapwHEDWPRD files are the same if not copy Primary to StandBy

(scp -p orapwHEDWPRD xhedwdbw21p:/orahome/u01/app/oracle/product/12.1.0.2.180116/db_1/dbs/orapwHEDWPRD)

Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD




--Get oracle password from TPAM

. oraenv

HEDWPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts

./ENable__HEDWPRD_xhedwdbm21p.sh


or 

./ENable_log_shipping.sh HEDWPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!!!!!! No need for Apr 2018 upgrade ENABLE DG Trasport for CM




SELECT DB_NAME, HOSTNAME, LOG_ARCHIVED, LOG_APPLIED,APPLIED_TIME,
LOG_ARCHIVED-LOG_APPLIED LOG_GAP
FROM
(
SELECT NAME DB_NAME
FROM V$DATABASE
),
(
SELECT UPPER(SUBSTR(HOST_NAME,1,(DECODE(INSTR(HOST_NAME,'.'),0,LENGTH(HOST_NAME),
(INSTR(HOST_NAME,'.')-1))))) HOSTNAME
FROM V$INSTANCE
),
(
SELECT MAX(SEQUENCE#) LOG_ARCHIVED
FROM V$ARCHIVED_LOG WHERE DEST_ID=1 AND ARCHIVED='YES'
),
(
SELECT MAX(SEQUENCE#) LOG_APPLIED
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
),
(
SELECT TO_CHAR(MAX(COMPLETION_TIME),'DD-MON/HH24:MI') APPLIED_TIME
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
);


!!! Example
DB_NAME	HOSTNAME	LOG_ARCHIVED	LOG_APPLIED	APPLIED_TIME	LOG_GAP
HEPYPRD	XHEPYDBM1P	420895		420894		16-JUL/09:20	1


6.	Verify the Standby database has been recovered to the last archive log from Primary:
On Primary:
	SQL> select max(sequence#) from v$archived_log;
On Standby:
	SQL> select max(sequence#) from v$log_history;


## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql




--- What to do if archivelog space full -----


on Primary
 
rmanc

CONFIGURE ARCHIVELOG DELETION POLICY TO BACKED UP 1 TIMES TO 'SBT_TAPE';
BACKUP ARCHIVELOG ALL DELETE INPUT;


Go to OEM and change Archivelog backup schedule to start in 2 min.


Once they are done checkout
On Primary

 1.  enable data guard
 2.  change backup policy

rmanc



xhepydbw1p://orahome/u01/app/oracle/product/12.1.0.2.170418/db_1/dbs/orapwHEPYPRD
CONFIGURE ARCHIVELOG DELETION POLICY TO SHIPPED TO ALL STANDBY BACKED UP 1 TIMES  TO 'SBT_TAPE';


3. Get range  of SEQUENCES to restore

## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql

 on standby  
 ###get sequence range to restore

         SELECT SEQUENCE#,APPLIED FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;


on Primary

rmanc

restore archivelog sequence between xxx and xxx;




***** QA1 *****

!!!!DISABLE DG Trasport for PY

In primary machine xhepydbw21q for PAYOR (PY)


. oraenv

HEPYQA


## To disable data guard

cd $SCRIPTS

!! Check make sure not N/A sessions. (Kill it)
   Check make sure all apps connection down and nothing running.



--If No Standby just take restore point
cd /home/oracle/tls/rman
./create_restore_point_new.sh HEPYQA B4UPGRDEC012020


./DISable_log_shipping.sh HEPYQA


## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!DISABLE DG Trasport for DW

In Prod on primary machine xhedwdbw21q for Data Warehouse (DW)


. oraenv

HEDWQA


## To disable data guard

cd $SCRIPTS

--If No Standby just take restore point
cd /home/oracle/tls/rman
./create_restore_point_new.sh HEDWQA B4UPGJUN232020

./DISable_log_shipping.sh HEDWQA

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr







-------------------------------------------------------------------------> next  day



!!!!ENABLE DG Trasport for PY

In Prod on primary machine xhepydbw21q  for PAYOR (PY)





. oraenv

HEPYQA


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts


./ENable_log_shipping.sh HEPYQA



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!!!ENABLE DG Trasport for DW

In Prod on primary machine xhedwdbw21q for Data Warehouse (DW)



. oraenv

HEDWQA


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts

./ENable_log_shipping.sh HEDWQA



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!!!!!! No need for Apr 2018 upgrade ENABLE DG Trasport for CM




SELECT DB_NAME, HOSTNAME, LOG_ARCHIVED, LOG_APPLIED,APPLIED_TIME,
LOG_ARCHIVED-LOG_APPLIED LOG_GAP
FROM
(
SELECT NAME DB_NAME
FROM V$DATABASE
),
(
SELECT UPPER(SUBSTR(HOST_NAME,1,(DECODE(INSTR(HOST_NAME,'.'),0,LENGTH(HOST_NAME),
(INSTR(HOST_NAME,'.')-1))))) HOSTNAME
FROM V$INSTANCE
),
(
SELECT MAX(SEQUENCE#) LOG_ARCHIVED
FROM V$ARCHIVED_LOG WHERE DEST_ID=1 AND ARCHIVED='YES'
),
(
SELECT MAX(SEQUENCE#) LOG_APPLIED
FROM V$ARCHIVED_LOG WHERE DEST_ID=2 AND APPLIED='YES'
),
(
SELECT TO_CHAR(MAX(COMPLETION_TIME),'DD-MON/HH24:MI') APPLIED_TIME
FROM V$ARCHIVED_LOG WHERE DEST_ID=2 AND APPLIED='YES'
);


!!! Example
DB_NAME	HOSTNAME	LOG_ARCHIVED	LOG_APPLIED	APPLIED_TIME	LOG_GAP
HEPYPRD	XHEPYDBM1P	420895		420894		16-JUL/09:20	1


6.	Verify the Standby database has been recovered to the last archive log from Primary:
On Primary:
	SQL> select max(sequence#) from v$archived_log;
On Standby:
	SQL> select max(sequence#) from v$log_history;


## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql




--- What to do if archivelog space full -----


on Primary
 
rmanc

CONFIGURE ARCHIVELOG DELETION POLICY TO BACKED UP 1 TIMES TO 'SBT_TAPE';
BACKUP ARCHIVELOG ALL DELETE INPUT;


Go to OEM and change Archivelog backup schedule to start in 2 min.


Once they are done checkout
On Primary

 1.  enable data guard
 2.  change backup policy

rmanc



xhepydbw1p://orahome/u01/app/oracle/product/12.1.0.2.170418/db_1/dbs/orapwHEPYPRD
CONFIGURE ARCHIVELOG DELETION POLICY TO SHIPPED TO ALL STANDBY BACKED UP 1 TIMES  TO 'SBT_TAPE';


3. Get range  of SEQUENCES to restore

## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql

 on standby  
 ###get sequence range to restore

         SELECT SEQUENCE#,APPLIED FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;


on Primary

rmanc

restore archivelog sequence between xxx and xxx;




***** Oct 6/7 2018 App Upgrade **************

-----------------------------------------------------------------------------> On Saturday Oct 06  11 PM 





!!!!DISABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)

-- Check make sure Level 0 completed
-- Check make sure last Archivelog completed.
-- Check make sure FLASH space freed up

--Get oracle password from TPAM

. oraenv

HEPYPRD


## To disable data guard

cd $SCRIPTS

!! Check make sure not N/A sessions. (Kill it)
   Check make sure all apps connection down and nothing running.


./DISable_log_shipping.sh HEPYPRD


## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!DISABLE DG Trasport for DW

In Prod on primary machine xhedwdbm21p for Data Warehouse (DW)

--Get oracle password from TPAM

. oraenv

HEDWPRD


-- Check make sure Level 0 completed
-- Check make sure last Archivelog completed.
-- Check make sure FLASH space freed up



## To disable data guard

cd $SCRIPTS


./DISable_log_shipping.sh HEDWPRD

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!!!!!! No need for OCT 2018 upgrade Care Manager (CM)






-------------------------------------------------------------------------> On Sunday Oct 07 around 6:30 AM



!!!!ENABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)




!! First check make sure Primary and Standby orapwHEPYPRD files are the same if not copy Primary to StandBy

Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD






--Get oracle password from TPAM

. oraenv

HEPYPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts



./ENable_log_shipping.sh HEPYPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!!!ENABLE DG Trasport for DW

In Prod on primary machine xhepydbw21p for Data Warehouse (DW)


!! First check make sure Primary and Standby orapwHEDWPRD files are the same if not copy Primary to StandBy

(scp -p orapwHEDWPRD xhedwdbw21p:/orahome/u01/app/oracle/product/12.1.0.2.180116/db_1/dbs/orapwHEDWPRD)

Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD




--Get oracle password from TPAM

. oraenv

HEDWPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts
r 

./ENable_log_shipping.sh HEDWPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr

!!! Just for OCT 2018 Upgrade

Check in HEDWPRD if these still have SQL Profiles

12x05xm9uwvs0

     
6t18s067t8nqx


!!!!!!!!! No need for Apr 2018 upgrade ENABLE DG Trasport for CM




SELECT DB_NAME, HOSTNAME, LOG_ARCHIVED, LOG_APPLIED,APPLIED_TIME,
LOG_ARCHIVED-LOG_APPLIED LOG_GAP
FROM
(
SELECT NAME DB_NAME
FROM V$DATABASE
),
(
SELECT UPPER(SUBSTR(HOST_NAME,1,(DECODE(INSTR(HOST_NAME,'.'),0,LENGTH(HOST_NAME),
(INSTR(HOST_NAME,'.')-1))))) HOSTNAME
FROM V$INSTANCE
),
(
SELECT MAX(SEQUENCE#) LOG_ARCHIVED
FROM V$ARCHIVED_LOG WHERE DEST_ID=1 AND ARCHIVED='YES'
),
(
SELECT MAX(SEQUENCE#) LOG_APPLIED
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
),
(
SELECT TO_CHAR(MAX(COMPLETION_TIME),'DD-MON/HH24:MI') APPLIED_TIME
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
);


!!! Example
DB_NAME	HOSTNAME	LOG_ARCHIVED	LOG_APPLIED	APPLIED_TIME	LOG_GAP
HEPYPRD	XHEPYDBM1P	420895		420894		16-JUL/09:20	1


6.	Verify the Standby database has been recovered to the last archive log from Primary:
On Primary:
	SQL> select max(sequence#) from v$archived_log;
On Standby:
	SQL> select max(sequence#) from v$log_history;


## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql



Check How much Archivelog generated

36 -                    17
LOGS_GENERATED	HOUR	SIZE_GB
66	10/07/2018 00	32.0347442626953125
18	10/07/2018 01	8.2161712646484375
16	10/07/2018 02	6.595123291015625
2	10/07/2018 04	0.23516082763671875
8	10/07/2018 06	2.348602294921875

Total: 65 GB


--- What to do if archivelog space full -----


on Primary
 
rmanc

CONFIGURE ARCHIVELOG DELETION POLICY TO BACKED UP 1 TIMES TO 'SBT_TAPE';
BACKUP ARCHIVELOG ALL DELETE INPUT;


Go to OEM and change Archivelog backup schedule to start in 2 min.


Once they are done checkout
On Primary

 1.  enable data guard
 2.  change backup policy

rmanc



xhepydbw1p://orahome/u01/app/oracle/product/12.1.0.2.170418/db_1/dbs/orapwHEPYPRD
CONFIGURE ARCHIVELOG DELETION POLICY TO SHIPPED TO ALL STANDBY BACKED UP 1 TIMES  TO 'SBT_TAPE';


3. Get range  of SEQUENCES to restore

## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql

 on standby  
 ###get sequence range to restore

         SELECT SEQUENCE#,APPLIED FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;


on Primary

rmanc

restore archivelog sequence between xxx and xxx;


***** Dec 1/2 2018 App Upgrade **************




-----------------------------------------------------------------------------> On Saturday Dec 1  11 PM 





!!!!DISABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)

-- Check make sure Level 0 completed (should start 1 AM on Saturday and should be done way before 11PM check around 10 AM)
-- Check make sure last Archivelog completed. ( 10:50 PM should kick off last one)
-- Check make sure FLASH space freed up

--Get oracle password from TPAM

. oraenv

HEPYPRD


## To disable data guard

cd $SCRIPTS

!! Check make sure not N/A sessions. (Kill it)
   Check make sure all apps connection down and nothing running.


./DISable_log_shipping.sh HEPYPRD


## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!DISABLE DG Trasport for DW

In Prod on primary machine xhedwdbm21p for Data Warehouse (DW)


-- Check make sure Level 0 completed (should start 9 AM on Saturday and should be done way before 11PM check around 11 AM)
-- Check make sure last Archivelog completed. ( 10:30 PM should kick off last one)
-- Check make sure FLASH space freed up


--Get oracle password from TPAM

. oraenv

HEDWPRD


-- Check make sure Level 0 completed
-- Check make sure last Archivelog completed.
-- Check make sure FLASH space freed up



## To disable data guard

cd $SCRIPTS


./DISable_log_shipping.sh HEDWPRD

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!!!!!! No need for DEC 2018 upgrade Care Manager (CM)






-------------------------------------------------------------------------> On Sunday Dec 2 around 6:30 AM



!!!!ENABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)




!! First check make sure Primary and Standby orapwHEPYPRD files are the same if not copy Primary to StandBy

cd $ORACLE_HOME/dbs

(scp -p orapwHEPYPRD xhepydbw21p:/orahome/u01/app/oracle/product/12.1.0.2.180717/db_1/dbs/orapwHEPYPRD)


Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD






--Get oracle password from TPAM

. oraenv

HEPYPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts



./ENable_log_shipping.sh HEPYPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!!!ENABLE DG Trasport for DW

In Prod on primary machine xhepydbw21p for Data Warehouse (DW)


!! First check make sure Primary and Standby orapwHEDWPRD files are the same if not copy Primary to StandBy

cd $ORACLE_HOME/dbs

(scp -p orapwHEDWPRD xhedwdbw21p:/orahome/u01/app/oracle/product/12.1.0.2.180717/db_1/dbs/orapwHEDWPRD)








Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD




--Get oracle password from TPAM

. oraenv

HEDWPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts
r 

./ENable_log_shipping.sh HEDWPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr




!!!!!!!!! No need for DEC 2018 upgrade ENABLE DG Trasport for CM




SELECT DB_NAME, HOSTNAME, LOG_ARCHIVED, LOG_APPLIED,APPLIED_TIME,
LOG_ARCHIVED-LOG_APPLIED LOG_GAP
FROM
(
SELECT NAME DB_NAME
FROM V$DATABASE
),
(
SELECT UPPER(SUBSTR(HOST_NAME,1,(DECODE(INSTR(HOST_NAME,'.'),0,LENGTH(HOST_NAME),
(INSTR(HOST_NAME,'.')-1))))) HOSTNAME
FROM V$INSTANCE
),
(
SELECT MAX(SEQUENCE#) LOG_ARCHIVED
FROM V$ARCHIVED_LOG WHERE DEST_ID=1 AND ARCHIVED='YES'
),
(
SELECT MAX(SEQUENCE#) LOG_APPLIED
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
),
(
SELECT TO_CHAR(MAX(COMPLETION_TIME),'DD-MON/HH24:MI') APPLIED_TIME
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
);


!!! Example
DB_NAME	HOSTNAME	LOG_ARCHIVED	LOG_APPLIED	APPLIED_TIME	LOG_GAP
HEPYPRD	XHEPYDBM1P	420895		420894		16-JUL/09:20	1


6.	Verify the Standby database has been recovered to the last archive log from Primary:
On Primary:
	SQL> select max(sequence#) from v$archived_log;
On Standby:
	SQL> select max(sequence#) from v$log_history;


## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql



Check How much Archivelog generated

36 -                    17
LOGS_GENERATED	HOUR	SIZE_GB
66	10/07/2018 00	32.0347442626953125
18	10/07/2018 01	8.2161712646484375
16	10/07/2018 02	6.595123291015625
2	10/07/2018 04	0.23516082763671875
8	10/07/2018 06	2.348602294921875

Total: 65 GB


--- What to do if archivelog space full -----


on Primary
 
rmanc

CONFIGURE ARCHIVELOG DELETION POLICY TO BACKED UP 1 TIMES TO 'SBT_TAPE';
BACKUP ARCHIVELOG ALL DELETE INPUT;


Go to OEM and change Archivelog backup schedule to start in 2 min.


Once they are done checkout
On Primary

 1.  enable data guard
 2.  change backup policy

rmanc




CONFIGURE ARCHIVELOG DELETION POLICY TO SHIPPED TO ALL STANDBY BACKED UP 1 TIMES TO 'SBT_TAPE';


3. Get range  of SEQUENCES to restore

## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql

 on standby  
 ###get sequence range to restore

         SELECT SEQUENCE#,APPLIED FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;


on Primary

rmanc

restore archivelog sequence between xxx and xxx;


****EB
***** 02/24/2019 18.10.1.2 *****


-----------------------------------------------------------------------------> On Sunday 5:30 AM 





!!!!DISABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)

-- Check make sure Level 0 completed (should start 1 AM on Saturday and should be done way before 11PM check around 10 AM)
-- Check make sure last Archivelog completed. ( 10:50 PM should kick off last one)
-- Check make sure FLASH space freed up

--Get oracle password from TPAM - r2e$MloQ

. oraenv

HEPYPRD


## To disable data guard

cd $SCRIPTS

!! Check make sure not N/A sessions. (Kill it)
   Check make sure all apps connection down and nothing running.


./DISable_log_shipping.sh HEPYPRD


## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!DISABLE DG Trasport for DW

In Prod on primary machine xhedwdbm21p for Data Warehouse (DW)


-- Check make sure Level 0 completed (should start 9 AM on Saturday and should be done way before 11PM check around 11 AM)
-- Check make sure last Archivelog completed. ( 10:30 PM should kick off last one)
-- Check make sure FLASH space freed up


--Get oracle password from TPAM - S0k?jHkz

. oraenv

HEDWPRD


-- Check make sure Level 0 completed
-- Check make sure last Archivelog completed.
-- Check make sure FLASH space freed up



## To disable data guard

cd $SCRIPTS


./DISable_log_shipping.sh HEDWPRD

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!!!!!! No need for this upgrade disable Care Manager (CM)






-------------------------------------------------------------------------> On Sunday 7:30 AM



!!!!ENABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)




!! First check make sure Primary and Standby orapwHEPYPRD files are the same if not copy Primary to StandBy

cd $ORACLE_HOME/dbs

(scp -p orapwHEPYPRD xhepydbw21p:/orahome/u01/app/oracle/product/12.1.0.2.181016/db_1/dbs/orapwHEPYPRD)


Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD






--Get oracle password from TPAM

. oraenv

HEPYPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts



./ENable_log_shipping.sh HEPYPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!!!ENABLE DG Trasport for DW

In Prod on primary machine xhepydbw21p for Data Warehouse (DW)


!! First check make sure Primary and Standby orapwHEDWPRD files are the same if not copy Primary to StandBy

cd $ORACLE_HOME/dbs

(scp -p orapwHEDWPRD xhedwdbw21p:/orahome/u01/app/oracle/product/12.1.0.2.181016db_1/dbs/orapwHEDWPRD)








Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD




--Get oracle password from TPAM

. oraenv

HEDWPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts
r 

./ENable_log_shipping.sh HEDWPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr




!!!!!!!!! No need for this upgrade ENABLE DG Trasport for CM




SELECT DB_NAME, HOSTNAME, LOG_ARCHIVED, LOG_APPLIED,APPLIED_TIME,
LOG_ARCHIVED-LOG_APPLIED LOG_GAP
FROM
(
SELECT NAME DB_NAME
FROM V$DATABASE
),
(
SELECT UPPER(SUBSTR(HOST_NAME,1,(DECODE(INSTR(HOST_NAME,'.'),0,LENGTH(HOST_NAME),
(INSTR(HOST_NAME,'.')-1))))) HOSTNAME
FROM V$INSTANCE
),
(
SELECT MAX(SEQUENCE#) LOG_ARCHIVED
FROM V$ARCHIVED_LOG WHERE DEST_ID=1 AND ARCHIVED='YES'
),
(
SELECT MAX(SEQUENCE#) LOG_APPLIED
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
),
(
SELECT TO_CHAR(MAX(COMPLETION_TIME),'DD-MON/HH24:MI') APPLIED_TIME
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
);


!!! Example
DB_NAME	HOSTNAME	LOG_ARCHIVED	LOG_APPLIED	APPLIED_TIME	LOG_GAP
HEPYPRD	XHEPYDBM1P	420895		420894		16-JUL/09:20	1


6.	Verify the Standby database has been recovered to the last archive log from Primary:
On Primary:
	SQL> select max(sequence#) from v$archived_log;
On Standby:
	SQL> select max(sequence#) from v$log_history;


## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql



Check How much Archivelog generated

36 -                    17
LOGS_GENERATED	HOUR	SIZE_GB
66	10/07/2018 00	32.0347442626953125
18	10/07/2018 01	8.2161712646484375
16	10/07/2018 02	6.595123291015625
2	10/07/2018 04	0.23516082763671875
8	10/07/2018 06	2.348602294921875

Total: 65 GB


--- What to do if archivelog space full -----


on Primary
 
rmanc

CONFIGURE ARCHIVELOG DELETION POLICY TO BACKED UP 1 TIMES TO 'SBT_TAPE';
BACKUP ARCHIVELOG ALL DELETE INPUT;


Go to OEM and change Archivelog backup schedule to start in 2 min.


Once they are done checkout
On Primary

 1.  enable data guard
 2.  change backup policy

rmanc




CONFIGURE ARCHIVELOG DELETION POLICY TO SHIPPED TO ALL STANDBY BACKED UP 1 TIMES TO 'SBT_TAPE';


3. Get range  of SEQUENCES to restore

## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql

 on standby  
 ###get sequence range to restore

         SELECT SEQUENCE#,APPLIED FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;


on Primary

rmanc

restore archivelog sequence between xxx and xxx;




***** Apr 13/14 2018 App Upgrade Payor Connector 19.1.1.1/ Custom 19.1.2.1 **************




-----------------------------------------------------------------------------> On Saturday Apr 13  10:00 - 10:10 PM 





!!!!DISABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)

-- Check make sure Level 0 completed (should start 1 AM on Saturday and should be done way before 11PM check around 10 AM)
-- Check make sure last Archivelog completed. ( 9:50 PM should kick off last one)
-- Check make sure FLASH space freed up

--Get oracle password from TPAM

. oraenv

HEPYPRD


## To disable data guard

cd $SCRIPTS

!! Check make sure not N/A sessions. (Kill it)
   Check make sure all apps connection down and nothing running.


./DISable_log_shipping.sh HEPYPRD


## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!DISABLE DG Trasport for DW

In Prod on primary machine xhedwdbm21p for Data Warehouse (DW)


-- Check make sure Level 0 completed (should start 9 AM on Saturday and should be done way before 11PM check around 11 AM)
-- Check make sure last Archivelog completed. ( 9:40 PM should kick off last one)
-- Check make sure FLASH space freed up


--Get oracle password from TPAM

. oraenv

HEDWPRD


-- Check make sure Level 0 completed
-- Check make sure last Archivelog completed.
-- Check make sure FLASH space freed up



## To disable data guard

cd $SCRIPTS


./DISable_log_shipping.sh HEDWPRD

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!!!!!! No need for APR 2019 upgrade Care Manager (CM)






-------------------------------------------------------------------------> On Sunday Apr 14 around 7:45  - 8:00 AM



!!!!ENABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)




!! First check make sure Primary and Standby orapwHEPYPRD files are the same if not copy Primary to StandBy

cd $ORACLE_HOME/dbs

(scp -p orapwHEPYPRD xhepydbw21p:/orahome/u01/app/oracle/product/12.1.0.2.181016/db_1/dbs/orapwHEPYPRD)


Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD






--Get oracle password from TPAM

. oraenv

HEPYPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts



./ENable_log_shipping.sh HEPYPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!!!ENABLE DG Trasport for DW

In Prod on primary machine xhepydbw21p for Data Warehouse (DW)


!! First check make sure Primary and Standby orapwHEDWPRD files are the same if not copy Primary to StandBy

cd $ORACLE_HOME/dbs

(scp -p orapwHEDWPRD xhedwdbw21p:/orahome/u01/app/oracle/product/12.1.0.2.181016/db_1/dbs/orapwHEDWPRD)








Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD




--Get oracle password from TPAM

. oraenv

HEDWPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts
r 

./ENable_log_shipping.sh HEDWPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr




!!!!!!!!! No need for APR 2019 upgrade ENABLE DG Trasport for CM




SELECT DB_NAME, HOSTNAME, LOG_ARCHIVED, LOG_APPLIED,APPLIED_TIME,
LOG_ARCHIVED-LOG_APPLIED LOG_GAP
FROM
(
SELECT NAME DB_NAME
FROM V$DATABASE
),
(
SELECT UPPER(SUBSTR(HOST_NAME,1,(DECODE(INSTR(HOST_NAME,'.'),0,LENGTH(HOST_NAME),
(INSTR(HOST_NAME,'.')-1))))) HOSTNAME
FROM V$INSTANCE
),
(
SELECT MAX(SEQUENCE#) LOG_ARCHIVED
FROM V$ARCHIVED_LOG WHERE DEST_ID=1 AND ARCHIVED='YES'
),
(
SELECT MAX(SEQUENCE#) LOG_APPLIED
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
),
(
SELECT TO_CHAR(MAX(COMPLETION_TIME),'DD-MON/HH24:MI') APPLIED_TIME
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
);


!!! Example
DB_NAME	HOSTNAME	LOG_ARCHIVED	LOG_APPLIED	APPLIED_TIME	LOG_GAP
HEPYPRD	XHEPYDBM1P	420895		420894		16-JUL/09:20	1


6.	Verify the Standby database has been recovered to the last archive log from Primary:
On Primary:
	SQL> select max(sequence#) from v$archived_log;
On Standby:
	SQL> select max(sequence#) from v$log_history;


## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql



Check How much Archivelog generated

36 -                    17
LOGS_GENERATED	HOUR	SIZE_GB
66	10/07/2018 00	32.0347442626953125
18	10/07/2018 01	8.2161712646484375
16	10/07/2018 02	6.595123291015625
2	10/07/2018 04	0.23516082763671875
8	10/07/2018 06	2.348602294921875

Total: 65 GB


--- What to do if archivelog space full -----


on Primary
 
rmanc

CONFIGURE ARCHIVELOG DELETION POLICY TO BACKED UP 1 TIMES TO 'SBT_TAPE';
BACKUP ARCHIVELOG ALL DELETE INPUT;


Go to OEM and change Archivelog backup schedule to start in 2 min.


Once they are done checkout
On Primary

 1.  enable data guard
 2.  change backup policy

rmanc




CONFIGURE ARCHIVELOG DELETION POLICY TO SHIPPED TO ALL STANDBY BACKED UP 1 TIMES TO 'SBT_TAPE';


3. Get range  of SEQUENCES to restore

## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql

 on standby  
 ###get sequence range to restore

         SELECT SEQUENCE#,APPLIED FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;


on Primary

rmanc

restore archivelog sequence between xxx and xxx;




***** Jul 20/21 2019 App Upgrade Payor Connector 19.5 **************




-----------------------------------------------------------------------------> On Saturday July 20  10:00 - 10:10 PM 





!!!!DISABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)

-- Check make sure Level 0 completed (should start 1 AM on Saturday and should be done way before 11PM check around 10 AM)
-- Check make sure last Archivelog completed. ( 9:45 PM should kick off last one)
-- Check make sure FLASH space freed up

--Get oracle password from TPAM

. oraenv

HEPYPRD


## To disable data guard

cd $SCRIPTS

!! Check make sure not N/A sessions. (Kill it)
   Check make sure all apps connection down and nothing running.


./DISable_log_shipping.sh HEPYPRD


## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!DISABLE DG Trasport for DW

In Prod on primary machine xhedwdbm21p for Data Warehouse (DW)


-- Check make sure Level 0 completed (should start 9 AM on Saturday and should be done way before 11PM check around 11 AM)
-- Check make sure last Archivelog completed. ( 9:40 PM should kick off last one)
-- Check make sure FLASH space freed up


--Get oracle password from TPAM

. oraenv

HEDWPRD


-- Check make sure Level 0 completed
-- Check make sure last Archivelog completed.
-- Check make sure FLASH space freed up



## To disable data guard

cd $SCRIPTS


./DISable_log_shipping.sh HEDWPRD

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!!!!!! No need for July 2019 upgrade Care Manager (CM)






-------------------------------------------------------------------------> On Sunday July 21 around 6:00  - 8:00 AM



!!!!ENABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)




!! First check make sure Primary and Standby orapwHEPYPRD files are the same if not copy Primary to StandBy

cd $ORACLE_HOME/dbs

(scp -p orapwHEPYPRD xhepydbw21p:/orahome/u01/app/oracle/product/12.1.0.2.1901151/db_1/dbs/orapwHEPYPRD)


Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD






--Get oracle password from TPAM

. oraenv

HEPYPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts



./ENable_log_shipping.sh HEPYPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!!!ENABLE DG Trasport for DW

In Prod on primary machine xhepydbw21p for Data Warehouse (DW)


!! First check make sure Primary and Standby orapwHEDWPRD files are the same if not copy Primary to StandBy

cd $ORACLE_HOME/dbs

(scp -p orapwHEDWPRD xhedwdbw21p:/orahome/u01/app/oracle/product/12.1.0.2.1901151/db_1/dbs/orapwHEDWPRD)








Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD




--Get oracle password from TPAM

. oraenv

HEDWPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts
r 

./ENable_log_shipping.sh HEDWPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr




!!!!!!!!! No need for APR 2019 upgrade ENABLE DG Trasport for CM




SELECT DB_NAME, HOSTNAME, LOG_ARCHIVED, LOG_APPLIED,APPLIED_TIME,
LOG_ARCHIVED-LOG_APPLIED LOG_GAP
FROM
(
SELECT NAME DB_NAME
FROM V$DATABASE
),
(
SELECT UPPER(SUBSTR(HOST_NAME,1,(DECODE(INSTR(HOST_NAME,'.'),0,LENGTH(HOST_NAME),
(INSTR(HOST_NAME,'.')-1))))) HOSTNAME
FROM V$INSTANCE
),
(
SELECT MAX(SEQUENCE#) LOG_ARCHIVED
FROM V$ARCHIVED_LOG WHERE DEST_ID=1 AND ARCHIVED='YES'
),
(
SELECT MAX(SEQUENCE#) LOG_APPLIED
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
),
(
SELECT TO_CHAR(MAX(COMPLETION_TIME),'DD-MON/HH24:MI') APPLIED_TIME
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
);


!!! Example
DB_NAME	HOSTNAME	LOG_ARCHIVED	LOG_APPLIED	APPLIED_TIME	LOG_GAP
HEPYPRD	XHEPYDBM1P	420895		420894		16-JUL/09:20	1


6.	Verify the Standby database has been recovered to the last archive log from Primary:
On Primary:
	SQL> select max(sequence#) from v$archived_log;
On Standby:
	SQL> select max(sequence#) from v$log_history;


## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql



Check How much Archivelog generated

36 -                    17
LOGS_GENERATED	HOUR	SIZE_GB
66	10/07/2018 00	32.0347442626953125
18	10/07/2018 01	8.2161712646484375
16	10/07/2018 02	6.595123291015625
2	10/07/2018 04	0.23516082763671875
8	10/07/2018 06	2.348602294921875

Total: 65 GB


--- What to do if archivelog space full -----


on Primary
 
rmanc

CONFIGURE ARCHIVELOG DELETION POLICY TO BACKED UP 1 TIMES TO 'SBT_TAPE';
BACKUP ARCHIVELOG ALL DELETE INPUT;


Go to OEM and change Archivelog backup schedule to start in 2 min.


Once they are done checkout
On Primary

 1.  enable data guard
 2.  change backup policy

rmanc




CONFIGURE ARCHIVELOG DELETION POLICY TO SHIPPED TO ALL STANDBY BACKED UP 1 TIMES TO 'SBT_TAPE';


3. Get range  of SEQUENCES to restore

## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql

 on standby  
 ###get sequence range to restore

         SELECT SEQUENCE#,APPLIED FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;


on Primary

rmanc

restore archivelog sequence between xxx and xxx;



@@@
***** Nov 08/09 2019 App Upgrade Payor Connector 19.8 **************




-----------------------------------------------------------------------------> On Friday Nov 08  11:00  PM 





!!!!DISABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)

-- Check make sure Level 0 completed (should start 1 AM on Saturday and should be done way before 11PM check around 10 AM)
-- Check make sure last Archivelog completed. ( 9:45 PM should kick off last one)
-- Check make sure FLASH space freed up

--Get oracle password from TPAM

. oraenv

HEPYPRD


## To disable data guard

cd $SCRIPTS

!! Check make sure not N/A sessions. (Kill it)
   Check make sure all apps connection down and nothing running.


*********************


CREATE INDEX PROD.POSTAL_ADDRESS_AEDBA_2
    ON PROD.POSTAL_ADDRESS(UPPER("CITY_NM"),UPPER("ZIP_CD"),UPPER("STATE_CD"),VER_ID)
TABLESPACE INDX
LOGGING
PCTFREE 10
INITRANS 2
MAXTRANS 255
STORAGE(INITIAL 64K
        BUFFER_POOL DEFAULT)
PARALLEL 3
NOCOMPRESS
ONLINE
/
ALTER INDEX PROD.POSTAL_ADDRESS_AEDBA_2 NOPARALLEL;

********************


./DISable_log_shipping.sh HEPYPRD


## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!DISABLE DG Trasport for DW

In Prod on primary machine xhedwdbm21p for Data Warehouse (DW)


-- Check make sure Level 0 completed (should start 9 AM on Saturday and should be done way before 11PM check around 11 AM)
-- Check make sure last Archivelog completed. ( 9:40 PM should kick off last one)
-- Check make sure FLASH space freed up


--Get oracle password from TPAM

. oraenv

HEDWPRD


-- Check make sure Level 0 completed
-- Check make sure last Archivelog completed.
-- Check make sure FLASH space freed up



## To disable data guard

cd $SCRIPTS


./DISable_log_shipping.sh HEDWPRD

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!!!!!! No need for Nov 2019 upgrade Care Manager (CM)






-------------------------------------------------------------------------> On Saturday Nov 09 around 6:00  - 8:00 AM



!!!!ENABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)




!! First check make sure Primary and Standby orapwHEPYPRD files are the same if not copy Primary to StandBy

cd $ORACLE_HOME/dbs

(scp -p orapwHEPYPRD xhepydbw21p:/orahome/u01/app/oracle/product/12.1.0.2.190716/db_1/dbs/orapwHEPYPRD)


Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD






--Get oracle password from TPAM

. oraenv

HEPYPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts



./ENable_log_shipping.sh HEPYPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!!!ENABLE DG Trasport for DW

In Prod on primary machine xhepydbw21p for Data Warehouse (DW)


!! First check make sure Primary and Standby orapwHEDWPRD files are the same if not copy Primary to StandBy

cd $ORACLE_HOME/dbs

(scp -p orapwHEDWPRD xhedwdbw21p:/orahome/u01/app/oracle/product/12.1.0.2.190716/db_1/dbs/orapwHEDWPRD)








Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD




--Get oracle password from TPAM

. oraenv

HEDWPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts
r 

./ENable_log_shipping.sh HEDWPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr




!!!!!!!!! No need for Nov 2019 upgrade ENABLE DG Trasport for CM




SELECT DB_NAME, HOSTNAME, LOG_ARCHIVED, LOG_APPLIED,APPLIED_TIME,
LOG_ARCHIVED-LOG_APPLIED LOG_GAP
FROM
(
SELECT NAME DB_NAME
FROM V$DATABASE
),
(
SELECT UPPER(SUBSTR(HOST_NAME,1,(DECODE(INSTR(HOST_NAME,'.'),0,LENGTH(HOST_NAME),
(INSTR(HOST_NAME,'.')-1))))) HOSTNAME
FROM V$INSTANCE
),
(
SELECT MAX(SEQUENCE#) LOG_ARCHIVED
FROM V$ARCHIVED_LOG WHERE DEST_ID=1 AND ARCHIVED='YES'
),
(
SELECT MAX(SEQUENCE#) LOG_APPLIED
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
),
(
SELECT TO_CHAR(MAX(COMPLETION_TIME),'DD-MON/HH24:MI') APPLIED_TIME
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
);


!!! Example
DB_NAME	HOSTNAME	LOG_ARCHIVED	LOG_APPLIED	APPLIED_TIME	LOG_GAP
HEPYPRD	XHEPYDBM1P	420895		420894		16-JUL/09:20	1


6.	Verify the Standby database has been recovered to the last archive log from Primary:
On Primary:
	SQL> select max(sequence#) from v$archived_log;
On Standby:
	SQL> select max(sequence#) from v$log_history;


## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql



Check How much Archivelog generated

36 -                    17
LOGS_GENERATED	HOUR	SIZE_GB
66	10/07/2018 00	32.0347442626953125
18	10/07/2018 01	8.2161712646484375
16	10/07/2018 02	6.595123291015625
2	10/07/2018 04	0.23516082763671875
8	10/07/2018 06	2.348602294921875

Total: 65 GB


--- What to do if archivelog space full -----


on Primary
 
rmanc

CONFIGURE ARCHIVELOG DELETION POLICY TO BACKED UP 1 TIMES TO 'SBT_TAPE';
BACKUP ARCHIVELOG ALL DELETE INPUT;


Go to OEM and change Archivelog backup schedule to start in 2 min.


Once they are done checkout
On Primary

 1.  enable data guard
 2.  change backup policy

rmanc




CONFIGURE ARCHIVELOG DELETION POLICY TO SHIPPED TO ALL STANDBY BACKED UP 1 TIMES TO 'SBT_TAPE';


3. Get range  of SEQUENCES to restore

## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql

 on standby  
 ###get sequence range to restore

         SELECT SEQUENCE#,APPLIED FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;


on Primary

rmanc

restore archivelog sequence between xxx and xxx;





-------------------------------------------------HRP 19.9----------------------------> On Saturday Feb 15  11:00  PM 

-------------------------------------------------HRP 20.4----------------------------> On Saturday Aug 1   11:00  PM 

-------------------------------------------------HRP 20.7----------------------------> On Saturday Nov 21   11:00  PM 

-- Check make sure Level 0 completed (should start 1 AM on Saturday and should be done way before 11PM check around 3 PM)
-- Comment out PY and DW crontab stats job if needed

-- Add DATA, INDEX and TEMP space to HEPYPRD
-- Add DATA, INDEX space to HEDWPRD


-- Check make sure last Archivelog completed. ( 10:15 PM should kick off last one)
-- Check make sure FLASH space freed up


-- Only for 20.7 verify servers bounced and db is up (in support of adding CPU)






!!!!DISABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)

--Get oracle password from TPAM

. oraenv

HEPYPRD


## To disable data guard

cd $SCRIPTS

-- Check make sure not N/A sessions. (Kill it)
-- Check make sure all apps connection down and nothing else running.




./DISable_log_shipping.sh HEPYPRD


## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



!!!!DISABLE DG Trasport for DW

In Prod on primary machine xhedwdbm21p for Data Warehouse (DW)


-- Check make sure Level 0 completed (should start 9 AM on Saturday and should be done way before 11PM check around 3 PM)
-- Check make sure last Archivelog completed. ( 10:40 PM should kick off last one)
-- Check make sure FLASH space freed up



--Get oracle password from TPAM

. oraenv

HEDWPRD






## To disable data guard

cd $SCRIPTS


./DISable_log_shipping.sh HEDWPRD

## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr




!! Run LockUser procedure in HEDWPRD
!! Manually kill N and A ID connections





-------------------------------------------------------------------------> On Sunday Feb 16 around 7:30 AM  - 8:00 AM

-------------------------------------------------------------------------> On Sunday Aug  2 around 7:30 AM  - 8:00 AM

-------------------------------------------------------------------------> On Sunday Nov  22 around 7:30 AM  - 8:30 AM


!!!!ENABLE DG Trasport for PY

In Prod on primary machine xhepydbm21p for PAYOR (PY)




!! First check make sure Primary and Standby orapwHEPYPRD files are the same if not copy Primary to StandBy

cd $ORACLE_HOME/dbs

(scp -p orapwHEPYPRD xhepydbw21p:/orahome/u01/app/oracle/product/12.1.0.2.200414/db_1/dbs/orapwHEPYPRD)


Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEPYPRD






--Get oracle password from TPAM

. oraenv

HEPYPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts



./ENable_log_shipping.sh HEPYPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr


!!!!ENABLE DG Trasport for DW

In Prod on primary machine xhepydbw21p for Data Warehouse (DW)


!! First check make sure Primary and Standby orapwHEDWPRD files are the same if not copy Primary to StandBy

cd $ORACLE_HOME/dbs

(scp -p orapwHEDWPRD xhedwdbw21p:/orahome/u01/app/oracle/product/12.1.0.2.200414/db_1/dbs/orapwHEDWPRD)








Login to Primary 
cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD


Login to StandBy

cd $ORACLE_HOME/dbs
ls -altr orapwHEDWPRD




--Get oracle password from TPAM

. oraenv

HEDWPRD


## To enable data guard

cd /orahome/u01/app/oracle/local/scripts
r 

./ENable_log_shipping.sh HEDWPRD



## Check logs

cd /orahome/u01/app/oracle/local/logs
ls -altr



alter system switch logfile;

!! !! Run UNLOCKUSER procedure in HEDWPRD

!! Uncomment PY and DW stats crontab jobs

!! Add 20.7 indexes and SQL Profile

SELECT DB_NAME, HOSTNAME, LOG_ARCHIVED, LOG_APPLIED,APPLIED_TIME,
LOG_ARCHIVED-LOG_APPLIED LOG_GAP
FROM
(
SELECT NAME DB_NAME
FROM V$DATABASE
),
(
SELECT UPPER(SUBSTR(HOST_NAME,1,(DECODE(INSTR(HOST_NAME,'.'),0,LENGTH(HOST_NAME),
(INSTR(HOST_NAME,'.')-1))))) HOSTNAME
FROM V$INSTANCE
),
(
SELECT MAX(SEQUENCE#) LOG_ARCHIVED
FROM V$ARCHIVED_LOG WHERE DEST_ID=1 AND ARCHIVED='YES'
),
(
SELECT MAX(SEQUENCE#) LOG_APPLIED
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
),
(
SELECT TO_CHAR(MAX(COMPLETION_TIME),'DD-MON/HH24:MI') APPLIED_TIME
FROM V$ARCHIVED_LOG WHERE DEST_ID=3 AND APPLIED='YES'
);


!!! Example
DB_NAME	HOSTNAME	LOG_ARCHIVED	LOG_APPLIED	APPLIED_TIME	LOG_GAP
HEPYPRD	XHEPYDBM1P	420895		420894		16-JUL/09:20	1


6.	Verify the Standby database has been recovered to the last archive log from Primary:
On Primary:
	SQL> select max(sequence#) from v$archived_log;
On Standby:
	SQL> select max(sequence#) from v$log_history;


## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql



Check How much Archivelog generated

36 -                    17
LOGS_GENERATED	HOUR	SIZE_GB
66	10/07/2018 00	32.0347442626953125
18	10/07/2018 01	8.2161712646484375
16	10/07/2018 02	6.595123291015625
2	10/07/2018 04	0.23516082763671875
8	10/07/2018 06	2.348602294921875

Total: 65 GB


--- What to do if archivelog space full -----


on Primary
 
rmanc

CONFIGURE ARCHIVELOG DELETION POLICY TO BACKED UP 1 TIMES TO 'SBT_TAPE';
BACKUP ARCHIVELOG ALL DELETE INPUT;


Go to OEM and change Archivelog backup schedule to start in 2 min.


Once they are done checkout
On Primary

 1.  enable data guard
 2.  change backup policy

rmanc




CONFIGURE ARCHIVELOG DELETION POLICY TO SHIPPED TO ALL STANDBY BACKED UP 1 TIMES TO 'SBT_TAPE';


3. Get range  of SEQUENCES to restore

## check what was last applied on primary and standby
cd $SQLPATH
sqlplus / as sysdba
@check_dg_parms.sql
@check_dg_logs.sql

 on standby  
 ###get sequence range to restore

         SELECT SEQUENCE#,APPLIED FROM V$ARCHIVED_LOG ORDER BY SEQUENCE#;


on Primary

rmanc

restore archivelog sequence between xxx and xxx;







