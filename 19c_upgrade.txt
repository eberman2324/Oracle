ALTER USER SYSTEM
IDENTIFIED BY "locked99999"
/

ALTER USER SYS
IDENTIFIED BY "locked99999"
/


fix_standard_user_10g_password.sql

Login to xoracldw2d

cd /orasftwlib/u190/aix/database 

scp -p dbms_home_19.8.0_aix.zip floradev:/workability/orahome_tar/dbms_home_19.8.0_aix.zip


Login to floradev

cp -p /u27/app/oracle/product/agent12c/agent_13.2.0.0.0/bin/unzip /orahome/u01/app/oracle/product/unzip

cd /orahome/u01/app/oracle/product



unzip -op /workability/orahome_tar/dbms_home_19.8.0_aix.zip | tar -xvf -  




       cd /etc
     vi oratab

 --Add following line
     
ORA1980:/orahome/u01/app/oracle/product/19.8.0/db_1:N:/u01:/u27


. $SETUPENV ORA1980

   






cd /orahome/u01/app/oracle/product/19.8.0/db_1/clone/bin

Note: the following command is wrapped.  It should be entered as one line.



perl clone.pl -silent ORACLE_BASE=/orahome/u01/app/oracle ORACLE_HOME=/orahome/u01/app/oracle/product/19.8.0/db_1 ORACLE_HOME_NAME=OraDB1980Home1  oracle.install.skipRootPre=TRUE

This will take about 5 minutes.  Check the output and review log (log name in shown in the output) to make sure there are no problematic errors
You should see similar at the end:



Setup Oracle Base successful.
..................................................   95% Done.

As a root user, execute the following script(s):
        1. /orahome/u01/app/oracle/product/19.8.0/db_1/root.sh



..................................................   100% Done.









cd /u27/app/upgrades/
mkdir 19c_upgrades
cd /u27/app/upgrades/19c_upgrades


1.	execute pre-upgrade tool

$ORACLE_HOME/jdk/bin/java -jar /orahome/u01/app/oracle/product/19.8.0/db_1/rdbms/admin/preupgrade.jar TERMINAL TEXT



cd /orahome/u01/app/oracle/cfgtoollogs/DBATST/preupgrade

view preupgrade.log
Report generated by Oracle Database Pre-Upgrade Information Tool Version
19.0.0.0.0 Build: 1 on 2020-08-13T11:34:01

Upgrade-To version: 19.0.0.0.0

=======================================
Status of the database prior to upgrade
=======================================
      Database Name:  DBATST
     Container Name:  DBATST
       Container ID:  0
            Version:  12.1.0.2.0
     DB Patch Level:  DATABASE PATCH SET UPDATE 12.1.0.2.190716
         Compatible:  12.1.0.2
          Blocksize:  8192
           Platform:  AIX-Based Systems (64-bit)
      Timezone File:  19
  Database log mode:  NOARCHIVELOG
           Readonly:  FALSE
            Edition:  EE

  Oracle Component                       Upgrade Action    Current Status
  ----------------                       --------------    --------------
  Oracle Server                          [to be upgraded]  VALID
  Oracle Text                            [to be upgraded]  VALID
  Oracle XML Database                    [to be upgraded]  VALID

==============
BEFORE UPGRADE
==============

  REQUIRED ACTIONS
  ================
  1.  (AUTOFIXUP) Empty the RECYCLEBIN immediately before database upgrade.

      The database contains 2 objects in the recycle bin.

      The recycle bin must be completely empty before database upgrade.

  RECOMMENDED ACTIONS
  ===================
  2.  Update NUMERIC INITIALIZATION PARAMETERS to meet estimated minimums.
      This action may be done now or when starting the database in upgrade mode
      using the 19 ORACLE HOME.

       Parameter                                 Currently  19 minimum
       ---------                                 ---------  ------------------
      *memory_target                             734003200          1266679808

      The database upgrade process requires certain initialization parameters
      to meet minimum values.  The Oracle upgrade process itself has minimum
      values which may be higher and are marked with an asterisk.  After
      upgrading, those asterisked parameter values may be reset if needed.

  3.  Ensure there is adequate tablespace for the upgrade.

                                               Auto      Min Size
      Tablespace                      Size     Extend    For Upgrade  Action
      ----------                   ----------  --------  -----------  --------
      UNDOTBS1                         300 MB  DISABLED       414 MB  Extend

      Tablespaces that are not AUTOEXTEND must have sufficient space for the
      upgrade process.  Minimum sizes are estimates.
      If an AUTOEXTEND tablespace is listed above, it is because datafile
      maximum size is limited and has to be increased to meet upgrade process
      requirements.
4.  Perform one of the following:
     1) Expire user accounts that use only the old 10G password version and
    follow the procedure recommended in Oracle Database Upgrade Guide under
    the section entitled, "Checking for Accounts Using Case-Insensitive
    Password Version".
     2) Explicitly set SQLNET.ALLOWED_LOGON_VERSION_SERVER in the 19
    SQLNET.ORA to a non-Exclusive Mode value, such as "11". (This is a short
    term approach and is not recommended because it will retain known
    security risks associated with the 10G password version.)

    Your database system has at least one account with only the 10G password
    version (see the PASSWORD_VERSIONS column of DBA_USERS).

    Starting with Oracle Database release 12.2.0.1, Exclusive Mode is the new
    default password-based authentication mode. All Exclusive Mode
    login/authentication attempts will fail for preexisting user accounts
    which only have the 10G password version and neither the 11G or 12C
    password version (see DBA_USERS.PASSWORD_VERSIONS.) For more information,
    refer to "Understanding Password Case Sensitivity and Upgrades" in the
    Oracle Database Upgrade Guide.

5.  Upgrade Oracle Application Express (APEX) manually before the database
    upgrade.

    The database contains APEX version 4.2.5.00.08. Upgrade APEX to at least
    version 18.2.0.00.12.

    Starting with Oracle Database Release 18, APEX is not upgraded
    automatically as part of the database upgrade. Refer to My Oracle Support
    Note 1088970.1 for information about APEX installation and upgrades.

6.  Remove the SEC_CASE_SENSITIVE_LOGON instance initialization parameter
    setting, to configure your system to use case sensitive password
    authentication by default.

    Your database system is configured to enforce case insensitive password
    authentication (the SEC_CASE_SENSITIVE_LOGON instance initialization
    parameter setting is FALSE).

    Starting with Oracle Database release 12.2, Exclusive Mode is the default
    password-based authentication mode. Case insensitive password
    authentication is not supported in Exclusive Mode. If your system needs
    to use case insensitive password authentication, Exclusive Mode must be
    switched off prior to the upgrade. See the Network Reference Manual
    chapter about the SQLNET.ORA parameter
    SQLNET.ALLOWED_LOGON_VERSION_SERVER for more details on Exclusive Mode.

7.  If an auto-login Oracle Transparent Data Encryption (TDE) Keystore is
    correctly set up, no action needs to be taken. Otherwise, before starting
    up the database in upgrade mode in the new Oracle Database Oracle Home,
    either open the TDE Keystore, or ensure that an auto-login TDE Keystore
    is configured for the system.  If errors are seen while the database
    upgrade is running because the TDE Keystore is closed, then open the TDE
    Keystore and resume the upgrade (see "catctl.pl -R").  It may be
    necessary to open the TDE Keystore as the upgrade progresses in a non-CDB
    or CDB (e.g., in CDB$ROOT and PDB) if no auto-login TDE Keystore has been
    configured, as the upgrade process can shutdown and startup the
    database.

    The database is using TDE.  The database upgrade process can involve
    operations (certain SQL statements and/or database startups) that need to
    access the encryption key.

    If Oracle Transparent Data Encryption (TDE) is in use, the database
    system must have access to its Oracle Transparent Data Encryption Master
    Encryption Key during database upgrade.  For more information on
    configuring Transparent Data Encryption, refer to the 12.1 Oracle
    Database Advanced Security Guide, Section 3: Configuring Transparent Data
    Encryption.

8.  Review and remove any unnecessary HIDDEN/UNDERSCORE parameters.

    The database contains the following initialization parameters whose name
    begins with an underscore:

    _optimizer_aggr_groupby_elim
    _optimizer_reduce_groupby_key

    Remove hidden parameters before database upgrade unless your application
    vendors and/or Oracle Support state differently.  Changes will need to be
    made in the pfile/spfile.

9.  Review and remove any unnecessary EVENTS.

    The database contains events.

    There are events set that should be removed before upgrade, unless your
    application vendors and/or Oracle Support state differently.  Changes
    will need to be made in the pfile/spfile.

10. (AUTOFIXUP) Gather stale data dictionary statistics prior to database
    upgrade in off-peak time using:

      EXECUTE DBMS_STATS.GATHER_DICTIONARY_STATS;

    Dictionary statistics do not exist or are stale (not up-to-date).

    Dictionary statistics help the Oracle optimizer find efficient SQL
    execution plans and are essential for proper upgrade timing. Oracle
    recommends gathering dictionary statistics in the last 24 hours before
    database upgrade.

    For information on managing optimizer statistics, refer to the 12.1.0.2
    Oracle Database SQL Tuning Guide.

================
11. Consider removing the following deprecated initialization parameters.

    Parameter
    ---------
    sec_case_sensitive_logon

    These deprecated parameters probably will be obsolete in a future release.

12. Check the Oracle Backup and Recovery User's Guide for information on how
    to manage an RMAN recovery catalog schema.

    If you are using a version of the recovery catalog schema that is older
    than that required by the RMAN client version, then you must upgrade the
    catalog schema.

    It is good practice to have the catalog schema the same or higher version
    than the RMAN client version you are using.

ORACLE GENERATED FIXUP SCRIPT
=============================
All of the issues in database DBATST
which are identified above as BEFORE UPGRADE "(AUTOFIXUP)" can be resolved by
executing the following

  SQL>@/orahome/u01/app/oracle/cfgtoollogs/DBATST/preupgrade/preupgrade_fixups.sql
  

===========
TER UPGRADE
===========

REQUIRED ACTIONS
================
None

RECOMMENDED ACTIONS
===================
13. (AUTOFIXUP) If you use the -T option for the database upgrade, then run
    $ORACLE_HOME/rdbms/admin/utluptabdata.sql after the upgrade is complete,
    to VALIDATE and UPGRADE any user tables affected by changes to
    Oracle-Maintained types.

    There are user tables dependent on Oracle-Maintained object types.

    If the -T option is used to set user tablespaces to READ ONLY during the
    upgrade, user tables in those tablespaces, that are dependent on
    Oracle-Maintained types, will not be automatically upgraded. If a type is
    evolved during the upgrade, any dependent tables need to be re-validated
    and upgraded to the latest type version AFTER the database upgrade
    completes.

14. Upgrade the database time zone file using the DBMS_DST package.

    The database is using time zone file version 19 and the target 19 release
    ships with time zone file version 32.

    Oracle recommends upgrading to the desired (latest) version of the time
    zone file.  For more information, refer to "Upgrading the Time Zone File
    and Timestamp with Time Zone Data" in the 19 Oracle Database
    Globalization Support Guide.

15. Recreate directory objects to remove any symbolic links from directory
    paths.  To identify paths that contain symbolic links before upgrading,
    use OS commands like UNIX file or WINDOWS dir.  After upgrading, run
    $ORACLE_HOME/rdbms/admin/utldirsymlink.sql to identify directory objects
    with symbolic links in the path.

    Found 2 user directory objects to be checked: XTTS_DIROBJ_DPDIR_41183,
    XTTS_DIROBJ_DPDIR_76069.

    Starting in Release 18c, symbolic links are not allowed in directory
    object paths used with BFILE data types, the UTL_FILE package, or
    external tables.

16. (AUTOFIXUP) Gather dictionary statistics after the upgrade using the
    command:

      EXECUTE DBMS_STATS.GATHER_DICTIONARY_STATS;

    Oracle recommends gathering dictionary statistics after upgrade.

    Dictionary statistics provide essential information to the Oracle
    optimizer to help it find efficient SQL execution plans. After a database
    upgrade, statistics need to be re-gathered as there can now be tables
    that have significantly changed during the upgrade or new tables that do
    not have statistics gathered yet.

17. Gather statistics on fixed objects after the upgrade and when there is a
    representative workload on the system using the command:

      EXECUTE DBMS_STATS.GATHER_FIXED_OBJECTS_STATS;

    This recommendation is given for all preupgrade runs.

    Fixed object statistics provide essential information to the Oracle
    optimizer to help it find efficient SQL execution plans.  Those
    statistics are specific to the Oracle Database release that generates
    them, and can be stale upon database upgrade.

    For information on managing optimizer statistics, refer to the 12.1.0.2
    Oracle Database SQL Tuning Guide.

ORACLE GENERATED FIXUP SCRIPT
=============================
All of the issues in database DBATST
which are identified above as AFTER UPGRADE "(AUTOFIXUP)" can be resolved by
executing the following

  SQL>@/orahome/u01/app/oracle/cfgtoollogs/DBATST/preupgrade/postupgrade_fixups.sql
  




2.	execute pre-fixups

sqlplus / as sysdba

@/orahome/u01/app/oracle/cfgtoollogs/DBATST/preupgrade/preupgrade_fixups.sql

Preup                             Preupgrade
Action                            Issue Is
Number  Preupgrade Check Name     Remedied    Further DBA Action
------  ------------------------  ----------  --------------------------------
    1.  purge_recyclebin          YES         None.
    2.  parameter_min_val         NO          Manual fixup recommended.
    3.  tablespaces               NO          Manual fixup recommended.
    4.  exclusive_mode_auth       NO          Manual fixup recommended.
    5.  apex_manual_upgrade       NO          Manual fixup recommended.
    6.  case_insensitive_auth     NO          Manual fixup recommended.
    7.  tde_in_use                NO          Manual fixup recommended.
    8.  hidden_params             NO          Informational only.
                                              Further action is optional.
    9.  underscore_events         NO          Informational only.
                                              Further action is optional.
   10.  dictionary_stats          YES         None.
   11.  parameter_deprecated      NO          Informational only.
                                              Further action is optional.
   12.  rman_recovery_version     NO          Informational only.
                                              Further action is optional.





alter system set memory_max_target=1300M scope=spfile; 
alter system set memory_target=1300M scope=spfile; 

## Remove following parameter: sec_case_sensitive_logon


ALTER DATABASE
DATAFILE '/u08/oracle/DBATST/rbs/undrbs01.dbf' RESIZE 500M
/


!! Make sure SYSAUX have free space
cd /orahome/u01/app/oracle/product/19.8.0/db_1/apex
@apexins SYSAUX SYSAUX TEMP /i/

6.	Drop old APEX schema
sqlplus>  drop user apex_040200 cascade; 


exec sys.validate_apex
@apxremov.sql

select USERNAME from DBA_USERS where ( PASSWORD_VERSIONS = '10G ' or PASSWORD_VERSIONS = '10G HTTP ') and USERNAME <> 'ANONYMOUS';

USERNAME

DMDV01
DRQA01
DMQA01
DRDV01
DBCMS



set echo on
ALTER PROFILE "AETNA_SERVICE_ACCOUNT_PROFILE" LIMIT PASSWORD_REUSE_MAX UNLIMITED PASSWORD_REUSE_TIME UNLIMITED;
alter user dbcms identified by VALUES 'S:8406389178114D80367B21E95B64D166500DFC0F6CB00D8B09A116F8385F;T:D216BD1BE9C8187C66D822B415C81B0A3EA8CCDAFB650FED84604EF2B20A498C0C7A943AF46F4EDD0368ADFEA689586248997C4737B11A6A1F682430DF6F7771065A190AACEA56C69CBE084454EC87C9;BBEE1F9B3A94B3CF';
ALTER PROFILE AETNA_SERVICE_ACCOUNT_PROFILE LIMIT PASSWORD_REUSE_MAX 6 PASSWORD_REUSE_TIME 365;
spool off

Fix others manually after upgrade.


!! TDE wallet location
select * from v$encryption_wallet;

/orahome/u01/app/oracle/admin/DBATST/wallet
      



11.	Copy password file, spfile and DG config files(if in use)  to new dbs directory
TSTASM18> cd $DBS
TSTASM18> cp *${ORACLE_SID}* $ORACLE_BASE/product/<upgrade version>/db_1/dbs


cp *${ORACLE_SID}* /orahome/u01/app/oracle/product/19.8.0/db_1/dbs


12.	Copy listener.ora and tnsnames.ora to new network/admin directory, edit listener.ora to point to 18c oracle home

cd $ORACLE_HOME/network/admin
 cp tnsnames.ora /orahome/u01/app/oracle/product/19.8.0/db_1/network/admin/tnsnames.ora
TSTASM18> cp listener.ora /orahome/u01/app/oracle/product/19.8.0/db_1/network/admin/listener.ora

vi /orahome/u01/app/oracle/product/19.8.0/db_1/network/admin/listener.ora


shutdown immediate

lsnrctl stop DBATST

13.	Update oratab to add ${ORACLE_SID}:/orahome/u01/app/oracle/product/<upgrade version>/db_1:N        and source environment


. $SETUPENV DBATST

sqlplus / as sysdba

startup upgrade

exit

cd /u27/app/upgrades/19c_upgrades

dbupgrade -d /orahome/u01/app/oracle/product/19.8.0/db_1/rdbms/admin -l /u27/app/upgrades/19c_upgrades

## Open new SSH
cd /u27/app/upgrades/19c_upgrades
tail -f catupgrd0.log


16.	 Rename the upgrade summary log to contain the database name.

cd /u27/app/upgrades/19c_upgrades
 mv upg_summary.logDBATST_upg_summary.log DBATST_upg_summary.log

sqlplus / as sysdba

shutdown immediate

startup

exit

lsnrctl start DBATST



20.	 Execute Post fixup script
sqlplus / as sysdba

SQL> @/orahome/u01/app/oracle/cfgtoollogs/DBATST/preupgrade/postupgrade_fixups.sql


21.	 Upgrade RMAN catalog
 rmanc

or

rman

connect target /

connect catalog DBATST/DBATSTnamr@RCATDEV


upgrade catalog;


22. Upgrade Time zone file
a.	Execute utlz_countstats.sql  to get optimizer statistics showing num_rows of all the tables having TIMESTAMP WITH TIME ZONE (TSTZ) data.
sqlplus / as sysdba

@?/rdbms/admin/utltz_countstats.sql



b.	Optionally purge scheduler logs and stats history, we are choosing to keep both
 exec dbms_schedule.purge_log;
 exec dbms_stats.alter_stats_history_retention(0);
 exec dbms_stats.purge_stats(systimestamp);
 exec dbms_stats.alter_stats_history_retention(31);

c.	Execute Timezone upgrade
sqlplus / as sysdba

cd /u27/app/upgrades/19c_upgrades
 spool ${ORACLE_SID}_utltz_upg_check.log
 @?/rdbms/admin/utltz_upg_check.sql
 spool off

spool ${ORACLE_SID}_utltz_upg_apply.log
 @?/rdbms/admin/utltz_upg_apply.sql

spool off
